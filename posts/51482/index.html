<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>mysql学习笔记 | GXBLOGS</title><meta name="author" content="ggw &amp; xpl"><meta name="copyright" content="ggw &amp; xpl"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="学习资源： 黑马程序员 MySQL数据库入门到精通，从mysql安装到mysql高级、mysql优化全囊括_哔哩哔哩_bilibili 29:57:49 高频 SQL 50 题（基础版） - 学习计划 - 力扣（LeetCode）全球极客挚爱的技术成长平台  基础篇 1. 概述  相关概念     名称 全称 简称     数据库 存储数据的仓库，数据是有组织的进行存储 DataBase（DB）">
<meta property="og:type" content="article">
<meta property="og:title" content="mysql学习笔记">
<meta property="og:url" content="https://gxblogs.com/posts/51482/index.html">
<meta property="og:site_name" content="GXBLOGS">
<meta property="og:description" content="学习资源： 黑马程序员 MySQL数据库入门到精通，从mysql安装到mysql高级、mysql优化全囊括_哔哩哔哩_bilibili 29:57:49 高频 SQL 50 题（基础版） - 学习计划 - 力扣（LeetCode）全球极客挚爱的技术成长平台  基础篇 1. 概述  相关概念     名称 全称 简称     数据库 存储数据的仓库，数据是有组织的进行存储 DataBase（DB）">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/ggw2021/images@main/blogs/Snipaste_2024-04-09_13-37-59.png">
<meta property="article:published_time" content="2024-04-09T07:54:07.832Z">
<meta property="article:modified_time" content="2024-07-12T08:30:21.932Z">
<meta property="article:author" content="ggw &amp; xpl">
<meta property="article:tag" content="数据库">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/ggw2021/images@main/blogs/Snipaste_2024-04-09_13-37-59.png"><link rel="shortcut icon" href="/static/imgs/paipai.ico"><link rel="canonical" href="https://gxblogs.com/posts/51482/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":300},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":200,"languages":{"author":"作者: ggw & xpl","link":"链接: ","source":"来源: GXBLOGS","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#1f1f1f","position":"bottom-left"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'mysql学习笔记',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-07-12 16:30:21'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="/css/ggwsettings.css"><link rel="stylesheet" href="/css/nav_menu.css"><link rel="stylesheet" href="/css/highlight/Kimbiedark.css"><script src="/css/else/echarts.min.js"></script><script src="/css/else/wow.min.js"></script><script type="text/javascript" src="/css/else/echarts-gl.min.js"></script><script src="/css/else/pace.min.js"></script><meta name="generator" content="Hexo 6.3.0"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/static/imgs/loading.gif" data-original="/static/imgs/touxiang.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">49</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">21</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">5</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 文章</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 链接</span></a></div><div class="menus_item"><a class="site-page" href="/comments/"><i class="fa-fw fa fa-comments"></i><span> 留言板</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://cdn.jsdelivr.net/gh/ggw2021/images@main/blogs/Snipaste_2024-04-09_13-37-59.png')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">GXBLOGS</a></span><div id="menus"></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 文章</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 链接</span></a></div><div class="menus_item"><a class="site-page" href="/comments/"><i class="fa-fw fa fa-comments"></i><span> 留言板</span></a></div></div><div id="nav-right"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i></a></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">mysql学习笔记</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2024-04-09T07:54:07.832Z" title="发表于 2024-04-09 15:54:07">2024-04-09</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-07-12T08:30:21.932Z" title="更新于 2024-07-12 16:30:21">2024-07-12</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E7%AC%94%E8%AE%B0/">笔记</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">49.3k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>195分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-commentcount"><i class="far fa-comments fa-fw post-meta-icon"></i><span class="post-meta-label">评论数:</span><a href="/posts/51482/#post-comment" itemprop="discussionUrl"><span class="valine-comment-count" data-xid="/posts/51482/" itemprop="commentCount"><i class="fa-solid fa-spinner fa-spin"></i></span></a></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><blockquote>
<p>学习资源：</p>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1Kr4y1i7ru/?spm_id_from=333.337.search-card.all.click&amp;vd_source=eca8bef44f4d5efc79f226fa688a5064">黑马程序员 MySQL数据库入门到精通，从mysql安装到mysql高级、mysql优化全囊括_哔哩哔哩_bilibili</a> 29:57:49</p>
<p><a target="_blank" rel="noopener" href="https://leetcode.cn/studyplan/sql-free-50/">高频 SQL 50 题（基础版） - 学习计划 - 力扣（LeetCode）全球极客挚爱的技术成长平台</a></p>
</blockquote>
<h2 id="基础篇">基础篇</h2>
<h3 id="1-概述">1. 概述</h3>
<ul>
<li><strong><u>相关概念</u></strong></li>
</ul>
<table>
<thead>
<tr>
<th>名称</th>
<th>全称</th>
<th>简称</th>
</tr>
</thead>
<tbody>
<tr>
<td>数据库</td>
<td>存储数据的仓库，数据是有组织的进行存储</td>
<td><strong>D</strong>ata<strong>B</strong>ase（DB）</td>
</tr>
<tr>
<td>数据库管理系统</td>
<td>操纵和管理数据库的大型软件</td>
<td><strong>D</strong>ata<strong>B</strong>ase <strong>M</strong>anagement <strong>S</strong>ystem (DBMS)</td>
</tr>
<tr>
<td>SQL</td>
<td>操作关系型数据库的编程语言，定义了一套操作关系型数据库统一标准</td>
<td><strong>S</strong>tructured <strong>Q</strong>uery <strong>L</strong>anguage (SQL)</td>
</tr>
</tbody>
</table>
<p>而目前主流的关系型数据库管理系统的市场占有率排名如下（2022）：</p>
<ol>
<li>Oracle：<u>大型</u>的<strong>收费</strong>数据库，Oracle公司产品，价格昂贵。</li>
<li>MySQL：开源<strong>免费</strong>的<u>中小型</u>数据库，后来Sun公司收购了MySQL，而Oracle又收购了Sun公司。目前Oracle推出了收费版本的MySQL，也提供了免费的社区版本。</li>
<li>SQL Server：Microsoft 公司推出的<strong>收费</strong>的<u>中型</u>数据库，C#、.net等语言常用。</li>
<li>PostgreSQL：开源<strong>免费</strong>的<u>中小型</u>数据库。</li>
<li>DB2：IBM公司的<u>大型</u><strong>收费</strong>数据库产品。</li>
<li>SQLLite：嵌入式的微型数据库。Android内置的数据库采用的就是该数据库。</li>
<li>MariaDB：开源<strong>免费</strong>的<u>中小型</u>数据库。是MySQL数据库的另外一个分支、另外一个衍生产品，与MySQL数据库有很好的兼容性。</li>
</ol>
<p>而不论我们使用的是上面的哪一个关系型数据库，最终在操作时，都是使用SQL语言来进行统一操作，因为我们前面讲到SQL语言，是操作关系型数据库的 <strong>统一标准</strong> 。所以即使我们现在学习的是MySQL，假如我们以后到了公司，使用的是别的关系型数据库，如：Oracle、DB2、SQLServer，也完全不用担心，因为操作的方式都是一致的。</p>
<hr>
<br>
<ul>
<li><strong>版本</strong></li>
</ul>
<p>官方： <a target="_blank" rel="noopener" href="https://www.mysql.com/">https://www.mysql.com/</a></p>
<p>MySQL官方提供了两种不同的版本：</p>
<ul>
<li>社区版本（MySQL Community Server）
<ul>
<li>免费，</li>
<li>MySQL不提供任何技术支持</li>
</ul>
</li>
<li>商业版本（MySQL Enterprise Edition）
<ul>
<li>收费，可以使用30天，</li>
<li>官方提供技术支持</li>
</ul>
</li>
</ul>
<hr>
<br>
<ul>
<li><strong><u>客户端连接</u></strong></li>
</ul>
<p><strong>方式一</strong>：使用MySQL提供的客户端命令行工具</p>
<p><img src="/static/imgs/loading.gif" data-original="https://cdn.jsdelivr.net/gh/ggw2021/images@main/blogs/Snipaste_2024-04-09_13-58-59.png" alt=""></p>
<br>
<p><strong>方式二</strong>：使用系统自带的命令行工具执行指令</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">mysql [-h 127.0.0.1] [-P 3306] -u root -p<br></code></pre></td></tr></table></figure>
<p>参数：</p>
<ul>
<li><code>-h</code> : MySQL服务所在的主机IP</li>
<li><code>-P</code> : MySQL服务端口号， 默认3306</li>
<li><code>-u</code> : MySQL数据库用户名</li>
<li><code>-p</code> ： MySQL数据库用户名对应的密码</li>
</ul>
<p><code>[]</code>内为可选参数，如果需要连接远程的MySQL，需要加上这两个参数来指定远程主机IP、端口，如果连接本地的MySQL，则无需指定这两个参数。</p>
<p>eg：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">C:\Users\GGW_2021&gt;mysql -u root -p<br>Enter password: ******<br>Welcome to the MySQL monitor.  Commands end with ; or \g.<br>Your MySQL connection id is 8<br>Server version: 8.0.29 MySQL Community Server - GPL<br><br>Copyright (c) 2000, 2022, Oracle and/or its affiliates.<br><br>Oracle is a registered trademark of Oracle Corporation and/or its<br>affiliates. Other names may be trademarks of their respective<br>owners.<br><br>Type &#x27;help;&#x27; or &#x27;\h&#x27; for help. Type &#x27;\c&#x27; to clear the current input statement.<br><br>mysql&gt;<br></code></pre></td></tr></table></figure>
<blockquote>
<p>注意： 使用这种方式进行连接时，需要安装完毕后配置PATH环境变量。</p>
</blockquote>
<hr>
<br>
<ul>
<li><strong><u>关系型数据库（RDBMS）</u></strong></li>
</ul>
<p><strong>概念</strong>：建立在关系模型基础上，由多张相互连接的二维表组成的数据库。</p>
<p>而所谓二维表，指的是由行和列组成的表，如下图（就类似于Excel表格数据，有表头、有列、有行，还可以通过一列关联另外一个表格中的某一列数据）。我们之前提到的MySQL、Oracle、DB2、SQLServer这些都是属于关系型数据库，里面都是基于二维表存储数据的。简单说，<u>基于二维表存储数据的数据库就成为关系型数据库，不是基于二维表存储数据的数据库，就是非关系型数据库</u>。</p>
<p><img src="/static/imgs/loading.gif" data-original="https://cdn.jsdelivr.net/gh/ggw2021/images@main/blogs/Snipaste_2024-04-09_14-08-44.png" alt=""></p>
<p>特点：<br>
A. 使用表存储数据，格式统一，便于维护。<br>
B. 使用SQL语言操作，标准统一，使用方便。</p>
<br>
<p><strong>数据模型</strong>:</p>
<p>MySQL是关系型数据库，是基于二维表进行数据存储的，具体的结构图下:</p>
<p><img src="/static/imgs/loading.gif" data-original="https://cdn.jsdelivr.net/gh/ggw2021/images@main/blogs/Snipaste_2024-04-09_14-09-58.png" alt=""></p>
<ul>
<li>我们可以通过MySQL客户端连接数据库管理系统DBMS，然后通过DBMS操作数据库。</li>
<li>可以使用SQL语句，通过数据库管理系统操作数据库，以及操作数据库中的表结构及数据。</li>
<li>一个数据库服务器中可以创建多个数据库，一个数据库中也可以包含多张表，而一张表中又可以包含多行记录。</li>
</ul>
<hr>
<p><br><br><br></p>
<h3 id="2-SQL">2. SQL</h3>
<blockquote>
<p>全称 <strong>S</strong>tructured <strong>Q</strong>uery <strong>L</strong>anguage，结构化查询语言。操作关系型数据库的编程语言，定义了一套操作关系型数据库统一标准 。</p>
</blockquote>
<h4 id="2-1-SQL通用语法以及分类">2.1 SQL通用语法以及分类</h4>
<p>在学习具体的SQL语句之前，先来了解一下SQL语言的同于语法。</p>
<p><strong>1).</strong> SQL语句可以单行或多行书写，以分号<code>;</code>结尾。</p>
<p><strong>2).</strong> SQL语句可以使用 空格 / 缩进 来增强语句的可读性。</p>
<p><strong>3).</strong> MySQL数据库的SQL语句<u>不区分大小写</u>，<u>关键字建议使用大写</u>。</p>
<p><strong>4).</strong> 注释：</p>
<ul>
<li>
<p>单行注释：</p>
  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">-- 注释内容  <br># 注释内容<br></code></pre></td></tr></table></figure>
</li>
<li>
<p>多行注释：</p>
  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">/* <br>    注释内容 <br>*/  <br></code></pre></td></tr></table></figure>
</li>
</ul>
<br>
<p>SQL语句，根据其功能，主要分为四类：DDL、DML、DQL、DCL。</p>
<table>
<thead>
<tr>
<th style="text-align:left">分 类</th>
<th style="text-align:left">全称</th>
<th style="text-align:left">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">DDL</td>
<td style="text-align:left">Data Definition Language</td>
<td style="text-align:left">数据定义语言，用来<u>定义</u>数据库对象(数据库，表，字段)</td>
</tr>
<tr>
<td style="text-align:left">DML</td>
<td style="text-align:left">Data Manipulation Language</td>
<td style="text-align:left">数据操作语言，用来对数据库表中的数据进行<u>增删改</u></td>
</tr>
<tr>
<td style="text-align:left">DQL</td>
<td style="text-align:left">Data Query Language</td>
<td style="text-align:left">数据查询语言，用来<u>查询</u>数据库中表的记录</td>
</tr>
<tr>
<td style="text-align:left">DCL</td>
<td style="text-align:left">Data Control Language</td>
<td style="text-align:left">数据控制语言，用来<u>创建</u>数据库用户、<u>控制</u>数据库的访问权限</td>
</tr>
</tbody>
</table>
<hr>
<p><br><br><br></p>
<h4 id="2-2-DDL">2.2 DDL</h4>
<blockquote>
<p>Data Definition Language，数据定义语言，用来定义数据库对象(数据库，表，字段) 。</p>
</blockquote>
<ul>
<li><strong><u>数据库操作</u></strong></li>
</ul>
<p><strong>1、</strong> 查询所有数据库</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">show</span> databases;<br></code></pre></td></tr></table></figure>
<br>
<p><strong>2、</strong> 查询当前数据库</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> database() ;<br></code></pre></td></tr></table></figure>
<details class="toggle" style="border: 1px solid  #edf4ee"><summary class="toggle-button" style="background-color:  #edf4ee;color:  #17181a">查看案例 </summary><div class="toggle-content"><p><code>SELECT DATABASE();</code>这条语句的作用是返回当前连接的默认数据库的名称。如果没有默认数据库，它将返回<code>NULL</code>。这可以在多数据库环境中快速确认当前的操作上下文，确保数据库查询或操作被正确地应用到预期的数据库上。<u>简而言之，它用来查看当前你正在哪个数据库下操作。</u></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">mysql&gt; use my_db_01<br>Database changed<br>mysql&gt; select database()<br>+------------+<br>| database() |<br>+------------+<br>| my_db_01   |<br>+------------+<br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure></div></details>
<br>
<p><strong>3、</strong> 创建数据库</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">create</span> database [ if <span class="hljs-keyword">not</span> <span class="hljs-keyword">exists</span> ] 数据库名 [ <span class="hljs-keyword">default</span> charset 字符集 ] [ <span class="hljs-keyword">collate</span> 排序规则 ] ;<br></code></pre></td></tr></table></figure>
<details class="toggle" style="border: 1px solid  #edf4ee"><summary class="toggle-button" style="background-color:  #edf4ee;color:  #17181a">查看案例 </summary><div class="toggle-content"><p><strong>A.</strong> 创建一个itcast数据库, 使用数据库默认的字符集。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">create</span> database itcast;<br></code></pre></td></tr></table></figure>
<p>在同一个数据库服务器中，不能创建两个名称相同的数据库，否则将会报错。<br>
可以通过 <code>if not exists</code> 参数来解决这个问题，数据库不存在, 则创建该数据库，如果存在，则不创建。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">create</span> database if <span class="hljs-keyword">not</span> extists itcast;<br></code></pre></td></tr></table></figure>
<p><strong>B.</strong> 创建一个itheima数据库，并且指定字符集。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">create</span> database itheima <span class="hljs-keyword">default</span> charset utf8mb4;<br></code></pre></td></tr></table></figure>
</div></details>
<br>
<p><strong>4、</strong> 删除数据库</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">drop</span> database [ if <span class="hljs-keyword">exists</span> ] 数据库名;<br></code></pre></td></tr></table></figure>
<p>如果删除一个不存在的数据库，将会报错。此时，可以加上参数 <code>if exists</code> ，如果数据库存在，再执行删除，否则不执行删除。</p>
<br>  
<p><strong>5、</strong> 切换数据库</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">use 数据库名;<br></code></pre></td></tr></table></figure>
<p>我们要操作某一个数据库下的表时，就需要通过该指令，切换到对应的数据库下，否则是不能操作的。比如，切换到itcast数据库，执行如下SQL：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">use itcast;<br></code></pre></td></tr></table></figure>
<hr>
<br>
<ul>
<li><strong><u>表操作</u></strong></li>
</ul>
<ol>
<li><strong>表操作-查询创建</strong></li>
</ol>
<p><strong>1).</strong> 查询当前数据库所有表</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">show</span> tables;<br></code></pre></td></tr></table></figure>
<p>比如,我们可以切换到sys这个系统数据库,并查看系统数据库中的所有表结构。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql">use sys;<br><span class="hljs-keyword">show</span> tables;<br></code></pre></td></tr></table></figure>
<br>
<p><strong>2).</strong> 查看指定表结构</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">desc</span> 表名;<br></code></pre></td></tr></table></figure>
<p>通过这条指令，我们可以查看到指定表的字段，字段的类型、是否可以为NULL，是否存在默认值等信息。</p>
<details class="toggle" style="border: 1px solid  #edf4ee"><summary class="toggle-button" style="background-color:  #edf4ee;color:  #17181a">查看案例 </summary><div class="toggle-content"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">mysql&gt; desc tb_user;<br>+--------+-------------+------+-----+---------+-------+<br>| Field  | Type        | Null | Key | Default | Extra |<br>+--------+-------------+------+-----+---------+-------+<br>| id     | int         | YES  |     | NULL    |       |<br>| name   | varchar(50) | YES  |     | NULL    |       |<br>| age    | int         | YES  |     | NULL    |       |<br>| gender | varchar(1)  | YES  |     | NULL    |       |<br>+--------+-------------+------+-----+---------+-------+<br>4 rows in set (0.00 sec)<br><br>mysql&gt;<br></code></pre></td></tr></table></figure></div></details>
<br>
<p><strong>3).</strong> 查询指定表的建表语句</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">show</span> <span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> 表名;<br></code></pre></td></tr></table></figure>
<details class="toggle" style="border: 1px solid  #edf4ee"><summary class="toggle-button" style="background-color:  #edf4ee;color:  #17181a">查看案例 </summary><div class="toggle-content"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">mysql&gt; show create table tb_user;<br>+---------+----------------------------------------------------------------------------------------------------------------<br>---------------------------------------------------------------------------------------------------------------------------<br>----------------------------------------+<br>| Table   | Create Table<br><br>                                        |<br>+---------+----------------------------------------------------------------------------------------------------------------<br>---------------------------------------------------------------------------------------------------------------------------<br>----------------------------------------+<br>| tb_user | CREATE TABLE `tb_user` (<br>  `id` int DEFAULT NULL COMMENT &#x27;编号&#x27;,<br>  `name` varchar(50) DEFAULT NULL COMMENT &#x27;姓名&#x27;,<br>  `age` int DEFAULT NULL COMMENT &#x27;年龄&#x27;,<br>  `gender` varchar(1) DEFAULT NULL COMMENT &#x27;性别&#x27;<br>) ENGINE=InnoDB DEFAULT CHARSET=utf8mb3 COMMENT=&#x27;用户表&#x27;            |<br>+---------+----------------------------------------------------------------------------------------------------------------<br>---------------------------------------------------------------------------------------------------------------------------<br>----------------------------------------+<br>1 row in set (0.00 sec)<br><br>mysql&gt;<br></code></pre></td></tr></table></figure></div></details>
<p>通过这条指令，主要是用来查看建表语句的，而有部分参数我们在创建表的时候，并未指定也会查询到，因为这部分是数据库的默认值，如：存储引擎、字符集等</p>
<br>
<p><strong>4).</strong> 创建表结构</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> 表名(<br>    字段<span class="hljs-number">1</span> 字段<span class="hljs-number">1</span>类型 [COMMENT 字段<span class="hljs-number">1</span>注释 ],<br>    字段<span class="hljs-number">2</span> 字段<span class="hljs-number">2</span>类型 [COMMENT 字段<span class="hljs-number">2</span>注释 ],<br>    字段<span class="hljs-number">3</span> 字段<span class="hljs-number">3</span>类型 [COMMENT 字段<span class="hljs-number">3</span>注释 ],<br>    ......<br>    字段n 字段n类型 [COMMENT 字段n注释 ]<br>) [ COMMENT 表注释 ] ;<br></code></pre></td></tr></table></figure>
<details class="toggle" style="border: 1px solid  #edf4ee"><summary class="toggle-button" style="background-color:  #edf4ee;color:  #17181a">查看案例 </summary><div class="toggle-content"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">mysql&gt; create table tb_user (<br>    -&gt;     id int comment &#x27;编号&#x27;,<br>    -&gt;     name varchar(50) comment &#x27;姓名&#x27;,<br>    -&gt;     age int comment &#x27;年龄&#x27;,<br>    -&gt;     gender varchar(1) comment &#x27;性别&#x27;<br>    -&gt; ) comment &#x27;用户表&#x27;;<br>Query OK, 0 rows affected (0.02 sec)<br><br>mysql&gt;<br></code></pre></td></tr></table></figure></div></details>
<br>
<ol start="2">
<li><strong>表操作-数据类型</strong></li>
</ol>
<p>MySQL中的数据类型有很多，主要分为三类：数值类型、字符串类型、日期时间类型。</p>
<p><strong>1).</strong> <u>数值</u>类型</p>
<table>
<thead>
<tr>
<th>类型</th>
<th>大小</th>
<th>有符号(SIGNED)范围</th>
<th>无符号(UNSIGNED)范围</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>TINYINT</td>
<td>1byte</td>
<td>(-128，127)</td>
<td>(0，255)</td>
<td>小整数值</td>
</tr>
<tr>
<td>SMALLINT</td>
<td>2bytes</td>
<td>(-32768，32767)</td>
<td>(0，65535)</td>
<td>大整数值</td>
</tr>
<tr>
<td>MEDIUMINT</td>
<td>3bytes</td>
<td>(-8388608，8388607)</td>
<td>(0，16777215)</td>
<td>大整数值</td>
</tr>
<tr>
<td>INT/INTEGER</td>
<td>4bytes</td>
<td>(-2147483648， 2147483647)</td>
<td>(0，4294967295)</td>
<td>大整数值</td>
</tr>
<tr>
<td>BIGINT</td>
<td>8bytes</td>
<td>(-2^63，2^63-1)</td>
<td>(0，2^64-1)</td>
<td>极大整数 值</td>
</tr>
<tr>
<td>FLOAT</td>
<td>4bytes</td>
<td>(-3.402823466 E+38， 3.402823466351 E+38)</td>
<td>0 和 (1.175494351 E- 38，3.402823466 E+38)</td>
<td>单精度浮 点数值</td>
</tr>
<tr>
<td>DOUBLE</td>
<td>8bytes</td>
<td>(-1.7976931348623157 E+308, 1.7976931348623157 E+308)</td>
<td>0 和 (2.2250738585072014 E-308， 1.7976931348623157 E+308)</td>
<td>双精度浮 点数值</td>
</tr>
<tr>
<td>DECIMAL</td>
<td></td>
<td>依赖于M(精度)和D(标度) 的值</td>
<td>依赖于M(精度)和D(标度)的值</td>
<td>小数值(精 确定点数)</td>
</tr>
</tbody>
</table>
<details class="toggle" style="border: 1px solid  #edf4ee"><summary class="toggle-button" style="background-color:  #edf4ee;color:  #17181a">查看案例 </summary><div class="toggle-content"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">1). 年龄字段 -- 不会出现负数, 而且人的年龄不会太大<br>age tinyint unsigned<br><br>2). 分数 -- 总分100分, 最多出现一位小数<br>score double(4,1)<br></code></pre></td></tr></table></figure></div></details>
<br>
<p><strong>2).</strong> <u>字符串</u>类型</p>
<table>
<thead>
<tr>
<th>类型</th>
<th>大小</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>CHAR</td>
<td>0-255 bytes</td>
<td>定长字符串(需要指定长度)</td>
</tr>
<tr>
<td>VARCHAR</td>
<td>0-65535 bytes</td>
<td>变长字符串(需要指定长度)</td>
</tr>
<tr>
<td>TINYBLOB</td>
<td>0-255 bytes</td>
<td>不超过255个字符的二进制数据</td>
</tr>
<tr>
<td>TINYTEXT</td>
<td>0-255 bytes</td>
<td>短文本字符串</td>
</tr>
<tr>
<td>BLOB</td>
<td>0-65 535 bytes</td>
<td>二进制形式的长文本数据</td>
</tr>
<tr>
<td>TEXT</td>
<td>0-65 535 bytes</td>
<td>长文本数据</td>
</tr>
<tr>
<td>MEDIUMBLOB</td>
<td>0-16 777 215 bytes</td>
<td>二进制形式的中等长度文本数据</td>
</tr>
<tr>
<td>MEDIUMTEXT</td>
<td>0-16 777 215 bytes</td>
<td>中等长度文本数据</td>
</tr>
<tr>
<td>LONGBLOB</td>
<td>0-4 294 967 295 bytes</td>
<td>二进制形式的极大文本数据</td>
</tr>
<tr>
<td>LONGTEXT</td>
<td>0-4 294 967 295 bytes</td>
<td>极大文本数据</td>
</tr>
</tbody>
</table>
<p>char 与 varchar 都可以描述字符串，char是定长字符串，指定长度多长，就占用多少个字符，和字段值的长度无关 。而varchar是变长字符串，指定的长度为最大占用长度 。相对来说，char的性能会更高些。</p>
<details class="toggle" style="border: 1px solid  #edf4ee"><summary class="toggle-button" style="background-color:  #edf4ee;color:  #17181a">查看案例 </summary><div class="toggle-content"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">1). 用户名 username ------&gt; 长度不定, 最长不会超过50<br>username varchar(50)<br><br>2). 性别 gender ---------&gt; 存储值, 不是男,就是女<br>gender char(1)<br><br>3). 手机号 phone --------&gt; 固定长度为11<br>phone char(11)<br></code></pre></td></tr></table></figure>
</div></details>
<br>
<p><strong>3).</strong> <u>日期时间</u>类型</p>
<table>
<thead>
<tr>
<th>类型</th>
<th>大 小</th>
<th>范围</th>
<th>格式</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>DATE</td>
<td>3</td>
<td>1000-01-01 至 9999-12-31</td>
<td>YYYY-MM-DD</td>
<td>日期值</td>
</tr>
<tr>
<td>TIME</td>
<td>3</td>
<td>-838:59:59 至 838:59:59</td>
<td>HH:MM:SS</td>
<td>时间值或持续时间</td>
</tr>
<tr>
<td>YEAR</td>
<td>1</td>
<td>1901 至 2155</td>
<td>YYYY</td>
<td>年份值</td>
</tr>
<tr>
<td>DATETIME</td>
<td>8</td>
<td>1000-01-01 00:00:00 至 9999-12-31 23:59:59</td>
<td>YYYY-MM-DD HH:MM:SS</td>
<td>混合日期和时间值</td>
</tr>
<tr>
<td>TIMESTAMP</td>
<td>4</td>
<td>1970-01-01 00:00:01 至 2038-01-19 03:14:07</td>
<td>YYYY-MM-DD HH:MM:SS</td>
<td>混合日期和时间值，时间戳</td>
</tr>
</tbody>
</table>
<details class="toggle" style="border: 1px solid  #edf4ee"><summary class="toggle-button" style="background-color:  #edf4ee;color:  #17181a">查看案例 </summary><div class="toggle-content"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">1). 生日字段 birthday<br>birthday date<br><br>2). 创建时间 createtime<br>createtime datetime<br></code></pre></td></tr></table></figure>
</div></details>
<br>
<ol start="3">
<li><strong>表操作-案例</strong></li>
</ol>
<p>设计一张员工信息表，要求如下：<br>
1.编号（纯数字）<br>
2.员工工号 (字符串类型，长度不超过10位)<br>
3.员工姓名（字符串类型，长度不超过10位）<br>
4.性别（男/女，存储一个汉字）<br>
5.年龄（正常人年龄，不可能存储负数）<br>
6.身份证号（二代身份证号均为18位，身份证中有X这样的字符）<br>
7.入职时间（取值年月日即可）</p>
<details class="toggle" style="border: 1px solid  #edf4ee"><summary class="toggle-button" style="background-color:  #edf4ee;color:  #17181a">查看答案 </summary><div class="toggle-content"><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> emp(<br>    id <span class="hljs-type">int</span> comment <span class="hljs-string">&#x27;编号&#x27;</span>,<br>    workno <span class="hljs-type">varchar</span>(<span class="hljs-number">10</span>) comment <span class="hljs-string">&#x27;工号&#x27;</span>,<br>    name <span class="hljs-type">varchar</span>(<span class="hljs-number">10</span>) comment <span class="hljs-string">&#x27;姓名&#x27;</span>,<br>    gender <span class="hljs-type">char</span>(<span class="hljs-number">1</span>) comment <span class="hljs-string">&#x27;性别&#x27;</span>,<br>    age tinyint unsigned comment <span class="hljs-string">&#x27;年龄&#x27;</span>,<br>    idcard <span class="hljs-type">char</span>(<span class="hljs-number">18</span>) comment <span class="hljs-string">&#x27;身份证号&#x27;</span>,<br>    entrydate <span class="hljs-type">date</span> comment <span class="hljs-string">&#x27;入职时间&#x27;</span><br>) comment <span class="hljs-string">&#x27;员工表&#x27;</span>;<br></code></pre></td></tr></table></figure>
<p>SQL语句编写完毕之后，就可以在MySQL的命令行中执行SQL，然后也可以通过 <code>desc</code> 指令查询表结构信息：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">mysql&gt; desc emp;<br>+-----------+------------------+------+-----+---------+-------+<br>| Field     | Type             | Null | Key | Default | Extra |<br>+-----------+------------------+------+-----+---------+-------+<br>| id        | int              | YES  |     | NULL    |       |<br>| workno    | varchar(10)      | YES  |     | NULL    |       |<br>| name      | varchar(10)      | YES  |     | NULL    |       |<br>| gender    | char(1)          | YES  |     | NULL    |       |<br>| age       | tinyint unsigned | YES  |     | NULL    |       |<br>| idcard    | char(18)         | YES  |     | NULL    |       |<br>| entrydate | date             | YES  |     | NULL    |       |<br>+-----------+------------------+------+-----+---------+-------+<br>7 rows in set (0.00 sec)<br><br>mysql&gt;<br></code></pre></td></tr></table></figure>
</div></details>
<p>表结构创建好了，里面的name字段是varchar类型，最大长度为10，也就意味着如果超过10将会报错，如果我们想修改这个字段的类型或修改字段的长度该如何操作呢？接下来再来讲解DDL语句中，如何操作表字段</p>
<br>
<ol start="4">
<li><strong>表操作-修改</strong></li>
</ol>
<p><strong>1).</strong> 添加字段</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> 表名 <span class="hljs-keyword">ADD</span> 字段名 类型 (长度) [ COMMENT 注释 ] [ 约束 ];<br></code></pre></td></tr></table></figure>
<p>案例: 为emp表增加一个新的字段”昵称”为nickname，类型为varchar(20)</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> emp <span class="hljs-keyword">ADD</span> nickname <span class="hljs-type">varchar</span>(<span class="hljs-number">20</span>) COMMENT <span class="hljs-string">&#x27;昵称&#x27;</span>;<br></code></pre></td></tr></table></figure>
<br>
<p><strong>2).</strong> 修改数据类型</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> 表名 MODIFY 字段名 新数据类型 (长度);  <br></code></pre></td></tr></table></figure>
<br>
<p><strong>3).</strong> 修改字段名和字段类型</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> 表名 CHANGE 旧字段名 新字段名 类型 (长度) [ COMMENT 注释 ] [ 约束 ];<br></code></pre></td></tr></table></figure>
<p>案例: 将emp表的nickname字段修改为username，类型为varchar(30)</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> emp CHANGE nickname username <span class="hljs-type">varchar</span>(<span class="hljs-number">30</span>) COMMENT <span class="hljs-string">&#x27;昵称&#x27;</span>;<br></code></pre></td></tr></table></figure>
<br>
<p><strong>4).</strong> 删除字段</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> 表名 <span class="hljs-keyword">DROP</span> 字段名;<br></code></pre></td></tr></table></figure>
<p>案例: 将emp表的字段username删除</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> emp <span class="hljs-keyword">DROP</span> username;<br></code></pre></td></tr></table></figure>
<br>
<p><strong>5).</strong> 修改表名</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> 表名 RENAME <span class="hljs-keyword">TO</span> 新表名;<br></code></pre></td></tr></table></figure>
<p>案例: 将emp表的表名修改为 employee</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> emp RENAME <span class="hljs-keyword">TO</span> employee;<br></code></pre></td></tr></table></figure>
<br>
<ol start="5">
<li>表操作-删除</li>
</ol>
<p><strong>1).</strong> 删除表</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">DROP</span> <span class="hljs-keyword">TABLE</span> [ IF <span class="hljs-keyword">EXISTS</span> ] 表名;<br></code></pre></td></tr></table></figure>
<p>可选项 <code>IF EXISTS</code> ，代表只有表名存在时才会删除该表，表名不存在，则不执行删除操作(如果不加该参数项，删除一张不存在的表，执行将会报错)。</p>
<p>案例: 如果tb_user表存在，则删除tb_user表</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">DROP</span> <span class="hljs-keyword">TABLE</span> IF <span class="hljs-keyword">EXISTS</span> tb_user;<br></code></pre></td></tr></table></figure>
<p><strong>2).</strong> 删除指定表, 并重新创建表</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">TRUNCATE</span> <span class="hljs-keyword">TABLE</span> 表名;<br></code></pre></td></tr></table></figure>
<blockquote>
<p>注意: 在删除表的时候，表中的全部数据也都会被删除。</p>
</blockquote>
<hr>
<p><br><br><br></p>
<h4 id="2-3-DML">2.3 DML</h4>
<blockquote>
<p>DML英文全称是Data Manipulation Language(数据操作语言)，用来对数据库中表的数据记录进行增、删、改操作。</p>
<ul>
<li>添加数据（INSERT）</li>
<li>修改数据（UPDATE）</li>
<li>删除数据（DELETE）</li>
</ul>
</blockquote>
<ul>
<li><u><strong>添加数据</strong></u></li>
</ul>
<p><strong>1).</strong> 给指定字段添加数据</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> 表名 (字段名<span class="hljs-number">1</span>, 字段名<span class="hljs-number">2</span>, ...) <span class="hljs-keyword">VALUES</span> (值<span class="hljs-number">1</span>, 值<span class="hljs-number">2</span>, ...);<br></code></pre></td></tr></table></figure>
<p>案例: 给employee表所有的字段添加数据 ；</p>
<details class="toggle" style="border: 1px solid  #edf4ee"><summary class="toggle-button" style="background-color:  #edf4ee;color:  #17181a">查看employee表结构 </summary><div class="toggle-content"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">+-----------+------------------+------+-----+---------+-------+<br>| Field     | Type             | Null | Key | Default | Extra |<br>+-----------+------------------+------+-----+---------+-------+<br>| id        | int              | YES  |     | NULL    |       |<br>| workno    | varchar(10)      | YES  |     | NULL    |       |<br>| name      | varchar(10)      | YES  |     | NULL    |       |<br>| gender    | char(1)          | YES  |     | NULL    |       |<br>| age       | tinyint unsigned | YES  |     | NULL    |       |<br>| idcard    | char(18)         | YES  |     | NULL    |       |<br>| entrydate | date             | YES  |     | NULL    |       |<br>+-----------+------------------+------+-----+---------+-------+<br></code></pre></td></tr></table></figure></div></details>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> employee(id,workno,name,gender,age,idcard,entrydate)<br><span class="hljs-keyword">values</span>(<span class="hljs-number">1</span>,<span class="hljs-string">&#x27;1&#x27;</span>,<span class="hljs-string">&#x27;Itcast&#x27;</span>,<span class="hljs-string">&#x27;男&#x27;</span>,<span class="hljs-number">10</span>,<span class="hljs-string">&#x27;123456789012345678&#x27;</span>,<span class="hljs-string">&#x27;2000-01-01&#x27;</span>);<br></code></pre></td></tr></table></figure>
<p>案例: 给employee表所有的字段添加数据执行如下SQL，添加的年龄字段值为-1。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> employee(id,workno,name,gender,age,idcard,entrydate)<br><span class="hljs-keyword">values</span>(<span class="hljs-number">1</span>,<span class="hljs-string">&#x27;1&#x27;</span>,<span class="hljs-string">&#x27;Itcast&#x27;</span>,<span class="hljs-string">&#x27;男&#x27;</span>,<span class="hljs-number">-1</span>,<span class="hljs-string">&#x27;123456789012345678&#x27;</span>,<span class="hljs-string">&#x27;2000-01-01&#x27;</span>);<br></code></pre></td></tr></table></figure>
<p>执行上述的SQL语句时，报错了，具体的错误信息如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">1264 - Out of range value for column &#x27;age&#x27; at row 1<br></code></pre></td></tr></table></figure>
<p>因为 employee 表的age字段类型为 tinyint，而且还是无符号的 unsigned ，所以取值只能在0-255 之间</p>
<br>
<p><strong>2).</strong> 给全部字段添加数据</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> 表名 <span class="hljs-keyword">VALUES</span> (值<span class="hljs-number">1</span>, 值<span class="hljs-number">2</span>, ...);<br></code></pre></td></tr></table></figure>
<p>案例：插入数据到employee表，具体的SQL如下：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> employee <span class="hljs-keyword">values</span>(<span class="hljs-number">2</span>,<span class="hljs-string">&#x27;2&#x27;</span>,<span class="hljs-string">&#x27;张无忌&#x27;</span>,<span class="hljs-string">&#x27;男&#x27;</span>,<span class="hljs-number">18</span>,<span class="hljs-string">&#x27;123456789012345670&#x27;</span>,<span class="hljs-string">&#x27;2005-01-01&#x27;</span>);<br></code></pre></td></tr></table></figure>
<br>
<p><strong>3).</strong> 批量添加数据</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> 表名 (字段名<span class="hljs-number">1</span>, 字段名<span class="hljs-number">2</span>, ...) <span class="hljs-keyword">VALUES</span> (值<span class="hljs-number">1</span>, 值<span class="hljs-number">2</span>, ...), (值<span class="hljs-number">1</span>, 值<span class="hljs-number">2</span>, ...), (值<span class="hljs-number">1</span>, 值<span class="hljs-number">2</span>, ...) ;<br></code></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> 表名 <span class="hljs-keyword">VALUES</span> (值<span class="hljs-number">1</span>, 值<span class="hljs-number">2</span>, ...), (值<span class="hljs-number">1</span>, 值<span class="hljs-number">2</span>, ...), (值<span class="hljs-number">1</span>, 值<span class="hljs-number">2</span>, ...) ;<br></code></pre></td></tr></table></figure>
<p>案例：批量插入数据到employee表，具体的SQL如下：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> employee <span class="hljs-keyword">values</span><br>(<span class="hljs-number">3</span>,<span class="hljs-string">&#x27;3&#x27;</span>,<span class="hljs-string">&#x27;韦一笑&#x27;</span>,<span class="hljs-string">&#x27;男&#x27;</span>,<span class="hljs-number">38</span>,<span class="hljs-string">&#x27;123456789012345670&#x27;</span>,<span class="hljs-string">&#x27;2005-01-01&#x27;</span>),<br>(<span class="hljs-number">4</span>,<span class="hljs-string">&#x27;4&#x27;</span>,<span class="hljs-string">&#x27;赵敏&#x27;</span>,<span class="hljs-string">&#x27;女&#x27;</span>,<span class="hljs-number">18</span>,<span class="hljs-string">&#x27;123456789012345670&#x27;</span>,<span class="hljs-string">&#x27;2005-01-01&#x27;</span>);<br></code></pre></td></tr></table></figure>
<blockquote>
<p>注意事项:</p>
<ul>
<li>插入数据时，指定的字段顺序需要与值的顺序是一一对应的</li>
<li>字符串和日期型数据应该包含在引号中。</li>
<li>插入的数据大小，应该在字段的规定范围内。</li>
</ul>
</blockquote>
<hr>
<br>
<ul>
<li><strong><u>修改数据</u></strong></li>
</ul>
<p>修改数据的具体语法为:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">UPDATE</span> 表名 <span class="hljs-keyword">SET</span> 字段名<span class="hljs-number">1</span> <span class="hljs-operator">=</span> 值<span class="hljs-number">1</span> , 字段名<span class="hljs-number">2</span> <span class="hljs-operator">=</span> 值<span class="hljs-number">2</span> , .... [ <span class="hljs-keyword">WHERE</span> 条件 ] ;<br></code></pre></td></tr></table></figure>
<p>案例:<br>
<strong>A.</strong> 修改id为1的数据，将name修改为itheima</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">update</span> employee <span class="hljs-keyword">set</span> name <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;itheima&#x27;</span> <span class="hljs-keyword">where</span> id <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;<br></code></pre></td></tr></table></figure>
<p><strong>B.</strong> 修改id为1的数据, 将name修改为小昭, gender修改为 女</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">update</span> employee <span class="hljs-keyword">set</span> name <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;小昭&#x27;</span> , gender <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;女&#x27;</span> <span class="hljs-keyword">where</span> id <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;<br></code></pre></td></tr></table></figure>
<p><strong>C.</strong> 将所有的员工入职日期修改为 2008-01-01</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">update</span> employee <span class="hljs-keyword">set</span> entrydate <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;2008-01-01&#x27;</span>;<br></code></pre></td></tr></table></figure>
<blockquote>
<p>注意事项:<br>
修改语句的条件可以有，也可以没有，如果没有条件，则会修改整张表的所有数据。</p>
</blockquote>
<hr>
<br>
<ul>
<li><strong><u>删除数据</u></strong></li>
</ul>
<p>删除数据的具体语法为：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">FROM</span> 表名 [ <span class="hljs-keyword">WHERE</span> 条件 ] ;<br></code></pre></td></tr></table></figure>
<p>案例:<br>
<strong>A.</strong> 删除gender为女的员工</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">delete</span> <span class="hljs-keyword">from</span> employee <span class="hljs-keyword">where</span> gender <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;女&#x27;</span>;<br></code></pre></td></tr></table></figure>
<p><strong>B.</strong> 删除所有员工</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">delete</span> <span class="hljs-keyword">from</span> employee;<br></code></pre></td></tr></table></figure>
<blockquote>
<p>注意事项:</p>
<ul>
<li>DELETE 语句的条件可以有，也可以没有，如果没有条件，则会删除整张表的所有数据。</li>
<li>DELETE 语句不能删除某一个字段的值(可以使用UPDATE，将该字段值置为NULL即可)。</li>
</ul>
</blockquote>
<hr>
<p><br><br><br></p>
<h4 id="2-4-DQL">2.4 DQL</h4>
<blockquote>
<p>DQL英文全称是Data Query Language(数据查询语言)，数据查询语言，用来查询数据库中表的记录。</p>
<p>查询关键字: SELECT</p>
<p>在一个正常的业务系统中，查询操作的频次是要远高于增删改的，当我们去访问企业官网、电商网站，在这些网站中我们所看到的数据，实际都是需要从数据库中查询并展示的。而且在查询的过程中，可能还会涉及到条件、排序、分页等操作。</p>
</blockquote>
<p>那么，本小节主要学习的就是如何进行数据的查询操作。 我们先来完成如下数据准备工作:</p>
<details class="toggle" style="border: 1px solid  #edf4ee"><summary class="toggle-button" style="background-color:  #edf4ee;color:  #17181a">数据准备 </summary><div class="toggle-content"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">+------+--------+-----------+--------+------+--------------------+-------------+------------+<br>| id   | workno | name      | gender | age  | idcard             | workaddress | entrydate  |<br>+------+--------+-----------+--------+------+--------------------+-------------+------------+<br>|    1 | 00001  | 柳岩666   | 女     |   20 | 123456789012345678 | 北京        | 2000-01-01 |<br>|    2 | 00002  | 张无忌    | 男     |   18 | 123456789012345670 | 北京        | 2005-09-01 |<br>|    3 | 00003  | 韦一笑    | 男     |   38 | 123456789712345670 | 上海        | 2005-08-01 |<br>|    4 | 00004  | 赵敏      | 女     |   18 | 123456757123845670 | 北京        | 2009-12-01 |<br>|    5 | 00005  | 小昭      | 女     |   16 | 123456769012345678 | 上海        | 2007-07-01 |<br>|    6 | 00006  | 杨逍      | 男     |   28 | 12345678931234567X | 北京        | 2006-01-01 |<br>|    7 | 00007  | 范瑶      | 男     |   40 | 123456789212345670 | 北京        | 2005-05-01 |<br>|    8 | 00008  | 黛绮丝    | 女     |   38 | 123456157123645670 | 天津        | 2015-05-01 |<br>|    9 | 00009  | 范凉凉    | 女     |   45 | 123156789012345678 | 北京        | 2010-04-01 |<br>|   10 | 00010  | 陈友谅    | 男     |   53 | 123456789012345670 | 上海        | 2011-01-01 |<br>|   11 | 00011  | 张士诚    | 男     |   55 | 123567897123465670 | 江苏        | 2015-05-01 |<br>|   12 | 00012  | 常遇春    | 男     |   32 | 123446757152345670 | 北京        | 2004-02-01 |<br>|   13 | 00013  | 张三丰    | 男     |   88 | 123656789012345678 | 江苏        | 2020-11-01 |<br>|   14 | 00014  | 灭绝      | 女     |   65 | 123456719012345670 | 西安        | 2019-05-01 |<br>|   15 | 00015  | 胡青牛    | 男     |   70 | 12345674971234567X | 西安        | 2018-04-01 |<br>|   16 | 00016  | 周芷若    | 女     |   18 | NULL               | 北京        | 2012-06-01 |<br>+------+--------+-----------+--------+------+--------------------+-------------+------------+<br></code></pre></td></tr></table></figure>
<br>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">drop</span> <span class="hljs-keyword">table</span> if <span class="hljs-keyword">exists</span> employee;<br><br><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> emp(<br>    id <span class="hljs-type">int</span> comment <span class="hljs-string">&#x27;编号&#x27;</span>,<br>    workno <span class="hljs-type">varchar</span>(<span class="hljs-number">10</span>) comment <span class="hljs-string">&#x27;工号&#x27;</span>,<br>    name <span class="hljs-type">varchar</span>(<span class="hljs-number">10</span>) comment <span class="hljs-string">&#x27;姓名&#x27;</span>,<br>    gender <span class="hljs-type">char</span>(<span class="hljs-number">1</span>) comment <span class="hljs-string">&#x27;性别&#x27;</span>,<br>    age tinyint unsigned comment <span class="hljs-string">&#x27;年龄&#x27;</span>,<br>    idcard <span class="hljs-type">char</span>(<span class="hljs-number">18</span>) comment <span class="hljs-string">&#x27;身份证号&#x27;</span>,<br>    workaddress <span class="hljs-type">varchar</span>(<span class="hljs-number">50</span>) comment <span class="hljs-string">&#x27;工作地址&#x27;</span>,<br>    entrydate <span class="hljs-type">date</span> comment <span class="hljs-string">&#x27;入职时间&#x27;</span><br>)comment <span class="hljs-string">&#x27;员工表&#x27;</span>;<br><br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> emp (id, workno, name, gender, age, idcard, workaddress, entrydate)<br><span class="hljs-keyword">VALUES</span> (<span class="hljs-number">1</span>, <span class="hljs-string">&#x27;00001&#x27;</span>, <span class="hljs-string">&#x27;柳岩666&#x27;</span>, <span class="hljs-string">&#x27;女&#x27;</span>, <span class="hljs-number">20</span>, <span class="hljs-string">&#x27;123456789012345678&#x27;</span>, <span class="hljs-string">&#x27;北京&#x27;</span>, <span class="hljs-string">&#x27;2000-01-01&#x27;</span>);<br><br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> emp (id, workno, name, gender, age, idcard, workaddress, entrydate)<br><span class="hljs-keyword">VALUES</span> (<span class="hljs-number">2</span>, <span class="hljs-string">&#x27;00002&#x27;</span>, <span class="hljs-string">&#x27;张无忌&#x27;</span>, <span class="hljs-string">&#x27;男&#x27;</span>, <span class="hljs-number">18</span>, <span class="hljs-string">&#x27;123456789012345670&#x27;</span>, <span class="hljs-string">&#x27;北京&#x27;</span>, <span class="hljs-string">&#x27;2005-09-01&#x27;</span>);<br><br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> emp (id, workno, name, gender, age, idcard, workaddress, entrydate)<br><span class="hljs-keyword">VALUES</span> (<span class="hljs-number">3</span>, <span class="hljs-string">&#x27;00003&#x27;</span>, <span class="hljs-string">&#x27;韦一笑&#x27;</span>, <span class="hljs-string">&#x27;男&#x27;</span>, <span class="hljs-number">38</span>, <span class="hljs-string">&#x27;123456789712345670&#x27;</span>, <span class="hljs-string">&#x27;上海&#x27;</span>, <span class="hljs-string">&#x27;2005-08-01&#x27;</span>);<br><br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> emp (id, workno, name, gender, age, idcard, workaddress, entrydate)<br><span class="hljs-keyword">VALUES</span> (<span class="hljs-number">4</span>, <span class="hljs-string">&#x27;00004&#x27;</span>, <span class="hljs-string">&#x27;赵敏&#x27;</span>, <span class="hljs-string">&#x27;女&#x27;</span>, <span class="hljs-number">18</span>, <span class="hljs-string">&#x27;123456757123845670&#x27;</span>, <span class="hljs-string">&#x27;北京&#x27;</span>, <span class="hljs-string">&#x27;2009-12-01&#x27;</span>);<br><br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> emp (id, workno, name, gender, age, idcard, workaddress, entrydate)<br><span class="hljs-keyword">VALUES</span> (<span class="hljs-number">5</span>, <span class="hljs-string">&#x27;00005&#x27;</span>, <span class="hljs-string">&#x27;小昭&#x27;</span>, <span class="hljs-string">&#x27;女&#x27;</span>, <span class="hljs-number">16</span>, <span class="hljs-string">&#x27;123456769012345678&#x27;</span>, <span class="hljs-string">&#x27;上海&#x27;</span>, <span class="hljs-string">&#x27;2007-07-01&#x27;</span>);<br><br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> emp (id, workno, name, gender, age, idcard, workaddress, entrydate)<br><span class="hljs-keyword">VALUES</span> (<span class="hljs-number">6</span>, <span class="hljs-string">&#x27;00006&#x27;</span>, <span class="hljs-string">&#x27;杨逍&#x27;</span>, <span class="hljs-string">&#x27;男&#x27;</span>, <span class="hljs-number">28</span>, <span class="hljs-string">&#x27;12345678931234567X&#x27;</span>, <span class="hljs-string">&#x27;北京&#x27;</span>, <span class="hljs-string">&#x27;2006-01-01&#x27;</span>);<br><br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> emp (id, workno, name, gender, age, idcard, workaddress, entrydate)<br><span class="hljs-keyword">VALUES</span> (<span class="hljs-number">7</span>, <span class="hljs-string">&#x27;00007&#x27;</span>, <span class="hljs-string">&#x27;范瑶&#x27;</span>, <span class="hljs-string">&#x27;男&#x27;</span>, <span class="hljs-number">40</span>, <span class="hljs-string">&#x27;123456789212345670&#x27;</span>, <span class="hljs-string">&#x27;北京&#x27;</span>, <span class="hljs-string">&#x27;2005-05-01&#x27;</span>);<br><br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> emp (id, workno, name, gender, age, idcard, workaddress, entrydate)<br><span class="hljs-keyword">VALUES</span> (<span class="hljs-number">8</span>, <span class="hljs-string">&#x27;00008&#x27;</span>, <span class="hljs-string">&#x27;黛绮丝&#x27;</span>, <span class="hljs-string">&#x27;女&#x27;</span>, <span class="hljs-number">38</span>, <span class="hljs-string">&#x27;123456157123645670&#x27;</span>, <span class="hljs-string">&#x27;天津&#x27;</span>, <span class="hljs-string">&#x27;2015-05-01&#x27;</span>);<br><br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> emp (id, workno, name, gender, age, idcard, workaddress, entrydate)<br><span class="hljs-keyword">VALUES</span> (<span class="hljs-number">9</span>, <span class="hljs-string">&#x27;00009&#x27;</span>, <span class="hljs-string">&#x27;范凉凉&#x27;</span>, <span class="hljs-string">&#x27;女&#x27;</span>, <span class="hljs-number">45</span>, <span class="hljs-string">&#x27;123156789012345678&#x27;</span>, <span class="hljs-string">&#x27;北京&#x27;</span>, <span class="hljs-string">&#x27;2010-04-01&#x27;</span>);<br><br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> emp (id, workno, name, gender, age, idcard, workaddress, entrydate)<br><span class="hljs-keyword">VALUES</span> (<span class="hljs-number">10</span>, <span class="hljs-string">&#x27;00010&#x27;</span>, <span class="hljs-string">&#x27;陈友谅&#x27;</span>, <span class="hljs-string">&#x27;男&#x27;</span>, <span class="hljs-number">53</span>, <span class="hljs-string">&#x27;123456789012345670&#x27;</span>, <span class="hljs-string">&#x27;上海&#x27;</span>, <span class="hljs-string">&#x27;2011-01-01&#x27;</span>);<br><br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> emp (id, workno, name, gender, age, idcard, workaddress, entrydate)<br><span class="hljs-keyword">VALUES</span> (<span class="hljs-number">11</span>, <span class="hljs-string">&#x27;00011&#x27;</span>, <span class="hljs-string">&#x27;张士诚&#x27;</span>, <span class="hljs-string">&#x27;男&#x27;</span>, <span class="hljs-number">55</span>, <span class="hljs-string">&#x27;123567897123465670&#x27;</span>, <span class="hljs-string">&#x27;江苏&#x27;</span>, <span class="hljs-string">&#x27;2015-05-01&#x27;</span>);<br><br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> emp (id, workno, name, gender, age, idcard, workaddress, entrydate)<br><span class="hljs-keyword">VALUES</span> (<span class="hljs-number">12</span>, <span class="hljs-string">&#x27;00012&#x27;</span>, <span class="hljs-string">&#x27;常遇春&#x27;</span>, <span class="hljs-string">&#x27;男&#x27;</span>, <span class="hljs-number">32</span>, <span class="hljs-string">&#x27;123446757152345670&#x27;</span>, <span class="hljs-string">&#x27;北京&#x27;</span>, <span class="hljs-string">&#x27;2004-02-01&#x27;</span>);<br><br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> emp (id, workno, name, gender, age, idcard, workaddress, entrydate)<br><span class="hljs-keyword">VALUES</span> (<span class="hljs-number">13</span>, <span class="hljs-string">&#x27;00013&#x27;</span>, <span class="hljs-string">&#x27;张三丰&#x27;</span>, <span class="hljs-string">&#x27;男&#x27;</span>, <span class="hljs-number">88</span>, <span class="hljs-string">&#x27;123656789012345678&#x27;</span>, <span class="hljs-string">&#x27;江苏&#x27;</span>, <span class="hljs-string">&#x27;2020-11-01&#x27;</span>);<br><br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> emp (id, workno, name, gender, age, idcard, workaddress, entrydate)<br><span class="hljs-keyword">VALUES</span> (<span class="hljs-number">14</span>, <span class="hljs-string">&#x27;00014&#x27;</span>, <span class="hljs-string">&#x27;灭绝&#x27;</span>, <span class="hljs-string">&#x27;女&#x27;</span>, <span class="hljs-number">65</span>, <span class="hljs-string">&#x27;123456719012345670&#x27;</span>, <span class="hljs-string">&#x27;西安&#x27;</span>, <span class="hljs-string">&#x27;2019-05-01&#x27;</span>);<br><br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> emp (id, workno, name, gender, age, idcard, workaddress, entrydate)<br><span class="hljs-keyword">VALUES</span> (<span class="hljs-number">15</span>, <span class="hljs-string">&#x27;00015&#x27;</span>, <span class="hljs-string">&#x27;胡青牛&#x27;</span>, <span class="hljs-string">&#x27;男&#x27;</span>, <span class="hljs-number">70</span>, <span class="hljs-string">&#x27;12345674971234567X&#x27;</span>, <span class="hljs-string">&#x27;西安&#x27;</span>, <span class="hljs-string">&#x27;2018-04-01&#x27;</span>);<br><br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> emp (id, workno, name, gender, age, idcard, workaddress, entrydate)<br><span class="hljs-keyword">VALUES</span> (<span class="hljs-number">16</span>, <span class="hljs-string">&#x27;00016&#x27;</span>, <span class="hljs-string">&#x27;周芷若&#x27;</span>, <span class="hljs-string">&#x27;女&#x27;</span>, <span class="hljs-number">18</span>, <span class="hljs-keyword">null</span>, <span class="hljs-string">&#x27;北京&#x27;</span>, <span class="hljs-string">&#x27;2012-06-01&#x27;</span>);<br></code></pre></td></tr></table></figure>
<p>准备完毕后，我们就可以看到emp表中准备的16条数据。接下来，我们再来完成DQL语法的学习。</p>
</div></details>
<br>
<ul>
<li><strong><u>基本语法</u></strong></li>
</ul>
<p>DQL 查询语句，语法结构如下：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span><br>    字段列表<br><span class="hljs-keyword">FROM</span><br>    表名列表<br><span class="hljs-keyword">WHERE</span><br>    条件列表<br><span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span><br>    分组字段列表<br><span class="hljs-keyword">HAVING</span><br>    分组后条件列表<br><span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span><br>    排序字段列表<br>LIMIT<br>    分页参数<br>;<br></code></pre></td></tr></table></figure>
<p>我们在讲解这部分内容的时候，会将上面的完整语法进行拆分，分为以下几个部分：</p>
<ul>
<li>基本查询（不带任何条件）</li>
<li>条件查询（WHERE）</li>
<li>聚合函数（count、max、min、avg、sum）</li>
<li>分组查询（group by）</li>
<li>排序查询（order by）</li>
<li>分页查询（limit）</li>
</ul>
<hr>
<br>
<ul>
<li><strong><u>基础查询</u></strong></li>
</ul>
<p>在基本查询的DQL语句中，不带任何的查询条件，查询的语法如下：</p>
<p><strong>1).</strong> 查询多个字段</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> 字段<span class="hljs-number">1</span>, 字段<span class="hljs-number">2</span>, 字段<span class="hljs-number">3</span> ... <span class="hljs-keyword">FROM</span> 表名 ;<br></code></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> 表名 ;<br></code></pre></td></tr></table></figure>
<blockquote>
<p>注意 : * 号代表查询所有字段，在实际开发中尽量少用（不直观、影响效率）。</p>
</blockquote>
<br>
<p><strong>2).</strong> 字段设置别名</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> 字段<span class="hljs-number">1</span> [ <span class="hljs-keyword">AS</span> 别名<span class="hljs-number">1</span> ] , 字段<span class="hljs-number">2</span> [ <span class="hljs-keyword">AS</span> 别名<span class="hljs-number">2</span> ] ... <span class="hljs-keyword">FROM</span> 表名;<br></code></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> 字段<span class="hljs-number">1</span> [ 别名<span class="hljs-number">1</span> ] , 字段<span class="hljs-number">2</span> [ 别名<span class="hljs-number">2</span> ] ... <span class="hljs-keyword">FROM</span> 表名;<br></code></pre></td></tr></table></figure>
<br>
<p><strong>3).</strong> 去除重复记录</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">DISTINCT</span> 字段列表 <span class="hljs-keyword">FROM</span> 表名;<br></code></pre></td></tr></table></figure>
<br>
<p>案例：<br>
<strong>A.</strong> 查询指定字段 name, workno, age并返回</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> name,workno,age <span class="hljs-keyword">from</span> emp;<br></code></pre></td></tr></table></figure>
<details class="toggle" style="border: 1px solid  #edf4ee"><summary class="toggle-button" style="background-color:  #edf4ee;color:  #17181a">查看输出 </summary><div class="toggle-content"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">+-----------+--------+------+<br>| name      | workno | age  |<br>+-----------+--------+------+<br>| 柳岩666   | 00001  |   20 |<br>| 张无忌    | 00002  |   18 |<br>| 韦一笑    | 00003  |   38 |<br>| 赵敏      | 00004  |   18 |<br>| 小昭      | 00005  |   16 |<br>| 杨逍      | 00006  |   28 |<br>| 范瑶      | 00007  |   40 |<br>| 黛绮丝    | 00008  |   38 |<br>| 范凉凉    | 00009  |   45 |<br>| 陈友谅    | 00010  |   53 |<br>| 张士诚    | 00011  |   55 |<br>| 常遇春    | 00012  |   32 |<br>| 张三丰    | 00013  |   88 |<br>| 灭绝      | 00014  |   65 |<br>| 胡青牛    | 00015  |   70 |<br>| 周芷若    | 00016  |   18 |<br>+-----------+--------+------+<br>16 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure></div></details>
<p><strong>B.</strong> 查询返回所有字段</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> id ,workno,name,gender,age,idcard,workaddress,entrydate <span class="hljs-keyword">from</span> emp;<br></code></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> emp;<br></code></pre></td></tr></table></figure>
<details class="toggle" style="border: 1px solid  #edf4ee"><summary class="toggle-button" style="background-color:  #edf4ee;color:  #17181a">查看输出 </summary><div class="toggle-content"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">+------+--------+-----------+--------+------+--------------------+-------------+------------+<br>| id   | workno | name      | gender | age  | idcard             | workaddress | entrydate  |<br>+------+--------+-----------+--------+------+--------------------+-------------+------------+<br>|    1 | 00001  | 柳岩666   | 女     |   20 | 123456789012345678 | 北京        | 2000-01-01 |<br>|    2 | 00002  | 张无忌    | 男     |   18 | 123456789012345670 | 北京        | 2005-09-01 |<br>|    3 | 00003  | 韦一笑    | 男     |   38 | 123456789712345670 | 上海        | 2005-08-01 |<br>|    4 | 00004  | 赵敏      | 女     |   18 | 123456757123845670 | 北京        | 2009-12-01 |<br>|    5 | 00005  | 小昭      | 女     |   16 | 123456769012345678 | 上海        | 2007-07-01 |<br>|    6 | 00006  | 杨逍      | 男     |   28 | 12345678931234567X | 北京        | 2006-01-01 |<br>|    7 | 00007  | 范瑶      | 男     |   40 | 123456789212345670 | 北京        | 2005-05-01 |<br>|    8 | 00008  | 黛绮丝    | 女     |   38 | 123456157123645670 | 天津        | 2015-05-01 |<br>|    9 | 00009  | 范凉凉    | 女     |   45 | 123156789012345678 | 北京        | 2010-04-01 |<br>|   10 | 00010  | 陈友谅    | 男     |   53 | 123456789012345670 | 上海        | 2011-01-01 |<br>|   11 | 00011  | 张士诚    | 男     |   55 | 123567897123465670 | 江苏        | 2015-05-01 |<br>|   12 | 00012  | 常遇春    | 男     |   32 | 123446757152345670 | 北京        | 2004-02-01 |<br>|   13 | 00013  | 张三丰    | 男     |   88 | 123656789012345678 | 江苏        | 2020-11-01 |<br>|   14 | 00014  | 灭绝      | 女     |   65 | 123456719012345670 | 西安        | 2019-05-01 |<br>|   15 | 00015  | 胡青牛    | 男     |   70 | 12345674971234567X | 西安        | 2018-04-01 |<br>|   16 | 00016  | 周芷若    | 女     |   18 | NULL               | 北京        | 2012-06-01 |<br>+------+--------+-----------+--------+------+--------------------+-------------+------------+<br>16 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure></div></details>
<p><strong>C.</strong> 查询所有员工的工作地址,起别名</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> workaddress <span class="hljs-keyword">as</span> <span class="hljs-string">&#x27;工作地址&#x27;</span> <span class="hljs-keyword">from</span> emp;<br></code></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- as可以省略</span><br><span class="hljs-keyword">select</span> workaddress <span class="hljs-string">&#x27;工作地址&#x27;</span> <span class="hljs-keyword">from</span> emp;<br></code></pre></td></tr></table></figure>
<details class="toggle" style="border: 1px solid  #edf4ee"><summary class="toggle-button" style="background-color:  #edf4ee;color:  #17181a">查看输出 </summary><div class="toggle-content"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">+--------------+<br>| 工作地址     |<br>+--------------+<br>| 北京         |<br>| 北京         |<br>| 上海         |<br>| 北京         |<br>| 上海         |<br>| 北京         |<br>| 北京         |<br>| 天津         |<br>| 北京         |<br>| 上海         |<br>| 江苏         |<br>| 北京         |<br>| 江苏         |<br>| 西安         |<br>| 西安         |<br>| 北京         |<br>+--------------+<br>16 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure></div></details>
<p><strong>D.</strong> 查询公司员工的上班地址有哪些(不要重复)</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-keyword">distinct</span> workaddress <span class="hljs-string">&#x27;工作地址&#x27;</span> <span class="hljs-keyword">from</span> emp;<br></code></pre></td></tr></table></figure>
<details class="toggle" style="border: 1px solid  #edf4ee"><summary class="toggle-button" style="background-color:  #edf4ee;color:  #17181a">查看输出 </summary><div class="toggle-content"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">+--------------+<br>| 工作地址     |<br>+--------------+<br>| 北京         |<br>| 上海         |<br>| 天津         |<br>| 江苏         |<br>| 西安         |<br>+--------------+<br>5 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure></div></details>
<hr>
<br>
<ul>
<li><strong><u>条件查询</u></strong></li>
</ul>
<p><strong>1).</strong> 语法</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> 字段列表 <span class="hljs-keyword">FROM</span> 表名 <span class="hljs-keyword">WHERE</span> 条件列表 ;<br></code></pre></td></tr></table></figure>
<br>
<p><strong>2).</strong> 条件</p>
<p>常用的比较运算符如下:</p>
<table>
<thead>
<tr>
<th style="text-align:left">比较运算符</th>
<th style="text-align:left">功能</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">&gt;</td>
<td style="text-align:left">大于</td>
</tr>
<tr>
<td style="text-align:left">&gt;=</td>
<td style="text-align:left">大于等于</td>
</tr>
<tr>
<td style="text-align:left">&lt;</td>
<td style="text-align:left">小于</td>
</tr>
<tr>
<td style="text-align:left">&lt;=</td>
<td style="text-align:left">小于等于</td>
</tr>
<tr>
<td style="text-align:left">=</td>
<td style="text-align:left">等于</td>
</tr>
<tr>
<td style="text-align:left">&lt;&gt; 或 !=</td>
<td style="text-align:left">不等于</td>
</tr>
<tr>
<td style="text-align:left">BETWEEN … AND …</td>
<td style="text-align:left">在某个范围之内(含最小、最大值)</td>
</tr>
<tr>
<td style="text-align:left">IN(…)</td>
<td style="text-align:left">在in之后的列表中的值，多选一</td>
</tr>
<tr>
<td style="text-align:left">LIKE 占位符</td>
<td style="text-align:left">模糊匹配(<code>_</code>匹配单个字符, <code>%</code>匹配任意个字符)</td>
</tr>
<tr>
<td style="text-align:left">IS NULL</td>
<td style="text-align:left">是NULL</td>
</tr>
</tbody>
</table>
<p>常用的逻辑运算符如下:</p>
<table>
<thead>
<tr>
<th style="text-align:left">逻辑运算符</th>
<th style="text-align:left">功能</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">AND 或 &amp;&amp;</td>
<td style="text-align:left">并且 (多个条件同时成立)</td>
</tr>
<tr>
<td style="text-align:left">OR 或 ||</td>
<td style="text-align:left">或者 (多个条件任意一个成立)</td>
</tr>
<tr>
<td style="text-align:left">NOT 或 !</td>
<td style="text-align:left">非 , 不是</td>
</tr>
</tbody>
</table>
<br>
<p>案例:<br>
<strong>A.</strong> 查询年龄等于 88 的员工</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> emp <span class="hljs-keyword">where</span> age <span class="hljs-operator">=</span> <span class="hljs-number">88</span>;<br></code></pre></td></tr></table></figure>
<details class="toggle" style="border: 1px solid  #edf4ee"><summary class="toggle-button" style="background-color:  #edf4ee;color:  #17181a">查看输出 </summary><div class="toggle-content"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">+------+--------+-----------+--------+------+--------------------+-------------+------------+<br>| id   | workno | name      | gender | age  | idcard             | workaddress | entrydate  |<br>+------+--------+-----------+--------+------+--------------------+-------------+------------+<br>|   13 | 00013  | 张三丰    | 男     |   88 | 123656789012345678 | 江苏        | 2020-11-01 |<br>+------+--------+-----------+--------+------+--------------------+-------------+------------+<br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure></div></details>
<p><strong>B.</strong> 查询年龄小于 20 的员工信息</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> emp <span class="hljs-keyword">where</span> age <span class="hljs-operator">&lt;</span> <span class="hljs-number">20</span>;<br></code></pre></td></tr></table></figure>
<details class="toggle" style="border: 1px solid  #edf4ee"><summary class="toggle-button" style="background-color:  #edf4ee;color:  #17181a">查看输出 </summary><div class="toggle-content"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">+------+--------+-----------+--------+------+--------------------+-------------+------------+<br>| id   | workno | name      | gender | age  | idcard             | workaddress | entrydate  |<br>+------+--------+-----------+--------+------+--------------------+-------------+------------+<br>|    2 | 00002  | 张无忌    | 男     |   18 | 123456789012345670 | 北京        | 2005-09-01 |<br>|    4 | 00004  | 赵敏      | 女     |   18 | 123456757123845670 | 北京        | 2009-12-01 |<br>|    5 | 00005  | 小昭      | 女     |   16 | 123456769012345678 | 上海        | 2007-07-01 |<br>|   16 | 00016  | 周芷若    | 女     |   18 | NULL               | 北京        | 2012-06-01 |<br>+------+--------+-----------+--------+------+--------------------+-------------+------------+<br>4 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure>
</div></details>
<p><strong>C.</strong> 查询年龄小于等于 20 的员工信息</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> emp <span class="hljs-keyword">where</span> age <span class="hljs-operator">&lt;=</span> <span class="hljs-number">20</span>;<br></code></pre></td></tr></table></figure>
<details class="toggle" style="border: 1px solid  #edf4ee"><summary class="toggle-button" style="background-color:  #edf4ee;color:  #17181a">查看输出 </summary><div class="toggle-content"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">+------+--------+-----------+--------+------+--------------------+-------------+------------+<br>| id   | workno | name      | gender | age  | idcard             | workaddress | entrydate  |<br>+------+--------+-----------+--------+------+--------------------+-------------+------------+<br>|    1 | 00001  | 柳岩666   | 女     |   20 | 123456789012345678 | 北京        | 2000-01-01 |<br>|    2 | 00002  | 张无忌    | 男     |   18 | 123456789012345670 | 北京        | 2005-09-01 |<br>|    4 | 00004  | 赵敏      | 女     |   18 | 123456757123845670 | 北京        | 2009-12-01 |<br>|    5 | 00005  | 小昭      | 女     |   16 | 123456769012345678 | 上海        | 2007-07-01 |<br>|   16 | 00016  | 周芷若    | 女     |   18 | NULL               | 北京        | 2012-06-01 |<br>+------+--------+-----------+--------+------+--------------------+-------------+------------+<br>5 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure>
</div></details>
<p><strong>D.</strong> 查询没有身份证号的员工信息</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> emp <span class="hljs-keyword">where</span> idcard <span class="hljs-keyword">is</span> <span class="hljs-keyword">null</span>;<br></code></pre></td></tr></table></figure>
<details class="toggle" style="border: 1px solid  #edf4ee"><summary class="toggle-button" style="background-color:  #edf4ee;color:  #17181a">查看输出 </summary><div class="toggle-content"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">+------+--------+-----------+--------+------+--------+-------------+------------+<br>| id   | workno | name      | gender | age  | idcard | workaddress | entrydate  |<br>+------+--------+-----------+--------+------+--------+-------------+------------+<br>|   16 | 00016  | 周芷若    | 女     |   18 | NULL   | 北京        | 2012-06-01 |<br>+------+--------+-----------+--------+------+--------+-------------+------------+<br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure>
</div></details>
<p><strong>E.</strong>  查询有身份证号的员工信息</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> emp <span class="hljs-keyword">where</span> idcard <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span>;<br></code></pre></td></tr></table></figure>
<details class="toggle" style="border: 1px solid  #edf4ee"><summary class="toggle-button" style="background-color:  #edf4ee;color:  #17181a">查看输出 </summary><div class="toggle-content"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">+------+--------+-----------+--------+------+--------------------+-------------+------------+<br>| id   | workno | name      | gender | age  | idcard             | workaddress | entrydate  |<br>+------+--------+-----------+--------+------+--------------------+-------------+------------+<br>|    1 | 00001  | 柳岩666   | 女     |   20 | 123456789012345678 | 北京        | 2000-01-01 |<br>|    2 | 00002  | 张无忌    | 男     |   18 | 123456789012345670 | 北京        | 2005-09-01 |<br>|    3 | 00003  | 韦一笑    | 男     |   38 | 123456789712345670 | 上海        | 2005-08-01 |<br>|    4 | 00004  | 赵敏      | 女     |   18 | 123456757123845670 | 北京        | 2009-12-01 |<br>|    5 | 00005  | 小昭      | 女     |   16 | 123456769012345678 | 上海        | 2007-07-01 |<br>|    6 | 00006  | 杨逍      | 男     |   28 | 12345678931234567X | 北京        | 2006-01-01 |<br>|    7 | 00007  | 范瑶      | 男     |   40 | 123456789212345670 | 北京        | 2005-05-01 |<br>|    8 | 00008  | 黛绮丝    | 女     |   38 | 123456157123645670 | 天津        | 2015-05-01 |<br>|    9 | 00009  | 范凉凉    | 女     |   45 | 123156789012345678 | 北京        | 2010-04-01 |<br>|   10 | 00010  | 陈友谅    | 男     |   53 | 123456789012345670 | 上海        | 2011-01-01 |<br>|   11 | 00011  | 张士诚    | 男     |   55 | 123567897123465670 | 江苏        | 2015-05-01 |<br>|   12 | 00012  | 常遇春    | 男     |   32 | 123446757152345670 | 北京        | 2004-02-01 |<br>|   13 | 00013  | 张三丰    | 男     |   88 | 123656789012345678 | 江苏        | 2020-11-01 |<br>|   14 | 00014  | 灭绝      | 女     |   65 | 123456719012345670 | 西安        | 2019-05-01 |<br>|   15 | 00015  | 胡青牛    | 男     |   70 | 12345674971234567X | 西安        | 2018-04-01 |<br>+------+--------+-----------+--------+------+--------------------+-------------+------------+<br>15 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure>
</div></details>
<p><strong>F.</strong>  查询年龄不等于 88 的员工信息</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> emp <span class="hljs-keyword">where</span> age <span class="hljs-operator">!=</span> <span class="hljs-number">88</span>;<br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> emp <span class="hljs-keyword">where</span> age <span class="hljs-operator">&lt;&gt;</span> <span class="hljs-number">88</span>;<br></code></pre></td></tr></table></figure>
<details class="toggle" style="border: 1px solid  #edf4ee"><summary class="toggle-button" style="background-color:  #edf4ee;color:  #17181a">查看输出 </summary><div class="toggle-content"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">+------+--------+-----------+--------+------+--------------------+-------------+------------+<br>| id   | workno | name      | gender | age  | idcard             | workaddress | entrydate  |<br>+------+--------+-----------+--------+------+--------------------+-------------+------------+<br>|    1 | 00001  | 柳岩666   | 女     |   20 | 123456789012345678 | 北京        | 2000-01-01 |<br>|    2 | 00002  | 张无忌    | 男     |   18 | 123456789012345670 | 北京        | 2005-09-01 |<br>|    3 | 00003  | 韦一笑    | 男     |   38 | 123456789712345670 | 上海        | 2005-08-01 |<br>|    4 | 00004  | 赵敏      | 女     |   18 | 123456757123845670 | 北京        | 2009-12-01 |<br>|    5 | 00005  | 小昭      | 女     |   16 | 123456769012345678 | 上海        | 2007-07-01 |<br>|    6 | 00006  | 杨逍      | 男     |   28 | 12345678931234567X | 北京        | 2006-01-01 |<br>|    7 | 00007  | 范瑶      | 男     |   40 | 123456789212345670 | 北京        | 2005-05-01 |<br>|    8 | 00008  | 黛绮丝    | 女     |   38 | 123456157123645670 | 天津        | 2015-05-01 |<br>|    9 | 00009  | 范凉凉    | 女     |   45 | 123156789012345678 | 北京        | 2010-04-01 |<br>|   10 | 00010  | 陈友谅    | 男     |   53 | 123456789012345670 | 上海        | 2011-01-01 |<br>|   11 | 00011  | 张士诚    | 男     |   55 | 123567897123465670 | 江苏        | 2015-05-01 |<br>|   12 | 00012  | 常遇春    | 男     |   32 | 123446757152345670 | 北京        | 2004-02-01 |<br>|   14 | 00014  | 灭绝      | 女     |   65 | 123456719012345670 | 西安        | 2019-05-01 |<br>|   15 | 00015  | 胡青牛    | 男     |   70 | 12345674971234567X | 西安        | 2018-04-01 |<br>|   16 | 00016  | 周芷若    | 女     |   18 | NULL               | 北京        | 2012-06-01 |<br>+------+--------+-----------+--------+------+--------------------+-------------+------------+<br>15 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure>
</div></details>
<p><strong>G.</strong>  查询年龄在15岁(包含) 到 20岁(包含)之间的员工信息</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> emp <span class="hljs-keyword">where</span> age <span class="hljs-operator">&gt;=</span> <span class="hljs-number">15</span> <span class="hljs-operator">&amp;&amp;</span> age <span class="hljs-operator">&lt;=</span> <span class="hljs-number">20</span>;<br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> emp <span class="hljs-keyword">where</span> age <span class="hljs-operator">&gt;=</span> <span class="hljs-number">15</span> <span class="hljs-keyword">and</span> age <span class="hljs-operator">&lt;=</span> <span class="hljs-number">20</span>;<br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> emp <span class="hljs-keyword">where</span> age <span class="hljs-keyword">between</span> <span class="hljs-number">15</span> <span class="hljs-keyword">and</span> <span class="hljs-number">20</span>;<br></code></pre></td></tr></table></figure>
<details class="toggle" style="border: 1px solid  #edf4ee"><summary class="toggle-button" style="background-color:  #edf4ee;color:  #17181a">查看输出 </summary><div class="toggle-content"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">+------+--------+-----------+--------+------+--------------------+-------------+------------+<br>| id   | workno | name      | gender | age  | idcard             | workaddress | entrydate  |<br>+------+--------+-----------+--------+------+--------------------+-------------+------------+<br>|    1 | 00001  | 柳岩666   | 女     |   20 | 123456789012345678 | 北京        | 2000-01-01 |<br>|    2 | 00002  | 张无忌    | 男     |   18 | 123456789012345670 | 北京        | 2005-09-01 |<br>|    4 | 00004  | 赵敏      | 女     |   18 | 123456757123845670 | 北京        | 2009-12-01 |<br>|    5 | 00005  | 小昭      | 女     |   16 | 123456769012345678 | 上海        | 2007-07-01 |<br>|   16 | 00016  | 周芷若    | 女     |   18 | NULL               | 北京        | 2012-06-01 |<br>+------+--------+-----------+--------+------+--------------------+-------------+------------+<br>5 rows in set, 1 warning (0.00 sec)<br></code></pre></td></tr></table></figure>
</div></details>
<p><strong>H.</strong>  查询性别为 女 且年龄小于 25岁的员工信息</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> emp <span class="hljs-keyword">where</span> gender <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;女&#x27;</span> <span class="hljs-keyword">and</span> age <span class="hljs-operator">&lt;</span> <span class="hljs-number">25</span>;<br></code></pre></td></tr></table></figure>
<details class="toggle" style="border: 1px solid  #edf4ee"><summary class="toggle-button" style="background-color:  #edf4ee;color:  #17181a">查看输出 </summary><div class="toggle-content"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">+------+--------+-----------+--------+------+--------------------+-------------+------------+<br>| id   | workno | name      | gender | age  | idcard             | workaddress | entrydate  |<br>+------+--------+-----------+--------+------+--------------------+-------------+------------+<br>|    1 | 00001  | 柳岩666   | 女     |   20 | 123456789012345678 | 北京        | 2000-01-01 |<br>|    4 | 00004  | 赵敏      | 女     |   18 | 123456757123845670 | 北京        | 2009-12-01 |<br>|    5 | 00005  | 小昭      | 女     |   16 | 123456769012345678 | 上海        | 2007-07-01 |<br>|   16 | 00016  | 周芷若    | 女     |   18 | NULL               | 北京        | 2012-06-01 |<br>+------+--------+-----------+--------+------+--------------------+-------------+------------+<br>4 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure>
</div></details>
<p><strong>I.</strong>  查询年龄等于18 或 20 或 40 的员工信息</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> emp <span class="hljs-keyword">where</span> age <span class="hljs-operator">=</span> <span class="hljs-number">18</span> <span class="hljs-keyword">or</span> age <span class="hljs-operator">=</span> <span class="hljs-number">20</span> <span class="hljs-keyword">or</span> age <span class="hljs-operator">=</span><span class="hljs-number">40</span>;<br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> emp <span class="hljs-keyword">where</span> age <span class="hljs-keyword">in</span>(<span class="hljs-number">18</span>,<span class="hljs-number">20</span>,<span class="hljs-number">40</span>);<br></code></pre></td></tr></table></figure>
<details class="toggle" style="border: 1px solid  #edf4ee"><summary class="toggle-button" style="background-color:  #edf4ee;color:  #17181a">查看输出 </summary><div class="toggle-content"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">+------+--------+-----------+--------+------+--------------------+-------------+------------+<br>| id   | workno | name      | gender | age  | idcard             | workaddress | entrydate  |<br>+------+--------+-----------+--------+------+--------------------+-------------+------------+<br>|    1 | 00001  | 柳岩666   | 女     |   20 | 123456789012345678 | 北京        | 2000-01-01 |<br>|    2 | 00002  | 张无忌    | 男     |   18 | 123456789012345670 | 北京        | 2005-09-01 |<br>|    4 | 00004  | 赵敏      | 女     |   18 | 123456757123845670 | 北京        | 2009-12-01 |<br>|    7 | 00007  | 范瑶      | 男     |   40 | 123456789212345670 | 北京        | 2005-05-01 |<br>|   16 | 00016  | 周芷若    | 女     |   18 | NULL               | 北京        | 2012-06-01 |<br>+------+--------+-----------+--------+------+--------------------+-------------+------------+<br>5 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure>
</div></details>
<p><code>_</code> <code>%</code>：</p>
<p><strong>J.</strong> 查询姓名为两个字的员工信息</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> emp <span class="hljs-keyword">where</span> name <span class="hljs-keyword">like</span> <span class="hljs-string">&#x27;__&#x27;</span>;<br></code></pre></td></tr></table></figure>
<details class="toggle" style="border: 1px solid  #edf4ee"><summary class="toggle-button" style="background-color:  #edf4ee;color:  #17181a">查看输出 </summary><div class="toggle-content"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">+------+--------+--------+--------+------+--------------------+-------------+------------+<br>| id   | workno | name   | gender | age  | idcard             | workaddress | entrydate  |<br>+------+--------+--------+--------+------+--------------------+-------------+------------+<br>|    4 | 00004  | 赵敏   | 女     |   18 | 123456757123845670 | 北京        | 2009-12-01 |<br>|    5 | 00005  | 小昭   | 女     |   16 | 123456769012345678 | 上海        | 2007-07-01 |<br>|    6 | 00006  | 杨逍   | 男     |   28 | 12345678931234567X | 北京        | 2006-01-01 |<br>|    7 | 00007  | 范瑶   | 男     |   40 | 123456789212345670 | 北京        | 2005-05-01 |<br>|   14 | 00014  | 灭绝   | 女     |   65 | 123456719012345670 | 西安        | 2019-05-01 |<br>+------+--------+--------+--------+------+--------------------+-------------+------------+<br>5 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure>
</div></details>
<p><strong>K.</strong> 查询身份证号最后一位是X的员工信息</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> emp <span class="hljs-keyword">where</span> idcard <span class="hljs-keyword">like</span> <span class="hljs-string">&#x27;%X&#x27;</span>;<br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> emp <span class="hljs-keyword">where</span> idcard <span class="hljs-keyword">like</span> <span class="hljs-string">&#x27;_________________X&#x27;</span>;<br></code></pre></td></tr></table></figure>
<details class="toggle" style="border: 1px solid  #edf4ee"><summary class="toggle-button" style="background-color:  #edf4ee;color:  #17181a">查看输出 </summary><div class="toggle-content"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">+------+--------+-----------+--------+------+--------------------+-------------+------------+<br>| id   | workno | name      | gender | age  | idcard             | workaddress | entrydate  |<br>+------+--------+-----------+--------+------+--------------------+-------------+------------+<br>|    6 | 00006  | 杨逍      | 男     |   28 | 12345678931234567X | 北京        | 2006-01-01 |<br>|   15 | 00015  | 胡青牛    | 男     |   70 | 12345674971234567X | 西安        | 2018-04-01 |<br>+------+--------+-----------+--------+------+--------------------+-------------+------------+<br>2 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure>
</div></details>
<hr>
<br>
<ul>
<li><strong><u>聚合函数</u></strong></li>
</ul>
<p><strong>1).</strong> 介绍<br>
将一列数据作为一个整体，进行纵向计算 。</p>
<br>
<p><strong>2).</strong> 常见的聚合函数</p>
<table>
<thead>
<tr>
<th>函数</th>
<th>功能</th>
</tr>
</thead>
<tbody>
<tr>
<td>count</td>
<td>统计数量</td>
</tr>
<tr>
<td>max</td>
<td>最大值</td>
</tr>
<tr>
<td>min</td>
<td>最小值</td>
</tr>
<tr>
<td>avg</td>
<td>平均值</td>
</tr>
<tr>
<td>sum</td>
<td>求和</td>
</tr>
</tbody>
</table>
<br>
<p><strong>3).</strong> 语法</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> 聚合函数(字段列表) <span class="hljs-keyword">FROM</span> 表名 ;<br></code></pre></td></tr></table></figure>
<blockquote>
<p>注意 : NULL值是不参与所有聚合函数运算的。</p>
</blockquote>
<br>
<p>案例：<br>
<strong>A.</strong> 统计该企业员工数量</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-built_in">count</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">from</span> emp; <span class="hljs-comment">-- 统计的是总记录数</span><br><span class="hljs-keyword">select</span> <span class="hljs-built_in">count</span>(idcard) <span class="hljs-keyword">from</span> emp; <span class="hljs-comment">-- 统计的是idcard字段不为null的记录数</span><br></code></pre></td></tr></table></figure>
<details class="toggle" style="border: 1px solid  #edf4ee"><summary class="toggle-button" style="background-color:  #edf4ee;color:  #17181a">查看输出 </summary><div class="toggle-content"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">mysql&gt; select count(*) from emp; -- 统计的是总记录数<br>+----------+<br>| count(*) |<br>+----------+<br>|       16 |<br>+----------+<br>1 row in set (0.00 sec)<br><br>mysql&gt; select count(idcard) from emp; -- 统计的是idcard字段不为null的记录数<br>+---------------+<br>| count(idcard) |<br>+---------------+<br>|            15 |<br>+---------------+<br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure></div></details>
<p>对于count聚合函数，统计符合条件的总记录数，还可以通过 count(数字/字符串)的形式进行统计查询，比如：</p>
 <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-built_in">count</span>(<span class="hljs-number">1</span>) <span class="hljs-keyword">from</span> emp;<br></code></pre></td></tr></table></figure>
<details class="toggle" style="border: 1px solid  #edf4ee"><summary class="toggle-button" style="background-color:  #edf4ee;color:  #17181a">查看输出 </summary><div class="toggle-content"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">+----------+<br>| count(1) |<br>+----------+<br>|       16 |<br>+----------+<br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure>
</div></details>
<blockquote>
<p>对于count(*) 、count(字段)、 count(1) 的具体原理，我们在进阶篇中SQL优化部分会详细讲解，此处大家只需要知道如何使用</p>
</blockquote>
<p><strong>B.</strong> 统计该企业员工的平均年龄</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-built_in">avg</span>(age) <span class="hljs-keyword">from</span> emp;<br></code></pre></td></tr></table></figure>
<details class="toggle" style="border: 1px solid  #edf4ee"><summary class="toggle-button" style="background-color:  #edf4ee;color:  #17181a">查看输出 </summary><div class="toggle-content"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">+----------+<br>| avg(age) |<br>+----------+<br>|  40.1250 |<br>+----------+<br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure>
</div></details>
<p><strong>C.</strong> 统计该企业员工的最大年龄</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-built_in">max</span>(age) <span class="hljs-keyword">from</span> emp;<br></code></pre></td></tr></table></figure>
<details class="toggle" style="border: 1px solid  #edf4ee"><summary class="toggle-button" style="background-color:  #edf4ee;color:  #17181a">查看输出 </summary><div class="toggle-content"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">+----------+<br>| max(age) |<br>+----------+<br>|       88 |<br>+----------+<br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure>
</div></details>
<p><strong>D.</strong> 统计该企业员工的最小年龄</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-built_in">min</span>(age) <span class="hljs-keyword">from</span> emp;<br></code></pre></td></tr></table></figure>
<details class="toggle" style="border: 1px solid  #edf4ee"><summary class="toggle-button" style="background-color:  #edf4ee;color:  #17181a">查看输出 </summary><div class="toggle-content"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">+----------+<br>| min(age) |<br>+----------+<br>|       16 |<br>+----------+<br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure>
</div></details>
<p><strong>E.</strong>  统计西安地区员工的年龄之和</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-built_in">sum</span>(age) <span class="hljs-keyword">from</span> emp <span class="hljs-keyword">where</span> workaddress <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;西安&#x27;</span>;<br></code></pre></td></tr></table></figure>
<details class="toggle" style="border: 1px solid  #edf4ee"><summary class="toggle-button" style="background-color:  #edf4ee;color:  #17181a">查看输出 </summary><div class="toggle-content"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">+----------+<br>| sum(age) |<br>+----------+<br>|      135 |<br>+----------+<br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure>
</div></details>
<hr>
<br>
<ul>
<li><strong><u>分组查询</u></strong></li>
</ul>
<p><strong>1).</strong> 语法</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> 字段列表 <span class="hljs-keyword">FROM</span> 表名 [ <span class="hljs-keyword">WHERE</span> 条件 ] <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> 分组字段名 [ <span class="hljs-keyword">HAVING</span> 分组后过滤条件 ];<br></code></pre></td></tr></table></figure>
<br>
<p><strong>2).</strong> where与having区别</p>
<ul>
<li>执行时机不同：where是分组之前进行过滤，不满足where条件，不参与分组；而having是分组之后对结果进行过滤。</li>
<li>判断条件不同：where不能对聚合函数进行判断，而having可以</li>
</ul>
<blockquote>
<p>注意事项:</p>
<ul>
<li>分组之后，查询的字段一般为聚合函数和分组字段，查询其他字段无任何意义。</li>
<li>执行顺序: where &gt; 聚合函数 &gt; having 。</li>
<li>支持多字段分组, 具体语法为 : <code>group by columnA, columnB</code></li>
</ul>
</blockquote>
 <br>
<p>案例:<br>
<strong>A.</strong> 根据性别分组 , 统计男性员工 和 女性员工的数量</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> gender, <span class="hljs-built_in">count</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">from</span> emp <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> gender ;<br></code></pre></td></tr></table></figure>
<details class="toggle" style="border: 1px solid  #edf4ee"><summary class="toggle-button" style="background-color:  #edf4ee;color:  #17181a">查看输出 </summary><div class="toggle-content"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">+--------+----------+<br>| gender | count(*) |<br>+--------+----------+<br>| 女     |        7 |<br>| 男     |        9 |<br>+--------+----------+<br>2 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure></div></details>
<p><strong>B.</strong> 根据性别分组 , 统计男性员工 和 女性员工的平均年龄</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> gender, <span class="hljs-built_in">avg</span>(age) <span class="hljs-keyword">from</span> emp <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> gender ;<br></code></pre></td></tr></table></figure>
<details class="toggle" style="border: 1px solid  #edf4ee"><summary class="toggle-button" style="background-color:  #edf4ee;color:  #17181a">查看输出 </summary><div class="toggle-content"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">+--------+----------+<br>| gender | avg(age) |<br>+--------+----------+<br>| 女     |  31.4286 |<br>| 男     |  46.8889 |<br>+--------+----------+<br>2 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure>
</div></details>
<p><strong>C.</strong> 查询年龄小于45的员工 , 并根据工作地址分组 , 获取员工数量大于等于3的工作地址</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> workaddress, <span class="hljs-built_in">count</span>(<span class="hljs-operator">*</span>) address_count <span class="hljs-keyword">from</span> emp <br><span class="hljs-keyword">where</span> age <span class="hljs-operator">&lt;</span> <span class="hljs-number">45</span> <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> workaddress <span class="hljs-keyword">having</span> address_count <span class="hljs-operator">&gt;=</span> <span class="hljs-number">3</span>;<br></code></pre></td></tr></table></figure>
<details class="toggle" style="border: 1px solid  #edf4ee"><summary class="toggle-button" style="background-color:  #edf4ee;color:  #17181a">查看输出 </summary><div class="toggle-content"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">+-------------+---------------+<br>| workaddress | address_count |<br>+-------------+---------------+<br>| 北京        |             7 |<br>+-------------+---------------+<br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure>
</div></details>
<p><strong>D.</strong> 统计各个工作地址上班的男性及女性员工的数量</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> workaddress, gender, <span class="hljs-built_in">count</span>(<span class="hljs-operator">*</span>) <span class="hljs-string">&#x27;数量&#x27;</span> <span class="hljs-keyword">from</span> emp <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> gender, workaddress;<br></code></pre></td></tr></table></figure>
<details class="toggle" style="border: 1px solid  #edf4ee"><summary class="toggle-button" style="background-color:  #edf4ee;color:  #17181a">查看输出 </summary><div class="toggle-content"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">+-------------+--------+--------+<br>| workaddress | gender | 数量   |<br>+-------------+--------+--------+<br>| 北京        | 女     |      4 |<br>| 北京        | 男     |      4 |<br>| 上海        | 男     |      2 |<br>| 上海        | 女     |      1 |<br>| 天津        | 女     |      1 |<br>| 江苏        | 男     |      2 |<br>| 西安        | 女     |      1 |<br>| 西安        | 男     |      1 |<br>+-------------+--------+--------+<br>8 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure>
</div></details>
<hr>
<br>
<ul>
<li><strong><u>排序查询</u></strong></li>
</ul>
<p>排序在日常开发中是非常常见的一个操作，有升序排序，也有降序排序。</p>
<p><strong>1).</strong> 语法</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> 字段列表 <span class="hljs-keyword">FROM</span> 表名 <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> 字段<span class="hljs-number">1</span> 排序方式<span class="hljs-number">1</span> , 字段<span class="hljs-number">2</span> 排序方式<span class="hljs-number">2</span> ;<br></code></pre></td></tr></table></figure>
<br>
<p><strong>2).</strong> 排序方式</p>
<ul>
<li>ASC : 升序(默认值)</li>
<li>DESC: 降序</li>
</ul>
<blockquote>
<p>注意事项：</p>
<ul>
<li>如果是升序, 可以不指定排序方式ASC ;</li>
<li>如果是多字段排序，当第一个字段值相同时，才会根据第二个字段进行排序 ;</li>
</ul>
</blockquote>
<br>
<p>案例:<br>
<strong>A.</strong> 根据年龄对公司的员工进行升序排序</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> emp <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> age <span class="hljs-keyword">asc</span>;<br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> emp <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> age;<br></code></pre></td></tr></table></figure>
<details class="toggle" style="border: 1px solid  #edf4ee"><summary class="toggle-button" style="background-color:  #edf4ee;color:  #17181a">查看输出 </summary><div class="toggle-content"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">+------+--------+-----------+--------+------+--------------------+-------------+------------+<br>| id   | workno | name      | gender | age  | idcard             | workaddress | entrydate  |<br>+------+--------+-----------+--------+------+--------------------+-------------+------------+<br>|    5 | 00005  | 小昭      | 女     |   16 | 123456769012345678 | 上海        | 2007-07-01 |<br>|    2 | 00002  | 张无忌    | 男     |   18 | 123456789012345670 | 北京        | 2005-09-01 |<br>|    4 | 00004  | 赵敏      | 女     |   18 | 123456757123845670 | 北京        | 2009-12-01 |<br>|   16 | 00016  | 周芷若    | 女     |   18 | NULL               | 北京        | 2012-06-01 |<br>|    1 | 00001  | 柳岩666   | 女     |   20 | 123456789012345678 | 北京        | 2000-01-01 |<br>|    6 | 00006  | 杨逍      | 男     |   28 | 12345678931234567X | 北京        | 2006-01-01 |<br>|   12 | 00012  | 常遇春    | 男     |   32 | 123446757152345670 | 北京        | 2004-02-01 |<br>|    3 | 00003  | 韦一笑    | 男     |   38 | 123456789712345670 | 上海        | 2005-08-01 |<br>|    8 | 00008  | 黛绮丝    | 女     |   38 | 123456157123645670 | 天津        | 2015-05-01 |<br>|    7 | 00007  | 范瑶      | 男     |   40 | 123456789212345670 | 北京        | 2005-05-01 |<br>|    9 | 00009  | 范凉凉    | 女     |   45 | 123156789012345678 | 北京        | 2010-04-01 |<br>|   10 | 00010  | 陈友谅    | 男     |   53 | 123456789012345670 | 上海        | 2011-01-01 |<br>|   11 | 00011  | 张士诚    | 男     |   55 | 123567897123465670 | 江苏        | 2015-05-01 |<br>|   14 | 00014  | 灭绝      | 女     |   65 | 123456719012345670 | 西安        | 2019-05-01 |<br>|   15 | 00015  | 胡青牛    | 男     |   70 | 12345674971234567X | 西安        | 2018-04-01 |<br>|   13 | 00013  | 张三丰    | 男     |   88 | 123656789012345678 | 江苏        | 2020-11-01 |<br>+------+--------+-----------+--------+------+--------------------+-------------+------------+<br>16 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure></div></details>
<p><strong>B.</strong> 根据入职时间, 对员工进行降序排序</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> emp <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> entrydate <span class="hljs-keyword">desc</span>;<br></code></pre></td></tr></table></figure>
<details class="toggle" style="border: 1px solid  #edf4ee"><summary class="toggle-button" style="background-color:  #edf4ee;color:  #17181a">查看输出 </summary><div class="toggle-content"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">+------+--------+-----------+--------+------+--------------------+-------------+------------+<br>| id   | workno | name      | gender | age  | idcard             | workaddress | entrydate  |<br>+------+--------+-----------+--------+------+--------------------+-------------+------------+<br>|   13 | 00013  | 张三丰    | 男     |   88 | 123656789012345678 | 江苏        | 2020-11-01 |<br>|   14 | 00014  | 灭绝      | 女     |   65 | 123456719012345670 | 西安        | 2019-05-01 |<br>|   15 | 00015  | 胡青牛    | 男     |   70 | 12345674971234567X | 西安        | 2018-04-01 |<br>|    8 | 00008  | 黛绮丝    | 女     |   38 | 123456157123645670 | 天津        | 2015-05-01 |<br>|   11 | 00011  | 张士诚    | 男     |   55 | 123567897123465670 | 江苏        | 2015-05-01 |<br>|   16 | 00016  | 周芷若    | 女     |   18 | NULL               | 北京        | 2012-06-01 |<br>|   10 | 00010  | 陈友谅    | 男     |   53 | 123456789012345670 | 上海        | 2011-01-01 |<br>|    9 | 00009  | 范凉凉    | 女     |   45 | 123156789012345678 | 北京        | 2010-04-01 |<br>|    4 | 00004  | 赵敏      | 女     |   18 | 123456757123845670 | 北京        | 2009-12-01 |<br>|    5 | 00005  | 小昭      | 女     |   16 | 123456769012345678 | 上海        | 2007-07-01 |<br>|    6 | 00006  | 杨逍      | 男     |   28 | 12345678931234567X | 北京        | 2006-01-01 |<br>|    2 | 00002  | 张无忌    | 男     |   18 | 123456789012345670 | 北京        | 2005-09-01 |<br>|    3 | 00003  | 韦一笑    | 男     |   38 | 123456789712345670 | 上海        | 2005-08-01 |<br>|    7 | 00007  | 范瑶      | 男     |   40 | 123456789212345670 | 北京        | 2005-05-01 |<br>|   12 | 00012  | 常遇春    | 男     |   32 | 123446757152345670 | 北京        | 2004-02-01 |<br>|    1 | 00001  | 柳岩666   | 女     |   20 | 123456789012345678 | 北京        | 2000-01-01 |<br>+------+--------+-----------+--------+------+--------------------+-------------+------------+<br>16 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure></div></details>
<p><strong>C.</strong> 根据年龄对公司的员工进行升序排序 , 年龄相同 , 再按照入职时间进行降序排序</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> emp <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> age <span class="hljs-keyword">asc</span> , entrydate <span class="hljs-keyword">desc</span>;<br></code></pre></td></tr></table></figure>
<details class="toggle" style="border: 1px solid  #edf4ee"><summary class="toggle-button" style="background-color:  #edf4ee;color:  #17181a">查看输出 </summary><div class="toggle-content"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">+------+--------+-----------+--------+------+--------------------+-------------+------------+<br>| id   | workno | name      | gender | age  | idcard             | workaddress | entrydate  |<br>+------+--------+-----------+--------+------+--------------------+-------------+------------+<br>|    5 | 00005  | 小昭      | 女     |   16 | 123456769012345678 | 上海        | 2007-07-01 |<br>|   16 | 00016  | 周芷若    | 女     |   18 | NULL               | 北京        | 2012-06-01 |<br>|    4 | 00004  | 赵敏      | 女     |   18 | 123456757123845670 | 北京        | 2009-12-01 |<br>|    2 | 00002  | 张无忌    | 男     |   18 | 123456789012345670 | 北京        | 2005-09-01 |<br>|    1 | 00001  | 柳岩666   | 女     |   20 | 123456789012345678 | 北京        | 2000-01-01 |<br>|    6 | 00006  | 杨逍      | 男     |   28 | 12345678931234567X | 北京        | 2006-01-01 |<br>|   12 | 00012  | 常遇春    | 男     |   32 | 123446757152345670 | 北京        | 2004-02-01 |<br>|    8 | 00008  | 黛绮丝    | 女     |   38 | 123456157123645670 | 天津        | 2015-05-01 |<br>|    3 | 00003  | 韦一笑    | 男     |   38 | 123456789712345670 | 上海        | 2005-08-01 |<br>|    7 | 00007  | 范瑶      | 男     |   40 | 123456789212345670 | 北京        | 2005-05-01 |<br>|    9 | 00009  | 范凉凉    | 女     |   45 | 123156789012345678 | 北京        | 2010-04-01 |<br>|   10 | 00010  | 陈友谅    | 男     |   53 | 123456789012345670 | 上海        | 2011-01-01 |<br>|   11 | 00011  | 张士诚    | 男     |   55 | 123567897123465670 | 江苏        | 2015-05-01 |<br>|   14 | 00014  | 灭绝      | 女     |   65 | 123456719012345670 | 西安        | 2019-05-01 |<br>|   15 | 00015  | 胡青牛    | 男     |   70 | 12345674971234567X | 西安        | 2018-04-01 |<br>|   13 | 00013  | 张三丰    | 男     |   88 | 123656789012345678 | 江苏        | 2020-11-01 |<br>+------+--------+-----------+--------+------+--------------------+-------------+------------+<br>16 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure></div></details>
<hr>
<br>
<ul>
<li><strong><u>分页查询</u></strong></li>
</ul>
<p>分页操作在业务系统开发时，也是非常常见的一个功能，我们在网站中看到的各种各样的分页条，后台都需要借助于数据库的分页操作。</p>
<p><strong>1).</strong> 语法</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> 字段列表 <span class="hljs-keyword">FROM</span> 表名 LIMIT 起始索引, 查询记录数 ;<br></code></pre></td></tr></table></figure>
<blockquote>
<p>注意事项:</p>
<ul>
<li>起始<u>索引从0开始</u>，起始索引 = （查询页码 - 1）* 每页显示记录数。</li>
<li>分页查询是数据库的方言，不同的数据库有不同的实现，MySQL中是LIMIT。</li>
<li>如果查询的是第一页数据，起始索引可以省略，直接简写为 limit 10。</li>
</ul>
</blockquote>
<br>
<p>案例:<br>
<strong>A.</strong> 查询第1页员工数据, 每页展示10条记录</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> emp limit <span class="hljs-number">0</span>,<span class="hljs-number">10</span>;<br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> emp limit <span class="hljs-number">10</span>;<br></code></pre></td></tr></table></figure>
<details class="toggle" style="border: 1px solid  #edf4ee"><summary class="toggle-button" style="background-color:  #edf4ee;color:  #17181a">查看输出 </summary><div class="toggle-content"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">+------+--------+-----------+--------+------+--------------------+-------------+------------+<br>| id   | workno | name      | gender | age  | idcard             | workaddress | entrydate  |<br>+------+--------+-----------+--------+------+--------------------+-------------+------------+<br>|    1 | 00001  | 柳岩666   | 女     |   20 | 123456789012345678 | 北京        | 2000-01-01 |<br>|    2 | 00002  | 张无忌    | 男     |   18 | 123456789012345670 | 北京        | 2005-09-01 |<br>|    3 | 00003  | 韦一笑    | 男     |   38 | 123456789712345670 | 上海        | 2005-08-01 |<br>|    4 | 00004  | 赵敏      | 女     |   18 | 123456757123845670 | 北京        | 2009-12-01 |<br>|    5 | 00005  | 小昭      | 女     |   16 | 123456769012345678 | 上海        | 2007-07-01 |<br>|    6 | 00006  | 杨逍      | 男     |   28 | 12345678931234567X | 北京        | 2006-01-01 |<br>|    7 | 00007  | 范瑶      | 男     |   40 | 123456789212345670 | 北京        | 2005-05-01 |<br>|    8 | 00008  | 黛绮丝    | 女     |   38 | 123456157123645670 | 天津        | 2015-05-01 |<br>|    9 | 00009  | 范凉凉    | 女     |   45 | 123156789012345678 | 北京        | 2010-04-01 |<br>|   10 | 00010  | 陈友谅    | 男     |   53 | 123456789012345670 | 上海        | 2011-01-01 |<br>+------+--------+-----------+--------+------+--------------------+-------------+------------+<br>10 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure></div></details>
<p><strong>B.</strong> 查询第2页员工数据, 每页展示10条记录 --------&gt; (页码-1)*页展示记录数</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> emp limit <span class="hljs-number">10</span>,<span class="hljs-number">10</span>;<br></code></pre></td></tr></table></figure>
<details class="toggle" style="border: 1px solid  #edf4ee"><summary class="toggle-button" style="background-color:  #edf4ee;color:  #17181a">查看输出 </summary><div class="toggle-content"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">+------+--------+-----------+--------+------+--------------------+-------------+------------+<br>| id   | workno | name      | gender | age  | idcard             | workaddress | entrydate  |<br>+------+--------+-----------+--------+------+--------------------+-------------+------------+<br>|   11 | 00011  | 张士诚    | 男     |   55 | 123567897123465670 | 江苏        | 2015-05-01 |<br>|   12 | 00012  | 常遇春    | 男     |   32 | 123446757152345670 | 北京        | 2004-02-01 |<br>|   13 | 00013  | 张三丰    | 男     |   88 | 123656789012345678 | 江苏        | 2020-11-01 |<br>|   14 | 00014  | 灭绝      | 女     |   65 | 123456719012345670 | 西安        | 2019-05-01 |<br>|   15 | 00015  | 胡青牛    | 男     |   70 | 12345674971234567X | 西安        | 2018-04-01 |<br>|   16 | 00016  | 周芷若    | 女     |   18 | NULL               | 北京        | 2012-06-01 |<br>+------+--------+-----------+--------+------+--------------------+-------------+------------+<br>6 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure></div></details>
<hr>
<br>
<ul>
<li><strong><u>案例</u></strong></li>
</ul>
<p><strong>1).</strong> 查询年龄为20,21,22,23岁的女员工信息。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> emp <span class="hljs-keyword">where</span> gender <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;女&#x27;</span> <span class="hljs-keyword">and</span> age <span class="hljs-keyword">in</span>(<span class="hljs-number">20</span>,<span class="hljs-number">21</span>,<span class="hljs-number">22</span>,<span class="hljs-number">23</span>);<br></code></pre></td></tr></table></figure>
<details class="toggle" style="border: 1px solid  #edf4ee"><summary class="toggle-button" style="background-color:  #edf4ee;color:  #17181a">查看输出 </summary><div class="toggle-content"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">+------+--------+-----------+--------+------+--------------------+-------------+------------+<br>| id   | workno | name      | gender | age  | idcard             | workaddress | entrydate  |<br>+------+--------+-----------+--------+------+--------------------+-------------+------------+<br>|    1 | 00001  | 柳岩666   | 女     |   20 | 123456789012345678 | 北京        | 2000-01-01 |<br>+------+--------+-----------+--------+------+--------------------+-------------+------------+<br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure></div></details>
<p><strong>2).</strong> 查询性别为 男 ，并且年龄在 20-40 岁(含)以内的姓名为三个字的员工。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> emp <br><span class="hljs-keyword">where</span> gender <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;男&#x27;</span> <span class="hljs-keyword">and</span> ( age <span class="hljs-keyword">between</span> <span class="hljs-number">20</span> <span class="hljs-keyword">and</span> <span class="hljs-number">40</span> ) <span class="hljs-keyword">and</span> name <span class="hljs-keyword">like</span> <span class="hljs-string">&#x27;___&#x27;</span>;<br></code></pre></td></tr></table></figure>
<details class="toggle" style="border: 1px solid  #edf4ee"><summary class="toggle-button" style="background-color:  #edf4ee;color:  #17181a">查看输出 </summary><div class="toggle-content"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">+------+--------+-----------+--------+------+--------------------+-------------+------------+<br>| id   | workno | name      | gender | age  | idcard             | workaddress | entrydate  |<br>+------+--------+-----------+--------+------+--------------------+-------------+------------+<br>|    3 | 00003  | 韦一笑    | 男     |   38 | 123456789712345670 | 上海        | 2005-08-01 |<br>|   12 | 00012  | 常遇春    | 男     |   32 | 123446757152345670 | 北京        | 2004-02-01 |<br>+------+--------+-----------+--------+------+--------------------+-------------+------------+<br>2 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure></div></details>
<p><strong>3).</strong> 统计员工表中, 年龄小于60岁的 , 男性员工和女性员工的人数。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> gender, <span class="hljs-built_in">count</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">from</span> emp <span class="hljs-keyword">where</span> age <span class="hljs-operator">&lt;</span> <span class="hljs-number">60</span> <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> gender;<br></code></pre></td></tr></table></figure>
<details class="toggle" style="border: 1px solid  #edf4ee"><summary class="toggle-button" style="background-color:  #edf4ee;color:  #17181a">查看输出 </summary><div class="toggle-content"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">+--------+----------+<br>| gender | count(*) |<br>+--------+----------+<br>| 女     |        6 |<br>| 男     |        7 |<br>+--------+----------+<br>2 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure></div></details>
<p><strong>4).</strong> 查询所有年龄小于等于35岁员工的姓名和年龄，并对查询结果按年龄升序排序，如果年龄相同按入职时间降序排序。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> name , age <span class="hljs-keyword">from</span> emp <span class="hljs-keyword">where</span> age <span class="hljs-operator">&lt;=</span> <span class="hljs-number">35</span> <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> age <span class="hljs-keyword">asc</span> , entrydate <span class="hljs-keyword">desc</span>;<br></code></pre></td></tr></table></figure>
<details class="toggle" style="border: 1px solid  #edf4ee"><summary class="toggle-button" style="background-color:  #edf4ee;color:  #17181a">查看输出 </summary><div class="toggle-content"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">+-----------+------+<br>| name      | age  |<br>+-----------+------+<br>| 小昭      |   16 |<br>| 周芷若    |   18 |<br>| 赵敏      |   18 |<br>| 张无忌    |   18 |<br>| 柳岩666   |   20 |<br>| 杨逍      |   28 |<br>| 常遇春    |   32 |<br>+-----------+------+<br>7 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure></div></details>
<p><strong>5).</strong> 查询性别为男，且年龄在20-40 岁(含)以内的前5个员工信息，对查询的结果按年龄升序排序，年龄相同按入职时间升序排序。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> emp <br><span class="hljs-keyword">where</span> gender <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;男&#x27;</span> <span class="hljs-keyword">and</span> age <span class="hljs-keyword">between</span> <span class="hljs-number">20</span> <span class="hljs-keyword">and</span> <span class="hljs-number">40</span> <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> age <span class="hljs-keyword">asc</span> , entrydate <span class="hljs-keyword">asc</span> <br>limit <span class="hljs-number">5</span> ;<br></code></pre></td></tr></table></figure>
<details class="toggle" style="border: 1px solid  #edf4ee"><summary class="toggle-button" style="background-color:  #edf4ee;color:  #17181a">查看输出 </summary><div class="toggle-content"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">+------+--------+-----------+--------+------+--------------------+-------------+------------+<br>| id   | workno | name      | gender | age  | idcard             | workaddress | entrydate  |<br>+------+--------+-----------+--------+------+--------------------+-------------+------------+<br>|    6 | 00006  | 杨逍      | 男     |   28 | 12345678931234567X | 北京        | 2006-01-01 |<br>|   12 | 00012  | 常遇春    | 男     |   32 | 123446757152345670 | 北京        | 2004-02-01 |<br>|    3 | 00003  | 韦一笑    | 男     |   38 | 123456789712345670 | 上海        | 2005-08-01 |<br>|    7 | 00007  | 范瑶      | 男     |   40 | 123456789212345670 | 北京        | 2005-05-01 |<br>+------+--------+-----------+--------+------+--------------------+-------------+------------+<br>4 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure></div></details>
<hr>
<br>
<ul>
<li><strong><u>执行顺序</u></strong></li>
</ul>
<p>在讲解DQL语句的具体语法之前，我们已经讲解了DQL语句的完整语法，及编写顺序，接下来，我们要来说明的是DQL语句在执行时的执行顺序，也就是先执行那一部分，后执行那一部分。</p>
<p><img src="/static/imgs/loading.gif" data-original="https://cdn.jsdelivr.net/gh/ggw2021/images@main/blogs/Snipaste_2024-04-09_22-09-43.png" alt=""></p>
<br>
<p>验证：<br>
查询年龄大于15的员工姓名、年龄，并根据年龄进行升序排序。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> name, age <span class="hljs-keyword">from</span> emp <span class="hljs-keyword">where</span> age <span class="hljs-operator">&gt;</span> <span class="hljs-number">15</span> <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> age <span class="hljs-keyword">asc</span>;<br></code></pre></td></tr></table></figure>
<p>在查询时，我们给emp表起一个别名 e，然后在select 及 where中使用该别名。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> e.name , e.age <span class="hljs-keyword">from</span> emp e <span class="hljs-keyword">where</span> e.age <span class="hljs-operator">&gt;</span> <span class="hljs-number">15</span> <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> age <span class="hljs-keyword">asc</span>;<br></code></pre></td></tr></table></figure>
<p>执行上述SQL语句后，我们看到依然可以正常的查询到结果，此时就说明： from 先执行, 然后 where 和 select 执行。那 where 和 select 到底哪个先执行呢?</p>
<p>此时，此时我们可以给select后面的字段起别名，然后在 where 中使用这个别名，然后看看是否可以执行成功</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> e.name ename, e.age eage <span class="hljs-keyword">from</span> emp e <span class="hljs-keyword">where</span> eage <span class="hljs-operator">&gt;</span> <span class="hljs-number">15</span> <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> age <span class="hljs-keyword">asc</span>;<br></code></pre></td></tr></table></figure>
<p>执行上述SQL报错了:  ERROR 1054 (42S22): Unknown column ‘eage’ in ‘where clause’</p>
<p>由此我们可以得出结论: from 先执行，然后执行 where ， 再执行select 。</p>
<br>
<p>接下来，我们再执行如下SQL语句，查看执行效果：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> e.name ename, e.age eage <span class="hljs-keyword">from</span> emp e <span class="hljs-keyword">where</span> e.age <span class="hljs-operator">&gt;</span> <span class="hljs-number">15</span> <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> eage <span class="hljs-keyword">asc</span>;<br></code></pre></td></tr></table></figure>
<p>结果执行成功。 那么也就验证了: order by 是在select 语句之后执行的。</p>
<br>
<p>综上所述，我们可以看到DQL语句的执行顺序为： from … where … group by …having … select … order by … limit …</p>
<hr>
<p><br><br><br></p>
<h4 id="2-5-DCL">2.5 DCL</h4>
<blockquote>
<p>DCL英文全称是Data Control Language(数据控制语言)，用来管理数据库用户、控制数据库的访问权限  <img src="/static/imgs/loading.gif" data-original="https://cdn.jsdelivr.net/gh/ggw2021/images@main/blogs/Snipaste_2024-04-09_22-17-08.png" alt=""></p>
</blockquote>
<br>
<ul>
<li><strong><u>管理用户</u></strong></li>
</ul>
<p><strong>1).</strong> 查询用户</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> mysql.user;<br></code></pre></td></tr></table></figure>
<details class="toggle" style="border: 1px solid  #edf4ee"><summary class="toggle-button" style="background-color:  #edf4ee;color:  #17181a">查看输出 </summary><div class="toggle-content"><p><img src="/static/imgs/loading.gif" data-original="https://cdn.jsdelivr.net/gh/ggw2021/images@main/blogs/Snipaste_2024-04-09_23-09-17.png" alt=""></p>
<p>其中 Host代表当前用户访问的主机, 如果为localhost, 仅代表只能够在当前本机访问，是不可以远程访问的。User代表的是访问该数据库的用户名。在MySQL中需要通过Host和User来唯一标识一个用户。</p>
</div></details>
<p><strong>2).</strong> 创建用户</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">USER</span> <span class="hljs-string">&#x27;用户名&#x27;</span>@<span class="hljs-string">&#x27;主机名&#x27;</span> IDENTIFIED <span class="hljs-keyword">BY</span> <span class="hljs-string">&#x27;密码&#x27;</span>;<br></code></pre></td></tr></table></figure>
<p><strong>3).</strong> 修改用户密码</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">USER</span> <span class="hljs-string">&#x27;用户名&#x27;</span>@<span class="hljs-string">&#x27;主机名&#x27;</span> IDENTIFIED <span class="hljs-keyword">WITH</span> mysql_native_password <span class="hljs-keyword">BY</span> <span class="hljs-string">&#x27;新密码&#x27;</span> ;<br></code></pre></td></tr></table></figure>
<p><strong>4).</strong> 删除用户</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">DROP</span> <span class="hljs-keyword">USER</span> <span class="hljs-string">&#x27;用户名&#x27;</span>@<span class="hljs-string">&#x27;主机名&#x27;</span> ;<br></code></pre></td></tr></table></figure>
<blockquote>
<p>注意事项:</p>
<ul>
<li>在MySQL中需要通过用户名@主机名的方式，来唯一标识一个用户。</li>
<li>主机名可以使用 % 通配。</li>
<li>这类SQL开发人员操作的比较少，主要是DBA（ Database Administrator 数据库管理员）使用。</li>
</ul>
</blockquote>
<br>
<p>案例：</p>
<p><strong>A.</strong> 创建用户itcast, 只能够在当前主机localhost访问, 密码123456;</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">create</span> <span class="hljs-keyword">user</span> <span class="hljs-string">&#x27;itcast&#x27;</span>@<span class="hljs-string">&#x27;localhost&#x27;</span> identified <span class="hljs-keyword">by</span> <span class="hljs-string">&#x27;123456&#x27;</span>;<br></code></pre></td></tr></table></figure>
<p><strong>B.</strong> 创建用户heima, 可以在任意主机访问该数据库, 密码123456;</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">create</span> <span class="hljs-keyword">user</span> <span class="hljs-string">&#x27;heima&#x27;</span>@<span class="hljs-string">&#x27;%&#x27;</span> identified <span class="hljs-keyword">by</span> <span class="hljs-string">&#x27;123456&#x27;</span>;<br></code></pre></td></tr></table></figure>
<p><strong>C.</strong> 修改用户heima的访问密码为1234;</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">alter</span> <span class="hljs-keyword">user</span> <span class="hljs-string">&#x27;heima&#x27;</span>@<span class="hljs-string">&#x27;%&#x27;</span> identified <span class="hljs-keyword">with</span> mysql_native_password <span class="hljs-keyword">by</span> <span class="hljs-string">&#x27;1234&#x27;</span>;<br></code></pre></td></tr></table></figure>
<p><strong>D.</strong> 删除 itcast@localhost 用户</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">drop</span> <span class="hljs-keyword">user</span> <span class="hljs-string">&#x27;itcast&#x27;</span>@<span class="hljs-string">&#x27;localhost&#x27;</span>;<br></code></pre></td></tr></table></figure>
<hr>
<br>
<ul>
<li><strong><u>权限控制</u></strong></li>
</ul>
<table>
<thead>
<tr>
<th>权限</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>ALL, ALL PRIVILEGES</td>
<td>所有权限</td>
</tr>
<tr>
<td>SELECT</td>
<td>查询数据</td>
</tr>
<tr>
<td>INSERT</td>
<td>插入数据</td>
</tr>
<tr>
<td>UPDATE</td>
<td>修改数据</td>
</tr>
<tr>
<td>DELETE</td>
<td>删除数据</td>
</tr>
<tr>
<td>ALTER</td>
<td>修改表</td>
</tr>
<tr>
<td>DROP</td>
<td>删除数据库/表/视图</td>
</tr>
<tr>
<td>CREATE</td>
<td>创建数据库/表</td>
</tr>
</tbody>
</table>
<p>上述只是简单罗列了常见的几种权限描述，其他权限描述及含义，可以直接参考<a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html">官方文档</a>。</p>
<br>
<p><strong>1).</strong> 查询权限</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SHOW</span> GRANTS <span class="hljs-keyword">FOR</span> <span class="hljs-string">&#x27;用户名&#x27;</span>@<span class="hljs-string">&#x27;主机名&#x27;</span> ;<br></code></pre></td></tr></table></figure>
<p><strong>2).</strong> 授予权限</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">GRANT</span> 权限列表 <span class="hljs-keyword">ON</span> 数据库名.表名 <span class="hljs-keyword">TO</span> <span class="hljs-string">&#x27;用户名&#x27;</span>@<span class="hljs-string">&#x27;主机名&#x27;</span>;<br></code></pre></td></tr></table></figure>
<p><strong>3).</strong> 撤销权限</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">REVOKE</span> 权限列表 <span class="hljs-keyword">ON</span> 数据库名.表名 <span class="hljs-keyword">FROM</span> <span class="hljs-string">&#x27;用户名&#x27;</span>@<span class="hljs-string">&#x27;主机名&#x27;</span>;<br></code></pre></td></tr></table></figure>
<blockquote>
<p>注意事项：</p>
<ul>
<li>多个权限之间，使用逗号分隔</li>
<li>授权时， 数据库名和表名可以使用 <code>*</code> 进行通配，代表所有。</li>
</ul>
</blockquote>
<br>
<p>案例:<br>
<strong>A.</strong> 查询 ‘heima’@‘%’ 用户的权限</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">show</span> grants <span class="hljs-keyword">for</span> <span class="hljs-string">&#x27;heima&#x27;</span>@<span class="hljs-string">&#x27;%&#x27;</span>;<br></code></pre></td></tr></table></figure>
<p><strong>B.</strong> 授予 ‘heima’@‘%’ 用户itcast数据库所有表的所有操作权限</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">grant</span> <span class="hljs-keyword">all</span> <span class="hljs-keyword">on</span> itcast.<span class="hljs-operator">*</span> <span class="hljs-keyword">to</span> <span class="hljs-string">&#x27;heima&#x27;</span>@<span class="hljs-string">&#x27;%&#x27;</span>;<br></code></pre></td></tr></table></figure>
<p><strong>C.</strong> 撤销 ‘heima’@‘%’ 用户的itcast数据库的所有权限</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">revoke</span> <span class="hljs-keyword">all</span> <span class="hljs-keyword">on</span> itcast.<span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;heima&#x27;</span>@<span class="hljs-string">&#x27;%&#x27;</span>;<br></code></pre></td></tr></table></figure>
<hr>
<p><br><br><br></p>
<h3 id="3-函数">3. 函数</h3>
<blockquote>
<p>函数 是指一段可以直接被另一段程序调用的程序或代码。 也就意味着，这一段程序或代码在MySQL中已经给我们提供了，我们要做的就是在合适的业务场景调用对应的函数完成对应的业务需求即可。 那么，函数到底在哪儿使用呢？</p>
<p>我们先来看两个场景：</p>
<p><strong>1).</strong> 在企业的OA或其他的人力系统中，经常会提供的有这样一个功能，每一个员工登录上来之后都能够看到当前员工入职的天数。 而在数据库中，存储的都是入职日期，如 2000-11-12，那如果快速计算出天数呢？<br>
<strong>2).</strong> 在做报表这类的业务需求中,我们要展示出学员的分数等级分布。而在数据库中，存储的是学生的分数值，如98/75，如何快速判定分数的等级呢？其实，上述的这一类的需求呢，我们通过MySQL中的函数都可以很方便的实现 。</p>
<p>MySQL中的函数主要分为以下四类： 字符串函数、数值函数、日期函数、流程函数。</p>
</blockquote>
<br>
<ul>
<li><strong><u>字符串函数</u></strong></li>
</ul>
<p>MySQL中内置了很多字符串函数，常用的几个如下：</p>
<table>
<thead>
<tr>
<th>函数</th>
<th>功能</th>
</tr>
</thead>
<tbody>
<tr>
<td>CONCAT(S1,S2,…Sn)</td>
<td>字符串拼接，将S1，S2，… Sn拼接成一个字符串</td>
</tr>
<tr>
<td>LOWER(str)</td>
<td>将字符串str全部转为小写</td>
</tr>
<tr>
<td>UPPER(str)</td>
<td>将字符串str全部转为大写</td>
</tr>
<tr>
<td>LPAD(str,n,pad)</td>
<td>左填充，用字符串pad对str的左边进行填充，达到n个字符串长度</td>
</tr>
<tr>
<td>RPAD(str,n,pad)</td>
<td>右填充，用字符串pad对str的右边进行填充，达到n个字符串长度</td>
</tr>
<tr>
<td>TRIM(str)</td>
<td>去掉字符串头部和尾部的空格</td>
</tr>
<tr>
<td>SUBSTRING(str,start,len)</td>
<td>返回从字符串str从start位置起的len个长度的字符串</td>
</tr>
</tbody>
</table>
<p>演示如下：<br>
<strong>A.</strong> concat : 字符串拼接</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> concat(<span class="hljs-string">&#x27;Hello&#x27;</span> , <span class="hljs-string">&#x27; MySQL&#x27;</span>);<br></code></pre></td></tr></table></figure>
<details class="toggle" style="border: 1px solid  #edf4ee"><summary class="toggle-button" style="background-color:  #edf4ee;color:  #17181a">查看输出 </summary><div class="toggle-content"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">+----------------------------+<br>| concat(&#x27;Hello&#x27; , &#x27; MySQL&#x27;) |<br>+----------------------------+<br>| Hello MySQL                |<br>+----------------------------+<br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure></div></details>
<p><strong>B.</strong> lower : 全部转小写</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-built_in">lower</span>(<span class="hljs-string">&#x27;Hello&#x27;</span>);<br></code></pre></td></tr></table></figure>
<details class="toggle" style="border: 1px solid  #edf4ee"><summary class="toggle-button" style="background-color:  #edf4ee;color:  #17181a">查看输出 </summary><div class="toggle-content"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">+----------------+<br>| lower(&#x27;Hello&#x27;) |<br>+----------------+<br>| hello          |<br>+----------------+<br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure>
</div></details>
<p><strong>C.</strong> upper : 全部转大写</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-built_in">upper</span>(<span class="hljs-string">&#x27;Hello&#x27;</span>);<br></code></pre></td></tr></table></figure>
<details class="toggle" style="border: 1px solid  #edf4ee"><summary class="toggle-button" style="background-color:  #edf4ee;color:  #17181a">查看输出 </summary><div class="toggle-content"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">+----------------+<br>| upper(&#x27;Hello&#x27;) |<br>+----------------+<br>| HELLO          |<br>+----------------+<br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure>
</div></details>
<p><strong>D.</strong> lpad : 左填充</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> lpad(<span class="hljs-string">&#x27;01&#x27;</span>, <span class="hljs-number">5</span>, <span class="hljs-string">&#x27;-&#x27;</span>);<br></code></pre></td></tr></table></figure>
<details class="toggle" style="border: 1px solid  #edf4ee"><summary class="toggle-button" style="background-color:  #edf4ee;color:  #17181a">查看输出 </summary><div class="toggle-content"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">+--------------------+<br>| lpad(&#x27;01&#x27;, 5, &#x27;-&#x27;) |<br>+--------------------+<br>| ---01              |<br>+--------------------+<br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure>
</div></details>
<p><strong>E.</strong>  rpad : 右填充</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> rpad(<span class="hljs-string">&#x27;01&#x27;</span>, <span class="hljs-number">5</span>, <span class="hljs-string">&#x27;-&#x27;</span>);<br></code></pre></td></tr></table></figure>
<details class="toggle" style="border: 1px solid  #edf4ee"><summary class="toggle-button" style="background-color:  #edf4ee;color:  #17181a">查看输出 </summary><div class="toggle-content"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">+--------------------+<br>| rpad(&#x27;01&#x27;, 5, &#x27;-&#x27;) |<br>+--------------------+<br>| 01---              |<br>+--------------------+<br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure>
</div></details>
<p><strong>F.</strong>  trim : 去除头尾空格</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-built_in">trim</span>(<span class="hljs-string">&#x27; Hello MySQL &#x27;</span>);<br></code></pre></td></tr></table></figure>
<details class="toggle" style="border: 1px solid  #edf4ee"><summary class="toggle-button" style="background-color:  #edf4ee;color:  #17181a">查看输出 </summary><div class="toggle-content"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">+-----------------------+<br>| trim(&#x27; Hello MySQL &#x27;) |<br>+-----------------------+<br>| Hello MySQL           |<br>+-----------------------+<br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure>
</div></details>
<p><strong>G.</strong>  substring : 截取子字符串</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-built_in">substring</span>(<span class="hljs-string">&#x27;Hello MySQL&#x27;</span>,<span class="hljs-number">1</span>,<span class="hljs-number">4</span>);<br></code></pre></td></tr></table></figure>
<details class="toggle" style="border: 1px solid  #edf4ee"><summary class="toggle-button" style="background-color:  #edf4ee;color:  #17181a">查看输出 </summary><div class="toggle-content"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">+------------------------------+<br>| substring(&#x27;Hello MySQL&#x27;,1,4) |<br>+------------------------------+<br>| Hell                         |<br>+------------------------------+<br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure>
</div></details>
<br>
<p>案例:</p>
<p>由于业务需求变更，企业员工的工号，统一为5位数，目前不足5位数的全部在前面补0。比如： 1号员<br>
工的工号应该为00001</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">update</span> emp <span class="hljs-keyword">set</span> workno <span class="hljs-operator">=</span> lpad(workno, <span class="hljs-number">5</span>, <span class="hljs-string">&#x27;0&#x27;</span>);<br></code></pre></td></tr></table></figure>
<details class="toggle" style="border: 1px solid  #edf4ee"><summary class="toggle-button" style="background-color:  #edf4ee;color:  #17181a">查看输出 </summary><div class="toggle-content"><p>原数据：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">+------+--------+-----------+--------+------+--------------------+-------------+------------+<br>| id   | workno | name      | gender | age  | idcard             | workaddress | entrydate  |<br>+------+--------+-----------+--------+------+--------------------+-------------+------------+<br>|    1 |     1  | 柳岩666   | 女     |   20 | 123456789012345678 | 北京        | 2000-01-01 |<br>|    2 |     2  | 张无忌    | 男     |   18 | 123456789012345670 | 北京        | 2005-09-01 |<br>|    3 |     3  | 韦一笑    | 男     |   38 | 123456789712345670 | 上海        | 2005-08-01 |<br>|    4 |     4  | 赵敏      | 女     |   18 | 123456757123845670 | 北京        | 2009-12-01 |<br>|    5 |     5  | 小昭      | 女     |   16 | 123456769012345678 | 上海        | 2007-07-01 |<br>|    6 |     6  | 杨逍      | 男     |   28 | 12345678931234567X | 北京        | 2006-01-01 |<br>|    7 |     7  | 范瑶      | 男     |   40 | 123456789212345670 | 北京        | 2005-05-01 |<br>|    8 |     8  | 黛绮丝    | 女     |   38 | 123456157123645670 | 天津        | 2015-05-01 |<br>|    9 |     9  | 范凉凉    | 女     |   45 | 123156789012345678 | 北京        | 2010-04-01 |<br>|   10 |    10  | 陈友谅    | 男     |   53 | 123456789012345670 | 上海        | 2011-01-01 |<br>|   11 |    11  | 张士诚    | 男     |   55 | 123567897123465670 | 江苏        | 2015-05-01 |<br>|   12 |    12  | 常遇春    | 男     |   32 | 123446757152345670 | 北京        | 2004-02-01 |<br>|   13 |    13  | 张三丰    | 男     |   88 | 123656789012345678 | 江苏        | 2020-11-01 |<br>|   14 |    14  | 灭绝      | 女     |   65 | 123456719012345670 | 西安        | 2019-05-01 |<br>|   15 |    15  | 胡青牛    | 男     |   70 | 12345674971234567X | 西安        | 2018-04-01 |<br>|   16 |    16  | 周芷若    | 女     |   18 | NULL               | 北京        | 2012-06-01 |<br>+------+--------+-----------+--------+------+--------------------+-------------+------------+<br></code></pre></td></tr></table></figure>
<p>处理完毕后, 具体的数据为:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">+------+--------+-----------+--------+------+--------------------+-------------+------------+<br>| id   | workno | name      | gender | age  | idcard             | workaddress | entrydate  |<br>+------+--------+-----------+--------+------+--------------------+-------------+------------+<br>|    1 | 00001  | 柳岩666   | 女     |   20 | 123456789012345678 | 北京        | 2000-01-01 |<br>|    2 | 00002  | 张无忌    | 男     |   18 | 123456789012345670 | 北京        | 2005-09-01 |<br>|    3 | 00003  | 韦一笑    | 男     |   38 | 123456789712345670 | 上海        | 2005-08-01 |<br>|    4 | 00004  | 赵敏      | 女     |   18 | 123456757123845670 | 北京        | 2009-12-01 |<br>|    5 | 00005  | 小昭      | 女     |   16 | 123456769012345678 | 上海        | 2007-07-01 |<br>|    6 | 00006  | 杨逍      | 男     |   28 | 12345678931234567X | 北京        | 2006-01-01 |<br>|    7 | 00007  | 范瑶      | 男     |   40 | 123456789212345670 | 北京        | 2005-05-01 |<br>|    8 | 00008  | 黛绮丝    | 女     |   38 | 123456157123645670 | 天津        | 2015-05-01 |<br>|    9 | 00009  | 范凉凉    | 女     |   45 | 123156789012345678 | 北京        | 2010-04-01 |<br>|   10 | 00010  | 陈友谅    | 男     |   53 | 123456789012345670 | 上海        | 2011-01-01 |<br>|   11 | 00011  | 张士诚    | 男     |   55 | 123567897123465670 | 江苏        | 2015-05-01 |<br>|   12 | 00012  | 常遇春    | 男     |   32 | 123446757152345670 | 北京        | 2004-02-01 |<br>|   13 | 00013  | 张三丰    | 男     |   88 | 123656789012345678 | 江苏        | 2020-11-01 |<br>|   14 | 00014  | 灭绝      | 女     |   65 | 123456719012345670 | 西安        | 2019-05-01 |<br>|   15 | 00015  | 胡青牛    | 男     |   70 | 12345674971234567X | 西安        | 2018-04-01 |<br>|   16 | 00016  | 周芷若    | 女     |   18 | NULL               | 北京        | 2012-06-01 |<br>+------+--------+-----------+--------+------+--------------------+-------------+------------+<br></code></pre></td></tr></table></figure>
</div></details>
<hr>
<br>
<ul>
<li><strong><u>数值函数</u></strong></li>
</ul>
<p>常见的数值函数如下：</p>
<table>
<thead>
<tr>
<th>函数</th>
<th>功能</th>
</tr>
</thead>
<tbody>
<tr>
<td>CEIL(x)</td>
<td>向上取整</td>
</tr>
<tr>
<td>FLOOR(x)</td>
<td>向下取整</td>
</tr>
<tr>
<td>MOD(x,y)</td>
<td>返回x/y的模</td>
</tr>
<tr>
<td>RAND()</td>
<td>返回0~1内的随机数</td>
</tr>
<tr>
<td>ROUND(x,y)</td>
<td>求参数x的四舍五入的值，保留y位小数</td>
</tr>
</tbody>
</table>
<p>演示如下：<br>
<strong>A.</strong> ceil：向上取整</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-built_in">ceil</span>(<span class="hljs-number">1.1</span>);<br></code></pre></td></tr></table></figure>
<details class="toggle" style="border: 1px solid  #edf4ee"><summary class="toggle-button" style="background-color:  #edf4ee;color:  #17181a">查看输出 </summary><div class="toggle-content"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">+-----------+<br>| ceil(1.1) |<br>+-----------+<br>|         2 |<br>+-----------+<br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure></div></details>
<p><strong>B.</strong> floor：向下取整</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-built_in">floor</span>(<span class="hljs-number">1.9</span>);<br></code></pre></td></tr></table></figure>
<details class="toggle" style="border: 1px solid  #edf4ee"><summary class="toggle-button" style="background-color:  #edf4ee;color:  #17181a">查看输出 </summary><div class="toggle-content"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">+------------+<br>| floor(1.9) |<br>+------------+<br>|          1 |<br>+------------+<br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure></div></details>
<p><strong>C.</strong> mod：取模</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-built_in">mod</span>(<span class="hljs-number">7</span>,<span class="hljs-number">4</span>);<br></code></pre></td></tr></table></figure>
<details class="toggle" style="border: 1px solid  #edf4ee"><summary class="toggle-button" style="background-color:  #edf4ee;color:  #17181a">查看输出 </summary><div class="toggle-content"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">+----------+<br>| mod(7,4) |<br>+----------+<br>|        3 |<br>+----------+<br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure></div></details>
<p><strong>D.</strong> rand：获取随机数</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> rand();<br></code></pre></td></tr></table></figure>
<details class="toggle" style="border: 1px solid  #edf4ee"><summary class="toggle-button" style="background-color:  #edf4ee;color:  #17181a">查看输出 </summary><div class="toggle-content"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">+---------------------+<br>| rand()              |<br>+---------------------+<br>| 0.32115934725958795 |<br>+---------------------+<br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure></div></details>
<p><strong>E.</strong>  round：四舍五入</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> round(<span class="hljs-number">2.344</span>,<span class="hljs-number">2</span>);<br></code></pre></td></tr></table></figure>
<details class="toggle" style="border: 1px solid  #edf4ee"><summary class="toggle-button" style="background-color:  #edf4ee;color:  #17181a">查看输出 </summary><div class="toggle-content"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">+----------------+<br>| round(2.344,2) |<br>+----------------+<br>|           2.34 |<br>+----------------+<br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure></div></details>
<br>
<p>案例：<br>
通过数据库的函数，生成一个六位数的随机验证码。<br>
思路： 获取随机数可以通过rand()函数，但是获取出来的随机数是在0-1之间的，所以可以在其基础上乘以1000000，然后舍弃小数部分，如果长度不足6位，补0</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> lpad(round(rand()<span class="hljs-operator">*</span><span class="hljs-number">1000000</span> , <span class="hljs-number">0</span>), <span class="hljs-number">6</span>, <span class="hljs-string">&#x27;0&#x27;</span>);<br></code></pre></td></tr></table></figure>
<details class="toggle" style="border: 1px solid  #edf4ee"><summary class="toggle-button" style="background-color:  #edf4ee;color:  #17181a">查看输出 </summary><div class="toggle-content"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">+-----------------------------------------+<br>| lpad(round(rand()*1000000 , 0), 6, &#x27;0&#x27;) |<br>+-----------------------------------------+<br>| 604623                                  |<br>+-----------------------------------------+<br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure></div></details>
<hr>
<br>
<ul>
<li><strong><u>日期函数</u></strong></li>
</ul>
<p>常见的日期函数如下：</p>
<table>
<thead>
<tr>
<th>函数</th>
<th>功能</th>
</tr>
</thead>
<tbody>
<tr>
<td>CURDATE()</td>
<td>返回当前日期</td>
</tr>
<tr>
<td>CURTIME()</td>
<td>返回当前时间</td>
</tr>
<tr>
<td>NOW()</td>
<td>返回当前日期和时间</td>
</tr>
<tr>
<td>YEAR(date)</td>
<td>获取指定date的年份</td>
</tr>
<tr>
<td>MONTH(date)</td>
<td>获取指定date的月份</td>
</tr>
<tr>
<td>DAY(date)</td>
<td>获取指定date的日期</td>
</tr>
<tr>
<td>DATE_ADD(date, INTERVAL expr type)</td>
<td>返回一个日期/时间值加上一个时间间隔expr后的时间值</td>
</tr>
<tr>
<td>DATEDIFF(date1,date2)</td>
<td>返回起始时间date1和 结束时间date2之间的天数<br />date2-date1</td>
</tr>
</tbody>
</table>
<p>演示如下：<br>
<strong>A.</strong> curdate：当前日期</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> curdate();<br></code></pre></td></tr></table></figure>
<details class="toggle" style="border: 1px solid  #edf4ee"><summary class="toggle-button" style="background-color:  #edf4ee;color:  #17181a">查看输出 </summary><div class="toggle-content"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">+------------+<br>| curdate()  |<br>+------------+<br>| 2024-04-10 |<br>+------------+<br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure></div></details>
<p><strong>B.</strong> curtime：当前时间</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> curtime();<br></code></pre></td></tr></table></figure>
<details class="toggle" style="border: 1px solid  #edf4ee"><summary class="toggle-button" style="background-color:  #edf4ee;color:  #17181a">查看输出 </summary><div class="toggle-content"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">+-----------+<br>| curtime() |<br>+-----------+<br>| 00:31:18  |<br>+-----------+<br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure>
</div></details>
<p><strong>C.</strong> now：当前日期和时间</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> now();<br></code></pre></td></tr></table></figure>
<details class="toggle" style="border: 1px solid  #edf4ee"><summary class="toggle-button" style="background-color:  #edf4ee;color:  #17181a">查看输出 </summary><div class="toggle-content"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">+---------------------+<br>| now()               |<br>+---------------------+<br>| 2024-04-10 00:31:37 |<br>+---------------------+<br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure>
</div></details>
<p><strong>D.</strong> YEAR , MONTH , DAY：当前年、月、日</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-keyword">YEAR</span>(now());<br><span class="hljs-keyword">select</span> <span class="hljs-keyword">MONTH</span>(now());<br><span class="hljs-keyword">select</span> <span class="hljs-keyword">DAY</span>(now());<br></code></pre></td></tr></table></figure>
<details class="toggle" style="border: 1px solid  #edf4ee"><summary class="toggle-button" style="background-color:  #edf4ee;color:  #17181a">查看输出 </summary><div class="toggle-content"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">mysql&gt; select YEAR(now());<br>+-------------+<br>| YEAR(now()) |<br>+-------------+<br>|        2024 |<br>+-------------+<br>1 row in set (0.00 sec)<br><br>mysql&gt; select MONTH(now());<br>+--------------+<br>| MONTH(now()) |<br>+--------------+<br>|            4 |<br>+--------------+<br>1 row in set (0.00 sec)<br><br>mysql&gt; select DAY(now());<br>+------------+<br>| DAY(now()) |<br>+------------+<br>|         10 |<br>+------------+<br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure>
</div></details>
<p><strong>E.</strong>  date_add：增加指定的时间间隔</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> date_add(now(), <span class="hljs-type">INTERVAL</span> <span class="hljs-number">70</span> <span class="hljs-keyword">YEAR</span> );<br></code></pre></td></tr></table></figure>
<details class="toggle" style="border: 1px solid  #edf4ee"><summary class="toggle-button" style="background-color:  #edf4ee;color:  #17181a">查看输出 </summary><div class="toggle-content"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">+------------------------------------+<br>| date_add(now(), INTERVAL 70 YEAR ) |<br>+------------------------------------+<br>| 2094-04-10 00:32:42                |<br>+------------------------------------+<br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure>
</div></details>
<p><strong>F.</strong>  datediff：获取两个日期相差的天数</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> datediff(<span class="hljs-string">&#x27;2021-10-01&#x27;</span>, <span class="hljs-string">&#x27;2021-12-01&#x27;</span>);<br></code></pre></td></tr></table></figure>
<details class="toggle" style="border: 1px solid  #edf4ee"><summary class="toggle-button" style="background-color:  #edf4ee;color:  #17181a">查看输出 </summary><div class="toggle-content"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">mysql&gt; select datediff(&#x27;2021-10-01&#x27;, &#x27;2021-12-01&#x27;);<br>+--------------------------------------+<br>| datediff(&#x27;2021-10-01&#x27;, &#x27;2021-12-01&#x27;) |<br>+--------------------------------------+<br>|                                  -61 |<br>+--------------------------------------+<br>1 row in set (0.00 sec)<br><br>mysql&gt; select datediff(&#x27;2021-12-01&#x27;, &#x27;2021-10-01&#x27;);<br>+--------------------------------------+<br>| datediff(&#x27;2021-12-01&#x27;, &#x27;2021-10-01&#x27;) |<br>+--------------------------------------+<br>|                                   61 |<br>+--------------------------------------+<br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure>
</div></details>
<br>
<p>案例：<br>
查询所有员工的入职天数，并根据入职天数倒序排序。<br>
思路： 入职天数，就是通过当前日期 - 入职日期，所以需要使用datediff函数来完成。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> name, datediff(curdate(), entrydate) <span class="hljs-keyword">as</span> <span class="hljs-string">&#x27;entrydays&#x27;</span> <br><span class="hljs-keyword">from</span> emp <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> entrydays <span class="hljs-keyword">desc</span>;<br></code></pre></td></tr></table></figure>
<details class="toggle" style="border: 1px solid  #edf4ee"><summary class="toggle-button" style="background-color:  #edf4ee;color:  #17181a">查看输出 </summary><div class="toggle-content"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">+-----------+-----------+<br>| name      | entrydays |<br>+-----------+-----------+<br>| 柳岩666   |      8866 |<br>| 常遇春    |      7374 |<br>| 范瑶      |      6919 |<br>| 韦一笑    |      6827 |<br>| 张无忌    |      6796 |<br>| 杨逍      |      6674 |<br>| 小昭      |      6128 |<br>| 赵敏      |      5244 |<br>| 范凉凉    |      5123 |<br>| 陈友谅    |      4848 |<br>| 周芷若    |      4331 |<br>| 黛绮丝    |      3267 |<br>| 张士诚    |      3267 |<br>| 胡青牛    |      2201 |<br>| 灭绝      |      1806 |<br>| 张三丰    |      1256 |<br>+-----------+-----------+<br>16 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure></div></details>
<hr>
<br>
<ul>
<li><strong><u>流程函数</u></strong></li>
</ul>
<p>流程函数也是很常用的一类函数，可以在SQL语句中实现条件筛选，从而提高语句的效率。</p>
<table>
<thead>
<tr>
<th>函数</th>
<th>功能</th>
</tr>
</thead>
<tbody>
<tr>
<td>IF(value , t , f)</td>
<td>如果value为true，则返回t，否则返回 f</td>
</tr>
<tr>
<td>IFNULL(value1 , value2)</td>
<td>如果value1不为空，返回value1，否则返回value2</td>
</tr>
<tr>
<td>CASE WHEN [ val1 ] THEN [res1] … ELSE [ default ] END</td>
<td>如果val1为true，返回res1，… 否则返回default默认值</td>
</tr>
<tr>
<td>CASE [ expr ] WHEN [ val1 ] THEN [res1] … ELSE [ default ] END</td>
<td>如果expr的值等于val1，返回 res1，… 否则返回default默认值</td>
</tr>
</tbody>
</table>
<p>演示如下：<br>
<strong>A.</strong> if</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> if(<span class="hljs-literal">false</span>, <span class="hljs-string">&#x27;Ok&#x27;</span>, <span class="hljs-string">&#x27;Error&#x27;</span>);<br></code></pre></td></tr></table></figure>
<details class="toggle" style="border: 1px solid  #edf4ee"><summary class="toggle-button" style="background-color:  #edf4ee;color:  #17181a">查看输出 </summary><div class="toggle-content"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">+--------------------------+<br>| if(false, &#x27;Ok&#x27;, &#x27;Error&#x27;) |<br>+--------------------------+<br>| Error                    |<br>+--------------------------+<br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure></div></details>
<p><strong>B.</strong> ifnull</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> ifnull(<span class="hljs-string">&#x27;Ok&#x27;</span>,<span class="hljs-string">&#x27;Default&#x27;</span>);<br><span class="hljs-keyword">select</span> ifnull(<span class="hljs-string">&#x27;&#x27;</span>,<span class="hljs-string">&#x27;Default&#x27;</span>);<br><span class="hljs-keyword">select</span> ifnull(<span class="hljs-keyword">null</span>,<span class="hljs-string">&#x27;Default&#x27;</span>);<br></code></pre></td></tr></table></figure>
<details class="toggle" style="border: 1px solid  #edf4ee"><summary class="toggle-button" style="background-color:  #edf4ee;color:  #17181a">查看输出 </summary><div class="toggle-content"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">mysql&gt; select ifnull(&#x27;Ok&#x27;,&#x27;Default&#x27;);<br>+------------------------+<br>| ifnull(&#x27;Ok&#x27;,&#x27;Default&#x27;) |<br>+------------------------+<br>| Ok                     |<br>+------------------------+<br>1 row in set (0.00 sec)<br><br>mysql&gt; select ifnull(&#x27;&#x27;,&#x27;Default&#x27;);<br>+----------------------+<br>| ifnull(&#x27;&#x27;,&#x27;Default&#x27;) |<br>+----------------------+<br>|                      |<br>+----------------------+<br>1 row in set (0.00 sec)<br><br>mysql&gt; select ifnull(null,&#x27;Default&#x27;);<br>+------------------------+<br>| ifnull(null,&#x27;Default&#x27;) |<br>+------------------------+<br>| Default                |<br>+------------------------+<br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure></div></details>
<p><strong>C.</strong> case when then else end<br>
需求: 查询emp表的员工姓名和工作地址 (北京/上海 ----&gt; 一线城市 , 其他 ----&gt; 二线城市)</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <br>    name,<br>    ( <span class="hljs-keyword">case</span> workaddress <br>        <span class="hljs-keyword">when</span> <span class="hljs-string">&#x27;北京&#x27;</span> <span class="hljs-keyword">then</span> <span class="hljs-string">&#x27;一线城市&#x27;</span> <br>        <span class="hljs-keyword">when</span> <span class="hljs-string">&#x27;上海&#x27;</span> <span class="hljs-keyword">then</span> <span class="hljs-string">&#x27;一线城市&#x27;</span> <br>        <span class="hljs-keyword">else</span> <span class="hljs-string">&#x27;二线城市&#x27;</span> <span class="hljs-keyword">end</span> ) <br>    <span class="hljs-keyword">as</span> <span class="hljs-string">&#x27;工作地址&#x27;</span><br><span class="hljs-keyword">from</span> emp;<br></code></pre></td></tr></table></figure>
<details class="toggle" style="border: 1px solid  #edf4ee"><summary class="toggle-button" style="background-color:  #edf4ee;color:  #17181a">查看输出 </summary><div class="toggle-content"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">+-----------+--------------+<br>| name      | 工作地址     |<br>+-----------+--------------+<br>| 柳岩666   | 一线城市     |<br>| 张无忌    | 一线城市     |<br>| 韦一笑    | 一线城市     |<br>| 赵敏      | 一线城市     |<br>| 小昭      | 一线城市     |<br>| 杨逍      | 一线城市     |<br>| 范瑶      | 一线城市     |<br>| 黛绮丝    | 二线城市     |<br>| 范凉凉    | 一线城市     |<br>| 陈友谅    | 一线城市     |<br>| 张士诚    | 二线城市     |<br>| 常遇春    | 一线城市     |<br>| 张三丰    | 二线城市     |<br>| 灭绝      | 二线城市     |<br>| 胡青牛    | 二线城市     |<br>| 周芷若    | 一线城市     |<br>+-----------+--------------+<br>16 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure></div></details>
<br>
<p>案例:</p>
<details class="toggle" style="border: 1px solid  #edf4ee"><summary class="toggle-button" style="background-color:  #edf4ee;color:  #17181a">导入数据 </summary><div class="toggle-content"><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> score(<br>    id <span class="hljs-type">int</span> comment <span class="hljs-string">&#x27;ID&#x27;</span>,<br>    name <span class="hljs-type">varchar</span>(<span class="hljs-number">20</span>) comment <span class="hljs-string">&#x27;姓名&#x27;</span>,<br>    math <span class="hljs-type">int</span> comment <span class="hljs-string">&#x27;数学&#x27;</span>,<br>    english <span class="hljs-type">int</span> comment <span class="hljs-string">&#x27;英语&#x27;</span>,<br>    chinese <span class="hljs-type">int</span> comment <span class="hljs-string">&#x27;语文&#x27;</span><br>) comment <span class="hljs-string">&#x27;学员成绩表&#x27;</span>;<br><br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> score(id, name, math, english, chinese) <span class="hljs-keyword">VALUES</span> <br>(<span class="hljs-number">1</span>, <span class="hljs-string">&#x27;Tom&#x27;</span>, <span class="hljs-number">67</span>, <span class="hljs-number">88</span>, <span class="hljs-number">95</span>), <br>(<span class="hljs-number">2</span>, <span class="hljs-string">&#x27;Rose&#x27;</span> , <span class="hljs-number">23</span>, <span class="hljs-number">66</span>, <span class="hljs-number">90</span>),<br>(<span class="hljs-number">3</span>, <span class="hljs-string">&#x27;Jack&#x27;</span>, <span class="hljs-number">56</span>, <span class="hljs-number">98</span>, <span class="hljs-number">76</span>);<br></code></pre></td></tr></table></figure></div></details>
<p>具体的SQL语句如下:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span><br>    id,<br>    name,<br>    (<span class="hljs-keyword">case</span> <br>        <span class="hljs-keyword">when</span> math <span class="hljs-operator">&gt;=</span> <span class="hljs-number">85</span> <span class="hljs-keyword">then</span> <span class="hljs-string">&#x27;优秀&#x27;</span> <br>        <span class="hljs-keyword">when</span> math <span class="hljs-operator">&gt;=</span><span class="hljs-number">60</span> <span class="hljs-keyword">then</span> <span class="hljs-string">&#x27;及格&#x27;</span> <br>        <span class="hljs-keyword">else</span> <span class="hljs-string">&#x27;不及格&#x27;</span> <span class="hljs-keyword">end</span> )<br>    <span class="hljs-string">&#x27;数学&#x27;</span>,<br>    (<span class="hljs-keyword">case</span> <br>        <span class="hljs-keyword">when</span> english <span class="hljs-operator">&gt;=</span> <span class="hljs-number">85</span> <span class="hljs-keyword">then</span> <span class="hljs-string">&#x27;优秀&#x27;</span> <br>        <span class="hljs-keyword">when</span> english <span class="hljs-operator">&gt;=</span><span class="hljs-number">60</span> <span class="hljs-keyword">then</span> <span class="hljs-string">&#x27;及格&#x27;</span> <br>        <span class="hljs-keyword">else</span> <span class="hljs-string">&#x27;不及格&#x27;</span> <span class="hljs-keyword">end</span> ) <br>    <span class="hljs-string">&#x27;英语&#x27;</span>,<br>    (<span class="hljs-keyword">case</span> <br>        <span class="hljs-keyword">when</span> chinese <span class="hljs-operator">&gt;=</span> <span class="hljs-number">85</span> <span class="hljs-keyword">then</span> <span class="hljs-string">&#x27;优秀&#x27;</span> <br>        <span class="hljs-keyword">when</span> chinese <span class="hljs-operator">&gt;=</span><span class="hljs-number">60</span> <span class="hljs-keyword">then</span> <span class="hljs-string">&#x27;及格&#x27;</span> <br>        <span class="hljs-keyword">else</span> <span class="hljs-string">&#x27;不及格&#x27;</span><span class="hljs-keyword">end</span> ) <br>     <span class="hljs-string">&#x27;语文&#x27;</span><br><span class="hljs-keyword">from</span> score;<br></code></pre></td></tr></table></figure>
<details class="toggle" style="border: 1px solid  #edf4ee"><summary class="toggle-button" style="background-color:  #edf4ee;color:  #17181a">查看输出 </summary><div class="toggle-content"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">+------+------+-----------+--------+--------+<br>| id   | name | 数学      | 英语   | 语文   |<br>+------+------+-----------+--------+--------+<br>|    1 | Tom  | 及格      | 优秀   | 优秀   |<br>|    2 | Rose | 不及格    | 及格   | 优秀   |<br>|    3 | Jack | 不及格    | 优秀   | 及格   |<br>+------+------+-----------+--------+--------+<br>3 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure></div></details>
<hr>
<br>
<p>MySQL的常见函数我们学习完了，那接下来，我们就来分析一下，在前面讲到的两个函数的案例场景，思考一下需要用到什么样的函数来实现?</p>
<p><strong>1).</strong> 数据库中，存储的是入职日期，如 2000-01-01，如何快速计算出入职天数呢？ --------&gt;<br>
答案: <span class="hide-inline"><button type="button" class="hide-button" style="background-color: #e3e3e3;color: #333">查看答案
  </button><span class="hide-content">datediff </span></span></p>
<p><strong>2).</strong> 数据库中，存储的是学生的分数值，如98、75，如何快速判定分数的等级呢？ ----------&gt;<br>
答案: <span class="hide-inline"><button type="button" class="hide-button" style="background-color: #e3e3e3;color: #333">查看答案
  </button><span class="hide-content">case ... when ... </span></span></p>
<hr>
<p><br><br><br></p>
<h3 id="4-约束">4. 约束</h3>
<h4 id="4-1-概述与演示">4.1 概述与演示</h4>
<p>概念：约束是作用于表中字段上的规则，用于限制存储在表中的数据。</p>
<p>目的：保证数据库中数据的正确、有效性和完整性</p>
<table>
<thead>
<tr>
<th style="text-align:left">约束</th>
<th style="text-align:left">描述</th>
<th style="text-align:left">关键字</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">非空约束</td>
<td style="text-align:left">限制该字段的数据不能为null</td>
<td style="text-align:left">NOT NULL</td>
</tr>
<tr>
<td style="text-align:left">唯一约束</td>
<td style="text-align:left">保证该字段的所有数据都是唯一、不重复的</td>
<td style="text-align:left">UNIQUE</td>
</tr>
<tr>
<td style="text-align:left">主键约束</td>
<td style="text-align:left">主键是一行数据的唯一标识，要求非空且唯一</td>
<td style="text-align:left">PRIMARY KEY</td>
</tr>
<tr>
<td style="text-align:left">默认约束</td>
<td style="text-align:left">保存数据时，如果未指定该字段的值，则采用默认值</td>
<td style="text-align:left">DEFAULT</td>
</tr>
<tr>
<td style="text-align:left">检查约束(8.0.16版本 之后)</td>
<td style="text-align:left">保证字段值满足某一个条件</td>
<td style="text-align:left">CHECK</td>
</tr>
<tr>
<td style="text-align:left">外键约束</td>
<td style="text-align:left">用来让两张表的数据之间建立连接，保证数据的一致 性和完整性</td>
<td style="text-align:left">FOREIGN KEY</td>
</tr>
</tbody>
</table>
<blockquote>
<p>注意：约束是作用于表中字段上的，可以在创建表/修改表的时候添加约束。</p>
</blockquote>
<br>
<p>上面我们介绍了数据库中常见的约束，以及约束涉及到的关键字，那这些约束我们到底如何在创建表、修改表的时候来指定呢，接下来我们就通过一个案例，来演示一下。</p>
<p>案例需求： 根据需求，完成表结构的创建。需求如下：</p>
<table>
<thead>
<tr>
<th>字段名</th>
<th>字段含 义</th>
<th>字段类型</th>
<th>约束条件</th>
<th>约束关键字</th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>ID唯一 标识</td>
<td>int</td>
<td>主键，并且自动增长</td>
<td>PRIMARY KEY, AUTO_INCREMENT</td>
</tr>
<tr>
<td>name</td>
<td>姓名</td>
<td>varchar(10)</td>
<td>不为空，并且唯一</td>
<td>NOT NULL , UNIQUE</td>
</tr>
<tr>
<td>age</td>
<td>年龄</td>
<td>int</td>
<td>大于0，并且小于等 于120</td>
<td>CHECK</td>
</tr>
<tr>
<td>status</td>
<td>状态</td>
<td>char(1)</td>
<td>如果没有指定该值， 默认为1</td>
<td>DEFAULT</td>
</tr>
<tr>
<td>gender</td>
<td>性别</td>
<td>char(1)</td>
<td>无</td>
<td></td>
</tr>
</tbody>
</table>
<p>对应的建表语句为：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> tb_user(<br>    id <span class="hljs-type">int</span> AUTO_INCREMENT <span class="hljs-keyword">PRIMARY</span> KEY COMMENT <span class="hljs-string">&#x27;ID唯一标识&#x27;</span>,<br>    name <span class="hljs-type">varchar</span>(<span class="hljs-number">10</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">UNIQUE</span> COMMENT <span class="hljs-string">&#x27;姓名&#x27;</span> ,<br>    age <span class="hljs-type">int</span> <span class="hljs-keyword">check</span> (age <span class="hljs-operator">&gt;</span> <span class="hljs-number">0</span> <span class="hljs-operator">&amp;&amp;</span> age <span class="hljs-operator">&lt;=</span> <span class="hljs-number">120</span>) COMMENT <span class="hljs-string">&#x27;年龄&#x27;</span> ,<br>    status <span class="hljs-type">char</span>(<span class="hljs-number">1</span>) <span class="hljs-keyword">default</span> <span class="hljs-string">&#x27;1&#x27;</span> COMMENT <span class="hljs-string">&#x27;状态&#x27;</span>,<br>    gender <span class="hljs-type">char</span>(<span class="hljs-number">1</span>) COMMENT <span class="hljs-string">&#x27;性别&#x27;</span><br>);<br></code></pre></td></tr></table></figure>
<p>在为字段添加约束时，我们只需要在字段之后加上约束的关键字即可，需要关注其语法。我们执行上面的SQL把表结构创建完成，然后接下来，就可以通过一组数据进行测试，从而验证一下，约束是否可以生效。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> tb_user(name,age,status,gender) <span class="hljs-keyword">values</span> <br>(<span class="hljs-string">&#x27;Tom1&#x27;</span>,<span class="hljs-number">19</span>,<span class="hljs-string">&#x27;1&#x27;</span>,<span class="hljs-string">&#x27;男&#x27;</span>),<br>(<span class="hljs-string">&#x27;Tom2&#x27;</span>,<span class="hljs-number">25</span>,<span class="hljs-string">&#x27;0&#x27;</span>,<span class="hljs-string">&#x27;男&#x27;</span>);<br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> tb_user(name,age,status,gender) <span class="hljs-keyword">values</span> (<span class="hljs-string">&#x27;Tom3&#x27;</span>,<span class="hljs-number">19</span>,<span class="hljs-string">&#x27;1&#x27;</span>,<span class="hljs-string">&#x27;男&#x27;</span>);<br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> tb_user(name,age,status,gender) <span class="hljs-keyword">values</span> (<span class="hljs-keyword">null</span>,<span class="hljs-number">19</span>,<span class="hljs-string">&#x27;1&#x27;</span>,<span class="hljs-string">&#x27;男&#x27;</span>);<br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> tb_user(name,age,status,gender) <span class="hljs-keyword">values</span> (<span class="hljs-string">&#x27;Tom3&#x27;</span>,<span class="hljs-number">19</span>,<span class="hljs-string">&#x27;1&#x27;</span>,<span class="hljs-string">&#x27;男&#x27;</span>);<br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> tb_user(name,age,status,gender) <span class="hljs-keyword">values</span> (<span class="hljs-string">&#x27;Tom4&#x27;</span>,<span class="hljs-number">80</span>,<span class="hljs-string">&#x27;1&#x27;</span>,<span class="hljs-string">&#x27;男&#x27;</span>);<br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> tb_user(name,age,status,gender) <span class="hljs-keyword">values</span> (<span class="hljs-string">&#x27;Tom5&#x27;</span>,<span class="hljs-number">-1</span>,<span class="hljs-string">&#x27;1&#x27;</span>,<span class="hljs-string">&#x27;男&#x27;</span>);<br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> tb_user(name,age,status,gender) <span class="hljs-keyword">values</span> (<span class="hljs-string">&#x27;Tom5&#x27;</span>,<span class="hljs-number">121</span>,<span class="hljs-string">&#x27;1&#x27;</span>,<span class="hljs-string">&#x27;男&#x27;</span>);<br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> tb_user(name,age,gender) <span class="hljs-keyword">values</span> (<span class="hljs-string">&#x27;Tom5&#x27;</span>,<span class="hljs-number">120</span>,<span class="hljs-string">&#x27;男&#x27;</span>);<br></code></pre></td></tr></table></figure>
<br>
<p>上面，我们是通过编写SQL语句的形式来完成约束的指定，那加入我们是通过图形化界面来创建表结构时，又该如何来指定约束呢？ 只需要在创建表的时候，根据我们的需要选择对应的约束即可。</p>
<p><strong>navicat</strong>:</p>
<p><img src="/static/imgs/loading.gif" data-original="https://cdn.jsdelivr.net/gh/ggw2021/images@main/blogs/Snipaste_2024-04-10_02-09-06.png" alt=""></p>
<p><img src="/static/imgs/loading.gif" data-original="https://cdn.jsdelivr.net/gh/ggw2021/images@main/blogs/Snipaste_2024-04-10_02-10-03.png" alt=""></p>
<p><img src="/static/imgs/loading.gif" data-original="https://cdn.jsdelivr.net/gh/ggw2021/images@main/blogs/Snipaste_2024-04-10_02-11-04.png" alt=""></p>
<p>MySQL从8.0.16版本开始支持<code>CHECK</code>约束，并且navicat好像无法使用图形化工具添加check</p>
<hr>
<p><br><br><br></p>
<h4 id="4-2-外键约束">4.2 外键约束</h4>
<ul>
<li><strong><u>介绍</u></strong></li>
</ul>
<p>外键：用来让两张表的数据之间建立连接，从而保证数据的一致性和完整性。<br>
我们来看一个例子：  ‘</p>
<p><img src="/static/imgs/loading.gif" data-original="https://cdn.jsdelivr.net/gh/ggw2021/images@main/blogs/Snipaste_2024-04-10_02-22-18.png" alt=""></p>
<p>左侧的emp表是员工表，里面存储员工的基本信息，包含员工的ID、姓名、年龄、职位、薪资、入职日期、上级主管ID、部门ID，在员工的信息中存储的是部门的ID dept_id，而这个部门的ID是关联的部门表dept的主键id，那emp表的dept_id就是外键, 关联的是另一张表的主键。</p>
<blockquote>
<p>注意：目前上述两张表，只是在逻辑上存在这样一层关系；在数据库层面，并未建立外键关联，<br>
所以是无法保证数据的一致性和完整性的。</p>
</blockquote>
<br>
<p>没有数据库外键关联的情况下，能够保证一致性和完整性呢，我们来测试一下。</p>
<details class="toggle" style="border: 1px solid  #edf4ee"><summary class="toggle-button" style="background-color:  #edf4ee;color:  #17181a">准备数据 </summary><div class="toggle-content"><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">drop</span> <span class="hljs-keyword">table</span> if <span class="hljs-keyword">exists</span> dept;<br><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> dept(<br>    id <span class="hljs-type">int</span> auto_increment comment <span class="hljs-string">&#x27;ID&#x27;</span> <span class="hljs-keyword">primary</span> key,<br>    name <span class="hljs-type">varchar</span>(<span class="hljs-number">50</span>) <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> comment <span class="hljs-string">&#x27;部门名称&#x27;</span><br>)comment <span class="hljs-string">&#x27;部门表&#x27;</span>;<br><br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> dept (id, name) <span class="hljs-keyword">VALUES</span> <br>(<span class="hljs-number">1</span>, <span class="hljs-string">&#x27;研发部&#x27;</span>), <br>(<span class="hljs-number">2</span>, <span class="hljs-string">&#x27;市场部&#x27;</span>),<br>(<span class="hljs-number">3</span>, <span class="hljs-string">&#x27;财务部&#x27;</span>), <br>(<span class="hljs-number">4</span>, <span class="hljs-string">&#x27;销售部&#x27;</span>), <br>(<span class="hljs-number">5</span>, <span class="hljs-string">&#x27;总经办&#x27;</span>);<br><br><span class="hljs-keyword">drop</span> <span class="hljs-keyword">table</span> if <span class="hljs-keyword">exists</span> emp;<br><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> emp(<br>    id <span class="hljs-type">int</span> auto_increment comment <span class="hljs-string">&#x27;ID&#x27;</span> <span class="hljs-keyword">primary</span> key,<br>    name <span class="hljs-type">varchar</span>(<span class="hljs-number">50</span>) <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> comment <span class="hljs-string">&#x27;姓名&#x27;</span>,<br>    age <span class="hljs-type">int</span> comment <span class="hljs-string">&#x27;年龄&#x27;</span>,<br>    job <span class="hljs-type">varchar</span>(<span class="hljs-number">20</span>) comment <span class="hljs-string">&#x27;职位&#x27;</span>,<br>    salary <span class="hljs-type">int</span> comment <span class="hljs-string">&#x27;薪资&#x27;</span>,<br>    entrydate <span class="hljs-type">date</span> comment <span class="hljs-string">&#x27;入职时间&#x27;</span>,<br>    managerid <span class="hljs-type">int</span> comment <span class="hljs-string">&#x27;直属领导ID&#x27;</span>,<br>    dept_id <span class="hljs-type">int</span> comment <span class="hljs-string">&#x27;部门ID&#x27;</span><br>)comment <span class="hljs-string">&#x27;员工表&#x27;</span>;<br><br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> emp (id, name, age, job,salary, entrydate, managerid, dept_id) <span class="hljs-keyword">VALUES</span><br>(<span class="hljs-number">1</span>, <span class="hljs-string">&#x27;金庸&#x27;</span>, <span class="hljs-number">66</span>, <span class="hljs-string">&#x27;总裁&#x27;</span>,<span class="hljs-number">20000</span>, <span class="hljs-string">&#x27;2000-01-01&#x27;</span>, <span class="hljs-keyword">null</span>,<span class="hljs-number">5</span>),<br>(<span class="hljs-number">2</span>, <span class="hljs-string">&#x27;张无忌&#x27;</span>, <span class="hljs-number">20</span>, <span class="hljs-string">&#x27;项目经理&#x27;</span>,<span class="hljs-number">12500</span>, <span class="hljs-string">&#x27;2005-12-05&#x27;</span>, <span class="hljs-number">1</span>,<span class="hljs-number">1</span>),<br>(<span class="hljs-number">3</span>, <span class="hljs-string">&#x27;杨逍&#x27;</span>, <span class="hljs-number">33</span>, <span class="hljs-string">&#x27;开发&#x27;</span>, <span class="hljs-number">8400</span>,<span class="hljs-string">&#x27;2000-11-03&#x27;</span>, <span class="hljs-number">2</span>,<span class="hljs-number">1</span>),<br>(<span class="hljs-number">4</span>, <span class="hljs-string">&#x27;韦一笑&#x27;</span>, <span class="hljs-number">48</span>, <span class="hljs-string">&#x27;开发&#x27;</span>,<span class="hljs-number">11000</span>, <span class="hljs-string">&#x27;2002-02-05&#x27;</span>, <span class="hljs-number">2</span>,<span class="hljs-number">1</span>),<br>(<span class="hljs-number">5</span>, <span class="hljs-string">&#x27;常遇春&#x27;</span>, <span class="hljs-number">43</span>, <span class="hljs-string">&#x27;开发&#x27;</span>,<span class="hljs-number">10500</span>, <span class="hljs-string">&#x27;2004-09-07&#x27;</span>, <span class="hljs-number">3</span>,<span class="hljs-number">1</span>),<br>(<span class="hljs-number">6</span>, <span class="hljs-string">&#x27;小昭&#x27;</span>, <span class="hljs-number">19</span>, <span class="hljs-string">&#x27;程序员鼓励师&#x27;</span>,<span class="hljs-number">6600</span>, <span class="hljs-string">&#x27;2004-10-12&#x27;</span>, <span class="hljs-number">2</span>,<span class="hljs-number">1</span>);<br></code></pre></td></tr></table></figure></div></details>
<p>接下来，我们可以做一个测试，删除id为1的部门信息。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">delete</span> <span class="hljs-keyword">from</span> dept <span class="hljs-keyword">where</span> id <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;<br></code></pre></td></tr></table></figure>
<details class="toggle" style="border: 1px solid  #edf4ee"><summary class="toggle-button" style="background-color:  #edf4ee;color:  #17181a">查看输出 </summary><div class="toggle-content"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">mysql&gt; select * from dept;<br>+----+-----------+<br>| id | name      |<br>+----+-----------+<br>|  2 | 市场部    |<br>|  3 | 财务部    |<br>|  4 | 销售部    |<br>|  5 | 总经办    |<br>+----+-----------+<br>4 rows in set (0.00 sec)<br><br>mysql&gt; select * from emp;<br>+----+-----------+------+--------------------+--------+------------+-----------+---------+<br>| id | name      | age  | job                | salary | entrydate  | managerid | dept_id |<br>+----+-----------+------+--------------------+--------+------------+-----------+---------+<br>|  1 | 金庸      |   66 | 总裁               |  20000 | 2000-01-01 |      NULL |       5 |<br>|  2 | 张无忌    |   20 | 项目经理           |  12500 | 2005-12-05 |         1 |       1 |<br>|  3 | 杨逍      |   33 | 开发               |   8400 | 2000-11-03 |         2 |       1 |<br>|  4 | 韦一笑    |   48 | 开发               |  11000 | 2002-02-05 |         2 |       1 |<br>|  5 | 常遇春    |   43 | 开发               |  10500 | 2004-09-07 |         3 |       1 |<br>|  6 | 小昭      |   19 | 程序员鼓励师       |   6600 | 2004-10-12 |         2 |       1 |<br>+----+-----------+------+--------------------+--------+------------+-----------+---------+<br></code></pre></td></tr></table></figure></div></details>
<p>结果，我们看到删除成功，而删除成功之后，部门表不存在id为1的部门，而在emp表中还有很多的员工，关联的为id为1的部门，此时就出现了数据的不完整性。 而要想解决这个问题就得通过数据库的外键约束。</p>
<hr>
<br>
<ul>
<li><strong><u>语法</u></strong></li>
</ul>
<p><strong>1).</strong> 添加外键</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> 表名(<br>    字段名 数据类型,<br>    ...<br>    [<span class="hljs-keyword">CONSTRAINT</span>] [外键名称] <span class="hljs-keyword">FOREIGN</span> KEY (外键字段名) <span class="hljs-keyword">REFERENCES</span> 主表 (主表列名)<br>);<br></code></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> 表名 <span class="hljs-keyword">ADD</span> <span class="hljs-keyword">CONSTRAINT</span> 外键名称 <span class="hljs-keyword">FOREIGN</span> KEY (外键字段名) <span class="hljs-keyword">REFERENCES</span> 主表 (主表列名) ;<br></code></pre></td></tr></table></figure>
<p>案例: 为emp表的dept_id字段添加外键约束, 关联dept表的主键id。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> emp <span class="hljs-keyword">add</span> <span class="hljs-keyword">constraint</span> fk_emp_dept_id <span class="hljs-keyword">foreign</span> key (dept_id) <span class="hljs-keyword">references</span> dept(id);<br></code></pre></td></tr></table></figure>
<p>添加了外键约束之后，我们再到dept表(父表)删除id为1的记录，然后看一下会发生什么现象。 此时将会报错，不能删除或更新父表记录，因为存在外键约束。<br>
1451 - Cannot delete or update a parent row: a foreign key constraint fails (`learn2024`.`emp`, CONSTRAINT `fk_emp_dept_id` FOREIGN KEY (`dept_id`) REFERENCES `dept` (`id`))</p>
<br>
<p><strong>2).</strong> 删除外键</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> 表名 <span class="hljs-keyword">DROP</span> <span class="hljs-keyword">FOREIGN</span> KEY 外键名称;<br></code></pre></td></tr></table></figure>
<p>案例：删除emp表的外键fk_emp_dept_id。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> emp <span class="hljs-keyword">drop</span> <span class="hljs-keyword">foreign</span> key fk_emp_dept_id;<br></code></pre></td></tr></table></figure>
<hr>
<br>
<ul>
<li><strong><u>删除/更新行为</u></strong></li>
</ul>
<p>添加了外键之后，再删除父表数据时产生的约束行为，我们就称为删除/更新行为。具体的删除/更新行为有以下几种:</p>
<table>
<thead>
<tr>
<th style="text-align:left">行为</th>
<th style="text-align:left">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">NO ACTION</td>
<td style="text-align:left">当在父表中删除/更新对应记录时，首先检查该记录是否有对应外键，如果有则不允许删除/更新。 (与 RESTRICT 一致) 默认行为</td>
</tr>
<tr>
<td style="text-align:left">RESTRICT</td>
<td style="text-align:left">当在父表中删除/更新对应记录时，首先检查该记录是否有对应外键，如果有则不允许删除/更新。 (与 NO ACTION 一致) 默认行为</td>
</tr>
<tr>
<td style="text-align:left">CASCADE</td>
<td style="text-align:left">当在父表中删除/更新对应记录时，首先检查该记录是否有对应外键，如果有，则也删除/更新外键在子表中的记录。</td>
</tr>
<tr>
<td style="text-align:left">SET NULL</td>
<td style="text-align:left">当在父表中删除对应记录时，首先检查该记录是否有对应外键，如果有则设置子表中该外键值为null（这就要求该外键允许取null）。</td>
</tr>
<tr>
<td style="text-align:left">SET DEFAULT</td>
<td style="text-align:left">父表有变更时，子表将外键列设置成一个默认的值 (Innodb不支持)</td>
</tr>
</tbody>
</table>
<p>具体语法为:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> 表名 <span class="hljs-keyword">ADD</span> <span class="hljs-keyword">CONSTRAINT</span> 外键名称 <span class="hljs-keyword">FOREIGN</span> KEY (外键字段) <span class="hljs-keyword">REFERENCES</span><br>主表名 (主表字段名) <span class="hljs-keyword">ON</span> <span class="hljs-keyword">UPDATE</span> CASCADE <span class="hljs-keyword">ON</span> <span class="hljs-keyword">DELETE</span> CASCADE;<br></code></pre></td></tr></table></figure>
<br>
<p>演示如下：</p>
<p>由于NO ACTION 是默认行为，我们前面语法演示的时候，已经测试过了，就不再演示了，这里我们再演示其他的两种行为：CASCADE、SET NULL。</p>
<p><strong>1).</strong> CASCADE</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> emp <span class="hljs-keyword">add</span> <span class="hljs-keyword">constraint</span> fk_emp_dept_id <span class="hljs-keyword">foreign</span> key (dept_id) <br><span class="hljs-keyword">references</span> dept(id) <span class="hljs-keyword">on</span> <span class="hljs-keyword">update</span> cascade <span class="hljs-keyword">on</span> <span class="hljs-keyword">delete</span> cascade ;<br></code></pre></td></tr></table></figure>
<p><strong>A.</strong> 修改父表id为1的记录，将id修改为6</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">update</span> dept <span class="hljs-keyword">set</span> id <span class="hljs-operator">=</span> <span class="hljs-number">6</span> <span class="hljs-keyword">where</span> id <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;<br></code></pre></td></tr></table></figure>
<details class="toggle" style="border: 1px solid  #edf4ee"><summary class="toggle-button" style="background-color:  #edf4ee;color:  #17181a">查看输出 </summary><div class="toggle-content"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">mysql&gt; select * from dept;<br>+----+-----------+<br>| id | name      |<br>+----+-----------+<br>|  2 | 市场部    |<br>|  3 | 财务部    |<br>|  4 | 销售部    |<br>|  5 | 总经办    |<br>|  6 | 研发部    |<br>+----+-----------+<br>5 rows in set (0.00 sec)<br><br>mysql&gt; select * from emp;<br>+----+-----------+------+--------------------+--------+------------+-----------+---------+<br>| id | name      | age  | job                | salary | entrydate  | managerid | dept_id |<br>+----+-----------+------+--------------------+--------+------------+-----------+---------+<br>|  1 | 金庸      |   66 | 总裁               |  20000 | 2000-01-01 |      NULL |       5 |<br>|  2 | 张无忌    |   20 | 项目经理           |  12500 | 2005-12-05 |         1 |       6 |<br>|  3 | 杨逍      |   33 | 开发               |   8400 | 2000-11-03 |         2 |       6 |<br>|  4 | 韦一笑    |   48 | 开发               |  11000 | 2002-02-05 |         2 |       6 |<br>|  5 | 常遇春    |   43 | 开发               |  10500 | 2004-09-07 |         3 |       6 |<br>|  6 | 小昭      |   19 | 程序员鼓励师       |   6600 | 2004-10-12 |         2 |       6 |<br>+----+-----------+------+--------------------+--------+------------+-----------+---------+<br>6 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure></div></details>
<p>我们发现，原来在子表中dept_id值为1的记录，现在也变为6了，这就是cascade级联的效果。</p>
<blockquote>
<p>在一般的业务系统中，不会修改一张表的主键值。</p>
</blockquote>
<p><strong>B.</strong> 删除父表id为6的记录</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">delete</span> <span class="hljs-keyword">from</span> dept <span class="hljs-keyword">where</span> id <span class="hljs-operator">=</span> <span class="hljs-number">6</span>;<br></code></pre></td></tr></table></figure>
<details class="toggle" style="border: 1px solid  #edf4ee"><summary class="toggle-button" style="background-color:  #edf4ee;color:  #17181a">查看输出 </summary><div class="toggle-content"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">mysql&gt; select * from dept;<br>+----+-----------+<br>| id | name      |<br>+----+-----------+<br>|  2 | 市场部    |<br>|  3 | 财务部    |<br>|  4 | 销售部    |<br>|  5 | 总经办    |<br>+----+-----------+<br>4 rows in set (0.00 sec)<br><br>mysql&gt; select * from emp;<br>+----+--------+------+--------+--------+------------+-----------+---------+<br>| id | name   | age  | job    | salary | entrydate  | managerid | dept_id |<br>+----+--------+------+--------+--------+------------+-----------+---------+<br>|  1 | 金庸   |   66 | 总裁   |  20000 | 2000-01-01 |      NULL |       5 |<br>+----+--------+------+--------+--------+------------+-----------+---------+<br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure></div></details>
<p>我们发现，父表的数据删除成功了，但是子表中关联的记录也被级联删除了。</p>
<p><br> <strong>2).</strong> SET NULL<br>
在进行测试之前，我们先需要删除上面建立的外键 fk_emp_dept_id。然后再通过数据脚本，将emp、dept表的数据恢复了。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> emp <span class="hljs-keyword">add</span> <span class="hljs-keyword">constraint</span> fk_emp_dept_id <span class="hljs-keyword">foreign</span> key (dept_id) <br><span class="hljs-keyword">references</span> dept(id) <span class="hljs-keyword">on</span> <span class="hljs-keyword">update</span> <span class="hljs-keyword">set</span> <span class="hljs-keyword">null</span> <span class="hljs-keyword">on</span> <span class="hljs-keyword">delete</span> <span class="hljs-keyword">set</span> <span class="hljs-keyword">null</span> ;<br></code></pre></td></tr></table></figure>
<p>接下来，我们删除id为1的数据，看看会发生什么样的现象。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">delete</span> <span class="hljs-keyword">from</span> dept <span class="hljs-keyword">where</span> id <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;<br></code></pre></td></tr></table></figure>
<details class="toggle" style="border: 1px solid  #edf4ee"><summary class="toggle-button" style="background-color:  #edf4ee;color:  #17181a">查看输出 </summary><div class="toggle-content"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">mysql&gt; select * from dept;<br>+----+-----------+<br>| id | name      |<br>+----+-----------+<br>|  2 | 市场部    |<br>|  3 | 财务部    |<br>|  4 | 销售部    |<br>|  5 | 总经办    |<br>+----+-----------+<br>4 rows in set (0.00 sec)<br><br>mysql&gt; select * from emp;<br>+----+-----------+------+--------------------+--------+------------+-----------+---------+<br>| id | name      | age  | job                | salary | entrydate  | managerid | dept_id |<br>+----+-----------+------+--------------------+--------+------------+-----------+---------+<br>|  1 | 金庸      |   66 | 总裁               |  20000 | 2000-01-01 |      NULL |       5 |<br>|  2 | 张无忌    |   20 | 项目经理           |  12500 | 2005-12-05 |         1 |    NULL |<br>|  3 | 杨逍      |   33 | 开发               |   8400 | 2000-11-03 |         2 |    NULL |<br>|  4 | 韦一笑    |   48 | 开发               |  11000 | 2002-02-05 |         2 |    NULL |<br>|  5 | 常遇春    |   43 | 开发               |  10500 | 2004-09-07 |         3 |    NULL |<br>|  6 | 小昭      |   19 | 程序员鼓励师       |   6600 | 2004-10-12 |         2 |    NULL |<br>+----+-----------+------+--------------------+--------+------------+-----------+---------+<br>6 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure></div></details>
<p>我们发现父表的记录是可以正常的删除的，父表的数据删除之后，再打开子表 emp，我们发现子表emp的dept_id字段，原来dept_id为1的数据，现在都被置为NULL了。</p>
<p>这就是SET NULL这种删除/更新行为的效果。</p>
<hr>
<p><br><br><br></p>
<h3 id="5-多表查询">5. 多表查询</h3>
<blockquote>
<p>我们之前在讲解SQL语句的时候，讲解了DQL语句，也就是数据查询语句，但是之前讲解的查询都是单表查询，而本章节我们要学习的则是多表查询操作，主要从以下几个方面进行讲解。</p>
</blockquote>
<h4 id="5-1-多表关系">5.1 多表关系</h4>
<p>项目开发中，在进行数据库表结构设计时，会根据业务需求及业务模块之间的关系，分析并设计表结构，由于业务之间相互关联，所以各个表结构之间也存在着各种联系，基本上分为三种：</p>
<ul>
<li>一对多(多对一)</li>
<li>多对多</li>
<li>一对一</li>
</ul>
<br>
<ul>
<li><strong><u>一对多(多对一)</u></strong></li>
</ul>
<p>案例:  部门 与 员工的关系<br>
关系:  一个部门对应多个员工，一个员工对应一个部门<br>
实现:  <strong>在多的一方建立外键，指向一的一方的主键</strong></p>
<p><img src="/static/imgs/loading.gif" data-original="https://cdn.jsdelivr.net/gh/ggw2021/images@main/blogs/Snipaste_2024-04-10_09-34-39.png" alt=""></p>
<p><strong>navicat</strong>查看ER图：</p>
<p><img src="/static/imgs/loading.gif" data-original="https://cdn.jsdelivr.net/gh/ggw2021/images@main/blogs/Snipaste_2024-04-10_09-44-42.png" alt=""></p>
<hr>
<br>
<ul>
<li><strong><u>多对多</u></strong></li>
</ul>
<p>案例:  学生 与 课程的关系<br>
关系:  一个学生可以选修多门课程，一门课程也可以供多个学生选择<br>
实现:  建立第三张中间表，中间表至少包含两个外键，分别关联两方主键</p>
<p><img src="/static/imgs/loading.gif" data-original="https://cdn.jsdelivr.net/gh/ggw2021/images@main/blogs/Snipaste_2024-04-10_09-35-52.png" alt=""></p>
<details class="toggle" style="border: 1px solid  #edf4ee"><summary class="toggle-button" style="background-color:  #edf4ee;color:  #17181a">对应的SQL脚本 </summary><div class="toggle-content"><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> student(<br>    id <span class="hljs-type">int</span> auto_increment <span class="hljs-keyword">primary</span> key comment <span class="hljs-string">&#x27;主键ID&#x27;</span>,<br>    name <span class="hljs-type">varchar</span>(<span class="hljs-number">10</span>) comment <span class="hljs-string">&#x27;姓名&#x27;</span>,<br>    <span class="hljs-keyword">no</span> <span class="hljs-type">varchar</span>(<span class="hljs-number">10</span>) comment <span class="hljs-string">&#x27;学号&#x27;</span><br>) comment <span class="hljs-string">&#x27;学生表&#x27;</span>;<br><br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> student <span class="hljs-keyword">values</span> <br>(<span class="hljs-keyword">null</span>, <span class="hljs-string">&#x27;黛绮丝&#x27;</span>, <span class="hljs-string">&#x27;2000100101&#x27;</span>),<br>(<span class="hljs-keyword">null</span>, <span class="hljs-string">&#x27;谢逊&#x27;</span>, <span class="hljs-string">&#x27;2000100102&#x27;</span>),<br>(<span class="hljs-keyword">null</span>, <span class="hljs-string">&#x27;殷天正&#x27;</span>, <span class="hljs-string">&#x27;2000100103&#x27;</span>),<br>(<span class="hljs-keyword">null</span>, <span class="hljs-string">&#x27;韦一笑&#x27;</span>, <span class="hljs-string">&#x27;2000100104&#x27;</span>);<br><br><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> course(<br>    id <span class="hljs-type">int</span> auto_increment <span class="hljs-keyword">primary</span> key comment <span class="hljs-string">&#x27;主键ID&#x27;</span>,<br>    name <span class="hljs-type">varchar</span>(<span class="hljs-number">10</span>) comment <span class="hljs-string">&#x27;课程名称&#x27;</span><br>) comment <span class="hljs-string">&#x27;课程表&#x27;</span>;<br><br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> course <span class="hljs-keyword">values</span> <br>(<span class="hljs-keyword">null</span>, <span class="hljs-string">&#x27;Java&#x27;</span>), <br>(<span class="hljs-keyword">null</span>, <span class="hljs-string">&#x27;PHP&#x27;</span>), <br>(<span class="hljs-keyword">null</span> , <span class="hljs-string">&#x27;MySQL&#x27;</span>) ,<br>(<span class="hljs-keyword">null</span>, <span class="hljs-string">&#x27;Hadoop&#x27;</span>);<br><br><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> student_course(<br>    id <span class="hljs-type">int</span> auto_increment comment <span class="hljs-string">&#x27;主键&#x27;</span> <span class="hljs-keyword">primary</span> key,<br>    studentid <span class="hljs-type">int</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> comment <span class="hljs-string">&#x27;学生ID&#x27;</span>,<br>    courseid <span class="hljs-type">int</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> comment <span class="hljs-string">&#x27;课程ID&#x27;</span>,<br>    <span class="hljs-keyword">constraint</span> fk_courseid <span class="hljs-keyword">foreign</span> key (courseid) <span class="hljs-keyword">references</span> course (id),<br>    <span class="hljs-keyword">constraint</span> fk_studentid <span class="hljs-keyword">foreign</span> key (studentid) <span class="hljs-keyword">references</span> student (id)<br>)comment <span class="hljs-string">&#x27;学生课程中间表&#x27;</span>;<br><br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> student_course <span class="hljs-keyword">values</span> <br>(<span class="hljs-keyword">null</span>,<span class="hljs-number">1</span>,<span class="hljs-number">1</span>),<br>(<span class="hljs-keyword">null</span>,<span class="hljs-number">1</span>,<span class="hljs-number">2</span>),<br>(<span class="hljs-keyword">null</span>,<span class="hljs-number">1</span>,<span class="hljs-number">3</span>),<br>(<span class="hljs-keyword">null</span>,<span class="hljs-number">2</span>,<span class="hljs-number">2</span>),<br>(<span class="hljs-keyword">null</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>),<br>(<span class="hljs-keyword">null</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>);<br></code></pre></td></tr></table></figure></div></details>
<hr>
<br>
<ul>
<li><strong><u>一对一</u></strong></li>
</ul>
<p>案例:  用户 与 用户详情的关系<br>
关系:  一对一关系，多用于单表拆分，将一张表的基础字段放在一张表中，其他详情字段放在另一张表中，以提升操作效率<br>
实现:  在任意一方加入外键，关联另外一方的主键，并且设置外键为唯一的(UNIQUE)</p>
<p><img src="/static/imgs/loading.gif" data-original="https://cdn.jsdelivr.net/gh/ggw2021/images@main/blogs/Snipaste_2024-04-10_09-48-25.png" alt=""></p>
<details class="toggle" style="border: 1px solid  #edf4ee"><summary class="toggle-button" style="background-color:  #edf4ee;color:  #17181a">对应的SQL脚本 </summary><div class="toggle-content"><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> tb_user(<br>    id <span class="hljs-type">int</span> auto_increment <span class="hljs-keyword">primary</span> key comment <span class="hljs-string">&#x27;主键ID&#x27;</span>,<br>    name <span class="hljs-type">varchar</span>(<span class="hljs-number">10</span>) comment <span class="hljs-string">&#x27;姓名&#x27;</span>,<br>    age <span class="hljs-type">int</span> comment <span class="hljs-string">&#x27;年龄&#x27;</span>,<br>    gender <span class="hljs-type">char</span>(<span class="hljs-number">1</span>) comment <span class="hljs-string">&#x27;1: 男 , 2: 女&#x27;</span>,<br>    phone <span class="hljs-type">char</span>(<span class="hljs-number">11</span>) comment <span class="hljs-string">&#x27;手机号&#x27;</span><br>) comment <span class="hljs-string">&#x27;用户基本信息表&#x27;</span>;<br><br><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> tb_user_edu(<br>    id <span class="hljs-type">int</span> auto_increment <span class="hljs-keyword">primary</span> key comment <span class="hljs-string">&#x27;主键ID&#x27;</span>,<br>    degree <span class="hljs-type">varchar</span>(<span class="hljs-number">20</span>) comment <span class="hljs-string">&#x27;学历&#x27;</span>,<br>    major <span class="hljs-type">varchar</span>(<span class="hljs-number">50</span>) comment <span class="hljs-string">&#x27;专业&#x27;</span>,<br>    primaryschool <span class="hljs-type">varchar</span>(<span class="hljs-number">50</span>) comment <span class="hljs-string">&#x27;小学&#x27;</span>,<br>    middleschool <span class="hljs-type">varchar</span>(<span class="hljs-number">50</span>) comment <span class="hljs-string">&#x27;中学&#x27;</span>,<br>    university <span class="hljs-type">varchar</span>(<span class="hljs-number">50</span>) comment <span class="hljs-string">&#x27;大学&#x27;</span>,<br>    userid <span class="hljs-type">int</span> <span class="hljs-keyword">unique</span> comment <span class="hljs-string">&#x27;用户ID&#x27;</span>,<br>    <span class="hljs-keyword">constraint</span> fk_userid <span class="hljs-keyword">foreign</span> key (userid) <span class="hljs-keyword">references</span> tb_user(id)<br>) comment <span class="hljs-string">&#x27;用户教育信息表&#x27;</span>;<br><br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> tb_user(id, name, age, gender, phone) <span class="hljs-keyword">values</span><br>(<span class="hljs-keyword">null</span>,<span class="hljs-string">&#x27;黄渤&#x27;</span>,<span class="hljs-number">45</span>,<span class="hljs-string">&#x27;1&#x27;</span>,<span class="hljs-string">&#x27;18800001111&#x27;</span>),<br>(<span class="hljs-keyword">null</span>,<span class="hljs-string">&#x27;冰冰&#x27;</span>,<span class="hljs-number">35</span>,<span class="hljs-string">&#x27;2&#x27;</span>,<span class="hljs-string">&#x27;18800002222&#x27;</span>),<br>(<span class="hljs-keyword">null</span>,<span class="hljs-string">&#x27;码云&#x27;</span>,<span class="hljs-number">55</span>,<span class="hljs-string">&#x27;1&#x27;</span>,<span class="hljs-string">&#x27;18800008888&#x27;</span>),<br>(<span class="hljs-keyword">null</span>,<span class="hljs-string">&#x27;李彦宏&#x27;</span>,<span class="hljs-number">50</span>,<span class="hljs-string">&#x27;1&#x27;</span>,<span class="hljs-string">&#x27;18800009999&#x27;</span>);<br><br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> tb_user_edu<br>(id, degree, major, primaryschool, middleschool, university, userid) <span class="hljs-keyword">values</span><br>(<span class="hljs-keyword">null</span>,<span class="hljs-string">&#x27;本科&#x27;</span>,<span class="hljs-string">&#x27;舞蹈&#x27;</span>,<span class="hljs-string">&#x27;静安区第一小学&#x27;</span>,<span class="hljs-string">&#x27;静安区第一中学&#x27;</span>,<span class="hljs-string">&#x27;北京舞蹈学院&#x27;</span>,<span class="hljs-number">1</span>),<br>(<span class="hljs-keyword">null</span>,<span class="hljs-string">&#x27;硕士&#x27;</span>,<span class="hljs-string">&#x27;表演&#x27;</span>,<span class="hljs-string">&#x27;朝阳区第一小学&#x27;</span>,<span class="hljs-string">&#x27;朝阳区第一中学&#x27;</span>,<span class="hljs-string">&#x27;北京电影学院&#x27;</span>,<span class="hljs-number">2</span>),<br>(<span class="hljs-keyword">null</span>,<span class="hljs-string">&#x27;本科&#x27;</span>,<span class="hljs-string">&#x27;英语&#x27;</span>,<span class="hljs-string">&#x27;杭州市第一小学&#x27;</span>,<span class="hljs-string">&#x27;杭州市第一中学&#x27;</span>,<span class="hljs-string">&#x27;杭州师范大学&#x27;</span>,<span class="hljs-number">3</span>),<br>(<span class="hljs-keyword">null</span>,<span class="hljs-string">&#x27;本科&#x27;</span>,<span class="hljs-string">&#x27;应用数学&#x27;</span>,<span class="hljs-string">&#x27;阳泉第一小学&#x27;</span>,<span class="hljs-string">&#x27;阳泉区第一中学&#x27;</span>,<span class="hljs-string">&#x27;清华大学&#x27;</span>,<span class="hljs-number">4</span>);<br></code></pre></td></tr></table></figure></div></details>
<hr>
<p><br><br><br></p>
<h4 id="5-2-多表查询概述">5.2 多表查询概述</h4>
<ul>
<li><strong><u>数据准备</u></strong></li>
</ul>
<p>1). 删除之前 emp, dept表的测试数据<br>
2). 执行如下脚本，创建emp表与dept表并插入测试数据</p>
<details class="toggle" style="border: 1px solid  #edf4ee"><summary class="toggle-button" style="background-color:  #edf4ee;color:  #17181a">查看脚本 </summary><div class="toggle-content"><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 创建dept表，并插入数据</span><br><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> dept(<br>    id <span class="hljs-type">int</span> auto_increment comment <span class="hljs-string">&#x27;ID&#x27;</span> <span class="hljs-keyword">primary</span> key,<br>    name <span class="hljs-type">varchar</span>(<span class="hljs-number">50</span>) <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> comment <span class="hljs-string">&#x27;部门名称&#x27;</span><br>)comment <span class="hljs-string">&#x27;部门表&#x27;</span>;<br><br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> dept (id, name) <span class="hljs-keyword">VALUES</span> <br>(<span class="hljs-number">1</span>, <span class="hljs-string">&#x27;研发部&#x27;</span>), <br>(<span class="hljs-number">2</span>, <span class="hljs-string">&#x27;市场部&#x27;</span>),<br>(<span class="hljs-number">3</span>, <span class="hljs-string">&#x27;财务部&#x27;</span>), <br>(<span class="hljs-number">4</span>, <span class="hljs-string">&#x27;销售部&#x27;</span>), <br>(<span class="hljs-number">5</span>, <span class="hljs-string">&#x27;总经办&#x27;</span>), <br>(<span class="hljs-number">6</span>, <span class="hljs-string">&#x27;人事部&#x27;</span>);<br><br><span class="hljs-comment">-- 创建emp表，并插入数据</span><br><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> emp(<br>    id <span class="hljs-type">int</span> auto_increment comment <span class="hljs-string">&#x27;ID&#x27;</span> <span class="hljs-keyword">primary</span> key,<br>    name <span class="hljs-type">varchar</span>(<span class="hljs-number">50</span>) <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> comment <span class="hljs-string">&#x27;姓名&#x27;</span>,<br>    age <span class="hljs-type">int</span> comment <span class="hljs-string">&#x27;年龄&#x27;</span>,<br>    job <span class="hljs-type">varchar</span>(<span class="hljs-number">20</span>) comment <span class="hljs-string">&#x27;职位&#x27;</span>,<br>    salary <span class="hljs-type">int</span> comment <span class="hljs-string">&#x27;薪资&#x27;</span>,<br>    entrydate <span class="hljs-type">date</span> comment <span class="hljs-string">&#x27;入职时间&#x27;</span>,<br>    managerid <span class="hljs-type">int</span> comment <span class="hljs-string">&#x27;直属领导ID&#x27;</span>,<br>    dept_id <span class="hljs-type">int</span> comment <span class="hljs-string">&#x27;部门ID&#x27;</span><br>)comment <span class="hljs-string">&#x27;员工表&#x27;</span>;<br><br><span class="hljs-comment">-- 添加外键</span><br><span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> emp <span class="hljs-keyword">add</span> <br><span class="hljs-keyword">constraint</span> fk_emp_dept_id <span class="hljs-keyword">foreign</span> key (dept_id) <span class="hljs-keyword">references</span> dept(id);<br><br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> emp (id, name, age, job,salary, entrydate, managerid, dept_id) <span class="hljs-keyword">VALUES</span><br>(<span class="hljs-number">1</span>, <span class="hljs-string">&#x27;金庸&#x27;</span>, <span class="hljs-number">66</span>, <span class="hljs-string">&#x27;总裁&#x27;</span>,<span class="hljs-number">20000</span>, <span class="hljs-string">&#x27;2000-01-01&#x27;</span>, <span class="hljs-keyword">null</span>,<span class="hljs-number">5</span>),<br>(<span class="hljs-number">2</span>, <span class="hljs-string">&#x27;张无忌&#x27;</span>, <span class="hljs-number">20</span>, <span class="hljs-string">&#x27;项目经理&#x27;</span>,<span class="hljs-number">12500</span>, <span class="hljs-string">&#x27;2005-12-05&#x27;</span>, <span class="hljs-number">1</span>,<span class="hljs-number">1</span>),<br>(<span class="hljs-number">3</span>, <span class="hljs-string">&#x27;杨逍&#x27;</span>, <span class="hljs-number">33</span>, <span class="hljs-string">&#x27;开发&#x27;</span>, <span class="hljs-number">8400</span>,<span class="hljs-string">&#x27;2000-11-03&#x27;</span>, <span class="hljs-number">2</span>,<span class="hljs-number">1</span>),<br>(<span class="hljs-number">4</span>, <span class="hljs-string">&#x27;韦一笑&#x27;</span>, <span class="hljs-number">48</span>, <span class="hljs-string">&#x27;开发&#x27;</span>,<span class="hljs-number">11000</span>, <span class="hljs-string">&#x27;2002-02-05&#x27;</span>, <span class="hljs-number">2</span>,<span class="hljs-number">1</span>),<br>(<span class="hljs-number">5</span>, <span class="hljs-string">&#x27;常遇春&#x27;</span>, <span class="hljs-number">43</span>, <span class="hljs-string">&#x27;开发&#x27;</span>,<span class="hljs-number">10500</span>, <span class="hljs-string">&#x27;2004-09-07&#x27;</span>, <span class="hljs-number">3</span>,<span class="hljs-number">1</span>),<br>(<span class="hljs-number">6</span>, <span class="hljs-string">&#x27;小昭&#x27;</span>, <span class="hljs-number">19</span>, <span class="hljs-string">&#x27;程序员鼓励师&#x27;</span>,<span class="hljs-number">6600</span>, <span class="hljs-string">&#x27;2004-10-12&#x27;</span>, <span class="hljs-number">2</span>,<span class="hljs-number">1</span>),<br>(<span class="hljs-number">7</span>, <span class="hljs-string">&#x27;灭绝&#x27;</span>, <span class="hljs-number">60</span>, <span class="hljs-string">&#x27;财务总监&#x27;</span>,<span class="hljs-number">8500</span>, <span class="hljs-string">&#x27;2002-09-12&#x27;</span>, <span class="hljs-number">1</span>,<span class="hljs-number">3</span>),<br>(<span class="hljs-number">8</span>, <span class="hljs-string">&#x27;周芷若&#x27;</span>, <span class="hljs-number">19</span>, <span class="hljs-string">&#x27;会计&#x27;</span>,<span class="hljs-number">48000</span>, <span class="hljs-string">&#x27;2006-06-02&#x27;</span>, <span class="hljs-number">7</span>,<span class="hljs-number">3</span>),<br>(<span class="hljs-number">9</span>, <span class="hljs-string">&#x27;丁敏君&#x27;</span>, <span class="hljs-number">23</span>, <span class="hljs-string">&#x27;出纳&#x27;</span>,<span class="hljs-number">5250</span>, <span class="hljs-string">&#x27;2009-05-13&#x27;</span>, <span class="hljs-number">7</span>,<span class="hljs-number">3</span>),<br>(<span class="hljs-number">10</span>, <span class="hljs-string">&#x27;赵敏&#x27;</span>, <span class="hljs-number">20</span>, <span class="hljs-string">&#x27;市场部总监&#x27;</span>,<span class="hljs-number">12500</span>, <span class="hljs-string">&#x27;2004-10-12&#x27;</span>, <span class="hljs-number">1</span>,<span class="hljs-number">2</span>),<br>(<span class="hljs-number">11</span>, <span class="hljs-string">&#x27;鹿杖客&#x27;</span>, <span class="hljs-number">56</span>, <span class="hljs-string">&#x27;职员&#x27;</span>,<span class="hljs-number">3750</span>, <span class="hljs-string">&#x27;2006-10-03&#x27;</span>, <span class="hljs-number">10</span>,<span class="hljs-number">2</span>),<br>(<span class="hljs-number">12</span>, <span class="hljs-string">&#x27;鹤笔翁&#x27;</span>, <span class="hljs-number">19</span>, <span class="hljs-string">&#x27;职员&#x27;</span>,<span class="hljs-number">3750</span>, <span class="hljs-string">&#x27;2007-05-09&#x27;</span>, <span class="hljs-number">10</span>,<span class="hljs-number">2</span>),<br>(<span class="hljs-number">13</span>, <span class="hljs-string">&#x27;方东白&#x27;</span>, <span class="hljs-number">19</span>, <span class="hljs-string">&#x27;职员&#x27;</span>,<span class="hljs-number">5500</span>, <span class="hljs-string">&#x27;2009-02-12&#x27;</span>, <span class="hljs-number">10</span>,<span class="hljs-number">2</span>),<br>(<span class="hljs-number">14</span>, <span class="hljs-string">&#x27;张三丰&#x27;</span>, <span class="hljs-number">88</span>, <span class="hljs-string">&#x27;销售总监&#x27;</span>,<span class="hljs-number">14000</span>, <span class="hljs-string">&#x27;2004-10-12&#x27;</span>, <span class="hljs-number">1</span>,<span class="hljs-number">4</span>),<br>(<span class="hljs-number">15</span>, <span class="hljs-string">&#x27;俞莲舟&#x27;</span>, <span class="hljs-number">38</span>, <span class="hljs-string">&#x27;销售&#x27;</span>,<span class="hljs-number">4600</span>, <span class="hljs-string">&#x27;2004-10-12&#x27;</span>, <span class="hljs-number">14</span>,<span class="hljs-number">4</span>),<br>(<span class="hljs-number">16</span>, <span class="hljs-string">&#x27;宋远桥&#x27;</span>, <span class="hljs-number">40</span>, <span class="hljs-string">&#x27;销售&#x27;</span>,<span class="hljs-number">4600</span>, <span class="hljs-string">&#x27;2004-10-12&#x27;</span>, <span class="hljs-number">14</span>,<span class="hljs-number">4</span>),<br>(<span class="hljs-number">17</span>, <span class="hljs-string">&#x27;陈友谅&#x27;</span>, <span class="hljs-number">42</span>, <span class="hljs-keyword">null</span>,<span class="hljs-number">2000</span>, <span class="hljs-string">&#x27;2011-10-12&#x27;</span>, <span class="hljs-number">1</span>,<span class="hljs-keyword">null</span>);<br></code></pre></td></tr></table></figure>
<p>dept表共6条记录，emp表共17条记录。</p>
</div></details>
<hr>
<br>
<ul>
<li><strong><u>概述</u></strong></li>
</ul>
<p>多表查询就是指从多张表中查询数据。</p>
<p>原来查询单表数据，执行的SQL形式为：<code>select * from emp;</code><br>
那么我们要执行多表查询，就只需要使用逗号分隔多张表即可，如： <code>select * from emp , dept;</code><br>
具体的执行结果如下:</p>
<details class="toggle" style="border: 1px solid  #edf4ee"><summary class="toggle-button" style="background-color:  #edf4ee;color:  #17181a">查看输出 </summary><div class="toggle-content"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">+----+-----------+------+--------------------+--------+------------+-----------+---------+----+-----------+<br>| id | name      | age  | job                | salary | entrydate  | managerid | dept_id | id | name      |<br>+----+-----------+------+--------------------+--------+------------+-----------+---------+----+-----------+<br>|  1 | 金庸      |   66 | 总裁               |  20000 | 2000-01-01 |      NULL |       5 |  6 | 人事部    |<br>|  1 | 金庸      |   66 | 总裁               |  20000 | 2000-01-01 |      NULL |       5 |  5 | 总经办    |<br>|  1 | 金庸      |   66 | 总裁               |  20000 | 2000-01-01 |      NULL |       5 |  4 | 销售部    |<br>|  1 | 金庸      |   66 | 总裁               |  20000 | 2000-01-01 |      NULL |       5 |  3 | 财务部    |<br>|  1 | 金庸      |   66 | 总裁               |  20000 | 2000-01-01 |      NULL |       5 |  2 | 市场部    |<br>|  1 | 金庸      |   66 | 总裁               |  20000 | 2000-01-01 |      NULL |       5 |  1 | 研发部    |<br>|  2 | 张无忌    |   20 | 项目经理           |  12500 | 2005-12-05 |         1 |       1 |  6 | 人事部    |<br>|  2 | 张无忌    |   20 | 项目经理           |  12500 | 2005-12-05 |         1 |       1 |  5 | 总经办    |<br>|  2 | 张无忌    |   20 | 项目经理           |  12500 | 2005-12-05 |         1 |       1 |  4 | 销售部    |<br>|  2 | 张无忌    |   20 | 项目经理           |  12500 | 2005-12-05 |         1 |       1 |  3 | 财务部    |<br>|  2 | 张无忌    |   20 | 项目经理           |  12500 | 2005-12-05 |         1 |       1 |  2 | 市场部    |<br>|  2 | 张无忌    |   20 | 项目经理           |  12500 | 2005-12-05 |         1 |       1 |  1 | 研发部    |<br>|  3 | 杨逍      |   33 | 开发               |   8400 | 2000-11-03 |         2 |       1 |  6 | 人事部    |<br>|  3 | 杨逍      |   33 | 开发               |   8400 | 2000-11-03 |         2 |       1 |  5 | 总经办    |<br>|  3 | 杨逍      |   33 | 开发               |   8400 | 2000-11-03 |         2 |       1 |  4 | 销售部    |<br>|  3 | 杨逍      |   33 | 开发               |   8400 | 2000-11-03 |         2 |       1 |  3 | 财务部    |<br>|  3 | 杨逍      |   33 | 开发               |   8400 | 2000-11-03 |         2 |       1 |  2 | 市场部    |<br>|  3 | 杨逍      |   33 | 开发               |   8400 | 2000-11-03 |         2 |       1 |  1 | 研发部    |<br>|  4 | 韦一笑    |   48 | 开发               |  11000 | 2002-02-05 |         2 |       1 |  6 | 人事部    |<br>|  4 | 韦一笑    |   48 | 开发               |  11000 | 2002-02-05 |         2 |       1 |  5 | 总经办    |<br>|  4 | 韦一笑    |   48 | 开发               |  11000 | 2002-02-05 |         2 |       1 |  4 | 销售部    |<br>|  4 | 韦一笑    |   48 | 开发               |  11000 | 2002-02-05 |         2 |       1 |  3 | 财务部    |<br>|  4 | 韦一笑    |   48 | 开发               |  11000 | 2002-02-05 |         2 |       1 |  2 | 市场部    |<br>|  4 | 韦一笑    |   48 | 开发               |  11000 | 2002-02-05 |         2 |       1 |  1 | 研发部    |<br>|  5 | 常遇春    |   43 | 开发               |  10500 | 2004-09-07 |         3 |       1 |  6 | 人事部    |<br>|  5 | 常遇春    |   43 | 开发               |  10500 | 2004-09-07 |         3 |       1 |  5 | 总经办    |<br>|  5 | 常遇春    |   43 | 开发               |  10500 | 2004-09-07 |         3 |       1 |  4 | 销售部    |<br>|  5 | 常遇春    |   43 | 开发               |  10500 | 2004-09-07 |         3 |       1 |  3 | 财务部    |<br>|  5 | 常遇春    |   43 | 开发               |  10500 | 2004-09-07 |         3 |       1 |  2 | 市场部    |<br>|  5 | 常遇春    |   43 | 开发               |  10500 | 2004-09-07 |         3 |       1 |  1 | 研发部    |<br>|  6 | 小昭      |   19 | 程序员鼓励师       |   6600 | 2004-10-12 |         2 |       1 |  6 | 人事部    |<br>|  6 | 小昭      |   19 | 程序员鼓励师       |   6600 | 2004-10-12 |         2 |       1 |  5 | 总经办    |<br>|  6 | 小昭      |   19 | 程序员鼓励师       |   6600 | 2004-10-12 |         2 |       1 |  4 | 销售部    |<br>|  6 | 小昭      |   19 | 程序员鼓励师       |   6600 | 2004-10-12 |         2 |       1 |  3 | 财务部    |<br>|  6 | 小昭      |   19 | 程序员鼓励师       |   6600 | 2004-10-12 |         2 |       1 |  2 | 市场部    |<br>|  6 | 小昭      |   19 | 程序员鼓励师       |   6600 | 2004-10-12 |         2 |       1 |  1 | 研发部    |<br>|  7 | 灭绝      |   60 | 财务总监           |   8500 | 2002-09-12 |         1 |       3 |  6 | 人事部    |<br>|  7 | 灭绝      |   60 | 财务总监           |   8500 | 2002-09-12 |         1 |       3 |  5 | 总经办    |<br>|  7 | 灭绝      |   60 | 财务总监           |   8500 | 2002-09-12 |         1 |       3 |  4 | 销售部    |<br>|  7 | 灭绝      |   60 | 财务总监           |   8500 | 2002-09-12 |         1 |       3 |  3 | 财务部    |<br>|  7 | 灭绝      |   60 | 财务总监           |   8500 | 2002-09-12 |         1 |       3 |  2 | 市场部    |<br>|  7 | 灭绝      |   60 | 财务总监           |   8500 | 2002-09-12 |         1 |       3 |  1 | 研发部    |<br>|  8 | 周芷若    |   19 | 会计               |  48000 | 2006-06-02 |         7 |       3 |  6 | 人事部    |<br>|  8 | 周芷若    |   19 | 会计               |  48000 | 2006-06-02 |         7 |       3 |  5 | 总经办    |<br>|  8 | 周芷若    |   19 | 会计               |  48000 | 2006-06-02 |         7 |       3 |  4 | 销售部    |<br>|  8 | 周芷若    |   19 | 会计               |  48000 | 2006-06-02 |         7 |       3 |  3 | 财务部    |<br>|  8 | 周芷若    |   19 | 会计               |  48000 | 2006-06-02 |         7 |       3 |  2 | 市场部    |<br>|  8 | 周芷若    |   19 | 会计               |  48000 | 2006-06-02 |         7 |       3 |  1 | 研发部    |<br>|  9 | 丁敏君    |   23 | 出纳               |   5250 | 2009-05-13 |         7 |       3 |  6 | 人事部    |<br>|  9 | 丁敏君    |   23 | 出纳               |   5250 | 2009-05-13 |         7 |       3 |  5 | 总经办    |<br>|  9 | 丁敏君    |   23 | 出纳               |   5250 | 2009-05-13 |         7 |       3 |  4 | 销售部    |<br>|  9 | 丁敏君    |   23 | 出纳               |   5250 | 2009-05-13 |         7 |       3 |  3 | 财务部    |<br>|  9 | 丁敏君    |   23 | 出纳               |   5250 | 2009-05-13 |         7 |       3 |  2 | 市场部    |<br>|  9 | 丁敏君    |   23 | 出纳               |   5250 | 2009-05-13 |         7 |       3 |  1 | 研发部    |<br>| 10 | 赵敏      |   20 | 市场部总监         |  12500 | 2004-10-12 |         1 |       2 |  6 | 人事部    |<br>| 10 | 赵敏      |   20 | 市场部总监         |  12500 | 2004-10-12 |         1 |       2 |  5 | 总经办    |<br>| 10 | 赵敏      |   20 | 市场部总监         |  12500 | 2004-10-12 |         1 |       2 |  4 | 销售部    |<br>| 10 | 赵敏      |   20 | 市场部总监         |  12500 | 2004-10-12 |         1 |       2 |  3 | 财务部    |<br>| 10 | 赵敏      |   20 | 市场部总监         |  12500 | 2004-10-12 |         1 |       2 |  2 | 市场部    |<br>| 10 | 赵敏      |   20 | 市场部总监         |  12500 | 2004-10-12 |         1 |       2 |  1 | 研发部    |<br>| 11 | 鹿杖客    |   56 | 职员               |   3750 | 2006-10-03 |        10 |       2 |  6 | 人事部    |<br>| 11 | 鹿杖客    |   56 | 职员               |   3750 | 2006-10-03 |        10 |       2 |  5 | 总经办    |<br>| 11 | 鹿杖客    |   56 | 职员               |   3750 | 2006-10-03 |        10 |       2 |  4 | 销售部    |<br>| 11 | 鹿杖客    |   56 | 职员               |   3750 | 2006-10-03 |        10 |       2 |  3 | 财务部    |<br>| 11 | 鹿杖客    |   56 | 职员               |   3750 | 2006-10-03 |        10 |       2 |  2 | 市场部    |<br>| 11 | 鹿杖客    |   56 | 职员               |   3750 | 2006-10-03 |        10 |       2 |  1 | 研发部    |<br>| 12 | 鹤笔翁    |   19 | 职员               |   3750 | 2007-05-09 |        10 |       2 |  6 | 人事部    |<br>| 12 | 鹤笔翁    |   19 | 职员               |   3750 | 2007-05-09 |        10 |       2 |  5 | 总经办    |<br>| 12 | 鹤笔翁    |   19 | 职员               |   3750 | 2007-05-09 |        10 |       2 |  4 | 销售部    |<br>| 12 | 鹤笔翁    |   19 | 职员               |   3750 | 2007-05-09 |        10 |       2 |  3 | 财务部    |<br>| 12 | 鹤笔翁    |   19 | 职员               |   3750 | 2007-05-09 |        10 |       2 |  2 | 市场部    |<br>| 12 | 鹤笔翁    |   19 | 职员               |   3750 | 2007-05-09 |        10 |       2 |  1 | 研发部    |<br>| 13 | 方东白    |   19 | 职员               |   5500 | 2009-02-12 |        10 |       2 |  6 | 人事部    |<br>| 13 | 方东白    |   19 | 职员               |   5500 | 2009-02-12 |        10 |       2 |  5 | 总经办    |<br>| 13 | 方东白    |   19 | 职员               |   5500 | 2009-02-12 |        10 |       2 |  4 | 销售部    |<br>| 13 | 方东白    |   19 | 职员               |   5500 | 2009-02-12 |        10 |       2 |  3 | 财务部    |<br>| 13 | 方东白    |   19 | 职员               |   5500 | 2009-02-12 |        10 |       2 |  2 | 市场部    |<br>| 13 | 方东白    |   19 | 职员               |   5500 | 2009-02-12 |        10 |       2 |  1 | 研发部    |<br>| 14 | 张三丰    |   88 | 销售总监           |  14000 | 2004-10-12 |         1 |       4 |  6 | 人事部    |<br>| 14 | 张三丰    |   88 | 销售总监           |  14000 | 2004-10-12 |         1 |       4 |  5 | 总经办    |<br>| 14 | 张三丰    |   88 | 销售总监           |  14000 | 2004-10-12 |         1 |       4 |  4 | 销售部    |<br>| 14 | 张三丰    |   88 | 销售总监           |  14000 | 2004-10-12 |         1 |       4 |  3 | 财务部    |<br>| 14 | 张三丰    |   88 | 销售总监           |  14000 | 2004-10-12 |         1 |       4 |  2 | 市场部    |<br>| 14 | 张三丰    |   88 | 销售总监           |  14000 | 2004-10-12 |         1 |       4 |  1 | 研发部    |<br>| 15 | 俞莲舟    |   38 | 销售               |   4600 | 2004-10-12 |        14 |       4 |  6 | 人事部    |<br>| 15 | 俞莲舟    |   38 | 销售               |   4600 | 2004-10-12 |        14 |       4 |  5 | 总经办    |<br>| 15 | 俞莲舟    |   38 | 销售               |   4600 | 2004-10-12 |        14 |       4 |  4 | 销售部    |<br>| 15 | 俞莲舟    |   38 | 销售               |   4600 | 2004-10-12 |        14 |       4 |  3 | 财务部    |<br>| 15 | 俞莲舟    |   38 | 销售               |   4600 | 2004-10-12 |        14 |       4 |  2 | 市场部    |<br>| 15 | 俞莲舟    |   38 | 销售               |   4600 | 2004-10-12 |        14 |       4 |  1 | 研发部    |<br>| 16 | 宋远桥    |   40 | 销售               |   4600 | 2004-10-12 |        14 |       4 |  6 | 人事部    |<br>| 16 | 宋远桥    |   40 | 销售               |   4600 | 2004-10-12 |        14 |       4 |  5 | 总经办    |<br>| 16 | 宋远桥    |   40 | 销售               |   4600 | 2004-10-12 |        14 |       4 |  4 | 销售部    |<br>| 16 | 宋远桥    |   40 | 销售               |   4600 | 2004-10-12 |        14 |       4 |  3 | 财务部    |<br>| 16 | 宋远桥    |   40 | 销售               |   4600 | 2004-10-12 |        14 |       4 |  2 | 市场部    |<br>| 16 | 宋远桥    |   40 | 销售               |   4600 | 2004-10-12 |        14 |       4 |  1 | 研发部    |<br>| 17 | 陈友谅    |   42 | NULL               |   2000 | 2011-10-12 |         1 |    NULL |  6 | 人事部    |<br>| 17 | 陈友谅    |   42 | NULL               |   2000 | 2011-10-12 |         1 |    NULL |  5 | 总经办    |<br>| 17 | 陈友谅    |   42 | NULL               |   2000 | 2011-10-12 |         1 |    NULL |  4 | 销售部    |<br>| 17 | 陈友谅    |   42 | NULL               |   2000 | 2011-10-12 |         1 |    NULL |  3 | 财务部    |<br>| 17 | 陈友谅    |   42 | NULL               |   2000 | 2011-10-12 |         1 |    NULL |  2 | 市场部    |<br>| 17 | 陈友谅    |   42 | NULL               |   2000 | 2011-10-12 |         1 |    NULL |  1 | 研发部    |<br>+----+-----------+------+--------------------+--------+------------+-----------+---------+----+-----------+<br>102 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure></div></details>
<p>此时,我们看到查询结果中包含了大量的结果集，总共102条记录，而这其实就是员工表emp所有的记录 (17) 与 部门表dept所有记录 (6) 的所有组合情况，这种现象称之为笛卡尔积。</p>
<p>接下来，就来简单介绍下笛卡尔积。</p>
<br>
<p><strong>笛卡尔积</strong>:  笛卡尔乘积是指在数学中，两个集合A集合 和 B集合的所有组合情况。</p>
<p><img src="/static/imgs/loading.gif" data-original="https://cdn.jsdelivr.net/gh/ggw2021/images@main/blogs/Snipaste_2024-04-10_10-01-21.png" alt=""></p>
<p>而在多表查询中，我们是需要<u>消除无效的笛卡尔积</u>的，只保留两张表关联部分的数据。</p>
<p><img src="/static/imgs/loading.gif" data-original="https://cdn.jsdelivr.net/gh/ggw2021/images@main/blogs/Snipaste_2024-04-10_10-03-24.png" alt=""></p>
<p>在SQL语句中，如何来去除无效的笛卡尔积呢？ 我们可以给多表查询加上连接查询的条件即可。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> emp , dept <span class="hljs-keyword">where</span> emp.dept_id <span class="hljs-operator">=</span> dept.id;<br></code></pre></td></tr></table></figure>
<details class="toggle" style="border: 1px solid  #edf4ee"><summary class="toggle-button" style="background-color:  #edf4ee;color:  #17181a">查看输出 </summary><div class="toggle-content"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">+----+-----------+------+--------------------+--------+------------+-----------+---------+----+-----------+<br>| id | name      | age  | job                | salary | entrydate  | managerid | dept_id | id | name      |<br>+----+-----------+------+--------------------+--------+------------+-----------+---------+----+-----------+<br>|  2 | 张无忌    |   20 | 项目经理           |  12500 | 2005-12-05 |         1 |       1 |  1 | 研发部    |<br>|  3 | 杨逍      |   33 | 开发               |   8400 | 2000-11-03 |         2 |       1 |  1 | 研发部    |<br>|  4 | 韦一笑    |   48 | 开发               |  11000 | 2002-02-05 |         2 |       1 |  1 | 研发部    |<br>|  5 | 常遇春    |   43 | 开发               |  10500 | 2004-09-07 |         3 |       1 |  1 | 研发部    |<br>|  6 | 小昭      |   19 | 程序员鼓励师       |   6600 | 2004-10-12 |         2 |       1 |  1 | 研发部    |<br>| 10 | 赵敏      |   20 | 市场部总监         |  12500 | 2004-10-12 |         1 |       2 |  2 | 市场部    |<br>| 11 | 鹿杖客    |   56 | 职员               |   3750 | 2006-10-03 |        10 |       2 |  2 | 市场部    |<br>| 12 | 鹤笔翁    |   19 | 职员               |   3750 | 2007-05-09 |        10 |       2 |  2 | 市场部    |<br>| 13 | 方东白    |   19 | 职员               |   5500 | 2009-02-12 |        10 |       2 |  2 | 市场部    |<br>|  7 | 灭绝      |   60 | 财务总监           |   8500 | 2002-09-12 |         1 |       3 |  3 | 财务部    |<br>|  8 | 周芷若    |   19 | 会计               |  48000 | 2006-06-02 |         7 |       3 |  3 | 财务部    |<br>|  9 | 丁敏君    |   23 | 出纳               |   5250 | 2009-05-13 |         7 |       3 |  3 | 财务部    |<br>| 14 | 张三丰    |   88 | 销售总监           |  14000 | 2004-10-12 |         1 |       4 |  4 | 销售部    |<br>| 15 | 俞莲舟    |   38 | 销售               |   4600 | 2004-10-12 |        14 |       4 |  4 | 销售部    |<br>| 16 | 宋远桥    |   40 | 销售               |   4600 | 2004-10-12 |        14 |       4 |  4 | 销售部    |<br>|  1 | 金庸      |   66 | 总裁               |  20000 | 2000-01-01 |      NULL |       5 |  5 | 总经办    |<br>+----+-----------+------+--------------------+--------+------------+-----------+---------+----+-----------+<br>16 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure>
<p>而由于id为17的员工，没有dept_id字段值，所以在多表查询时，根据连接查询的条件并没有查询到。</p>
</div></details>
<hr>
<br>
<ul>
<li>
<p><strong><u>分类</u></strong></p>
<ul>
<li>
<p>连接查询：</p>
<ol>
<li>
<p>内连接：相当于查询A、B交集部分数据</p>
</li>
<li>
<p>外连接：</p>
</li>
<li>
<p>左外连接：查询左表所有数据，以及两张表交集部分数据</p>
</li>
<li>
<p>右外连接：查询右表所有数据，以及两张表交集部分数据</p>
</li>
<li>
<p>自连接：当前表与自身的连接查询，自连接必须使用表别名</p>
</li>
</ol>
</li>
<li>
<p>子查询</p>
</li>
</ul>
</li>
</ul>
<hr>
<p><br><br><br></p>
<h4 id="5-3-内连接">5.3 内连接</h4>
<p><img src="/static/imgs/loading.gif" data-original="https://cdn.jsdelivr.net/gh/ggw2021/images@main/blogs/Snipaste_2024-04-10_10-07-30.png" alt=""></p>
<p>内连接查询的是两张表交集部分的数据。(也就是绿色部分的数据)</p>
<p>内连接的语法分为两种:  隐式内连接、显式内连接。先来学习一下具体的语法结构。</p>
<br>
<p><strong>1).</strong> 隐式内连</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> 字段列表 <span class="hljs-keyword">FROM</span> 表<span class="hljs-number">1</span> , 表<span class="hljs-number">2</span> <span class="hljs-keyword">WHERE</span> 条件 ... ;<br></code></pre></td></tr></table></figure>
<br>
<p><strong>2).</strong> 显式内连接</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> 字段列表 <span class="hljs-keyword">FROM</span> 表<span class="hljs-number">1</span> [ <span class="hljs-keyword">INNER</span> ] <span class="hljs-keyword">JOIN</span> 表<span class="hljs-number">2</span> <span class="hljs-keyword">ON</span> 连接条件 ... ;<br></code></pre></td></tr></table></figure>
<p><code>INNER JOIN</code>选择两个表中存在匹配关系的行。只有当在连接的两个表中找到相匹配的行时，这些行才会出现在查询结果中。如果一行在一个表中有匹配，而在另一个表中没有匹配，则该行不会出现在结果集中。</p>
<p>它的主要作用是明确指出要执行的是内连接操作，有助于提高SQL语句的可读性，特别是对于SQL语句的维护和理解而言。然而，从功能角度来看，无论是否明确写出<code>INNER</code>，结果都是一样的。</p>
<br>
<p>案例:<br>
<strong>A.</strong> 查询每一个员工的姓名 , 及关联的部门的名称 (隐式内连接实现)<br>
表结构: emp , dept<br>
连接条件: emp.dept_id = <a target="_blank" rel="noopener" href="http://dept.id">dept.id</a></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> emp.name , dept.name <span class="hljs-keyword">from</span> emp , dept <span class="hljs-keyword">where</span> emp.dept_id <span class="hljs-operator">=</span> dept.id ;<br><br><span class="hljs-comment">-- 为每一张表起别名,简化SQL编写</span><br><span class="hljs-keyword">select</span> e.name,d.name <span class="hljs-keyword">from</span> emp e , dept d <span class="hljs-keyword">where</span> e.dept_id <span class="hljs-operator">=</span> d.id;<br></code></pre></td></tr></table></figure>
<details class="toggle" style="border: 1px solid  #edf4ee"><summary class="toggle-button" style="background-color:  #edf4ee;color:  #17181a">查看输出 </summary><div class="toggle-content"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">+-----------+-----------+<br>| name      | name      |<br>+-----------+-----------+<br>| 张无忌    | 研发部    |<br>| 杨逍      | 研发部    |<br>| 韦一笑    | 研发部    |<br>| 常遇春    | 研发部    |<br>| 小昭      | 研发部    |<br>| 赵敏      | 市场部    |<br>| 鹿杖客    | 市场部    |<br>| 鹤笔翁    | 市场部    |<br>| 方东白    | 市场部    |<br>| 灭绝      | 财务部    |<br>| 周芷若    | 财务部    |<br>| 丁敏君    | 财务部    |<br>| 张三丰    | 销售部    |<br>| 俞莲舟    | 销售部    |<br>| 宋远桥    | 销售部    |<br>| 金庸      | 总经办    |<br>+-----------+-----------+<br>16 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure></div></details>
<p><strong>B.</strong> 查询每一个员工的姓名 , 及关联的部门的名称 (显式内连接实现) — INNER JOIN …ON …<br>
表结构: emp , dept<br>
连接条件: emp.dept_id = <a target="_blank" rel="noopener" href="http://dept.id">dept.id</a></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> e.name, d.name <span class="hljs-keyword">from</span> emp e <span class="hljs-keyword">inner</span> <span class="hljs-keyword">join</span> dept d <span class="hljs-keyword">on</span> e.dept_id <span class="hljs-operator">=</span> d.id;<br><br><span class="hljs-comment">-- 为每一张表起别名,简化SQL编写</span><br><span class="hljs-keyword">select</span> e.name, d.name <span class="hljs-keyword">from</span> emp e <span class="hljs-keyword">join</span> dept d <span class="hljs-keyword">on</span> e.dept_id <span class="hljs-operator">=</span> d.id;<br></code></pre></td></tr></table></figure>
<details class="toggle" style="border: 1px solid  #edf4ee"><summary class="toggle-button" style="background-color:  #edf4ee;color:  #17181a">查看输出 </summary><div class="toggle-content"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">+-----------+-----------+<br>| name      | name      |<br>+-----------+-----------+<br>| 张无忌    | 研发部    |<br>| 杨逍      | 研发部    |<br>| 韦一笑    | 研发部    |<br>| 常遇春    | 研发部    |<br>| 小昭      | 研发部    |<br>| 赵敏      | 市场部    |<br>| 鹿杖客    | 市场部    |<br>| 鹤笔翁    | 市场部    |<br>| 方东白    | 市场部    |<br>| 灭绝      | 财务部    |<br>| 周芷若    | 财务部    |<br>| 丁敏君    | 财务部    |<br>| 张三丰    | 销售部    |<br>| 俞莲舟    | 销售部    |<br>| 宋远桥    | 销售部    |<br>| 金庸      | 总经办    |<br>+-----------+-----------+<br>16 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure></div></details>
<blockquote>
<p>表的别名:<br>
①. tablea as 别名1 , tableb as 别名2 ;<br>
②. tablea 别名1 , tableb 别名2 ;</p>
</blockquote>
<blockquote>
<p>注意事项:  一旦为表起了别名，就不能再使用表名来指定对应的字段了，此时只能够使用别名来指定字<br>
段。</p>
</blockquote>
<hr>
<p><br><br><br></p>
<h4 id="5-4-外连接">5.4 外连接</h4>
<p><img src="/static/imgs/loading.gif" data-original="https://cdn.jsdelivr.net/gh/ggw2021/images@main/blogs/Snipaste_2024-04-10_10-07-30.png" alt=""></p>
<p>外连接分为两种，分别是：左外连接 和 右外连接。具体的语法结构为：</p>
<br>
<p><strong>1).</strong> 左外连接</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> 字段列表 <span class="hljs-keyword">FROM</span> 表<span class="hljs-number">1</span> <span class="hljs-keyword">LEFT</span> [ <span class="hljs-keyword">OUTER</span> ] <span class="hljs-keyword">JOIN</span> 表<span class="hljs-number">2</span> <span class="hljs-keyword">ON</span> 条件 ... ;<br></code></pre></td></tr></table></figure>
<p>左外连接相当于查询表1(左表)的所有数据，当然也包含表1和表2交集部分的数据。【蓝 + 绿】</p>
<br>
<p><strong>2).</strong> 右外连接</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> 字段列表 <span class="hljs-keyword">FROM</span> 表<span class="hljs-number">1</span> <span class="hljs-keyword">RIGHT</span> [ <span class="hljs-keyword">OUTER</span> ] <span class="hljs-keyword">JOIN</span> 表<span class="hljs-number">2</span> <span class="hljs-keyword">ON</span> 条件 ... ;<br></code></pre></td></tr></table></figure>
<p>右外连接相当于查询表2(右表)的所有数据，当然也包含表1和表2交集部分的数据。  【黄 + 绿】</p>
<br>
<p>案例:<br>
<strong>A.</strong> 查询emp表的所有数据, 和对应的部门信息<br>
由于需求中提到，要查询emp的所有数据，所以是不能内连接查询的，需要考虑使用外连接查询。<br>
表结构: emp, dept<br>
连接条件: emp.dept_id = <a target="_blank" rel="noopener" href="http://dept.id">dept.id</a></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span><span class="hljs-operator">*</span>E.<span class="hljs-operator">*</span><span class="hljs-operator">*</span> <span class="hljs-operator">*</span>, d.name <span class="hljs-keyword">from</span> emp e <span class="hljs-keyword">left</span> <span class="hljs-keyword">outer</span> <span class="hljs-keyword">join</span> dept d <span class="hljs-keyword">on</span> e.dept_id <span class="hljs-operator">=</span> d.id;<br><br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span><span class="hljs-operator">*</span>E.<span class="hljs-operator">*</span><span class="hljs-operator">*</span> <span class="hljs-operator">*</span>, d.name <span class="hljs-keyword">from</span> emp e <span class="hljs-keyword">left</span> <span class="hljs-keyword">join</span> dept d <span class="hljs-keyword">on</span> e.dept_id <span class="hljs-operator">=</span> d.id;<br></code></pre></td></tr></table></figure>
<details class="toggle" style="border: 1px solid  #edf4ee"><summary class="toggle-button" style="background-color:  #edf4ee;color:  #17181a">查看输出 </summary><div class="toggle-content"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">+----+-----------+------+--------------------+--------+------------+-----------+---------+-----------+<br>| id | name      | age  | job                | salary | entrydate  | managerid | dept_id | name      |<br>+----+-----------+------+--------------------+--------+------------+-----------+---------+-----------+<br>|  1 | 金庸      |   66 | 总裁               |  20000 | 2000-01-01 |      NULL |       5 | 总经办    |<br>|  2 | 张无忌    |   20 | 项目经理           |  12500 | 2005-12-05 |         1 |       1 | 研发部    |<br>|  3 | 杨逍      |   33 | 开发               |   8400 | 2000-11-03 |         2 |       1 | 研发部    |<br>|  4 | 韦一笑    |   48 | 开发               |  11000 | 2002-02-05 |         2 |       1 | 研发部    |<br>|  5 | 常遇春    |   43 | 开发               |  10500 | 2004-09-07 |         3 |       1 | 研发部    |<br>|  6 | 小昭      |   19 | 程序员鼓励师       |   6600 | 2004-10-12 |         2 |       1 | 研发部    |<br>|  7 | 灭绝      |   60 | 财务总监           |   8500 | 2002-09-12 |         1 |       3 | 财务部    |<br>|  8 | 周芷若    |   19 | 会计               |  48000 | 2006-06-02 |         7 |       3 | 财务部    |<br>|  9 | 丁敏君    |   23 | 出纳               |   5250 | 2009-05-13 |         7 |       3 | 财务部    |<br>| 10 | 赵敏      |   20 | 市场部总监         |  12500 | 2004-10-12 |         1 |       2 | 市场部    |<br>| 11 | 鹿杖客    |   56 | 职员               |   3750 | 2006-10-03 |        10 |       2 | 市场部    |<br>| 12 | 鹤笔翁    |   19 | 职员               |   3750 | 2007-05-09 |        10 |       2 | 市场部    |<br>| 13 | 方东白    |   19 | 职员               |   5500 | 2009-02-12 |        10 |       2 | 市场部    |<br>| 14 | 张三丰    |   88 | 销售总监           |  14000 | 2004-10-12 |         1 |       4 | 销售部    |<br>| 15 | 俞莲舟    |   38 | 销售               |   4600 | 2004-10-12 |        14 |       4 | 销售部    |<br>| 16 | 宋远桥    |   40 | 销售               |   4600 | 2004-10-12 |        14 |       4 | 销售部    |<br>| 17 | 陈友谅    |   42 | NULL               |   2000 | 2011-10-12 |         1 |    NULL | NULL      |<br>+----+-----------+------+--------------------+--------+------------+-----------+---------+-----------+<br>17 rows in set (0.01 sec)<br></code></pre></td></tr></table></figure></div></details>
<p><strong>B.</strong> 查询dept表的所有数据, 和对应的员工信息(右外连接)<br>
由于需求中提到，要查询dept表的所有数据，所以是不能内连接查询的，需要考虑使用外连接查询。<br>
表结构: emp, dept<br>
连接条件: emp.dept_id = <a target="_blank" rel="noopener" href="http://dept.id">dept.id</a></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> d.<span class="hljs-operator">*</span>, <span class="hljs-operator">*</span><span class="hljs-operator">*</span>E.<span class="hljs-operator">*</span><span class="hljs-operator">*</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> emp e <span class="hljs-keyword">right</span> <span class="hljs-keyword">outer</span> <span class="hljs-keyword">join</span> dept d <span class="hljs-keyword">on</span> e.dept_id <span class="hljs-operator">=</span> d.id;<br><br><span class="hljs-keyword">select</span> d.<span class="hljs-operator">*</span>, <span class="hljs-operator">*</span><span class="hljs-operator">*</span>E.<span class="hljs-operator">*</span><span class="hljs-operator">*</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> dept d <span class="hljs-keyword">left</span> <span class="hljs-keyword">outer</span> <span class="hljs-keyword">join</span> emp e <span class="hljs-keyword">on</span> e.dept_id <span class="hljs-operator">=</span> d.id;<br></code></pre></td></tr></table></figure>
<details class="toggle" style="border: 1px solid  #edf4ee"><summary class="toggle-button" style="background-color:  #edf4ee;color:  #17181a">查看输出 </summary><div class="toggle-content"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">+----+-----------+------+-----------+------+--------------------+--------+------------+-----------+---------+<br>| id | name      | id   | name      | age  | job                | salary | entrydate  | managerid | dept_id |<br>+----+-----------+------+-----------+------+--------------------+--------+------------+-----------+---------+<br>|  1 | 研发部    |    2 | 张无忌    |   20 | 项目经理           |  12500 | 2005-12-05 |         1 |       1 |<br>|  1 | 研发部    |    3 | 杨逍      |   33 | 开发               |   8400 | 2000-11-03 |         2 |       1 |<br>|  1 | 研发部    |    4 | 韦一笑    |   48 | 开发               |  11000 | 2002-02-05 |         2 |       1 |<br>|  1 | 研发部    |    5 | 常遇春    |   43 | 开发               |  10500 | 2004-09-07 |         3 |       1 |<br>|  1 | 研发部    |    6 | 小昭      |   19 | 程序员鼓励师       |   6600 | 2004-10-12 |         2 |       1 |<br>|  2 | 市场部    |   10 | 赵敏      |   20 | 市场部总监         |  12500 | 2004-10-12 |         1 |       2 |<br>|  2 | 市场部    |   11 | 鹿杖客    |   56 | 职员               |   3750 | 2006-10-03 |        10 |       2 |<br>|  2 | 市场部    |   12 | 鹤笔翁    |   19 | 职员               |   3750 | 2007-05-09 |        10 |       2 |<br>|  2 | 市场部    |   13 | 方东白    |   19 | 职员               |   5500 | 2009-02-12 |        10 |       2 |<br>|  3 | 财务部    |    7 | 灭绝      |   60 | 财务总监           |   8500 | 2002-09-12 |         1 |       3 |<br>|  3 | 财务部    |    8 | 周芷若    |   19 | 会计               |  48000 | 2006-06-02 |         7 |       3 |<br>|  3 | 财务部    |    9 | 丁敏君    |   23 | 出纳               |   5250 | 2009-05-13 |         7 |       3 |<br>|  4 | 销售部    |   14 | 张三丰    |   88 | 销售总监           |  14000 | 2004-10-12 |         1 |       4 |<br>|  4 | 销售部    |   15 | 俞莲舟    |   38 | 销售               |   4600 | 2004-10-12 |        14 |       4 |<br>|  4 | 销售部    |   16 | 宋远桥    |   40 | 销售               |   4600 | 2004-10-12 |        14 |       4 |<br>|  5 | 总经办    |    1 | 金庸      |   66 | 总裁               |  20000 | 2000-01-01 |      NULL |       5 |<br>|  6 | 人事部    | NULL | NULL      | NULL | NULL               |   NULL | NULL       |      NULL |    NULL |<br>+----+-----------+------+-----------+------+--------------------+--------+------------+-----------+---------+<br>17 rows in set (0.01 sec)<br></code></pre></td></tr></table></figure></div></details>
<blockquote>
<p>注意事项：<br>
左外连接和右外连接是可以相互替换的，只需要调整在连接查询时SQL中，表结构的先后顺序就可以了。而我们在<u>日常开发使用时，更偏向于左外连接</u>。</p>
</blockquote>
<hr>
<p><br><br><br></p>
<h4 id="5-5-自连接">5.5 自连接</h4>
<ul>
<li><u><strong>自连接查询</strong></u></li>
</ul>
<p>自连接查询，顾名思义，就是自己连接自己，也就是把一张表连接查询多次。我们先来学习一下自连接的查询语法：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> 字段列表 <span class="hljs-keyword">FROM</span> 表A 别名A <span class="hljs-keyword">JOIN</span> 表A 别名B <span class="hljs-keyword">ON</span> 条件 ... ;<br></code></pre></td></tr></table></figure>
<p>而对于自连接查询，可以是内连接查询，也可以是外连接查询。</p>
<br>
<p>案例：<br>
<strong>A.</strong> 查询员工 及其 所属领导的名字<br>
表结构: emp</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> a.name , b.name <br><span class="hljs-keyword">from</span> emp a , emp b <span class="hljs-keyword">where</span> a.managerid <span class="hljs-operator">=</span> b.id;<br></code></pre></td></tr></table></figure>
<details class="toggle" style="border: 1px solid  #edf4ee"><summary class="toggle-button" style="background-color:  #edf4ee;color:  #17181a">查看输出 </summary><div class="toggle-content"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">+-----------+-----------+<br>| name      | name      |<br>+-----------+-----------+<br>| 张无忌    | 金庸      |<br>| 杨逍      | 张无忌    |<br>| 韦一笑    | 张无忌    |<br>| 常遇春    | 杨逍      |<br>| 小昭      | 张无忌    |<br>| 灭绝      | 金庸      |<br>| 周芷若    | 灭绝      |<br>| 丁敏君    | 灭绝      |<br>| 赵敏      | 金庸      |<br>| 鹿杖客    | 赵敏      |<br>| 鹤笔翁    | 赵敏      |<br>| 方东白    | 赵敏      |<br>| 张三丰    | 金庸      |<br>| 俞莲舟    | 张三丰    |<br>| 宋远桥    | 张三丰    |<br>| 陈友谅    | 金庸      |<br>+-----------+-----------+<br>16 rows in set (0.01 sec)<br></code></pre></td></tr></table></figure></div></details>
<p><strong>B.</strong> 查询所有员工 emp 及其领导的名字 emp , 如果员工没有领导, 也需要查询出来<br>
表结构: emp a , emp b</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> a.name <span class="hljs-string">&#x27;员工&#x27;</span>, b.name <span class="hljs-string">&#x27;领导&#x27;</span> <br><span class="hljs-keyword">from</span> emp a <span class="hljs-keyword">left</span> <span class="hljs-keyword">join</span> emp b <span class="hljs-keyword">on</span> a.managerid <span class="hljs-operator">=</span> b.id;<br></code></pre></td></tr></table></figure>
<details class="toggle" style="border: 1px solid  #edf4ee"><summary class="toggle-button" style="background-color:  #edf4ee;color:  #17181a">查看输出 </summary><div class="toggle-content"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">+-----------+-----------+<br>| 员工      | 领导      |<br>+-----------+-----------+<br>| 金庸      | NULL      |<br>| 张无忌    | 金庸      |<br>| 杨逍      | 张无忌    |<br>| 韦一笑    | 张无忌    |<br>| 常遇春    | 杨逍      |<br>| 小昭      | 张无忌    |<br>| 灭绝      | 金庸      |<br>| 周芷若    | 灭绝      |<br>| 丁敏君    | 灭绝      |<br>| 赵敏      | 金庸      |<br>| 鹿杖客    | 赵敏      |<br>| 鹤笔翁    | 赵敏      |<br>| 方东白    | 赵敏      |<br>| 张三丰    | 金庸      |<br>| 俞莲舟    | 张三丰    |<br>| 宋远桥    | 张三丰    |<br>| 陈友谅    | 金庸      |<br>+-----------+-----------+<br>17 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure></div></details>
<blockquote>
<p>注意事项:<br>
在自连接查询中，必须要为表起别名，要不然我们不清楚所指定的条件、返回的字段，到底是哪一张表的字段。</p>
</blockquote>
<hr>
<br>
<ul>
<li><strong><u>联合查询</u></strong></li>
</ul>
<p>对于union查询，就是把多次查询的结果合并起来，形成一个新的查询结果集。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> 字段列表 <span class="hljs-keyword">FROM</span> 表A ...<br><span class="hljs-keyword">UNION</span> [ <span class="hljs-keyword">ALL</span> ]<br><span class="hljs-keyword">SELECT</span> 字段列表 <span class="hljs-keyword">FROM</span> 表B ....;<br></code></pre></td></tr></table></figure>
<ul>
<li>对于联合查询的多张表的列数必须保持一致，字段类型也需要保持一致。</li>
<li><code>union all</code> 会将全部的数据直接合并在一起，<code>union</code> 会对合并之后的数据去重。</li>
</ul>
<br>
<p>案例:<br>
<strong>A.</strong> 将薪资低于 5000 的员工 , 和 年龄大于 50 岁的员工全部查询出来.<br>
当前对于这个需求，我们可以直接使用多条件查询，使用逻辑运算符 or 连接即可。 那这里呢，我们也可以通过union/union all来联合查询.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> emp <span class="hljs-keyword">where</span> salary <span class="hljs-operator">&lt;</span> <span class="hljs-number">5000</span><br><span class="hljs-keyword">union</span> <span class="hljs-keyword">all</span><br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> emp <span class="hljs-keyword">where</span> age <span class="hljs-operator">&gt;</span> <span class="hljs-number">50</span>;<br></code></pre></td></tr></table></figure>
<details class="toggle" style="border: 1px solid  #edf4ee"><summary class="toggle-button" style="background-color:  #edf4ee;color:  #17181a">查看输出 </summary><div class="toggle-content"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">+----+-----------+------+--------------+--------+------------+-----------+---------+<br>| id | name      | age  | job          | salary | entrydate  | managerid | dept_id |<br>+----+-----------+------+--------------+--------+------------+-----------+---------+<br>| 11 | 鹿杖客    |   56 | 职员         |   3750 | 2006-10-03 |        10 |       2 |<br>| 12 | 鹤笔翁    |   19 | 职员         |   3750 | 2007-05-09 |        10 |       2 |<br>| 15 | 俞莲舟    |   38 | 销售         |   4600 | 2004-10-12 |        14 |       4 |<br>| 16 | 宋远桥    |   40 | 销售         |   4600 | 2004-10-12 |        14 |       4 |<br>| 17 | 陈友谅    |   42 | NULL         |   2000 | 2011-10-12 |         1 |    NULL |<br>|  1 | 金庸      |   66 | 总裁         |  20000 | 2000-01-01 |      NULL |       5 |<br>|  7 | 灭绝      |   60 | 财务总监     |   8500 | 2002-09-12 |         1 |       3 |<br>| 11 | 鹿杖客    |   56 | 职员         |   3750 | 2006-10-03 |        10 |       2 |<br>| 14 | 张三丰    |   88 | 销售总监     |  14000 | 2004-10-12 |         1 |       4 |<br>+----+-----------+------+--------------+--------+------------+-----------+---------+<br>9 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure>
<p>发现 <strong>鹿杖客</strong> 出现了两次</p>
</div></details>
<p>union all查询出来的结果，仅仅进行简单的合并，并未去重。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> emp <span class="hljs-keyword">where</span> salary <span class="hljs-operator">&lt;</span> <span class="hljs-number">5000</span><br><span class="hljs-keyword">union</span><br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> emp <span class="hljs-keyword">where</span> age <span class="hljs-operator">&gt;</span> <span class="hljs-number">50</span>;<br></code></pre></td></tr></table></figure>
<details class="toggle" style="border: 1px solid  #edf4ee"><summary class="toggle-button" style="background-color:  #edf4ee;color:  #17181a">查看输出 </summary><div class="toggle-content"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">+----+-----------+------+--------------+--------+------------+-----------+---------+<br>| id | name      | age  | job          | salary | entrydate  | managerid | dept_id |<br>+----+-----------+------+--------------+--------+------------+-----------+---------+<br>| 11 | 鹿杖客    |   56 | 职员         |   3750 | 2006-10-03 |        10 |       2 |<br>| 12 | 鹤笔翁    |   19 | 职员         |   3750 | 2007-05-09 |        10 |       2 |<br>| 15 | 俞莲舟    |   38 | 销售         |   4600 | 2004-10-12 |        14 |       4 |<br>| 16 | 宋远桥    |   40 | 销售         |   4600 | 2004-10-12 |        14 |       4 |<br>| 17 | 陈友谅    |   42 | NULL         |   2000 | 2011-10-12 |         1 |    NULL |<br>|  1 | 金庸      |   66 | 总裁         |  20000 | 2000-01-01 |      NULL |       5 |<br>|  7 | 灭绝      |   60 | 财务总监     |   8500 | 2002-09-12 |         1 |       3 |<br>| 14 | 张三丰    |   88 | 销售总监     |  14000 | 2004-10-12 |         1 |       4 |<br>+----+-----------+------+--------------+--------+------------+-----------+---------+<br>8 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure></div></details>
<p>union 联合查询，会对查询出来的结果进行去重处理。</p>
<blockquote>
<p>注意：<br>
如果多条查询语句查询出来的结果，字段数量不一致，在进行union/union all联合查询时，将会报错。如：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> emp <span class="hljs-keyword">where</span> salary <span class="hljs-operator">&lt;</span> <span class="hljs-number">5000</span><br><span class="hljs-keyword">union</span><br><span class="hljs-keyword">select</span> name <span class="hljs-keyword">from</span> emp <span class="hljs-keyword">where</span> age <span class="hljs-operator">&gt;</span> <span class="hljs-number">50</span>;<br></code></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">ERROR 1222 (21000): The used SELECT statements have a different number of columns<br></code></pre></td></tr></table></figure>
<p>这个是对的</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> id <span class="hljs-keyword">from</span> emp <span class="hljs-keyword">where</span> salary <span class="hljs-operator">&lt;</span> <span class="hljs-number">5000</span><br><span class="hljs-keyword">union</span><br><span class="hljs-keyword">select</span> name <span class="hljs-keyword">from</span> emp <span class="hljs-keyword">where</span> age <span class="hljs-operator">&gt;</span> <span class="hljs-number">50</span>;<br></code></pre></td></tr></table></figure>
<details class="toggle" style="border: 1px solid  #edf4ee"><summary class="toggle-button" style="background-color:  #edf4ee;color:  #17181a">查看输出 </summary><div class="toggle-content"><blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">+-----------+<br>| id        |<br>+-----------+<br>| 11        |<br>| 12        |<br>| 15        |<br>| 16        |<br>| 17        |<br>| 金庸      |<br>| 灭绝      |<br>| 鹿杖客    |<br>| 张三丰    |<br>+-----------+<br>9 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure>
</blockquote>
</div></details>
</blockquote>
<hr>
<p><br><br><br></p>
<h4 id="5-6-子查询">5.6 子查询</h4>
<ul>
<li><strong><u>概述</u></strong></li>
</ul>
<p><strong>1).</strong> 概念<br>
SQL语句中嵌套SELECT语句，称为嵌套查询，又称子查询。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> t1 <span class="hljs-keyword">WHERE</span> column1 <span class="hljs-operator">=</span> ( <span class="hljs-keyword">SELECT</span> column1 <span class="hljs-keyword">FROM</span> t2 );<br></code></pre></td></tr></table></figure>
<p>子查询外部的语句可以是 INSERT / UPDATE / DELETE / SELECT 的任何一个。</p>
<br>
<p><strong>2).</strong> 分类<br>
根据子查询结果不同，分为：<br>
A. 标量子查询（子查询结果为单个值）<br>
B. 列子查询(子查询结果为一列)<br>
C. 行子查询(子查询结果为一行)<br>
D. 表子查询(子查询结果为多行多列)</p>
<p>根据子查询位置，分为：<br>
A. WHERE之后<br>
B. FROM之后<br>
C. SELECT之后</p>
<hr>
<br>
<ul>
<li><u><strong>标量子查询</strong></u></li>
</ul>
<p>子查询返回的结果是单个值（数字、字符串、日期等），最简单的形式，这种子查询称为标量子查询。</p>
<p>常用的操作符：<code>=</code> <code>&lt;&gt;</code> <code>&gt;</code> <code>&gt;=</code> <code>&lt;</code> <code>&lt;=</code></p>
<br>
<p>案例:<br>
A. 查询 “销售部” 的所有员工信息<br>
完成这个需求时，我们可以将需求分解为两步：</p>
<p>①. 查询 “销售部” 部门ID</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> id <span class="hljs-keyword">from</span> dept <span class="hljs-keyword">where</span> name <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;销售部&#x27;</span>;<br></code></pre></td></tr></table></figure>
<p>②. 根据 “销售部” 部门ID, 查询员工信息</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> emp <span class="hljs-keyword">where</span> dept_id <span class="hljs-operator">=</span> (<span class="hljs-keyword">select</span> id <span class="hljs-keyword">from</span> dept <span class="hljs-keyword">where</span> name <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;销售部&#x27;</span>);<br></code></pre></td></tr></table></figure>
<details class="toggle" style="border: 1px solid  #edf4ee"><summary class="toggle-button" style="background-color:  #edf4ee;color:  #17181a">查看输出 </summary><div class="toggle-content"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">+----+-----------+------+--------------+--------+------------+-----------+---------+<br>| id | name      | age  | job          | salary | entrydate  | managerid | dept_id |<br>+----+-----------+------+--------------+--------+------------+-----------+---------+<br>| 14 | 张三丰    |   88 | 销售总监     |  14000 | 2004-10-12 |         1 |       4 |<br>| 15 | 俞莲舟    |   38 | 销售         |   4600 | 2004-10-12 |        14 |       4 |<br>| 16 | 宋远桥    |   40 | 销售         |   4600 | 2004-10-12 |        14 |       4 |<br>+----+-----------+------+--------------+--------+------------+-----------+---------+<br>3 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure></div></details>
<p><strong>B.</strong> 查询在 “方东白” 入职之后的员工信息<br>
完成这个需求时，我们可以将需求分解为两步：</p>
<p>①. 查询 方东白 的入职日期</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> entrydate <span class="hljs-keyword">from</span> emp <span class="hljs-keyword">where</span> name <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;方东白&#x27;</span>;<br></code></pre></td></tr></table></figure>
<p>②. 查询指定入职日期之后入职的员工信息</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> emp <span class="hljs-keyword">where</span> entrydate <span class="hljs-operator">&gt;</span> (<span class="hljs-keyword">select</span> entrydate <span class="hljs-keyword">from</span> emp <span class="hljs-keyword">where</span> name <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;方东白&#x27;</span>);<br></code></pre></td></tr></table></figure>
<details class="toggle" style="border: 1px solid  #edf4ee"><summary class="toggle-button" style="background-color:  #edf4ee;color:  #17181a">查看输出 </summary><div class="toggle-content"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">+----+-----------+------+--------+--------+------------+-----------+---------+<br>| id | name      | age  | job    | salary | entrydate  | managerid | dept_id |<br>+----+-----------+------+--------+--------+------------+-----------+---------+<br>|  9 | 丁敏君    |   23 | 出纳   |   5250 | 2009-05-13 |         7 |       3 |<br>| 17 | 陈友谅    |   42 | NULL   |   2000 | 2011-10-12 |         1 |    NULL |<br>+----+-----------+------+--------+--------+------------+-----------+---------+<br>2 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure></div></details>
<hr>
<br>
<ul>
<li><strong><u>列子查询</u></strong></li>
</ul>
<p>子查询返回的结果是一列（可以是多行），这种子查询称为列子查询。<br>
常用的操作符：IN 、NOT IN 、 ANY 、SOME 、 ALL</p>
<table>
<thead>
<tr>
<th style="text-align:left">操作符</th>
<th style="text-align:left">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">IN</td>
<td style="text-align:left">在指定的集合范围之内，多选一</td>
</tr>
<tr>
<td style="text-align:left">NOT IN</td>
<td style="text-align:left">不在指定的集合范围之内</td>
</tr>
<tr>
<td style="text-align:left">ANY</td>
<td style="text-align:left">子查询返回列表中，有任意一个满足即可</td>
</tr>
<tr>
<td style="text-align:left">SOME</td>
<td style="text-align:left">与ANY等同，使用SOME的地方都可以使用ANY</td>
</tr>
<tr>
<td style="text-align:left">ALL</td>
<td style="text-align:left">子查询返回列表的所有值都必须满足</td>
</tr>
</tbody>
</table>
<p>案例:<br>
<strong>A.</strong> 查询 “销售部” 和 “市场部” 的所有员工信息<br>
分解为以下两步:</p>
<p>①. 查询 “销售部” 和 “市场部” 的部门ID</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> id <span class="hljs-keyword">from</span> dept <span class="hljs-keyword">where</span> name <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;销售部&#x27;</span> <span class="hljs-keyword">or</span> name <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;市场部&#x27;</span>;<br></code></pre></td></tr></table></figure>
<p>②. 根据部门ID, 查询员工信息</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> emp <br><span class="hljs-keyword">where</span> dept_id <span class="hljs-keyword">in</span> (<span class="hljs-keyword">select</span> id <span class="hljs-keyword">from</span> dept <span class="hljs-keyword">where</span> name <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;销售部&#x27;</span> <span class="hljs-keyword">or</span> name <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;市场部&#x27;</span>);<br></code></pre></td></tr></table></figure>
<details class="toggle" style="border: 1px solid  #edf4ee"><summary class="toggle-button" style="background-color:  #edf4ee;color:  #17181a">查看输出 </summary><div class="toggle-content"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">+----+-----------+------+-----------------+--------+------------+-----------+---------+<br>| id | name      | age  | job             | salary | entrydate  | managerid | dept_id |<br>+----+-----------+------+-----------------+--------+------------+-----------+---------+<br>| 10 | 赵敏      |   20 | 市场部总监      |  12500 | 2004-10-12 |         1 |       2 |<br>| 11 | 鹿杖客    |   56 | 职员            |   3750 | 2006-10-03 |        10 |       2 |<br>| 12 | 鹤笔翁    |   19 | 职员            |   3750 | 2007-05-09 |        10 |       2 |<br>| 13 | 方东白    |   19 | 职员            |   5500 | 2009-02-12 |        10 |       2 |<br>| 14 | 张三丰    |   88 | 销售总监        |  14000 | 2004-10-12 |         1 |       4 |<br>| 15 | 俞莲舟    |   38 | 销售            |   4600 | 2004-10-12 |        14 |       4 |<br>| 16 | 宋远桥    |   40 | 销售            |   4600 | 2004-10-12 |        14 |       4 |<br>+----+-----------+------+-----------------+--------+------------+-----------+---------+<br>7 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure></div></details>
<p><strong>B.</strong> 查询比 财务部 所有人工资都高的员工信息<br>
分解为以下两步:</p>
<p>①. 查询所有 财务部 人员工资</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> id <span class="hljs-keyword">from</span> dept <span class="hljs-keyword">where</span> name <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;财务部&#x27;</span>;<br><br><span class="hljs-keyword">select</span> salary <span class="hljs-keyword">from</span> emp <span class="hljs-keyword">where</span> dept_id <span class="hljs-operator">=</span> (<span class="hljs-keyword">select</span> id <span class="hljs-keyword">from</span> dept <span class="hljs-keyword">where</span> name <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;财务部&#x27;</span>);<br></code></pre></td></tr></table></figure>
<p>②.   比 财务部 所有人工资都高的员工信息</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> emp <span class="hljs-keyword">where</span> salary <span class="hljs-operator">&gt;</span> <br><span class="hljs-keyword">all</span> ( <span class="hljs-keyword">select</span> salary <span class="hljs-keyword">from</span> emp <span class="hljs-keyword">where</span> dept_id <span class="hljs-operator">=</span> (<span class="hljs-keyword">select</span> id <span class="hljs-keyword">from</span> dept <span class="hljs-keyword">where</span> name <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;财务部&#x27;</span>) );<br></code></pre></td></tr></table></figure>
<details class="toggle" style="border: 1px solid  #edf4ee"><summary class="toggle-button" style="background-color:  #edf4ee;color:  #17181a">查看输出 </summary><div class="toggle-content"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">Empty set (0.01 sec)<br></code></pre></td></tr></table></figure></div></details>
<p><strong>C.</strong> 查询比研发部其中任意一人工资高的员工信息<br>
分解为以下两步:</p>
<p>①. 查询研发部所有人工资</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> salary <span class="hljs-keyword">from</span> emp <span class="hljs-keyword">where</span> dept_id <span class="hljs-operator">=</span> (<span class="hljs-keyword">select</span> id <span class="hljs-keyword">from</span> dept <span class="hljs-keyword">where</span> name <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;研发部&#x27;</span>);<br></code></pre></td></tr></table></figure>
<p>②. 比研发部其中任意一人工资高的员工信息</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> emp <span class="hljs-keyword">where</span> salary <span class="hljs-operator">&gt;</span> <br><span class="hljs-keyword">any</span> ( <span class="hljs-keyword">select</span> salary <span class="hljs-keyword">from</span> emp <span class="hljs-keyword">where</span> dept_id <span class="hljs-operator">=</span> (<span class="hljs-keyword">select</span> id <span class="hljs-keyword">from</span> dept <span class="hljs-keyword">where</span> name <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;研发部&#x27;</span>) );<br></code></pre></td></tr></table></figure>
<details class="toggle" style="border: 1px solid  #edf4ee"><summary class="toggle-button" style="background-color:  #edf4ee;color:  #17181a">查看输出 </summary><div class="toggle-content"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">+----+-----------+------+-----------------+--------+------------+-----------+---------+<br>| id | name      | age  | job             | salary | entrydate  | managerid | dept_id |<br>+----+-----------+------+-----------------+--------+------------+-----------+---------+<br>|  1 | 金庸      |   66 | 总裁            |  20000 | 2000-01-01 |      NULL |       5 |<br>|  2 | 张无忌    |   20 | 项目经理        |  12500 | 2005-12-05 |         1 |       1 |<br>|  3 | 杨逍      |   33 | 开发            |   8400 | 2000-11-03 |         2 |       1 |<br>|  4 | 韦一笑    |   48 | 开发            |  11000 | 2002-02-05 |         2 |       1 |<br>|  5 | 常遇春    |   43 | 开发            |  10500 | 2004-09-07 |         3 |       1 |<br>|  7 | 灭绝      |   60 | 财务总监        |   8500 | 2002-09-12 |         1 |       3 |<br>|  8 | 周芷若    |   19 | 会计            |  48000 | 2006-06-02 |         7 |       3 |<br>| 10 | 赵敏      |   20 | 市场部总监      |  12500 | 2004-10-12 |         1 |       2 |<br>| 14 | 张三丰    |   88 | 销售总监        |  14000 | 2004-10-12 |         1 |       4 |<br>+----+-----------+------+-----------------+--------+------------+-----------+---------+<br>9 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure></div></details>
<hr>
<br>
<ul>
<li><strong><u>行子查询</u></strong></li>
</ul>
<p>子查询返回的结果是一行（可以是多列），这种子查询称为行子查询。</p>
<p>常用的操作符：= 、&lt;&gt; 、IN 、NOT IN</p>
<br>
<p>案例:<br>
<strong>A.</strong> 查询与 “张无忌” 的薪资及直属领导相同的员工信息 ;<br>
这个需求同样可以拆解为两步进行:</p>
<p>①. 查询 “张无忌” 的薪资及直属领导</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> salary, managerid <span class="hljs-keyword">from</span> emp <span class="hljs-keyword">where</span> name <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;张无忌&#x27;</span>;<br></code></pre></td></tr></table></figure>
<p>②. 查询与 “张无忌” 的薪资及直属领导相同的员工信息 ;</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> emp <br><span class="hljs-keyword">where</span> (salary,managerid) <span class="hljs-operator">=</span> (<span class="hljs-keyword">select</span> salary, managerid <span class="hljs-keyword">from</span> emp <span class="hljs-keyword">where</span> name <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;张无忌&#x27;</span>);<br></code></pre></td></tr></table></figure>
<details class="toggle" style="border: 1px solid  #edf4ee"><summary class="toggle-button" style="background-color:  #edf4ee;color:  #17181a">查看输出 </summary><div class="toggle-content"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">+----+-----------+------+-----------------+--------+------------+-----------+---------+<br>| id | name      | age  | job             | salary | entrydate  | managerid | dept_id |<br>+----+-----------+------+-----------------+--------+------------+-----------+---------+<br>|  2 | 张无忌    |   20 | 项目经理        |  12500 | 2005-12-05 |         1 |       1 |<br>| 10 | 赵敏      |   20 | 市场部总监      |  12500 | 2004-10-12 |         1 |       2 |<br>+----+-----------+------+-----------------+--------+------------+-----------+---------+<br>2 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure></div></details>
<hr>
<br>
<ul>
<li><strong><u>表子查询</u></strong></li>
</ul>
<p>子查询返回的结果是多行多列，这种子查询称为表子查询。</p>
<p>常用的操作符：IN</p>
<p>案例:<br>
<strong>A.</strong> 查询与 “鹿杖客” , “宋远桥” 的职位和薪资相同的员工信息<br>
分解为两步执行:</p>
<p>①. 查询 “鹿杖客” , “宋远桥” 的职位和薪资</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> job, salary <span class="hljs-keyword">from</span> emp <span class="hljs-keyword">where</span> name <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;鹿杖客&#x27;</span> <span class="hljs-keyword">or</span> name <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;宋远桥&#x27;</span>;<br></code></pre></td></tr></table></figure>
<p>②. 查询与 “鹿杖客” , “宋远桥” 的职位和薪资相同的员工信息</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> emp <span class="hljs-keyword">where</span> (job,salary) <br><span class="hljs-keyword">in</span> ( <span class="hljs-keyword">select</span> job, salary <span class="hljs-keyword">from</span> emp <span class="hljs-keyword">where</span> name <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;鹿杖客&#x27;</span> <span class="hljs-keyword">or</span> name <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;宋远桥&#x27;</span> );<br></code></pre></td></tr></table></figure>
<details class="toggle" style="border: 1px solid  #edf4ee"><summary class="toggle-button" style="background-color:  #edf4ee;color:  #17181a">查看输出 </summary><div class="toggle-content"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">+----+-----------+------+--------+--------+------------+-----------+---------+<br>| id | name      | age  | job    | salary | entrydate  | managerid | dept_id |<br>+----+-----------+------+--------+--------+------------+-----------+---------+<br>| 11 | 鹿杖客    |   56 | 职员   |   3750 | 2006-10-03 |        10 |       2 |<br>| 12 | 鹤笔翁    |   19 | 职员   |   3750 | 2007-05-09 |        10 |       2 |<br>| 15 | 俞莲舟    |   38 | 销售   |   4600 | 2004-10-12 |        14 |       4 |<br>| 16 | 宋远桥    |   40 | 销售   |   4600 | 2004-10-12 |        14 |       4 |<br>+----+-----------+------+--------+--------+------------+-----------+---------+<br>4 rows in set (0.01 sec)<br></code></pre></td></tr></table></figure></div></details>
<p><strong>B.</strong> 查询入职日期是 “2006-01-01” 之后的员工信息 , 及其部门信息<br>
分解为两步执行:</p>
<p>①. 入职日期是 “2006-01-01” 之后的员工信息</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> emp <span class="hljs-keyword">where</span> entrydate <span class="hljs-operator">&gt;</span> <span class="hljs-string">&#x27;2006-01-01&#x27;</span>;<br></code></pre></td></tr></table></figure>
<p>②. 查询这部分员工, 对应的部门信息;</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span><span class="hljs-operator">*</span>E.<span class="hljs-operator">*</span><span class="hljs-operator">*</span> <span class="hljs-operator">*</span>, d.<span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> (<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> emp <span class="hljs-keyword">where</span> entrydate <span class="hljs-operator">&gt;</span> <span class="hljs-string">&#x27;2006-01-01&#x27;</span>) e <br><span class="hljs-keyword">left</span> <span class="hljs-keyword">join</span> dept d <span class="hljs-keyword">on</span> e.dept_id <span class="hljs-operator">=</span> d.id ;<br></code></pre></td></tr></table></figure>
<details class="toggle" style="border: 1px solid  #edf4ee"><summary class="toggle-button" style="background-color:  #edf4ee;color:  #17181a">查看输出 </summary><div class="toggle-content"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">+----+-----------+------+--------+--------+------------+-----------+---------+------+-----------+<br>| id | name      | age  | job    | salary | entrydate  | managerid | dept_id | id   | name      |<br>+----+-----------+------+--------+--------+------------+-----------+---------+------+-----------+<br>|  8 | 周芷若    |   19 | 会计   |  48000 | 2006-06-02 |         7 |       3 |    3 | 财务部    |<br>|  9 | 丁敏君    |   23 | 出纳   |   5250 | 2009-05-13 |         7 |       3 |    3 | 财务部    |<br>| 11 | 鹿杖客    |   56 | 职员   |   3750 | 2006-10-03 |        10 |       2 |    2 | 市场部    |<br>| 12 | 鹤笔翁    |   19 | 职员   |   3750 | 2007-05-09 |        10 |       2 |    2 | 市场部    |<br>| 13 | 方东白    |   19 | 职员   |   5500 | 2009-02-12 |        10 |       2 |    2 | 市场部    |<br>| 17 | 陈友谅    |   42 | NULL   |   2000 | 2011-10-12 |         1 |    NULL | NULL | NULL      |<br>+----+-----------+------+--------+--------+------------+-----------+---------+------+-----------+<br>6 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure></div></details>
<hr>
<p><br><br><br></p>
<h4 id="5-7-多表查询案例">5.7 多表查询案例</h4>
<details class="toggle" style="border: 1px solid  #edf4ee"><summary class="toggle-button" style="background-color:  #edf4ee;color:  #17181a">数据环境准备 </summary><div class="toggle-content"><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> salgrade(<br>    grade <span class="hljs-type">int</span>,<br>    losal <span class="hljs-type">int</span>,<br>    hisal <span class="hljs-type">int</span><br>) comment <span class="hljs-string">&#x27;薪资等级表&#x27;</span>;<br><br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> salgrade <span class="hljs-keyword">values</span> (<span class="hljs-number">1</span>,<span class="hljs-number">0</span>,<span class="hljs-number">3000</span>);<br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> salgrade <span class="hljs-keyword">values</span> (<span class="hljs-number">2</span>,<span class="hljs-number">3001</span>,<span class="hljs-number">5000</span>);<br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> salgrade <span class="hljs-keyword">values</span> (<span class="hljs-number">3</span>,<span class="hljs-number">5001</span>,<span class="hljs-number">8000</span>);<br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> salgrade <span class="hljs-keyword">values</span> (<span class="hljs-number">4</span>,<span class="hljs-number">8001</span>,<span class="hljs-number">10000</span>);<br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> salgrade <span class="hljs-keyword">values</span> (<span class="hljs-number">5</span>,<span class="hljs-number">10001</span>,<span class="hljs-number">15000</span>);<br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> salgrade <span class="hljs-keyword">values</span> (<span class="hljs-number">6</span>,<span class="hljs-number">15001</span>,<span class="hljs-number">20000</span>);<br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> salgrade <span class="hljs-keyword">values</span> (<span class="hljs-number">7</span>,<span class="hljs-number">20001</span>,<span class="hljs-number">25000</span>);<br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> salgrade <span class="hljs-keyword">values</span> (<span class="hljs-number">8</span>,<span class="hljs-number">25001</span>,<span class="hljs-number">30000</span>);<br></code></pre></td></tr></table></figure>
<p>数据表回顾：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">mysql&gt; select * from emp;<br>+----+-----------+------+--------------------+--------+------------+-----------+---------+<br>| id | name      | age  | job                | salary | entrydate  | managerid | dept_id |<br>+----+-----------+------+--------------------+--------+------------+-----------+---------+<br>|  1 | 金庸      |   66 | 总裁               |  20000 | 2000-01-01 |      NULL |       5 |<br>|  2 | 张无忌    |   20 | 项目经理           |  12500 | 2005-12-05 |         1 |       1 |<br>|  3 | 杨逍      |   33 | 开发               |   8400 | 2000-11-03 |         2 |       1 |<br>|  4 | 韦一笑    |   48 | 开发               |  11000 | 2002-02-05 |         2 |       1 |<br>|  5 | 常遇春    |   43 | 开发               |  10500 | 2004-09-07 |         3 |       1 |<br>|  6 | 小昭      |   19 | 程序员鼓励师       |   6600 | 2004-10-12 |         2 |       1 |<br>|  7 | 灭绝      |   60 | 财务总监           |   8500 | 2002-09-12 |         1 |       3 |<br>|  8 | 周芷若    |   19 | 会计               |  48000 | 2006-06-02 |         7 |       3 |<br>|  9 | 丁敏君    |   23 | 出纳               |   5250 | 2009-05-13 |         7 |       3 |<br>| 10 | 赵敏      |   20 | 市场部总监         |  12500 | 2004-10-12 |         1 |       2 |<br>| 11 | 鹿杖客    |   56 | 职员               |   3750 | 2006-10-03 |        10 |       2 |<br>| 12 | 鹤笔翁    |   19 | 职员               |   3750 | 2007-05-09 |        10 |       2 |<br>| 13 | 方东白    |   19 | 职员               |   5500 | 2009-02-12 |        10 |       2 |<br>| 14 | 张三丰    |   88 | 销售总监           |  14000 | 2004-10-12 |         1 |       4 |<br>| 15 | 俞莲舟    |   38 | 销售               |   4600 | 2004-10-12 |        14 |       4 |<br>| 16 | 宋远桥    |   40 | 销售               |   4600 | 2004-10-12 |        14 |       4 |<br>| 17 | 陈友谅    |   42 | NULL               |   2000 | 2011-10-12 |         1 |    NULL |<br>+----+-----------+------+--------------------+--------+------------+-----------+---------+<br>17 rows in set (0.00 sec)<br><br>mysql&gt; select * from dept;<br>+----+-----------+<br>| id | name      |<br>+----+-----------+<br>|  1 | 研发部    |<br>|  2 | 市场部    |<br>|  3 | 财务部    |<br>|  4 | 销售部    |<br>|  5 | 总经办    |<br>|  6 | 人事部    |<br>+----+-----------+<br>6 rows in set (0.00 sec)<br><br>mysql&gt; select * from salgrade;<br>+-------+-------+-------+<br>| grade | losal | hisal |<br>+-------+-------+-------+<br>|     1 |     0 |  3000 |<br>|     2 |  3001 |  5000 |<br>|     3 |  5001 |  8000 |<br>|     4 |  8001 | 10000 |<br>|     5 | 10001 | 15000 |<br>|     6 | 15001 | 20000 |<br>|     7 | 20001 | 25000 |<br>|     8 | 25001 | 30000 |<br>+-------+-------+-------+<br>8 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure>
</div></details>
<p>在这个案例中，我们主要运用上面所讲解的多表查询的语法，完成以下的12个需求即可，而这里主要涉及到的表就三张：emp员工表、dept部门表、salgrade薪资等级表 。</p>
<br>
<p><strong>1).</strong> 查询员工的姓名、年龄、职位、部门信息 （隐式内连接）<br>
表: emp , dept<br>
连接条件: <code>emp.dept_id = dept.id</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> e.name , e.age , e.job , d.name <span class="hljs-keyword">from</span> emp e , dept d <span class="hljs-keyword">where</span> e.dept_id <span class="hljs-operator">=</span> d.id;<br></code></pre></td></tr></table></figure>
<details class="toggle" style="border: 1px solid  #edf4ee"><summary class="toggle-button" style="background-color:  #edf4ee;color:  #17181a">查看输出 </summary><div class="toggle-content"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">+-----------+------+--------------------+-----------+<br>| name      | age  | job                | name      |<br>+-----------+------+--------------------+-----------+<br>| 张无忌    |   20 | 项目经理           | 研发部    |<br>| 杨逍      |   33 | 开发               | 研发部    |<br>| 韦一笑    |   48 | 开发               | 研发部    |<br>| 常遇春    |   43 | 开发               | 研发部    |<br>| 小昭      |   19 | 程序员鼓励师       | 研发部    |<br>| 赵敏      |   20 | 市场部总监         | 市场部    |<br>| 鹿杖客    |   56 | 职员               | 市场部    |<br>| 鹤笔翁    |   19 | 职员               | 市场部    |<br>| 方东白    |   19 | 职员               | 市场部    |<br>| 灭绝      |   60 | 财务总监           | 财务部    |<br>| 周芷若    |   19 | 会计               | 财务部    |<br>| 丁敏君    |   23 | 出纳               | 财务部    |<br>| 张三丰    |   88 | 销售总监           | 销售部    |<br>| 俞莲舟    |   38 | 销售               | 销售部    |<br>| 宋远桥    |   40 | 销售               | 销售部    |<br>| 金庸      |   66 | 总裁               | 总经办    |<br>+-----------+------+--------------------+-----------+<br>16 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure></div></details>
<br>
<p><strong>2).</strong> 查询年龄小于30岁的员工的姓名、年龄、职位、部门信息（显式内连接）<br>
表: emp , dept<br>
连接条件: <code>emp.dept_id = dept.id</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> e.name , e.age , e.job , d.name <br><span class="hljs-keyword">from</span> emp e <span class="hljs-keyword">inner</span> <span class="hljs-keyword">join</span> dept d <span class="hljs-keyword">on</span> e.dept_id <span class="hljs-operator">=</span>d.id <br><span class="hljs-keyword">where</span> e.age <span class="hljs-operator">&lt;</span> <span class="hljs-number">30</span>;<br></code></pre></td></tr></table></figure>
<details class="toggle" style="border: 1px solid  #edf4ee"><summary class="toggle-button" style="background-color:  #edf4ee;color:  #17181a">查看输出 </summary><div class="toggle-content"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">+-----------+------+--------------------+-----------+<br>| name      | age  | job                | name      |<br>+-----------+------+--------------------+-----------+<br>| 张无忌    |   20 | 项目经理           | 研发部    |<br>| 小昭      |   19 | 程序员鼓励师       | 研发部    |<br>| 周芷若    |   19 | 会计               | 财务部    |<br>| 丁敏君    |   23 | 出纳               | 财务部    |<br>| 赵敏      |   20 | 市场部总监         | 市场部    |<br>| 鹤笔翁    |   19 | 职员               | 市场部    |<br>| 方东白    |   19 | 职员               | 市场部    |<br>+-----------+------+--------------------+-----------+<br>7 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure></div></details>
<br>
<p><strong>3).</strong> 查询拥有员工的部门ID、部门名称<br>
表: emp , dept<br>
连接条件: <code>emp.dept_id = dept.id</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-keyword">distinct</span> d.id , d.name <span class="hljs-keyword">from</span> emp e , dept d <span class="hljs-keyword">where</span> e.dept_id <span class="hljs-operator">=</span> d.id;<br></code></pre></td></tr></table></figure>
<details class="toggle" style="border: 1px solid  #edf4ee"><summary class="toggle-button" style="background-color:  #edf4ee;color:  #17181a">查看输出 </summary><div class="toggle-content"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">+----+-----------+<br>| id | name      |<br>+----+-----------+<br>|  1 | 研发部    |<br>|  2 | 市场部    |<br>|  3 | 财务部    |<br>|  4 | 销售部    |<br>|  5 | 总经办    |<br>+----+-----------+<br>5 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure></div></details>
<br>
<p><strong>4).</strong> 查询所有年龄大于40岁的员工, 及其归属的部门名称; 如果员工没有分配部门, 也需要展示出来(外连接)<br>
表: emp , dept<br>
连接条件: <code>emp.dept_id = dept.id</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span><span class="hljs-operator">*</span>E.<span class="hljs-operator">*</span><span class="hljs-operator">*</span> <span class="hljs-operator">*</span>, d.name <span class="hljs-keyword">from</span> emp e <span class="hljs-keyword">left</span> <span class="hljs-keyword">join</span> dept d <span class="hljs-keyword">on</span> e.dept_id <span class="hljs-operator">=</span> d.id <br><span class="hljs-keyword">where</span> e.age <span class="hljs-operator">&gt;</span> <span class="hljs-number">40</span> ;<br></code></pre></td></tr></table></figure>
<details class="toggle" style="border: 1px solid  #edf4ee"><summary class="toggle-button" style="background-color:  #edf4ee;color:  #17181a">查看输出 </summary><div class="toggle-content"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">+----+-----------+------+--------------+--------+------------+-----------+---------+-----------+<br>| id | name      | age  | job          | salary | entrydate  | managerid | dept_id | name      |<br>+----+-----------+------+--------------+--------+------------+-----------+---------+-----------+<br>|  1 | 金庸      |   66 | 总裁         |  20000 | 2000-01-01 |      NULL |       5 | 总经办    |<br>|  4 | 韦一笑    |   48 | 开发         |  11000 | 2002-02-05 |         2 |       1 | 研发部    |<br>|  5 | 常遇春    |   43 | 开发         |  10500 | 2004-09-07 |         3 |       1 | 研发部    |<br>|  7 | 灭绝      |   60 | 财务总监     |   8500 | 2002-09-12 |         1 |       3 | 财务部    |<br>| 11 | 鹿杖客    |   56 | 职员         |   3750 | 2006-10-03 |        10 |       2 | 市场部    |<br>| 14 | 张三丰    |   88 | 销售总监     |  14000 | 2004-10-12 |         1 |       4 | 销售部    |<br>| 17 | 陈友谅    |   42 | NULL         |   2000 | 2011-10-12 |         1 |    NULL | NULL      |<br>+----+-----------+------+--------------+--------+------------+-----------+---------+-----------+<br>7 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure></div></details>
<br>
<p><strong>5).</strong> 查询所有员工的工资等级<br>
表: emp , salgrade<br>
连接条件 : <code>emp.salary &gt;= salgrade.losal and emp.salary &lt;= salgrade.hisal</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 方式一</span><br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span><span class="hljs-operator">*</span>E.<span class="hljs-operator">*</span><span class="hljs-operator">*</span> <span class="hljs-operator">*</span> , s.grade , s.losal, s.hisal <span class="hljs-keyword">from</span> emp e , salgrade s <br><span class="hljs-keyword">where</span> e.salary <span class="hljs-operator">&gt;=</span> s.losal <span class="hljs-keyword">and</span> e.salary <span class="hljs-operator">&lt;=</span> s.hisal;<br><span class="hljs-comment">-- 方式二</span><br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span><span class="hljs-operator">*</span>E.<span class="hljs-operator">*</span><span class="hljs-operator">*</span> <span class="hljs-operator">*</span> , s.grade , s.losal, s.hisal <span class="hljs-keyword">from</span> emp e , salgrade s <br><span class="hljs-keyword">where</span> e.salary <span class="hljs-keyword">between</span> s.losal <span class="hljs-keyword">and</span> s.hisal;<br></code></pre></td></tr></table></figure>
<details class="toggle" style="border: 1px solid  #edf4ee"><summary class="toggle-button" style="background-color:  #edf4ee;color:  #17181a">查看输出 </summary><div class="toggle-content"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">+----+-----------+------+--------------------+--------+------------+-----------+---------+-------+-------+-------+<br>| id | name      | age  | job                | salary | entrydate  | managerid | dept_id | grade | losal | hisal |<br>+----+-----------+------+--------------------+--------+------------+-----------+---------+-------+-------+-------+<br>|  1 | 金庸      |   66 | 总裁               |  20000 | 2000-01-01 |      NULL |       5 |     6 | 15001 | 20000 |<br>|  2 | 张无忌    |   20 | 项目经理           |  12500 | 2005-12-05 |         1 |       1 |     5 | 10001 | 15000 |<br>|  3 | 杨逍      |   33 | 开发               |   8400 | 2000-11-03 |         2 |       1 |     4 |  8001 | 10000 |<br>|  4 | 韦一笑    |   48 | 开发               |  11000 | 2002-02-05 |         2 |       1 |     5 | 10001 | 15000 |<br>|  5 | 常遇春    |   43 | 开发               |  10500 | 2004-09-07 |         3 |       1 |     5 | 10001 | 15000 |<br>|  6 | 小昭      |   19 | 程序员鼓励师       |   6600 | 2004-10-12 |         2 |       1 |     3 |  5001 |  8000 |<br>|  7 | 灭绝      |   60 | 财务总监           |   8500 | 2002-09-12 |         1 |       3 |     4 |  8001 | 10000 |<br>|  9 | 丁敏君    |   23 | 出纳               |   5250 | 2009-05-13 |         7 |       3 |     3 |  5001 |  8000 |<br>| 10 | 赵敏      |   20 | 市场部总监         |  12500 | 2004-10-12 |         1 |       2 |     5 | 10001 | 15000 |<br>| 11 | 鹿杖客    |   56 | 职员               |   3750 | 2006-10-03 |        10 |       2 |     2 |  3001 |  5000 |<br>| 12 | 鹤笔翁    |   19 | 职员               |   3750 | 2007-05-09 |        10 |       2 |     2 |  3001 |  5000 |<br>| 13 | 方东白    |   19 | 职员               |   5500 | 2009-02-12 |        10 |       2 |     3 |  5001 |  8000 |<br>| 14 | 张三丰    |   88 | 销售总监           |  14000 | 2004-10-12 |         1 |       4 |     5 | 10001 | 15000 |<br>| 15 | 俞莲舟    |   38 | 销售               |   4600 | 2004-10-12 |        14 |       4 |     2 |  3001 |  5000 |<br>| 16 | 宋远桥    |   40 | 销售               |   4600 | 2004-10-12 |        14 |       4 |     2 |  3001 |  5000 |<br>| 17 | 陈友谅    |   42 | NULL               |   2000 | 2011-10-12 |         1 |    NULL |     1 |     0 |  3000 |<br>+----+-----------+------+--------------------+--------+------------+-----------+---------+-------+-------+-------+<br>16 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure></div></details>
<br>
<p><strong>6).</strong> 查询 “研发部” 所有员工的信息 及 工资等级<br>
表: emp , salgrade , dept<br>
连接条件 : <code>emp.salary between salgrade.losal and salgrade.hisal , emp.dept_id = dept.id</code><br>
查询条件 : <code>dept.name = '研发部'</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span><span class="hljs-operator">*</span>E.<span class="hljs-operator">*</span><span class="hljs-operator">*</span> <span class="hljs-operator">*</span> , s.grade <span class="hljs-keyword">from</span> emp e , dept d , salgrade s <br><span class="hljs-keyword">where</span> e.dept_id <span class="hljs-operator">=</span> d.id <br>      <span class="hljs-keyword">and</span> (e.salary <span class="hljs-keyword">between</span> s.losal <span class="hljs-keyword">and</span> s.hisal ) <br>      <span class="hljs-keyword">and</span> d.name <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;研发部&#x27;</span>;<br></code></pre></td></tr></table></figure>
<details class="toggle" style="border: 1px solid  #edf4ee"><summary class="toggle-button" style="background-color:  #edf4ee;color:  #17181a">查看输出 </summary><div class="toggle-content"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">+----+-----------+------+--------------------+--------+------------+-----------+---------+-------+<br>| id | name      | age  | job                | salary | entrydate  | managerid | dept_id | grade |<br>+----+-----------+------+--------------------+--------+------------+-----------+---------+-------+<br>|  6 | 小昭      |   19 | 程序员鼓励师       |   6600 | 2004-10-12 |         2 |       1 |     3 |<br>|  3 | 杨逍      |   33 | 开发               |   8400 | 2000-11-03 |         2 |       1 |     4 |<br>|  5 | 常遇春    |   43 | 开发               |  10500 | 2004-09-07 |         3 |       1 |     5 |<br>|  4 | 韦一笑    |   48 | 开发               |  11000 | 2002-02-05 |         2 |       1 |     5 |<br>|  2 | 张无忌    |   20 | 项目经理           |  12500 | 2005-12-05 |         1 |       1 |     5 |<br>+----+-----------+------+--------------------+--------+------------+-----------+---------+-------+<br>5 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure></div></details>
<br>
<p><strong>7).</strong> 查询 “研发部” 员工的平均工资<br>
表: emp , dept<br>
连接条件 : <code>emp.dept_id = dept.id</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-built_in">avg</span>(e.salary) <span class="hljs-keyword">from</span> emp e, dept d <br><span class="hljs-keyword">where</span> e.dept_id <span class="hljs-operator">=</span> d.id <span class="hljs-keyword">and</span> d.name <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;研发部&#x27;</span>;<br></code></pre></td></tr></table></figure>
<details class="toggle" style="border: 1px solid  #edf4ee"><summary class="toggle-button" style="background-color:  #edf4ee;color:  #17181a">查看输出 </summary><div class="toggle-content"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">+---------------+<br>| avg(e.salary) |<br>+---------------+<br>|     9800.0000 |<br>+---------------+<br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure>
</div></details>
<br>
<p><strong>8).</strong> 查询工资比 “灭绝” 高的员工信息。</p>
<p>①. 查询 “灭绝” 的薪资</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> salary <span class="hljs-keyword">from</span> emp <span class="hljs-keyword">where</span> name <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;灭绝&#x27;</span>;<br></code></pre></td></tr></table></figure>
<p>②. 查询比她工资高的员工数据</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> emp <span class="hljs-keyword">where</span> salary <span class="hljs-operator">&gt;</span> ( <span class="hljs-keyword">select</span> salary <span class="hljs-keyword">from</span> emp <span class="hljs-keyword">where</span> name <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;灭绝&#x27;</span> );<br></code></pre></td></tr></table></figure>
<details class="toggle" style="border: 1px solid  #edf4ee"><summary class="toggle-button" style="background-color:  #edf4ee;color:  #17181a">查看输出 </summary><div class="toggle-content"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">+----+-----------+------+-----------------+--------+------------+-----------+---------+<br>| id | name      | age  | job             | salary | entrydate  | managerid | dept_id |<br>+----+-----------+------+-----------------+--------+------------+-----------+---------+<br>|  1 | 金庸      |   66 | 总裁            |  20000 | 2000-01-01 |      NULL |       5 |<br>|  2 | 张无忌    |   20 | 项目经理        |  12500 | 2005-12-05 |         1 |       1 |<br>|  4 | 韦一笑    |   48 | 开发            |  11000 | 2002-02-05 |         2 |       1 |<br>|  5 | 常遇春    |   43 | 开发            |  10500 | 2004-09-07 |         3 |       1 |<br>|  8 | 周芷若    |   19 | 会计            |  48000 | 2006-06-02 |         7 |       3 |<br>| 10 | 赵敏      |   20 | 市场部总监      |  12500 | 2004-10-12 |         1 |       2 |<br>| 14 | 张三丰    |   88 | 销售总监        |  14000 | 2004-10-12 |         1 |       4 |<br>+----+-----------+------+-----------------+--------+------------+-----------+---------+<br>7 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure>
</div></details>
<br>
<p><strong>9).</strong> 查询比平均薪资高的员工信息</p>
<p>①. 查询员工的平均薪资</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-built_in">avg</span>(salary) <span class="hljs-keyword">from</span> emp;<br></code></pre></td></tr></table></figure>
<p>②. 查询比平均薪资高的员工信息</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> emp <span class="hljs-keyword">where</span> salary <span class="hljs-operator">&gt;</span> ( <span class="hljs-keyword">select</span> <span class="hljs-built_in">avg</span>(salary) <span class="hljs-keyword">from</span> emp );<br></code></pre></td></tr></table></figure>
<details class="toggle" style="border: 1px solid  #edf4ee"><summary class="toggle-button" style="background-color:  #edf4ee;color:  #17181a">查看输出 </summary><div class="toggle-content"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">+----+-----------+------+-----------------+--------+------------+-----------+---------+<br>| id | name      | age  | job             | salary | entrydate  | managerid | dept_id |<br>+----+-----------+------+-----------------+--------+------------+-----------+---------+<br>|  1 | 金庸      |   66 | 总裁            |  20000 | 2000-01-01 |      NULL |       5 |<br>|  2 | 张无忌    |   20 | 项目经理        |  12500 | 2005-12-05 |         1 |       1 |<br>|  4 | 韦一笑    |   48 | 开发            |  11000 | 2002-02-05 |         2 |       1 |<br>|  8 | 周芷若    |   19 | 会计            |  48000 | 2006-06-02 |         7 |       3 |<br>| 10 | 赵敏      |   20 | 市场部总监      |  12500 | 2004-10-12 |         1 |       2 |<br>| 14 | 张三丰    |   88 | 销售总监        |  14000 | 2004-10-12 |         1 |       4 |<br>+----+-----------+------+-----------------+--------+------------+-----------+---------+<br>6 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure>
</div></details>
<br>
<p><strong>10).</strong> 查询低于本部门平均工资的员工信息</p>
<p>①. 查询指定部门平均薪资</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-built_in">avg</span>(e1.salary) <span class="hljs-keyword">from</span> emp e1 <span class="hljs-keyword">where</span> e1.dept_id <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;<br><br><span class="hljs-keyword">select</span> <span class="hljs-built_in">avg</span>(e1.salary) <span class="hljs-keyword">from</span> emp e1 <span class="hljs-keyword">where</span> e1.dept_id <span class="hljs-operator">=</span> <span class="hljs-number">2</span>;<br></code></pre></td></tr></table></figure>
<p>②. 查询低于本部门平均工资的员工信息</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> emp e2 <span class="hljs-keyword">where</span> e2.salary <span class="hljs-operator">&lt;</span> <br>( <span class="hljs-keyword">select</span> <span class="hljs-built_in">avg</span>(e1.salary) <span class="hljs-keyword">from</span> emp e1 <span class="hljs-keyword">where</span> e1.dept_id <span class="hljs-operator">=</span> e2.dept_id );<br></code></pre></td></tr></table></figure>
<details class="toggle" style="border: 1px solid  #edf4ee"><summary class="toggle-button" style="background-color:  #edf4ee;color:  #17181a">查看输出 </summary><div class="toggle-content"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">+----+-----------+------+--------------------+--------+------------+-----------+---------+<br>| id | name      | age  | job                | salary | entrydate  | managerid | dept_id |<br>+----+-----------+------+--------------------+--------+------------+-----------+---------+<br>|  3 | 杨逍      |   33 | 开发               |   8400 | 2000-11-03 |         2 |       1 |<br>|  6 | 小昭      |   19 | 程序员鼓励师       |   6600 | 2004-10-12 |         2 |       1 |<br>|  7 | 灭绝      |   60 | 财务总监           |   8500 | 2002-09-12 |         1 |       3 |<br>|  9 | 丁敏君    |   23 | 出纳               |   5250 | 2009-05-13 |         7 |       3 |<br>| 11 | 鹿杖客    |   56 | 职员               |   3750 | 2006-10-03 |        10 |       2 |<br>| 12 | 鹤笔翁    |   19 | 职员               |   3750 | 2007-05-09 |        10 |       2 |<br>| 13 | 方东白    |   19 | 职员               |   5500 | 2009-02-12 |        10 |       2 |<br>| 15 | 俞莲舟    |   38 | 销售               |   4600 | 2004-10-12 |        14 |       4 |<br>| 16 | 宋远桥    |   40 | 销售               |   4600 | 2004-10-12 |        14 |       4 |<br>+----+-----------+------+--------------------+--------+------------+-----------+---------+<br>9 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure>
</div></details>
<br>
<p><strong>11).</strong> 查询所有的部门信息, 并统计部门的员工人数</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> d.id, d.name , ( <span class="hljs-keyword">select</span> <span class="hljs-built_in">count</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">from</span> emp e <span class="hljs-keyword">where</span> e.dept_id <span class="hljs-operator">=</span> d.id ) <span class="hljs-string">&#x27;人数&#x27;</span><br><span class="hljs-keyword">from</span> dept d;<br></code></pre></td></tr></table></figure>
<details class="toggle" style="border: 1px solid  #edf4ee"><summary class="toggle-button" style="background-color:  #edf4ee;color:  #17181a">查看输出 </summary><div class="toggle-content"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">+------+-----------+--------+<br>| id   | name      | 人数   |<br>+------+-----------+--------+<br>|    1 | 研发部    |      5 |<br>|    2 | 市场部    |      4 |<br>|    3 | 财务部    |      3 |<br>|    4 | 销售部    |      3 |<br>|    5 | 总经办    |      1 |<br>|    6 | 人事部    |      0 |<br>+------+-----------+--------+<br>6 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure>
</div></details>
<br>
<p><strong>12).</strong> 查询所有学生的选课情况, 展示出学生名称, 学号, 课程名称<br>
表: student , course , student_course<br>
连接条件: <code>student.id = student_course.studentid , course.id = student_course.courseid</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> s.name , s.no , c.name <span class="hljs-keyword">from</span> student s , student_course sc , course c <br><span class="hljs-keyword">where</span> s.id <span class="hljs-operator">=</span> sc.studentid <span class="hljs-keyword">and</span> sc.courseid <span class="hljs-operator">=</span> c.id ;<br></code></pre></td></tr></table></figure>
<details class="toggle" style="border: 1px solid  #edf4ee"><summary class="toggle-button" style="background-color:  #edf4ee;color:  #17181a">查看输出 </summary><div class="toggle-content"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">+-----------+------------+--------+<br>| name      | no         | name   |<br>+-----------+------------+--------+<br>| 黛绮丝    | 2000100101 | Java   |<br>| 黛绮丝    | 2000100101 | PHP    |<br>| 黛绮丝    | 2000100101 | MySQL  |<br>| 谢逊      | 2000100102 | PHP    |<br>| 谢逊      | 2000100102 | MySQL  |<br>| 殷天正    | 2000100103 | Hadoop |<br>+-----------+------------+--------+<br>6 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure>
</div></details>
<blockquote>
<p>备注: 以上需求的实现方式可能会很多, SQL写法也有很多，只要能满足我们的需求，查询出符合条件的记录即可。</p>
</blockquote>
<hr>
<p><br><br><br></p>
<h3 id="6-事务">6. 事务</h3>
<h4 id="6-1-事务简介">6.1 事务简介</h4>
<p>事务 是一组操作的集合，它是一个不可分割的工作单位，事务会把所有的操作作为一个整体一起向系统提交或撤销操作请求，即这些操作要么同时成功，要么同时失败。</p>
<br>
<p>就比如:</p>
<p>张三给李四转账1000块钱，张三银行账户的钱减少1000，而李四银行账户的钱要增加1000。 这一组操作就必须在一个事务的范围内，要么都成功，要么都失败。</p>
<p>正常情况: 转账这个操作, 需要分为以下这么三步来完成 , 三步完成之后, 张三减少1000, 而李四增加1000, 转账成功。</p>
<p>异常情况: 转账这个操作, 也是分为以下这么三步来完成 , 在执行第三步是报错了, 这样就导致张三减少1000块钱, 而李四的金额没变, 这样就造成了数据的不一致, 就出现问题了。</p>
<br>
<p>为了解决上述的问题，就需要通过数据的事务来完成，我们只需要在业务逻辑执行之前开启事务，执行完毕后提交事务。如果执行过程中报错，则回滚事务，把数据恢复到事务开始之前的状态。</p>
<blockquote>
<p>注意： 默认MySQL的事务是自动提交的，也就是说，当执行完一条DML语句时，MySQL会立即隐式的提交事务。</p>
</blockquote>
<hr>
<p><br><br><br></p>
<h4 id="6-2-事务操作">6.2 事务操作</h4>
<details class="toggle" style="border: 1px solid  #edf4ee"><summary class="toggle-button" style="background-color:  #edf4ee;color:  #17181a">数据准备 </summary><div class="toggle-content"><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">drop</span> <span class="hljs-keyword">table</span> if <span class="hljs-keyword">exists</span> account;<br><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> account(<br>    id <span class="hljs-type">int</span> <span class="hljs-keyword">primary</span> key AUTO_INCREMENT comment <span class="hljs-string">&#x27;ID&#x27;</span>,<br>    name <span class="hljs-type">varchar</span>(<span class="hljs-number">10</span>) comment <span class="hljs-string">&#x27;姓名&#x27;</span>,<br>    money <span class="hljs-keyword">double</span>(<span class="hljs-number">10</span>,<span class="hljs-number">2</span>) comment <span class="hljs-string">&#x27;余额&#x27;</span><br>) comment <span class="hljs-string">&#x27;账户表&#x27;</span>;<br><br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> account(name, money) <span class="hljs-keyword">VALUES</span> <br>(<span class="hljs-string">&#x27;张三&#x27;</span>,<span class="hljs-number">2000</span>), <br>(<span class="hljs-string">&#x27;李四&#x27;</span>,<span class="hljs-number">2000</span>);<br></code></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">+----+--------+---------+<br>| id | name   | money   |<br>+----+--------+---------+<br>|  1 | 张三   | 2000.00 |<br>|  2 | 李四   | 2000.00 |<br>+----+--------+---------+<br>2 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure>
</div></details>
<ul>
<li><strong><u>未控制事务</u></strong></li>
</ul>
<p><strong>1).</strong> 测试正常情况</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 1. 查询张三余额</span><br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> account <span class="hljs-keyword">where</span> name <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;张三&#x27;</span>;<br><span class="hljs-comment">-- 2. 张三的余额减少1000</span><br><span class="hljs-keyword">update</span> account <span class="hljs-keyword">set</span> money <span class="hljs-operator">=</span> money <span class="hljs-operator">-</span> <span class="hljs-number">1000</span> <span class="hljs-keyword">where</span> name <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;张三&#x27;</span>;<br><span class="hljs-comment">-- 3. 李四的余额增加1000</span><br><span class="hljs-keyword">update</span> account <span class="hljs-keyword">set</span> money <span class="hljs-operator">=</span> money <span class="hljs-operator">+</span> <span class="hljs-number">1000</span> <span class="hljs-keyword">where</span> name <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;李四&#x27;</span>;<br></code></pre></td></tr></table></figure>
<details class="toggle" style="border: 1px solid  #edf4ee"><summary class="toggle-button" style="background-color:  #edf4ee;color:  #17181a">查看表格 </summary><div class="toggle-content"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">+----+--------+---------+<br>| id | name   | money   |<br>+----+--------+---------+<br>|  1 | 张三   | 1000.00 |<br>|  2 | 李四   | 3000.00 |<br>+----+--------+---------+<br>2 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure></div></details>
<p>测试完毕之后检查数据的状态, 可以看到数据操作前后是一致的。</p>
<br>
<p><strong>2).</strong> 测试异常情况</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 1. 查询张三余额</span><br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> account <span class="hljs-keyword">where</span> name <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;张三&#x27;</span>;<br><span class="hljs-comment">-- 2. 张三的余额减少1000</span><br><span class="hljs-keyword">update</span> account <span class="hljs-keyword">set</span> money <span class="hljs-operator">=</span> money <span class="hljs-operator">-</span> <span class="hljs-number">1000</span> <span class="hljs-keyword">where</span> name <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;张三&#x27;</span>;<br>出错了....<br><span class="hljs-comment">-- 3. 李四的余额增加1000</span><br><span class="hljs-keyword">update</span> account <span class="hljs-keyword">set</span> money <span class="hljs-operator">=</span> money <span class="hljs-operator">+</span> <span class="hljs-number">1000</span> <span class="hljs-keyword">where</span> name <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;李四&#x27;</span>;<br></code></pre></td></tr></table></figure>
<details class="toggle" style="border: 1px solid  #edf4ee"><summary class="toggle-button" style="background-color:  #edf4ee;color:  #17181a">查看表格 </summary><div class="toggle-content"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">+----+--------+---------+<br>| id | name   | money   |<br>+----+--------+---------+<br>|  1 | 张三   | 1000.00 |<br>|  2 | 李四   | 2000.00 |<br>+----+--------+---------+<br>2 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure>
</div></details>
<p>一次性执行上述的SQL语句(出错了… 这句话不符合SQL语法,执行就会报错)，检查最终的数据情况, 发现数据在操作前后不一致了。</p>
<hr>
<br>
<ul>
<li><strong><u>控制事务一</u></strong></li>
</ul>
<p><strong>1).</strong> 查看 / 设置事务提交方式</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> @<span class="hljs-variable">@autocommit</span> ;<br><span class="hljs-keyword">SET</span> @<span class="hljs-variable">@autocommit</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span> ;<br></code></pre></td></tr></table></figure>
<p><strong>2).</strong> 提交事务</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">COMMIT</span>;<br></code></pre></td></tr></table></figure>
<p><strong>3).</strong> 回滚事务</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">ROLLBACK</span>;<br></code></pre></td></tr></table></figure>
<blockquote>
<p>注意：上述的这种方式，我们是修改了事务的自动提交行为, 把默认的自动提交修改为了手动提<br>
交, 此时我们执行的DML语句都不会提交, 需要手动的执行commit进行提交。</p>
</blockquote>
<hr>
<br>
<ul>
<li><strong><u>控制事务二</u></strong></li>
</ul>
<p><strong>1).</strong> 开启事务</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">START</span> TRANSACTION 或 <span class="hljs-keyword">BEGIN</span> ;<br></code></pre></td></tr></table></figure>
<p><strong>2).</strong> 提交事务</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">COMMIT</span>;<br></code></pre></td></tr></table></figure>
<p><strong>3).</strong> 回滚事务</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">ROLLBACK</span>;<br></code></pre></td></tr></table></figure>
<br>
<p>转账案例：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 开启事务</span><br><span class="hljs-keyword">start</span> transaction;<br><span class="hljs-comment">-- 1. 查询张三余额</span><br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> account <span class="hljs-keyword">where</span> name <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;张三&#x27;</span>;<br><span class="hljs-comment">-- 2. 张三的余额减少1000</span><br><span class="hljs-keyword">update</span> account <span class="hljs-keyword">set</span> money <span class="hljs-operator">=</span> money <span class="hljs-operator">-</span> <span class="hljs-number">1000</span> <span class="hljs-keyword">where</span> name <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;张三&#x27;</span>;<br><span class="hljs-comment">-- 3. 李四的余额增加1000</span><br><span class="hljs-keyword">update</span> account <span class="hljs-keyword">set</span> money <span class="hljs-operator">=</span> money <span class="hljs-operator">+</span> <span class="hljs-number">1000</span> <span class="hljs-keyword">where</span> name <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;李四&#x27;</span>;<br><span class="hljs-comment">-- 如果正常执行完毕, 则提交事务</span><br><span class="hljs-keyword">commit</span>;<br><span class="hljs-comment">-- 如果执行过程中报错, 则回滚事务</span><br><span class="hljs-comment">-- rollback;</span><br></code></pre></td></tr></table></figure>
<details class="toggle" style="border: 1px solid  #edf4ee"><summary class="toggle-button" style="background-color:  #edf4ee;color:  #17181a">查看输出 </summary><div class="toggle-content"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">+----+--------+---------+<br>| id | name   | money   |<br>+----+--------+---------+<br>|  1 | 张三   | 1000.00 |<br>|  2 | 李四   | 3000.00 |<br>+----+--------+---------+<br>2 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure></div></details>
<hr>
<p><br><br><br></p>
<h4 id="6-3-事务四大特性">6.3 事务四大特性</h4>
<ul>
<li>原子性（<strong>A</strong>tomicity）：事务是不可分割的最小操作单元，要么全部成功，要么全部失败。</li>
<li>一致性（<strong>C</strong>onsistency）：事务完成时，必须使所有的数据都保持一致状态。</li>
<li>隔离性（<strong>I</strong>solation）：数据库系统提供的隔离机制，保证事务在不受外部并发操作影响的独立环境下运行。</li>
<li>持久性（<strong>D</strong>urability）：事务一旦提交或回滚，它对数据库中的数据的改变就是永久的。</li>
</ul>
<p>上述就是事务的四大特性，简称ACID。</p>
<hr>
<p><br><br><br></p>
<h4 id="6-4-并发事务问题">6.4 并发事务问题</h4>
<p>隔离性主要用来处理并发事务中的三个问题：脏读（Dirty Reads）、不可重复读（Nonrepeatable Reads）、幻读（Phantom Reads）。</p>
<p><strong>1).</strong> <strong>赃读</strong>：一个事务读到另外一个事务还没有提交的数据</p>
<p>比如B读取到了A未提交的数据。</p>
<p><img src="/static/imgs/loading.gif" data-original="https://cdn.jsdelivr.net/gh/ggw2021/images@main/blogs/Snipaste_2024-04-10_20-12-21.png" alt=""></p>
<p>脏读发生在一个事务读取了另一个事务未提交的数据。如果那个事务回滚，读取的数据将是无效的。</p>
<br>
<p><strong>2).</strong> <strong>不可重复读</strong>：一个事务先后读取同一条记录，但两次读取的数据不同，称之为不可重复读。</p>
<p>事务A两次读取同一条记录，但是读取到的数据却是不一样的。</p>
<p><img src="/static/imgs/loading.gif" data-original="https://cdn.jsdelivr.net/gh/ggw2021/images@main/blogs/Snipaste_2024-04-10_20-14-11.png" alt=""></p>
<p>不可重复读发生在一个事务读取了某些数据，然后另一个事务修改或删除了这些数据。当第一个事务再次读取相同的数据时，得到的结果不同。</p>
<br>
<p><strong>3).</strong> <strong>幻读</strong>：一个事务按照条件查询数据时，没有对应的数据行，但是在插入数据时，又发现这行数据<br>
已经存在，好像出现了 “幻影”。</p>
<p><img src="/static/imgs/loading.gif" data-original="https://cdn.jsdelivr.net/gh/ggw2021/images@main/blogs/Snipaste_2024-04-10_20-17-27.png" alt=""></p>
<p>幻读类似于不可重复读，但它是指当一个事务重新执行一个查询时，返回一组符合查询条件的行，但这组行中包含了因为其他事务插入的新行。</p>
<hr>
<p><br><br><br></p>
<h4 id="6-5-事务隔离级别">6.5 事务隔离级别</h4>
<p>为了处理这些问题，SQL标准定义了四个隔离级别，每个级别都以牺牲一定的并发性能为代价，提供了不同程度的隔离保护：</p>
<ol>
<li><strong>读未提交 (Read Uncommitted)</strong>：最低的隔离级别，允许读取未提交的数据变更，可能会导致脏读、不可重复读和幻读。</li>
<li><strong>读已提交 (Read Committed)</strong>：保证读取的数据是已经被提交的。这可以避免脏读，但不可重复读和幻读仍然可能发生。</li>
<li><strong>可重复读 (Repeatable Read)</strong>：保证在同一个事务内的查询可以多次执行而返回相同的结果，即在事务开始后无法看到其他事务对数据所做的修改。这可以防止脏读和不可重复读，但幻读可能发生。</li>
<li><strong>串行化 (Serializable)</strong>：最高的隔离级别，通过强制事务串行执行，防止脏读、不可重复读和幻读。</li>
</ol>
<table>
<thead>
<tr>
<th style="text-align:left">隔离级别</th>
<th style="text-align:left">脏读</th>
<th style="text-align:left">不可重复读</th>
<th style="text-align:left">幻读</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">Read uncommitted</td>
<td style="text-align:left">√</td>
<td style="text-align:left">√</td>
<td style="text-align:left">√</td>
</tr>
<tr>
<td style="text-align:left">Read committed</td>
<td style="text-align:left">×</td>
<td style="text-align:left">√</td>
<td style="text-align:left">√</td>
</tr>
<tr>
<td style="text-align:left">Repeatable Read(默认)</td>
<td style="text-align:left">×</td>
<td style="text-align:left">×</td>
<td style="text-align:left">√</td>
</tr>
<tr>
<td style="text-align:left">Serializable</td>
<td style="text-align:left">×</td>
<td style="text-align:left">×</td>
<td style="text-align:left">×</td>
</tr>
</tbody>
</table>
<br>
<p><strong>1).</strong> 查看事务隔离级别</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> @<span class="hljs-variable">@TRANSACTION</span>_ISOLATION;<br></code></pre></td></tr></table></figure>
<p><strong>2).</strong> 设置事务隔离级别</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SET</span> <br>[ SESSION <span class="hljs-operator">|</span> <span class="hljs-keyword">GLOBAL</span> ] <br>TRANSACTION ISOLATION LEVEL <br>&#123; READ UNCOMMITTED <span class="hljs-operator">|</span> READ COMMITTED <span class="hljs-operator">|</span> REPEATABLE READ <span class="hljs-operator">|</span> SERIALIZABLE &#125;;<br></code></pre></td></tr></table></figure>
<blockquote>
<p>注意：事务隔离级别越高，数据越安全，但是性能越低。</p>
</blockquote>
<hr>
<p><br><br><br></p>
<h2 id="进阶篇">进阶篇</h2>
<h3 id="1-存储引擎">1. 存储引擎</h3>
<h4 id="1-1-MySQL体系结构">1.1 MySQL体系结构</h4>
<p><img src="/static/imgs/loading.gif" data-original="https://cdn.jsdelivr.net/gh/ggw2021/images@main/blogs/Snipaste_2024-04-12_11-01-19.png" alt=""></p>
<p><strong>1).</strong> 连接层<br>
最上层是一些客户端和链接服务，包含本地sock 通信和大多数基于客户端/服务端工具实现的类似于TCP/IP的通信。主要完成一些类似于连接处理、授权认证、及相关的安全方案。在该层上引入了线程池的概念，为通过认证安全接入的客户端提供线程。同样在该层上可以实现基于SSL的安全链接。服务器也会为安全接入的每个客户端验证它所具有的操作权限。</p>
<p><strong>2).</strong> 服务层<br>
第二层架构主要完成大多数的核心服务功能，如SQL接口，并完成缓存的查询，SQL的分析和优化，部分内置函数的执行。所有跨存储引擎的功能也在这一层实现，如 过程、函数等。在该层，服务器会解析查询并创建相应的内部解析树，并对其完成相应的优化如确定表的查询的顺序，是否利用索引等，最后生成相应的执行操作。如果是select语句，服务器还会查询内部的缓存，如果缓存空间足够大，这样在解决大量读操作的环境中能够很好的提升系统的性能。</p>
<p><strong>3).</strong> 引擎层<br>
存储引擎层， 存储引擎真正的负责了MySQL中数据的存储和提取，服务器通过API和存储引擎进行通信。不同的存储引擎具有不同的功能，这样我们可以根据自己的需要，来选取合适的存储引擎。数据库中的索引是在存储引擎层实现的。</p>
<p><strong>4).</strong> 存储层<br>
数据存储层， 主要是将数据(如: redolog、undolog、数据、索引、二进制日志、错误日志、查询日志、慢查询日志等)存储在文件系统之上，并完成与存储引擎的交互。和其他数据库相比，MySQL有点与众不同，它的架构可以在多种不同场景中应用并发挥良好作用。主要体现在存储引擎上，插件式的存储引擎架构，将查询处理和其他的系统任务以及数据的存储提取分离。这种架构可以根据业务的需求和实际需要选择合适的存储引擎。</p>
<hr>
<p><br><br><br></p>
<h4 id="1-2-存储引擎介绍">1.2 存储引擎介绍</h4>
<p>大家可能没有听说过存储引擎，但是一定听过引擎这个词，引擎就是发动机，是一个机器的核心组件。比如，对于舰载机、直升机、火箭来说，他们都有各自的引擎，是他们最为核心的组件。而我们在选择引擎的时候，需要在合适的场景，选择合适的存储引擎，就像在直升机上，我们不能选择舰载机的引擎一样。</p>
<p>而对于存储引擎，也是一样，他是mysql数据库的核心，我们也需要在合适的场景选择合适的存储引擎。接下来就来介绍一下存储引擎。</p>
<p>存储引擎就是存储数据、建立索引、更新/查询数据等技术的实现方式 。存储引擎是基于表的，而不是基于库的，所以存储引擎也可被称为表类型。<u>我们可以在创建表的时候，来指定选择的存储引擎，如果没有指定将自动选择默认的存储引擎</u>。</p>
<br>
<p><strong><strong>1).</strong></strong> 建表时指定存储引擎</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> 表名(<br>    字段<span class="hljs-number">1</span> 字段<span class="hljs-number">1</span>类型 [ COMMENT 字段<span class="hljs-number">1</span>注释 ] ,<br>    ......<br>    字段n 字段n类型 [COMMENT 字段n注释 ]<br>) ENGINE <span class="hljs-operator">=</span> INNODB [ COMMENT 表注释 ] <br></code></pre></td></tr></table></figure>
<p><strong><strong>2).</strong></strong> 查询当前数据库支持的存储引擎</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">show</span> engines;<br></code></pre></td></tr></table></figure>
<br>
<p>示例演示:<br>
<strong>A</strong>. 查询建表语句 — 默认存储引擎: InnoDB</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">show</span> <span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> account;<br></code></pre></td></tr></table></figure>
<details class="toggle" style="border: 1px solid  #edf4ee"><summary class="toggle-button" style="background-color:  #edf4ee;color:  #17181a">查看输出 </summary><div class="toggle-content"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">mysql&gt; show create table account;<br>+---------+--------------------------------------------------------------------------<br>-------------------------------------------------------------------------------------<br>--------------------------------------------------+<br>| Table   | Create Table<br><br>                                                  |<br>+---------+--------------------------------------------------------------------------<br>-------------------------------------------------------------------------------------<br>--------------------------------------------------+<br>| account | CREATE TABLE `account` (<br>  `id` int NOT NULL AUTO_INCREMENT COMMENT &#x27;ID&#x27;,<br>  `name` varchar(10) DEFAULT NULL COMMENT &#x27;姓名&#x27;,<br>  `money` double(10,2) DEFAULT NULL COMMENT &#x27;余额&#x27;,<br>  PRIMARY KEY (`id`)<br>) ENGINE=InnoDB AUTO_INCREMENT=3 DEFAULT CHARSET=utf8mb3 COMMENT=&#x27;账户表&#x27;        |<br>+---------+--------------------------------------------------------------------------<br>-------------------------------------------------------------------------------------<br>--------------------------------------------------+<br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure></div></details>
<p>我们可以看到，创建表时，即使我们没有指定存储引擎，数据库也会自动选择默认的存储引擎。</p>
<p><strong>B</strong>. 查询当前数据库支持的存储引擎</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">show</span> engines ;<br></code></pre></td></tr></table></figure>
<details class="toggle" style="border: 1px solid  #edf4ee"><summary class="toggle-button" style="background-color:  #edf4ee;color:  #17181a">查看输出 </summary><div class="toggle-content"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">mysql&gt; show engines;<br>+--------------------+---------+----------------------------------------------------------------+--------------+------+------------+<br>| Engine             | Support | Comment                                                        | Transactions | XA   | Savepoints |<br>+--------------------+---------+----------------------------------------------------------------+--------------+------+------------+<br>| MEMORY             | YES     | Hash based, stored in memory, useful for temporary tables      | NO           | NO   | NO         |<br>| MRG_MYISAM         | YES     | Collection of identical MyISAM tables                          | NO           | NO   | NO         |<br>| CSV                | YES     | CSV storage engine                                             | NO           | NO   | NO         |<br>| FEDERATED          | NO      | Federated MySQL storage engine                                 | NULL         | NULL | NULL       |<br>| PERFORMANCE_SCHEMA | YES     | Performance Schema                                             | NO           | NO   | NO         |<br>| MyISAM             | YES     | MyISAM storage engine                                          | NO           | NO   | NO         |<br>| InnoDB             | DEFAULT | Supports transactions, row-level locking, and foreign keys     | YES          | YES  | YES        |<br>| BLACKHOLE          | YES     | /dev/null storage engine (anything you write to it disappears) | NO           | NO   | NO         |<br>| ARCHIVE            | YES     | Archive storage engine                                         | NO           | NO   | NO         |<br>+--------------------+---------+----------------------------------------------------------------+--------------+------+------------+<br>9 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure></div></details>
<p><strong>C</strong>. 创建表 my_myisam , 并指定MyISAM存储引擎</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> my_myisam(<br>    id <span class="hljs-type">int</span>,<br>    name <span class="hljs-type">varchar</span>(<span class="hljs-number">10</span>)<br>) engine <span class="hljs-operator">=</span> MyISAM ;<br></code></pre></td></tr></table></figure>
<details class="toggle" style="border: 1px solid  #edf4ee"><summary class="toggle-button" style="background-color:  #edf4ee;color:  #17181a">查看输出 </summary><div class="toggle-content"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">mysql&gt; show create table my_myisam;<br>+-----------+-------------------------------------------------------------------------------------------------------------------------------+<br>| Table     | Create Table                                                                                                                  |<br>+-----------+-------------------------------------------------------------------------------------------------------------------------------+<br>| my_myisam | CREATE TABLE `my_myisam` (<br>  `id` int DEFAULT NULL,<br>  `name` varchar(10) DEFAULT NULL<br>) ENGINE=MyISAM DEFAULT CHARSET=utf8mb3 |<br>+-----------+-------------------------------------------------------------------------------------------------------------------------------+<br>1 row in set (0.00 sec)<br><br></code></pre></td></tr></table></figure></div></details>
<hr>
<p><br><br><br></p>
<h4 id="1-3-存储引擎特点">1.3 存储引擎特点</h4>
<p>上面我们介绍了什么是存储引擎，以及如何在建表时如何指定存储引擎，接下来我们就来介绍下来上面重点提到的三种存储引擎 InnoDB、MyISAM、Memory的特点。</p>
<br>
<ul>
<li><strong><u>InnoDB</u></strong></li>
</ul>
<p><strong><strong>1).</strong></strong> 介绍<br>
InnoDB是一种兼顾高可靠性和高性能的通用存储引擎，在 MySQL 5.5 之后，InnoDB是默认的MySQL 存储引擎。</p>
<br>
<p><strong>2).</strong> 特点</p>
<ol>
<li>DML操作遵循ACID模型，支持事务；</li>
<li>行级锁，提高并发访问性能；</li>
<li>支持外键FOREIGN KEY约束，保证数据的完整性和正确性；</li>
</ol>
<br>
<p><strong>3).</strong> 文件</p>
<p><code>xxx.ibd</code>：xxx代表的是表名，innoDB引擎的每张表都会对应这样一个表空间文件，存储该表的表结构（frm-早期的 、sdi-新版的）、数据和索引。</p>
<p>参数：innodb_file_per_table</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">show</span> variables <span class="hljs-keyword">like</span> <span class="hljs-string">&#x27;innodb_file_per_table&#x27;</span>;<br></code></pre></td></tr></table></figure>
<p><img src="/static/imgs/loading.gif" data-original="https://cdn.jsdelivr.net/gh/ggw2021/images@main/blogs/Snipaste_2024-04-12_11-26-16.png" alt=""></p>
<p>如果该参数开启，代表对于InnoDB引擎的表，每一张表都对应一个ibd文件。 我们直接打开MySQL的数据存放目录： <code>C:\ProgramData\MySQL\MySQL Server 8.0\Data</code> ， 这个目录下有很多文件夹，不同的文件夹代表不同的数据库，我们直接打开itcast文件夹。  【我没在文件夹下找到，可能是因为我版本太低了】</p>
<p><img src="/static/imgs/loading.gif" data-original="https://cdn.jsdelivr.net/gh/ggw2021/images@main/blogs/Snipaste_2024-04-12_11-25-39.png" alt=""></p>
<p>可以看到里面有很多的ibd文件，每一个ibd文件就对应一张表，比如：我们有一张表 account，就有这样的一个account.ibd文件，而在这个ibd文件中不仅存放表结构、数据，还会存放该表对应的索引信息。 而该文件是基于二进制存储的，不能直接基于记事本打开，我们可以使用mysql提供的一个指令 <code>ibd2sdi</code> ，通过该指令就可以从ibd文件中提取sdi信息，而sdi数据字典信息中就包含该表的表结构。</p>
<p><img src="/static/imgs/loading.gif" data-original="https://cdn.jsdelivr.net/gh/ggw2021/images@main/blogs/Snipaste_2024-04-12_11-35-51.png" alt=""></p>
<br>
<p><strong>4).</strong> 逻辑存储结构</p>
<p><img src="/static/imgs/loading.gif" data-original="https://cdn.jsdelivr.net/gh/ggw2021/images@main/blogs/Snipaste_2024-04-12_11-43-26.png" alt=""></p>
<ul>
<li>表空间 : InnoDB存储引擎逻辑结构的最高层，ibd文件其实就是表空间文件，在表空间中可以包含多Segment段。</li>
<li>段 : 表空间是由各个段组成的， 常见的段有数据段、索引段、回滚段等。InnoDB中对于段的管理，都是引擎自身完成，不需要人为对其控制，一个段中包含多个区。</li>
<li>区 : 区是表空间的单元结构，每个区的大小为1M。 默认情况下， InnoDB存储引擎页大小为16K， 即一个区中一共有64个连续的页。</li>
<li>页 : 页是组成区的最小单元，页也是InnoDB 存储引擎磁盘管理的最小单元，每个页的大小默认为 16KB。为了保证页的连续性，InnoDB 存储引擎每次从磁盘申请 4-5 个区。</li>
<li>行 : InnoDB 存储引擎是面向行的，也就是说数据是按行进行存放的，在每一行中除了定义表时所指定的字段以外，还包含两个隐藏字段(后面会详细介绍)。</li>
</ul>
<hr>
<br>
<ul>
<li><strong><u>MyISAM</u></strong></li>
</ul>
<p><strong>1).</strong> 介绍<br>
MyISAM是MySQL早期的默认存储引擎。</p>
<br>
<p><strong>2).</strong> 特点<br>
不支持事务，不支持外键<br>
支持表锁，不支持行锁<br>
访问速度快</p>
<br>
<p><strong>3).</strong> 文件<br>
<code>xxx.sdi</code>：存储表结构信息<br>
<code>xxx.MYD</code>: 存储数据<br>
<code>xxx.MYI</code>: 存储索引</p>
<hr>
<br>
<ul>
<li><strong><u>Memory</u></strong></li>
</ul>
<p><strong>1).</strong> 介绍<br>
Memory引擎的表数据时存储在内存中的，由于受到硬件问题、或断电问题的影响，只能将这些表作为临时表或缓存使用。</p>
<br>
<p><strong>2).</strong> 特点<br>
内存存放<br>
hash索引（默认）</p>
<br>
<p><strong>3).</strong> 文件<br>
<code>xxx.sdi</code>：存储表结构信息</p>
<hr>
<br>
<ul>
<li><strong><u>区别及特点</u></strong></li>
</ul>
<table>
<thead>
<tr>
<th style="text-align:left">特点</th>
<th style="text-align:left">InnoDB</th>
<th style="text-align:left">MyISAM</th>
<th style="text-align:left">Memory</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">存储限制</td>
<td style="text-align:left">64TB</td>
<td style="text-align:left">有</td>
<td style="text-align:left">有</td>
</tr>
<tr>
<td style="text-align:left">事务安全</td>
<td style="text-align:left">支持</td>
<td style="text-align:left">-</td>
<td style="text-align:left">-</td>
</tr>
<tr>
<td style="text-align:left">锁机制</td>
<td style="text-align:left">行锁</td>
<td style="text-align:left">表锁</td>
<td style="text-align:left">表锁</td>
</tr>
<tr>
<td style="text-align:left">B+tree索引</td>
<td style="text-align:left">支持</td>
<td style="text-align:left">支持</td>
<td style="text-align:left">支持</td>
</tr>
<tr>
<td style="text-align:left">Hash索引</td>
<td style="text-align:left">-</td>
<td style="text-align:left">-</td>
<td style="text-align:left">支持</td>
</tr>
<tr>
<td style="text-align:left">全文索引</td>
<td style="text-align:left">支持(5.6版本之后)</td>
<td style="text-align:left">支持</td>
<td style="text-align:left">-</td>
</tr>
<tr>
<td style="text-align:left">空间使用</td>
<td style="text-align:left">高</td>
<td style="text-align:left">低</td>
<td style="text-align:left">N/A</td>
</tr>
<tr>
<td style="text-align:left">内存使用</td>
<td style="text-align:left">高</td>
<td style="text-align:left">低</td>
<td style="text-align:left">中等</td>
</tr>
<tr>
<td style="text-align:left">批量插入速度</td>
<td style="text-align:left">低</td>
<td style="text-align:left">高</td>
<td style="text-align:left">高</td>
</tr>
<tr>
<td style="text-align:left">支持外键</td>
<td style="text-align:left">支持</td>
<td style="text-align:left">-</td>
<td style="text-align:left">-</td>
</tr>
</tbody>
</table>
<blockquote>
<p><strong>面试题:</strong><br>
<strong>InnoDB引擎与MyISAM引擎的区别 ?</strong><br>
①. InnoDB引擎, 支持事务, 而MyISAM不支持。<br>
②. InnoDB引擎, 支持行锁和表锁, 而MyISAM仅支持表锁, 不支持行锁。<br>
③. InnoDB引擎, 支持外键, 而MyISAM是不支持的。</p>
<p>主要是上述三点区别，当然也可以从索引结构、存储限制等方面，更加深入的回答，具体参考如下官方文档</p>
<p><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/innodb-introduction.html">https://dev.mysql.com/doc/refman/8.0/en/innodb-introduction.html</a><br>
<a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/myisam-storage-engine.html">https://dev.mysql.com/doc/refman/8.0/en/myisam-storage-engine.html</a></p>
</blockquote>
<hr>
<p><br><br><br></p>
<h4 id="1-4-存储引擎选择">1.4 存储引擎选择</h4>
<p>在选择存储引擎时，应该根据应用系统的特点选择合适的存储引擎。对于复杂的应用系统，还可以根据实际情况选择多种存储引擎进行组合。</p>
<ul>
<li><code>InnoDB</code>: 是Mysql的默认存储引擎，支持事务、外键。如果应用对事务的完整性有比较高的要求，在并发条件下要求数据的一致性，数据操作除了插入和查询之外，还包含很多的更新、删除操作，那么InnoDB存储引擎是比较合适的选择。</li>
<li><code>MyISAM</code> ： 如果应用是以读操作和插入操作为主，只有很少的更新和删除操作，并且对事务的完整性、并发性要求不是很高，那么选择这个存储引擎是非常合适的。</li>
<li><code>MEMORY</code>：将所有数据保存在内存中，访问速度快，通常用于临时表及缓存。MEMORY的缺陷就是对表的大小有限制，太大的表无法缓存在内存中，而且无法保障数据的安全性。</li>
</ul>
<hr>
<p><br><br><br></p>
<h3 id="2-索引">2. 索引</h3>
<h4 id="2-1-索引概述">2.1 索引概述</h4>
<ul>
<li><strong><u>介绍</u></strong></li>
</ul>
<p><strong>索引（index）</strong> 是帮助MySQL高效获取数据的数据结构(有序)。在数据之外，数据库系统还维护着满足特定查找算法的数据结构，这些数据结构以某种方式引用（指向）数据， 这样就可以在这些数据结构上实现高级查找算法，这种数据结构就是索引。</p>
<hr>
<br>
<ul>
<li><strong><u>演示</u></strong></li>
</ul>
<p>表结构及其数据如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">+----+-----------+------+<br>| id | name      | age  |<br>+----+-----------+------+<br>|  1 | 金庸       |   66 |<br>|  2 | 张无忌     |   20 |<br>|  3 | 杨逍       |   33 |<br>|  4 | 韦一笑     |   48 |<br>|  5 | 常遇春     |   43 |<br>|  6 | 小昭       |   19 |<br>|  7 | 灭绝       |   60 |<br>|  8 | 周芷若     |   19 |<br>|  9 | 丁敏君     |   23 |<br>| 10 | 赵敏       |   20 |<br>+----+-----------+------+<br></code></pre></td></tr></table></figure>
<p>假如我们要执行的SQL语句为 ： <code>select * from user where age = 45</code>;</p>
<br>
<p><strong>1).</strong> 无索引情况</p>
<p><img src="/static/imgs/loading.gif" data-original="https://cdn.jsdelivr.net/gh/ggw2021/images@main/blogs/Snipaste_2024-04-12_12-09-25.png" alt=""></p>
<p><img src="/static/imgs/loading.gif" data-original="https://cdn.jsdelivr.net/gh/ggw2021/images@main/blogs/GIF%202024-04-12%2012-05-54.gif" alt=""></p>
<p>在无索引情况下，就需要从第一行开始扫描，一直扫描到最后一行，我们称之为 全表扫描，性能很低。</p>
<br>
<p><strong>2).</strong> 有索引情况</p>
<p>如果我们针对于这张表建立了索引，假设索引结构就是二叉树，那么也就意味着，会对age这个字段建<br>
立一个二叉树的索引结构。</p>
<p><img src="/static/imgs/loading.gif" data-original="https://cdn.jsdelivr.net/gh/ggw2021/images@main/blogs/Snipaste_2024-04-12_12-11-11.png" alt=""></p>
<p>此时我们在进行查询时，只需要扫描三次就可以找到数据了，极大的提高的查询的效率。</p>
<blockquote>
<p>备注： 这里我们只是假设索引的结构是二叉树，介绍一下索引的大概原理，只是一个示意图，并不是索引的真实结构，索引的真实结构，后面会详细介绍。</p>
</blockquote>
<hr>
<br>
<ul>
<li><strong><u>特点</u></strong></li>
</ul>
<table>
<thead>
<tr>
<th style="text-align:left">优势</th>
<th style="text-align:left">劣势</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">提高数据检索的效率，降低数据库 的IO成本</td>
<td style="text-align:left">索引列也是要占用空间的。</td>
</tr>
<tr>
<td style="text-align:left">通过索引列对数据进行排序，降低数据排序的成本，降低CPU的消耗。</td>
<td style="text-align:left">索引大大提高了查询效率，同时却也降低更新表的速度， 如对表进行INSERT、UPDATE、DELETE时，效率降低。</td>
</tr>
</tbody>
</table>
<hr>
<p><br><br><br></p>
<h4 id="2-2-索引结构">2.2 索引结构</h4>
<ul>
<li><u><strong>概述</strong></u></li>
</ul>
<p>MySQL的索引是在存储引擎层实现的，不同的存储引擎有不同的索引结构，主要包含以下几种：</p>
<table>
<thead>
<tr>
<th style="text-align:left">索引结构</th>
<th style="text-align:left">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">B+Tree索引</td>
<td style="text-align:left">最常见的索引类型，大部分引擎都支持 B+ 树索引</td>
</tr>
<tr>
<td style="text-align:left">Hash索引</td>
<td style="text-align:left">底层数据结构是用哈希表实现的, 只有精确匹配索引列的查询才有效, 不支持范围查询</td>
</tr>
<tr>
<td style="text-align:left">R-tree(空间索 引）</td>
<td style="text-align:left">空间索引是MyISAM引擎的一个特殊索引类型，主要用于地理空间数据类型，通常使用较少</td>
</tr>
<tr>
<td style="text-align:left">Full-text(全文 索引)</td>
<td style="text-align:left">是一种通过建立倒排索引, 快速匹配文档的方式。类似于 Lucene,Solr,ES</td>
</tr>
</tbody>
</table>
<p>上述是MySQL中所支持的所有的索引结构，接下来，我们再来看看不同的存储引擎对于索引结构的支持情况。</p>
<table>
<thead>
<tr>
<th>索引</th>
<th>InnoDB</th>
<th>MyISAM</th>
<th>Memory</th>
</tr>
</thead>
<tbody>
<tr>
<td>B+tree索引</td>
<td>支持</td>
<td>支持</td>
<td>支持</td>
</tr>
<tr>
<td>Hash 索引</td>
<td>不支持</td>
<td>不支持</td>
<td>支持</td>
</tr>
<tr>
<td>R-tree 索引</td>
<td>不支持</td>
<td>支持</td>
<td>不支持</td>
</tr>
<tr>
<td>Full-text</td>
<td>5.6版本之后支持</td>
<td>支持</td>
<td>不支持</td>
</tr>
</tbody>
</table>
<blockquote>
<p>注意： 我们平常所说的索引，如果没有特别指明，都是指B+树结构组织的索引。</p>
</blockquote>
<hr>
<br>
<ul>
<li><strong><u>二叉树</u></strong></li>
</ul>
<p>假如说MySQL的索引结构采用二叉树的数据结构，比较理想的结构如下：</p>
<p><img src="/static/imgs/loading.gif" data-original="https://cdn.jsdelivr.net/gh/ggw2021/images@main/blogs/Snipaste_2024-04-12_12-55-38.png" alt=""></p>
<p>如果主键是顺序插入的，则会形成一个单向链表，结构如下：</p>
<p><img src="/static/imgs/loading.gif" data-original="https://cdn.jsdelivr.net/gh/ggw2021/images@main/blogs/Snipaste_2024-04-12_12-55-59.png" alt=""></p>
<p>所以，如果选择二叉树作为索引结构，会存在以下缺点：</p>
<ul>
<li>顺序插入时，会形成一个链表，查询性能大大降低。</li>
<li>大数据量情况下，层级较深，检索速度慢。</li>
</ul>
<br>
<p>此时大家可能会想到，我们可以选择红黑树，红黑树是一颗自平衡二叉树，那这样即使是顺序插入数据，最终形成的数据结构也是一颗平衡的二叉树,结构如下:</p>
<p><img src="/static/imgs/loading.gif" data-original="https://cdn.jsdelivr.net/gh/ggw2021/images@main/blogs/Snipaste_2024-04-12_12-56-55.png" alt=""></p>
<p>但是，即使如此，由于红黑树也是一颗二叉树，所以也会存在一个缺点：大数据量情况下，层级较深，检索速度慢。</p>
<br>
<p>所以，在MySQL的索引结构中，并没有选择二叉树或者红黑树，而选择的是B+Tree，那么什么是B+Tree呢？在详解B+Tree之前，先来介绍一个B tree。</p>
<hr>
<br>
<ul>
<li><strong><u>B Tree</u></strong></li>
</ul>
<p>B Tree，B树是一种多叉路衡查找树，相对于二叉树，B树每个节点可以有多个分支，即多叉。以一颗最大度数（max-degree）为5(5阶)的B tree为例，那这个B树每个节点最多存储4个key，5个指针：</p>
<p><img src="/static/imgs/loading.gif" data-original="https://cdn.jsdelivr.net/gh/ggw2021/images@main/blogs/Snipaste_2024-04-12_13-09-39.png" alt=""></p>
<blockquote>
<p>知识小贴士: 树的度数指的是一个节点的子节点个数</p>
</blockquote>
<p>我们可以通过一个数据结构可视化的网站来简单演示一下。 <a target="_blank" rel="noopener" href="https://www.cs.usfca.edu/~galles/visualization/BTree.html">https://www.cs.usfca.edu/~galles/visualization/BTree.html</a></p>
<p>插入一组数据： <code>100 65 169 368 900 556 780 35 215 1200 234 888 158 90 1000 88 120 268 250 </code>。然后观察一些数据插入过程中，节点的变化情况。</p>
<p><img src="/static/imgs/loading.gif" data-original="https://cdn.jsdelivr.net/gh/ggw2021/images@main/blogs/Snipaste_2024-04-12_13-11-35.png" alt=""></p>
<p>特点：</p>
<ul>
<li>5阶的B树，每一个节点最多存储4个key，对应5个指针。</li>
<li>一旦节点存储的key数量到达5，就会裂变，中间元素向上分裂。</li>
<li>在B树中，非叶子节点和叶子节点都会存放数据</li>
</ul>
<hr>
<br>
<ul>
<li><strong><u>B+Tree</u></strong></li>
</ul>
<p>B+Tree是B tree的变种，我们以一颗最大度数（max-degree）为4（4阶）的b+tree为例，来看一下其结构示意图：</p>
<p><img src="/static/imgs/loading.gif" data-original="https://cdn.jsdelivr.net/gh/ggw2021/images@main/blogs/Snipaste_2024-04-12_13-33-06.png" alt=""></p>
<p>我们可以看到，两部分：</p>
<ul>
<li>绿色框框起来的部分，是索引部分，仅仅起到索引数据的作用，不存储数据。</li>
<li>红色框框起来的部分，是数据存储部分，在其叶子节点中要存储具体的数据</li>
</ul>
<p>我们可以通过一个数据结构可视化的网站来简单演示一下。 <a target="_blank" rel="noopener" href="https://www.cs.usfca.edu/~galles/visualization/BPlusTree.html">https://www.cs.usfca.edu/~galles/visualization/BPlusTree.html</a></p>
<p>插入一组数据： <code>100 65 169 368 900 556 780 35 215 1200 234 888 158 90 1000 88 120 268 250</code> 。然后观察一些数据插入过程中，节点的变化情况。</p>
<p><img src="/static/imgs/loading.gif" data-original="https://cdn.jsdelivr.net/gh/ggw2021/images@main/blogs/Snipaste_2024-04-12_13-35-31.png" alt=""></p>
<p>最终我们看到，B+Tree 与 B tree相比，主要有以下三点区别：</p>
<ul>
<li>所有的数据都会出现在叶子节点。</li>
<li>叶子节点形成一个单向链表。</li>
<li>非叶子节点仅仅起到索引数据作用，具体的数据都是在叶子节点存放的。</li>
</ul>
<br>
<p>上述我们所看到的结构是标准的B+Tree的数据结构，接下来，我们再来看看MySQL中优化之后的B+Tree。</p>
<p>MySQL索引数据结构对经典的B+Tree进行了优化。在原B+Tree的基础上，增加一个指向相邻叶子节点的链表指针，就形成了带有顺序指针的B+Tree，提高区间访问的性能，利于排序。</p>
<p><img src="/static/imgs/loading.gif" data-original="https://cdn.jsdelivr.net/gh/ggw2021/images@main/blogs/Snipaste_2024-04-12_13-37-19.png" alt=""></p>
<hr>
<br>
<ul>
<li><strong><u>Hash</u></strong></li>
</ul>
<p>MySQL中除了支持B+Tree索引，还支持一种索引类型—Hash索引。</p>
<p><strong>1).</strong> 结构<br>
哈希索引就是采用一定的hash算法，将键值换算成新的hash值，映射到对应的槽位上，然后存储在hash表中。</p>
<p><img src="/static/imgs/loading.gif" data-original="https://cdn.jsdelivr.net/gh/ggw2021/images@main/blogs/Snipaste_2024-04-12_13-43-39.png" alt=""></p>
<p>如果两个(或多个)键值，映射到一个相同的槽位上，他们就产生了hash冲突（也称为hash碰撞），可以通过链表来解决。</p>
<br>
<p><strong>2).</strong> 特点</p>
<p>A. Hash索引只能用于对等比较(=，in)，不支持范围查询（between，&gt;，&lt; ，…）<br>
B. 无法利用索引完成排序操作<br>
C. 查询效率高，通常(不存在hash冲突的情况)只需要一次检索就可以了，效率通常要高于B+tree索引</p>
<br>
<p><strong>3).</strong> 存储引擎支持</p>
<p>在MySQL中，支持hash索引的是Memory存储引擎。 而InnoDB中具有自适应hash功能，hash索引是InnoDB存储引擎根据B+Tree索引在指定条件下自动构建的。</p>
<blockquote>
<p>思考题： 为什么InnoDB存储引擎选择使用B+tree索引结构?</p>
<p>A. 相对于二叉树，层级更少，搜索效率高；<br>
B. 对于B tree，无论是叶子节点还是非叶子节点，都会保存数据，这样导致一页中存储的键值减少，指针跟着减少，要同样保存大量数据，只能增加树的高度，导致性能降低；<br>
C. 相对Hash索引，B+tree支持范围匹配及排序操作；</p>
</blockquote>
<hr>
<p><br><br><br></p>
<h4 id="2-3-索引分类">2.3 索引分类</h4>
<ul>
<li><strong><u>索引分类</u></strong></li>
</ul>
<p>在MySQL数据库，将索引的具体类型主要分为以下几类：主键索引、唯一索引、常规索引、全文索引。</p>
<table>
<thead>
<tr>
<th style="text-align:left">分类</th>
<th style="text-align:left">含义</th>
<th style="text-align:left">特点</th>
<th style="text-align:left">关键字</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">主键索引</td>
<td style="text-align:left">针对于表中主键创建的索引</td>
<td style="text-align:left">默认自动创建, 只能有一个</td>
<td style="text-align:left">PRIMARY</td>
</tr>
<tr>
<td style="text-align:left">唯一索引</td>
<td style="text-align:left">避免同一个表中某数据列中的值重复</td>
<td style="text-align:left">可以有多个</td>
<td style="text-align:left">UNIQUE</td>
</tr>
<tr>
<td style="text-align:left">常规索引</td>
<td style="text-align:left">快速定位特定数据</td>
<td style="text-align:left">可以有多个</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">全文索引</td>
<td style="text-align:left">全文索引查找的是文本中的关键词，而不是比较索引中的值</td>
<td style="text-align:left">可以有多个</td>
<td style="text-align:left">FULLTEXT</td>
</tr>
</tbody>
</table>
<hr>
<br>
<ul>
<li><strong><u>聚集索引&amp;二级索引</u></strong></li>
</ul>
<p>而在在InnoDB存储引擎中，根据索引的存储形式，又可以分为以下两种：</p>
<table>
<thead>
<tr>
<th style="text-align:left">分类</th>
<th style="text-align:left">含义</th>
<th style="text-align:left">特点</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">聚集索引（Clustered Index)</td>
<td style="text-align:left">将数据存储与索引放到了一块，索引结构的叶子 节点保存了行数据</td>
<td style="text-align:left">必须有, 而且只有一个</td>
</tr>
<tr>
<td style="text-align:left">二级索引（Secondary Index)</td>
<td style="text-align:left">将数据与索引分开存储，索引结构的叶子节点关 联的是对应的主键</td>
<td style="text-align:left">可以存在多个</td>
</tr>
</tbody>
</table>
<p>聚集索引选取规则:</p>
<ul>
<li>如果存在主键，主键索引就是聚集索引。</li>
<li>如果不存在主键，将使用第一个唯一（UNIQUE）索引作为聚集索引。</li>
<li>如果表没有主键，或没有合适的唯一索引，则InnoDB会自动生成一个rowid作为隐藏的聚集索引。</li>
</ul>
<br>
<p>聚集索引和二级索引的具体结构如下：</p>
<p><img src="/static/imgs/loading.gif" data-original="https://cdn.jsdelivr.net/gh/ggw2021/images@main/blogs/Snipaste_2024-04-12_13-56-45.png" alt=""></p>
<ul>
<li>聚集索引的叶子节点下挂的是这一行的数据 。</li>
<li>二级索引的叶子节点下挂的是该字段值对应的主键值。</li>
</ul>
<br>
<p>接下来，我们来分析一下，当我们执行如下的SQL语句时，具体的查找过程是什么样子的。</p>
<p><img src="/static/imgs/loading.gif" data-original="https://cdn.jsdelivr.net/gh/ggw2021/images@main/blogs/Snipaste_2024-04-12_13-57-46.png" alt=""></p>
<p>具体过程如下:<br>
①. 由于是根据name字段进行查询，所以先根据name='Arm’到name字段的二级索引中进行匹配查找。但是在二级索引中只能查找到 Arm 对应的主键值 10。<br>
②. 由于查询返回的数据是*，所以此时，还需要根据主键值10，到聚集索引中查找10对应的记录，最终找到10对应的行row。<br>
③. 最终拿到这一行的数据，直接返回即可。</p>
<blockquote>
<p>回表查询： 这种先到二级索引中查找数据，找到主键值，然后再到聚集索引中根据主键值，获取数据的方式，就称之为回表查询。</p>
<p><strong>思考题</strong>：<br>
以下两条SQL语句，那个执行效率高? 为什么?<br>
A. select * from user where id = 10 ;<br>
B. select * from user where name = ‘Arm’ ;<br>
备注: id为主键，name字段创建的有索引；<br>
解答：<br>
A 语句的执行性能要高于B 语句。<br>
因为A语句直接走聚集索引，直接返回数据。 而B语句需要先查询name字段的二级索引，然后再查询聚集索引，也就是需要进行回表查询。</p>
<p><strong>思考题</strong>：<br>
InnoDB主键索引的B+tree高度为多高呢?</p>
<p><img src="/static/imgs/loading.gif" data-original="https://cdn.jsdelivr.net/gh/ggw2021/images@main/blogs/Snipaste_2024-04-12_13-37-19.png" alt=""></p>
<p>假设:<br>
一行数据大小为1k，一页中可以存储16行这样的数据。InnoDB的指针占用6个字节的空间，主键即使为bigint，占用字节数为8。</p>
<p>高度为2：<br>
n * 8 + (n + 1) * 6 = 16*1024 , 算出n约为 1170<br>
1171* 16 = 18736<br>
也就是说，如果树的高度为2，则可以存储 18000 多条记录。</p>
<p>高度为3：<br>
1171 * 1171 * 16 = 21939856<br>
也就是说，如果树的高度为3，则可以存储 2200w 左右的记录。</p>
</blockquote>
<hr>
<p><br><br><br></p>
<h4 id="2-4-索引语法">2.4 索引语法</h4>
<p><strong>1).</strong> 创建索引</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> [ <span class="hljs-keyword">UNIQUE</span> <span class="hljs-operator">|</span> FULLTEXT ] INDEX index_name <span class="hljs-keyword">ON</span> table_name (index_col_name,... );<br></code></pre></td></tr></table></figure>
<p>不加可选参数<code>[ UNIQUE | FULLTEXT ]</code>，则表示创建的是一个常规索引。</p>
<p><strong>2).</strong> 查看索引</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SHOW</span> INDEX <span class="hljs-keyword">FROM</span> table_name;<br></code></pre></td></tr></table></figure>
<p><strong>3).</strong> 删除索引</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">DROP</span> INDEX index_name <span class="hljs-keyword">ON</span> table_name;<br></code></pre></td></tr></table></figure>
<br>
<p>案例演示:</p>
<p>先来创建一张表 tb_user_，并且查询测试数据。</p>
<p>解释：因为前面创建过了一张tb_user的表，所以改叫这个名字，但是后面又用一样（tb_user）的是因为教程就是交这个，不用太过纠结，就<strong>把后面的tb_user和tb_user_当成同一张表即可</strong>。</p>
<details class="toggle" style="border: 1px solid  #edf4ee"><summary class="toggle-button" style="background-color:  #edf4ee;color:  #17181a">数据准备 </summary><div class="toggle-content"><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">drop</span> <span class="hljs-keyword">table</span> if <span class="hljs-keyword">exists</span> tb_user_;<br><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> tb_user_(<br>    id <span class="hljs-type">int</span> <span class="hljs-keyword">primary</span> key auto_increment comment <span class="hljs-string">&#x27;主键&#x27;</span>,<br>    name <span class="hljs-type">varchar</span>(<span class="hljs-number">50</span>) <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> comment <span class="hljs-string">&#x27;用户名&#x27;</span>,<br>    phone <span class="hljs-type">varchar</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> comment <span class="hljs-string">&#x27;手机号&#x27;</span>,<br>    email <span class="hljs-type">varchar</span>(<span class="hljs-number">100</span>) comment <span class="hljs-string">&#x27;邮箱&#x27;</span>,<br>    profession <span class="hljs-type">varchar</span>(<span class="hljs-number">11</span>) comment <span class="hljs-string">&#x27;专业&#x27;</span>,<br>    age tinyint unsigned comment <span class="hljs-string">&#x27;年龄&#x27;</span>,<br>    gender <span class="hljs-type">char</span>(<span class="hljs-number">1</span>) comment <span class="hljs-string">&#x27;性别 , 1: 男, 2: 女&#x27;</span>,<br>    status <span class="hljs-type">char</span>(<span class="hljs-number">1</span>) comment <span class="hljs-string">&#x27;状态&#x27;</span>,<br>    createtime datetime comment <span class="hljs-string">&#x27;创建时间&#x27;</span><br>) comment <span class="hljs-string">&#x27;系统用户表&#x27;</span>;<br><br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> tb_user_ (name, phone, email, profession, age, gender, status,<br>createtime) <span class="hljs-keyword">VALUES</span> <br>(<span class="hljs-string">&#x27;吕布&#x27;</span>, <span class="hljs-string">&#x27;17799990000&#x27;</span>, <span class="hljs-string">&#x27;lvbu666@163.com&#x27;</span>, <span class="hljs-string">&#x27;软件工程&#x27;</span>, <span class="hljs-number">23</span>, <span class="hljs-string">&#x27;1&#x27;</span>, <span class="hljs-string">&#x27;6&#x27;</span>, <span class="hljs-string">&#x27;2001-02-02 00:00:00&#x27;</span>);<br><br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> tb_user_ (name, phone, email, profession, age, gender, status, <br>createtime) <span class="hljs-keyword">VALUES</span> <br>(<span class="hljs-string">&#x27;曹操&#x27;</span>, <span class="hljs-string">&#x27;17799990001&#x27;</span>, <span class="hljs-string">&#x27;caocao666@qq.com&#x27;</span>, <span class="hljs-string">&#x27;通讯工程&#x27;</span>, <span class="hljs-number">33</span>, <span class="hljs-string">&#x27;1&#x27;</span>, <span class="hljs-string">&#x27;0&#x27;</span>, <span class="hljs-string">&#x27;2001-03-05 00:00:00&#x27;</span>);<br><br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> tb_user_ (name, phone, email, profession, age, gender, status,<br>createtime) <span class="hljs-keyword">VALUES</span> <br>(<span class="hljs-string">&#x27;赵云&#x27;</span>, <span class="hljs-string">&#x27;17799990002&#x27;</span>, <span class="hljs-string">&#x27;17799990@139.com&#x27;</span>, <span class="hljs-string">&#x27;英语&#x27;</span>, <span class="hljs-number">34</span>, <span class="hljs-string">&#x27;1&#x27;</span>, <span class="hljs-string">&#x27;2&#x27;</span>, <span class="hljs-string">&#x27;2002-03-02 00:00:00&#x27;</span>);<br><br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> tb_user_ (name, phone, email, profession, age, gender, status,<br>createtime) <span class="hljs-keyword">VALUES</span> <br>(<span class="hljs-string">&#x27;孙悟空&#x27;</span>, <span class="hljs-string">&#x27;17799990003&#x27;</span>, <span class="hljs-string">&#x27;17799990@sina.com&#x27;</span>, <span class="hljs-string">&#x27;工程造价&#x27;</span>, <span class="hljs-number">54</span>, <span class="hljs-string">&#x27;1&#x27;</span>, <span class="hljs-string">&#x27;0&#x27;</span>, <span class="hljs-string">&#x27;2001-07-02 00:00:00&#x27;</span>);<br><br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> tb_user_ (name, phone, email, profession, age, gender, status,<br>createtime) <span class="hljs-keyword">VALUES</span> <br>(<span class="hljs-string">&#x27;花木兰&#x27;</span>, <span class="hljs-string">&#x27;17799990004&#x27;</span>, <span class="hljs-string">&#x27;19980729@sina.com&#x27;</span>, <span class="hljs-string">&#x27;软件工程&#x27;</span>, <span class="hljs-number">23</span>, <span class="hljs-string">&#x27;2&#x27;</span>, <span class="hljs-string">&#x27;1&#x27;</span>, <span class="hljs-string">&#x27;2001-04-22 00:00:00&#x27;</span>);<br><br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> tb_user_ (name, phone, email, profession, age, gender, status,<br>createtime) <span class="hljs-keyword">VALUES</span> <br>(<span class="hljs-string">&#x27;大乔&#x27;</span>, <span class="hljs-string">&#x27;17799990005&#x27;</span>, <span class="hljs-string">&#x27;daqiao666@sina.com&#x27;</span>, <span class="hljs-string">&#x27;舞蹈&#x27;</span>, <span class="hljs-number">22</span>, <span class="hljs-string">&#x27;2&#x27;</span>, <span class="hljs-string">&#x27;0&#x27;</span>, <span class="hljs-string">&#x27;2001-02-07 00:00:00&#x27;</span>);<br><br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> tb_user_ (name, phone, email, profession, age, gender, status,<br>createtime) <span class="hljs-keyword">VALUES</span> <br>(<span class="hljs-string">&#x27;露娜&#x27;</span>, <span class="hljs-string">&#x27;17799990006&#x27;</span>, <span class="hljs-string">&#x27;luna_love@sina.com&#x27;</span>, <span class="hljs-string">&#x27;应用数学&#x27;</span>, <span class="hljs-number">24</span>, <span class="hljs-string">&#x27;2&#x27;</span>, <span class="hljs-string">&#x27;0&#x27;</span>, <span class="hljs-string">&#x27;2001-02-08 00:00:00&#x27;</span>);<br><br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> tb_user_ (name, phone, email, profession, age, gender, status,<br>createtime) <span class="hljs-keyword">VALUES</span> <br>(<span class="hljs-string">&#x27;程咬金&#x27;</span>, <span class="hljs-string">&#x27;17799990007&#x27;</span>, <span class="hljs-string">&#x27;chengyaojin@163.com&#x27;</span>, <span class="hljs-string">&#x27;化工&#x27;</span>, <span class="hljs-number">38</span>, <span class="hljs-string">&#x27;1&#x27;</span>, <span class="hljs-string">&#x27;5&#x27;</span>, <span class="hljs-string">&#x27;2001-05-23 00:00:00&#x27;</span>);<br><br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> tb_user_ (name, phone, email, profession, age, gender, status,<br>createtime) <span class="hljs-keyword">VALUES</span> <br>(<span class="hljs-string">&#x27;项羽&#x27;</span>, <span class="hljs-string">&#x27;17799990008&#x27;</span>, <span class="hljs-string">&#x27;xiaoyu666@qq.com&#x27;</span>, <span class="hljs-string">&#x27;金属材料&#x27;</span>, <span class="hljs-number">43</span>, <span class="hljs-string">&#x27;1&#x27;</span>, <span class="hljs-string">&#x27;0&#x27;</span>, <span class="hljs-string">&#x27;2001-09-18 00:00:00&#x27;</span>);<br><br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> tb_user_ (name, phone, email, profession, age, gender, status,<br>createtime) <span class="hljs-keyword">VALUES</span> <br>(<span class="hljs-string">&#x27;白起&#x27;</span>, <span class="hljs-string">&#x27;17799990009&#x27;</span>, <span class="hljs-string">&#x27;baiqi666@sina.com&#x27;</span>, <span class="hljs-string">&#x27;机械工程及其自动化&#x27;</span>, <span class="hljs-number">27</span>, <span class="hljs-string">&#x27;1&#x27;</span>, <span class="hljs-string">&#x27;2&#x27;</span>, <span class="hljs-string">&#x27;2001-08-16 00:00:00&#x27;</span>);<br><br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> tb_user_ (name, phone, email, profession, age, gender, status,<br>createtime) <span class="hljs-keyword">VALUES</span> <br>(<span class="hljs-string">&#x27;韩信&#x27;</span>, <span class="hljs-string">&#x27;17799990010&#x27;</span>, <span class="hljs-string">&#x27;hanxin520@163.com&#x27;</span>, <span class="hljs-string">&#x27;无机非金属材料工程&#x27;</span>, <span class="hljs-number">27</span>, <span class="hljs-string">&#x27;1&#x27;</span>, <span class="hljs-string">&#x27;0&#x27;</span>, <span class="hljs-string">&#x27;2001-06-12 00:00:00&#x27;</span>);<br><br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> tb_user_ (name, phone, email, profession, age, gender, status,<br>createtime) <span class="hljs-keyword">VALUES</span> <br>(<span class="hljs-string">&#x27;荆轲&#x27;</span>, <span class="hljs-string">&#x27;17799990011&#x27;</span>, <span class="hljs-string">&#x27;jingke123@163.com&#x27;</span>, <span class="hljs-string">&#x27;会计&#x27;</span>, <span class="hljs-number">29</span>, <span class="hljs-string">&#x27;1&#x27;</span>, <span class="hljs-string">&#x27;0&#x27;</span>, <span class="hljs-string">&#x27;2001-05-11 00:00:00&#x27;</span>);<br><br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> tb_user_ (name, phone, email, profession, age, gender, status,<br>createtime) <span class="hljs-keyword">VALUES</span> <br>(<span class="hljs-string">&#x27;兰陵王&#x27;</span>, <span class="hljs-string">&#x27;17799990012&#x27;</span>, <span class="hljs-string">&#x27;lanlinwang666@126.com&#x27;</span>, <span class="hljs-string">&#x27;工程造价&#x27;</span>, <span class="hljs-number">44</span>, <span class="hljs-string">&#x27;1&#x27;</span>, <span class="hljs-string">&#x27;1&#x27;</span>, <span class="hljs-string">&#x27;2001-04-09 00:00:00&#x27;</span>);<br><br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> tb_user_ (name, phone, email, profession, age, gender, status,<br>createtime) <span class="hljs-keyword">VALUES</span> <br>(<span class="hljs-string">&#x27;狂铁&#x27;</span>, <span class="hljs-string">&#x27;17799990013&#x27;</span>, <span class="hljs-string">&#x27;kuangtie@sina.com&#x27;</span>, <span class="hljs-string">&#x27;应用数学&#x27;</span>, <span class="hljs-number">43</span>, <span class="hljs-string">&#x27;1&#x27;</span>, <span class="hljs-string">&#x27;2&#x27;</span>, <span class="hljs-string">&#x27;2001-04-10 00:00:00&#x27;</span>);<br><br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> tb_user_ (name, phone, email, profession, age, gender, status,<br>createtime) <span class="hljs-keyword">VALUES</span> <br>(<span class="hljs-string">&#x27;貂蝉&#x27;</span>, <span class="hljs-string">&#x27;17799990014&#x27;</span>, <span class="hljs-string">&#x27;84958948374@qq.com&#x27;</span>, <span class="hljs-string">&#x27;软件工程&#x27;</span>, <span class="hljs-number">40</span>, <span class="hljs-string">&#x27;2&#x27;</span>, <span class="hljs-string">&#x27;3&#x27;</span>, <span class="hljs-string">&#x27;2001-02-12 00:00:00&#x27;</span>);<br><br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> tb_user_ (name, phone, email, profession, age, gender, status,<br>createtime) <span class="hljs-keyword">VALUES</span> <br>(<span class="hljs-string">&#x27;妲己&#x27;</span>, <span class="hljs-string">&#x27;17799990015&#x27;</span>, <span class="hljs-string">&#x27;2783238293@qq.com&#x27;</span>, <span class="hljs-string">&#x27;软件工程&#x27;</span>, <span class="hljs-number">31</span>, <span class="hljs-string">&#x27;2&#x27;</span>, <span class="hljs-string">&#x27;0&#x27;</span>, <span class="hljs-string">&#x27;2001-01-30 00:00:00&#x27;</span>);<br><br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> tb_user_ (name, phone, email, profession, age, gender, status,<br>createtime) <span class="hljs-keyword">VALUES</span> <br>(<span class="hljs-string">&#x27;芈月&#x27;</span>, <span class="hljs-string">&#x27;17799990016&#x27;</span>, <span class="hljs-string">&#x27;xiaomin2001@sina.com&#x27;</span>, <span class="hljs-string">&#x27;工业经济&#x27;</span>, <span class="hljs-number">35</span>, <span class="hljs-string">&#x27;2&#x27;</span>, <span class="hljs-string">&#x27;0&#x27;</span>, <span class="hljs-string">&#x27;2000-05-03 00:00:00&#x27;</span>);<br><br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> tb_user_ (name, phone, email, profession, age, gender, status,<br>createtime) <span class="hljs-keyword">VALUES</span> <br>(<span class="hljs-string">&#x27;嬴政&#x27;</span>, <span class="hljs-string">&#x27;17799990017&#x27;</span>, <span class="hljs-string">&#x27;8839434342@qq.com&#x27;</span>, <span class="hljs-string">&#x27;化工&#x27;</span>, <span class="hljs-number">38</span>, <span class="hljs-string">&#x27;1&#x27;</span>, <span class="hljs-string">&#x27;1&#x27;</span>, <span class="hljs-string">&#x27;2001-08-08 00:00:00&#x27;</span>);<br><br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> tb_user_ (name, phone, email, profession, age, gender, status,<br>createtime) <span class="hljs-keyword">VALUES</span> <br>(<span class="hljs-string">&#x27;狄仁杰&#x27;</span>, <span class="hljs-string">&#x27;17799990018&#x27;</span>, <span class="hljs-string">&#x27;jujiamlm8166@163.com&#x27;</span>, <span class="hljs-string">&#x27;国际贸易&#x27;</span>, <span class="hljs-number">30</span>, <span class="hljs-string">&#x27;1&#x27;</span>, <span class="hljs-string">&#x27;0&#x27;</span>, <span class="hljs-string">&#x27;2007-03-12 00:00:00&#x27;</span>);<br><br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> tb_user_ (name, phone, email, profession, age, gender, status,<br>createtime) <span class="hljs-keyword">VALUES</span> <br>(<span class="hljs-string">&#x27;安琪拉&#x27;</span>, <span class="hljs-string">&#x27;17799990019&#x27;</span>, <span class="hljs-string">&#x27;jdodm1h@126.com&#x27;</span>, <span class="hljs-string">&#x27;城市规划&#x27;</span>, <span class="hljs-number">51</span>, <span class="hljs-string">&#x27;2&#x27;</span>, <span class="hljs-string">&#x27;0&#x27;</span>, <span class="hljs-string">&#x27;2001-08-15 00:00:00&#x27;</span>);<br><br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> tb_user_ (name, phone, email, profession, age, gender, status,<br>createtime) <span class="hljs-keyword">VALUES</span> <br>(<span class="hljs-string">&#x27;典韦&#x27;</span>, <span class="hljs-string">&#x27;17799990020&#x27;</span>, <span class="hljs-string">&#x27;ycaunanjian@163.com&#x27;</span>, <span class="hljs-string">&#x27;城市规划&#x27;</span>, <span class="hljs-number">52</span>, <span class="hljs-string">&#x27;1&#x27;</span>, <span class="hljs-string">&#x27;2&#x27;</span>, <span class="hljs-string">&#x27;2000-04-12 00:00:00&#x27;</span>);<br><br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> tb_user_ (name, phone, email, profession, age, gender, status,<br>createtime) <span class="hljs-keyword">VALUES</span> <br>(<span class="hljs-string">&#x27;廉颇&#x27;</span>, <span class="hljs-string">&#x27;17799990021&#x27;</span>, <span class="hljs-string">&#x27;lianpo321@126.com&#x27;</span>, <span class="hljs-string">&#x27;土木工程&#x27;</span>, <span class="hljs-number">19</span>, <span class="hljs-string">&#x27;1&#x27;</span>, <span class="hljs-string">&#x27;3&#x27;</span>, <span class="hljs-string">&#x27;2002-07-18 00:00:00&#x27;</span>);<br><br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> tb_user_ (name, phone, email, profession, age, gender, status,<br>createtime) <span class="hljs-keyword">VALUES</span> <br>(<span class="hljs-string">&#x27;后羿&#x27;</span>, <span class="hljs-string">&#x27;17799990022&#x27;</span>, <span class="hljs-string">&#x27;altycj2000@139.com&#x27;</span>, <span class="hljs-string">&#x27;城市园林&#x27;</span>, <span class="hljs-number">20</span>, <span class="hljs-string">&#x27;1&#x27;</span>, <span class="hljs-string">&#x27;0&#x27;</span>, <span class="hljs-string">&#x27;2002-03-10 00:00:00&#x27;</span>);<br><br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> tb_user_ (name, phone, email, profession, age, gender, status,<br>createtime) <span class="hljs-keyword">VALUES</span> <br>(<span class="hljs-string">&#x27;姜子牙&#x27;</span>, <span class="hljs-string">&#x27;17799990023&#x27;</span>, <span class="hljs-string">&#x27;37483844@qq.com&#x27;</span>, <span class="hljs-string">&#x27;工程造价&#x27;</span>, <span class="hljs-number">29</span>, <span class="hljs-string">&#x27;1&#x27;</span>, <span class="hljs-string">&#x27;4&#x27;</span>, <span class="hljs-string">&#x27;2003-05-26 00:00:00&#x27;</span>);<br></code></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">+----+-----------+-------------+-----------------------+-----------------------------+------+--------+--------+---------------------+<br>| id | name      | phone       | email                 | profession                  | age  | gender | status | createtime          |<br>+----+-----------+-------------+-----------------------+-----------------------------+------+--------+--------+---------------------+<br>|  1 | 吕布      | 17799990000 | lvbu666@163.com       | 软件工程                      |   23 | 1      | 6      | 2001-02-02 00:00:00 |<br>|  2 | 曹操      | 17799990001 | caocao666@qq.com      | 通讯工程                      |   33 | 1      | 0      | 2001-03-05 00:00:00 |<br>|  3 | 赵云      | 17799990002 | 17799990@139.com      | 英语                         |   34 | 1      | 2      | 2002-03-02 00:00:00 |<br>|  4 | 孙悟空    | 17799990003 | 17799990@sina.com     | 工程造价                      |   54 | 1      | 0      | 2001-07-02 00:00:00 |<br>|  5 | 花木兰    | 17799990004 | 19980729@sina.com     | 软件工程                      |   23 | 2      | 1      | 2001-04-22 00:00:00 |<br>|  6 | 大乔      | 17799990005 | daqiao666@sina.com    | 舞蹈                         |   22 | 2      | 0      | 2001-02-07 00:00:00 |<br>|  7 | 露娜      | 17799990006 | luna_love@sina.com    | 应用数学                      |   24 | 2      | 0      | 2001-02-08 00:00:00 |<br>|  8 | 程咬金    | 17799990007 | chengyaojin@163.com   | 化工                          |   38 | 1      | 5      | 2001-05-23 00:00:00 |<br>|  9 | 项羽      | 17799990008 | xiaoyu666@qq.com      | 金属材料                      |   43 | 1      | 0      | 2001-09-18 00:00:00 |<br>| 10 | 白起      | 17799990009 | baiqi666@sina.com     | 机械工程及其自动化              |   27 | 1      | 2      | 2001-08-16 00:00:00 |<br>| 11 | 韩信      | 17799990010 | hanxin520@163.com     | 无机非金属材料工程              |   27 | 1      | 0      | 2001-06-12 00:00:00 |<br>| 12 | 荆轲      | 17799990011 | jingke123@163.com     | 会计                          |   29 | 1      | 0      | 2001-05-11 00:00:00 |<br>| 13 | 兰陵王    | 17799990012 | lanlinwang666@126.com | 工程造价                       |   44 | 1      | 1      | 2001-04-09 00:00:00 |<br>| 14 | 狂铁      | 17799990013 | kuangtie@sina.com     | 应用数学                      |   43 | 1      | 2      | 2001-04-10 00:00:00 |<br>| 15 | 貂蝉      | 17799990014 | 84958948374@qq.com    | 软件工程                      |   40 | 2      | 3      | 2001-02-12 00:00:00 |<br>| 16 | 妲己      | 17799990015 | 2783238293@qq.com     | 软件工程                      |   31 | 2      | 0      | 2001-01-30 00:00:00 |<br>| 17 | 芈月      | 17799990016 | xiaomin2001@sina.com  | 工业经济                      |   35 | 2      | 0      | 2000-05-03 00:00:00 |<br>| 18 | 嬴政      | 17799990017 | 8839434342@qq.com     | 化工                         |   38 | 1      | 1      | 2001-08-08 00:00:00 |<br>| 19 | 狄仁杰    | 17799990018 | jujiamlm8166@163.com  | 国际贸易                      |   30 | 1      | 0      | 2007-03-12 00:00:00 |<br>| 20 | 安琪拉    | 17799990019 | jdodm1h@126.com       | 城市规划                      |   51 | 2      | 0      | 2001-08-15 00:00:00 |<br>| 21 | 典韦      | 17799990020 | ycaunanjian@163.com   | 城市规划                      |   52 | 1      | 2      | 2000-04-12 00:00:00 |<br>| 22 | 廉颇      | 17799990021 | lianpo321@126.com     | 土木工程                      |   19 | 1      | 3      | 2002-07-18 00:00:00 |<br>| 23 | 后羿      | 17799990022 | altycj2000@139.com    | 城市园林                      |   20 | 1      | 0      | 2002-03-10 00:00:00 |<br>| 24 | 姜子牙    | 17799990023 | 37483844@qq.com       | 工程造价                      |   29 | 1      | 4      | 2003-05-26 00:00:00 |<br>+----+-----------+-------------+-----------------------+-----------------------------+------+--------+--------+---------------------+<br></code></pre></td></tr></table></figure>
</div></details>
<p>数据准备好了之后，接下来，我们就来完成如下需求：</p>
<details class="toggle" style="border: 1px solid  #edf4ee"><summary class="toggle-button" style="background-color:  #edf4ee;color:  #17181a">创检前先查看一下索引 </summary><div class="toggle-content"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">+----------+------------+----------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+---------+------------+<br>| Table    | Non_unique | Key_name | Seq_in_index | Column_name | Collation | Cardinality | Sub_part | Packed | Null | Index_type | Comment | Index_comment | Visible | Expression |<br>+----------+------------+----------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+---------+------------+<br>| tb_user_ |          0 | PRIMARY  |            1 | id          | A         |           2 |     NULL |   NULL |      | BTREE      |         |               | YES     | NULL       |<br>+----------+------------+----------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+---------+------------+<br></code></pre></td></tr></table></figure></div></details>
<p><strong>A.</strong> name字段为姓名字段，该字段的值可能会重复，为该字段创建索引。<br>
因为可能重复，所以创建常规索引。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> INDEX idx_user_name <span class="hljs-keyword">ON</span> tb_user_(name);<br></code></pre></td></tr></table></figure>
<p><strong>B.</strong> phone手机号字段的值，是非空，且唯一的，为该字段创建唯一索引。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">UNIQUE</span> INDEX idx_user_phone <span class="hljs-keyword">ON</span> tb_user_(phone);<br></code></pre></td></tr></table></figure>
<p><strong>C.</strong> 为profession、age、status创建联合索引。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> INDEX idx_user_pro_age_sta <span class="hljs-keyword">ON</span> tb_user_(profession,age,status);<br></code></pre></td></tr></table></figure>
<p><strong>D.</strong> 为email建立合适的索引来提升查询效率。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> INDEX idx_email <span class="hljs-keyword">ON</span> tb_user_(email);<br></code></pre></td></tr></table></figure>
<p>完成上述的需求之后，我们再查看tb_user表的所有的索引数据。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">show</span> index <span class="hljs-keyword">from</span> tb_user_;<br></code></pre></td></tr></table></figure>
<details class="toggle" style="border: 1px solid  #edf4ee"><summary class="toggle-button" style="background-color:  #edf4ee;color:  #17181a">查看输出 </summary><div class="toggle-content"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">+----------+------------+----------------------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+---------+------------+<br>| Table    | Non_unique | Key_name             | Seq_in_index | Column_name | Collation | Cardinality | Sub_part | Packed | Null | Index_type | Comment | Index_comment | Visible | Expression |<br>+----------+------------+----------------------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+---------+------------+<br>| tb_user_ |          0 | PRIMARY              |            1 | id          | A         |          24 |     NULL |   NULL |      | BTREE      |         |               | YES     | NULL       |<br>| tb_user_ |          0 | idx_user_phone       |            1 | phone       | A         |          24 |     NULL |   NULL |      | BTREE      |         |               | YES     | NULL       |<br>| tb_user_ |          1 | idx_user_name        |            1 | name        | A         |          24 |     NULL |   NULL |      | BTREE      |         |               | YES     | NULL       |<br>| tb_user_ |          1 | idx_user_pro_age_sta |            1 | profession  | A         |          16 |     NULL |   NULL | YES  | BTREE      |         |               | YES     | NULL       |<br>| tb_user_ |          1 | idx_user_pro_age_sta |            2 | age         | A         |          22 |     NULL |   NULL | YES  | BTREE      |         |               | YES     | NULL       |<br>| tb_user_ |          1 | idx_user_pro_age_sta |            3 | status      | A         |          24 |     NULL |   NULL | YES  | BTREE      |         |               | YES     | NULL       |<br>| tb_user_ |          1 | idx_email            |            1 | email       | A         |          24 |     NULL |   NULL | YES  | BTREE      |         |               | YES     | NULL       |<br>+----------+------------+----------------------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+---------+------------+<br>7 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure></div></details>
<hr>
<p><br><br><br></p>
<h4 id="2-5-SQL性能的分析">2.5 SQL性能的分析</h4>
<ul>
<li><strong>SQL执行频率</strong></li>
</ul>
<p>MySQL 客户端连接成功后，通过 <code>show [session|global] status</code> 命令可以提供服务器状态信息。通过如下指令，可以查看当前数据库的INSERT、UPDATE、DELETE、SELECT的访问频次：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- session 是查看当前会话 ;</span><br><span class="hljs-comment">-- global 是查询全局数据 ;</span><br><span class="hljs-keyword">SHOW</span> <span class="hljs-keyword">GLOBAL</span> STATUS <span class="hljs-keyword">LIKE</span> <span class="hljs-string">&#x27;Com_______&#x27;</span>;<br></code></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">mysql&gt; SHOW GLOBAL STATUS LIKE &#x27;Com_______&#x27;;<br>+---------------+-------+<br>| Variable_name | Value |<br>+---------------+-------+<br>| Com_binlog    | 0     |<br>| Com_commit    | 0     |<br>| Com_delete    | 0     |<br>| Com_import    | 0     |<br>| Com_insert    | 53    |<br>| Com_repair    | 0     |<br>| Com_revoke    | 0     |<br>| Com_select    | 39    |<br>| Com_signal    | 0     |<br>| Com_update    | 0     |<br>| Com_xa_end    | 0     |<br>+---------------+-------+<br>11 rows in set (0.01 sec)<br></code></pre></td></tr></table></figure>
<p>Com_delete: 删除次数<br>
Com_insert: 插入次数<br>
Com_select: 查询次数<br>
Com_update: 更新次数</p>
<p>我们可以在当前数据库再执行几次查询操作，然后再次查看执行频次，看看 Com_select 参数会不会变化。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">mysql&gt; SHOW GLOBAL STATUS LIKE &#x27;Com_______&#x27;;<br>+---------------+-------+<br>| Variable_name | Value |<br>+---------------+-------+<br>| Com_binlog    | 0     |<br>| Com_commit    | 0     |<br>| Com_delete    | 0     |<br>| Com_import    | 0     |<br>| Com_insert    | 53    |<br>| Com_repair    | 0     |<br>| Com_revoke    | 0     |<br>| Com_select    | 73    |<br>| Com_signal    | 0     |<br>| Com_update    | 0     |<br>| Com_xa_end    | 0     |<br>+---------------+-------+<br>11 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure>
<blockquote>
<p>通过上述指令，我们可以查看到当前数据库到底是以查询为主，还是以增删改为主，从而为数据库优化提供参考依据。 如果是<u>以增删改为主，我们可以考虑不对其进行索引的优化</u>。 如果是<u>以查询为主，那么就要考虑对数据库的索引进行优化了</u>。</p>
</blockquote>
<p>那么通过查询SQL的执行频次，我们就能够知道当前数据库到底是增删改为主，还是查询为主。 那假如说是以查询为主，我们又该如何定位针对于那些查询语句进行优化呢？ 次数我们可以借助于慢查询日志。</p>
<p>接下来，我们就来介绍一下MySQL中的慢查询日志</p>
<hr>
<br>
<ul>
<li><strong><u>慢查询日志</u></strong></li>
</ul>
<p>慢查询日志记录了所有执行时间超过指定参数（long_query_time，单位：秒，默认10秒）的所有SQL语句的日志。</p>
<p>MySQL的慢查询日志<strong>默认没有开启</strong>，我们可以查看一下系统变量 slow_query_log。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">show</span> variables <span class="hljs-keyword">like</span> <span class="hljs-string">&#x27;slow_query_log&#x27;</span>;<br></code></pre></td></tr></table></figure>
<details class="toggle" style="border: 1px solid  #edf4ee"><summary class="toggle-button" style="background-color:  #edf4ee;color:  #17181a">查看输出 </summary><div class="toggle-content"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">+----------------+-------+<br>| Variable_name  | Value |<br>+----------------+-------+<br>| slow_query_log | OFF   |<br>+----------------+-------+<br>1 row in set, 1 warning (0.00 sec)<br></code></pre></td></tr></table></figure></div></details>
<br>
<p>【<strong>Linux</strong>】如果要开启慢查询日志，需要在MySQL的配置文件（/etc/my.cnf）中配置如下信息：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"># 开启MySQL慢日志查询开关<br>slow_query_log<span class="hljs-operator">=</span><span class="hljs-number">1</span><br># 设置慢日志的时间为<span class="hljs-number">2</span>秒，<span class="hljs-keyword">SQL</span>语句执行时间超过<span class="hljs-number">2</span>秒，就会视为慢查询，记录慢查询日志<br>long_query_time<span class="hljs-operator">=</span><span class="hljs-number">2</span><br></code></pre></td></tr></table></figure>
<p>配置完毕之后，通过以下指令重新启动MySQL服务器进行测试，查看慢日志文件中记录的信息/var/lib/mysql/localhost-slow.log</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">systemctl restart mysqld<br></code></pre></td></tr></table></figure>
<p>然后，再次查看开关情况，慢查询日志就已经打开了</p>
<br>
<p>测试：<br>
<strong>A.</strong> 执行如下SQL语句 ：<br>
【教程中没有给 tb_sku 表】</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tb_user_; <span class="hljs-comment">-- 这条SQL执行效率比较高, 执行耗时 0.00sec</span><br><span class="hljs-keyword">select</span> <span class="hljs-built_in">count</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">from</span> tb_sku; <span class="hljs-comment">-- 由于tb_sku表中, 预先存入了1000w的记录, count一次,耗时13.35sec</span><br></code></pre></td></tr></table></figure>
<p><img src="/static/imgs/loading.gif" data-original="https://cdn.jsdelivr.net/gh/ggw2021/images@main/blogs/Snipaste_2024-04-12_16-55-01.png" alt=""></p>
<p><strong>B.</strong> 检查慢查询日志 ：<br>
最终我们发现，在慢查询日志中，只会记录执行时间超多我们预设时间（2s）的SQL，执行较快的SQL是不会记录的。</p>
<p><img src="/static/imgs/loading.gif" data-original="https://cdn.jsdelivr.net/gh/ggw2021/images@main/blogs/Snipaste_2024-04-12_16-56-13.png" alt=""></p>
<p>那这样，通过慢查询日志，就可以定位出执行效率比较低的SQL，从而有针对性的进行优化</p>
<hr>
<br>
<ul>
<li><strong><u>profile详情</u></strong></li>
</ul>
<p>show profiles 能够在做SQL优化时帮助我们了解时间都耗费到哪里去了。通过have_profiling参数，能够看到当前MySQL是否支持profile操作：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> @<span class="hljs-variable">@have</span>_profiling ;<br></code></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">mysql&gt; SELECT @@have_profiling ;<br>+------------------+<br>| @@have_profiling |<br>+------------------+<br>| YES              |<br>+------------------+<br>1 row in set, 1 warning (0.00 sec)<br><br>mysql&gt; SELECT @@profiling ;<br>+-------------+<br>| @@profiling |<br>+-------------+<br>|           0 |<br>+-------------+<br>1 row in set, 1 warning (0.00 sec)<br></code></pre></td></tr></table></figure>
<p>可以看到，当前MySQL是支持 profile操作的，但是开关是关闭的。可以通过set语句在session/global级别开启profiling：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SET</span> profiling <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;<br></code></pre></td></tr></table></figure>
<p>开关已经打开了，接下来，我们所执行的SQL语句，都会被MySQL记录，并记录执行时间消耗到哪儿去了。 我们直接执行如下的SQL语句：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tb_user_;<br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tb_user_ <span class="hljs-keyword">where</span> id <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;<br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tb_user_ <span class="hljs-keyword">where</span> name <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;白起&#x27;</span>;<br><span class="hljs-keyword">select</span> <span class="hljs-built_in">count</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">from</span> tb_sku;<br></code></pre></td></tr></table></figure>
<p>执行一系列的业务SQL的操作，然后通过如下指令查看指令的执行耗时：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 查看每一条SQL的耗时基本情况</span><br><span class="hljs-keyword">show</span> profiles;<br><br><span class="hljs-comment">-- 查看指定query_id的SQL语句各个阶段的耗时情况</span><br><span class="hljs-keyword">show</span> profile <span class="hljs-keyword">for</span> query query_id;<br><br><span class="hljs-comment">-- 查看指定query_id的SQL语句CPU的使用情况</span><br><span class="hljs-keyword">show</span> profile cpu <span class="hljs-keyword">for</span> query query_id;<br></code></pre></td></tr></table></figure>
<p>查看每一条SQL的耗时情况:</p>
<p><img src="/static/imgs/loading.gif" data-original="https://cdn.jsdelivr.net/gh/ggw2021/images@main/blogs/Snipaste_2024-04-12_17-03-43.png" alt=""></p>
<p>查看指定SQL各个阶段的耗时情况 :</p>
<p><img src="/static/imgs/loading.gif" data-original="https://cdn.jsdelivr.net/gh/ggw2021/images@main/blogs/Snipaste_2024-04-12_17-04-37.png" alt=""></p>
<hr>
<br>
<ul>
<li><strong><u>explain</u></strong></li>
</ul>
<p><code>EXPLAIN</code> 或者 <code>DESC</code> 命令获取 MySQL 如何执行 SELECT 语句的信息，包括在 SELECT 语句执行过程中表如何连接和连接的顺序。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 直接在select语句之前加上关键字 explain / desc</span><br>EXPLAIN <span class="hljs-keyword">SELECT</span> 字段列表 <span class="hljs-keyword">FROM</span> 表名 <span class="hljs-keyword">WHERE</span> 条件 ;<br></code></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">mysql&gt; explain select * from tb_user where id = 1;<br>+----+-------------+---------+------------+-------+---------------+---------+---------+-------+------+----------+-------+<br>| id | select_type | table   | partitions | type  | possible_keys | key     | key_len | ref   | rows | filtered | Extra |<br>+----+-------------+---------+------------+-------+---------------+---------+---------+-------+------+----------+-------+<br>|  1 | SIMPLE      | tb_user | NULL       | const | PRIMARY       | PRIMARY | 4       | const |    1 |   100.00 | NULL  |<br>+----+-------------+---------+------------+-------+---------------+---------+---------+-------+------+----------+-------+<br>1 row in set, 1 warning (0.00 sec)<br></code></pre></td></tr></table></figure>
<p>Explain 执行计划中各个字段的含义:</p>
<table>
<thead>
<tr>
<th style="text-align:left">字段</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">id</td>
<td>select查询的序列号，表示查询中执行select子句或者是操作表的顺序 (id相同，执行顺序从上到下；id不同，值越大，越先执行)。</td>
</tr>
<tr>
<td style="text-align:left">select_type</td>
<td>表示 SELECT 的类型，常见的取值有 SIMPLE（简单表，即不使用表连接 或者子查询）、PRIMARY（主查询，即外层的查询）、 UNION（UNION 中的第二个或者后面的查询语句）、 SUBQUERY（SELECT/WHERE之后包含了子查询）等</td>
</tr>
<tr>
<td style="text-align:left">type</td>
<td>表示连接类型，性能由好到差的连接类型为NULL、system、const、 eq_ref、ref、range、 index、all 。</td>
</tr>
<tr>
<td style="text-align:left">possible_key</td>
<td>显示可能应用在这张表上的索引，一个或多个。</td>
</tr>
<tr>
<td style="text-align:left">key</td>
<td>实际使用的索引，如果为NULL，则没有使用索引。</td>
</tr>
<tr>
<td style="text-align:left">key_len</td>
<td>表示索引中使用的字节数， 该值为索引字段最大可能长度，并非实际使用长 度，在不损失精确性的前提下， 长度越短越好 。</td>
</tr>
<tr>
<td style="text-align:left">rows</td>
<td>MySQL认为必须要执行查询的行数，在innodb引擎的表中，是一个估计值， 可能并不总是准确的。</td>
</tr>
<tr>
<td style="text-align:left">filtered</td>
<td>表示返回结果的行数占需读取行数的百分比， filtered 的值越大越好。</td>
</tr>
</tbody>
</table>
<hr>
<p><br><br><br></p>
<h4 id="2-6-索引的使用">2.6 索引的使用</h4>
<h5 id="2-6-1-验证索引效率">2.6.1 验证索引效率</h5>
<p>在讲解索引的使用原则之前，先通过一个简单的案例，来验证一下索引，看看是否能够通过索引来提升数据查询性能。在演示的时候，我们还是使用之前准备的一张表 tb_sku , 在这张表中准备了1000w的记录。</p>
<p><img src="/static/imgs/loading.gif" data-original="https://cdn.jsdelivr.net/gh/ggw2021/images@main/blogs/Snipaste_2024-04-12_17-18-40.png" alt=""></p>
<p>这张表中id为主键，有主键索引，而其他字段是没有建立索引的。 我们先来查询其中的一条记录，看<br>
看里面的字段情况，执行如下SQL：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tb_sku <span class="hljs-keyword">where</span> id <span class="hljs-operator">=</span> <span class="hljs-number">1</span>\G;<br></code></pre></td></tr></table></figure>
<p><img src="/static/imgs/loading.gif" data-original="https://cdn.jsdelivr.net/gh/ggw2021/images@main/blogs/Snipaste_2024-04-12_17-20-31.png" alt=""></p>
<details class="toggle" style="border: 1px solid  #edf4ee"><summary class="toggle-button" style="background-color:  #edf4ee;color:  #17181a">\G的作用 </summary><div class="toggle-content"><p>在 SQL 查询中，特别是在使用 MySQL 或类似的数据库管理系统时，末尾的 <code>\G</code> 是一个有用的修饰符，用来改变查询结果的显示方式。</p>
<p>通常，当你执行一个 <code>SELECT</code> 语句，结果会以表格形式显示，即每行数据为一个记录，每列对应一个字段。但如果在查询结束时添加 <code>\G</code>，结果将以垂直格式显示，每个字段及其值会显示在单独的一行，这使得结果更易于阅读，特别是当表中包含许多列时。</p>
<p>例如，没有使用 <code>\G</code> 的查询可能会这样显示：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">+----+------+-------+<br>| id | name | price |<br>+----+------+-------+<br>|  1 | Apple|  1.20 |<br>+----+------+-------+<br></code></pre></td></tr></table></figure>
<p>使用 <code>\G</code> 的查询会这样显示：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">*************************** 1. row ***************************<br>id: 1<br>name: Apple<br>price: 1.20<br></code></pre></td></tr></table></figure>
<p>这种格式对于调试或查看包含多个字段的单条记录非常有用，因为它使得每个字段和对应的值都非常清晰和易于区分。</p>
</div></details>
<p>可以看到即使有1000w的数据,根据id进行数据查询,性能依然很快，因为主键id是有索引的。 那么接下来，我们再来根据 sn 字段进行查询，执行如下SQL：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> tb_sku <span class="hljs-keyword">WHERE</span> sn <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;100000003145001&#x27;</span>;<br></code></pre></td></tr></table></figure>
<p><img src="/static/imgs/loading.gif" data-original="https://cdn.jsdelivr.net/gh/ggw2021/images@main/blogs/Snipaste_2024-04-12_17-23-04.png" alt=""></p>
<p>我们可以看到根据sn字段进行查询，查询返回了一条数据，结果耗时 20.78sec，就是因为sn没有索引，而造成查询效率很低。</p>
<p>那么我们可以针对于sn字段，建立一个索引，建立了索引之后，我们再次根据sn进行查询，再来看一下查询耗时情况。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">create</span> index idx_sku_sn <span class="hljs-keyword">on</span> tb_sku(sn) ;<br></code></pre></td></tr></table></figure>
<p><img src="/static/imgs/loading.gif" data-original="https://cdn.jsdelivr.net/gh/ggw2021/images@main/blogs/Snipaste_2024-04-12_17-52-45.png" alt=""></p>
<p>然后再次执行相同的SQL语句，再次查看SQL的耗时。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> tb_sku <span class="hljs-keyword">WHERE</span> sn <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;100000003145001&#x27;</span>;<br></code></pre></td></tr></table></figure>
<p><img src="/static/imgs/loading.gif" data-original="https://cdn.jsdelivr.net/gh/ggw2021/images@main/blogs/Snipaste_2024-04-12_17-53-33.png" alt=""></p>
<p>我们明显会看到，sn字段建立了索引之后，查询性能大大提升。建立索引前后，查询耗时都不是一个数量级的。</p>
<hr>
<br>
<h5 id="2-6-2-最左前缀法则">2.6.2 最左前缀法则</h5>
<p>如果索引了多列（联合索引），要遵守最左前缀法则。最左前缀法则指的是查询从索引的最左列开始，并且不跳过索引中的列。如果跳跃某一列，索引将会部分失效(后面的字段索引失效)。</p>
<p>以 tb_user 表为例，我们先来查看一下之前 tb_user 表所创建的索引。</p>
<p><img src="/static/imgs/loading.gif" data-original="https://cdn.jsdelivr.net/gh/ggw2021/images@main/blogs/Snipaste_2024-04-12_17-56-18.png" alt=""></p>
<p>在 tb_user 表中，有一个联合索引，这个联合索引涉及到三个字段，顺序分别为：profession，age，status。</p>
<p>对于最左前缀法则指的是，查询时，最左变的列，也就是profession必须存在，否则索引全部失效。而且中间不能跳过某一列，否则该列后面的字段索引将失效。 接下来，我们来演示几组案例，看一下具体的执行计划：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">explain <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tb_user <span class="hljs-keyword">where</span> profession <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;软件工程&#x27;</span> <span class="hljs-keyword">and</span> age <span class="hljs-operator">=</span> <span class="hljs-number">31</span> <span class="hljs-keyword">and</span> status <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;0&#x27;</span>;<br></code></pre></td></tr></table></figure>
<p><img src="/static/imgs/loading.gif" data-original="https://cdn.jsdelivr.net/gh/ggw2021/images@main/blogs/Snipaste_2024-04-12_17-57-50.png" alt=""></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">explain <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tb_user <span class="hljs-keyword">where</span> profession <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;软件工程&#x27;</span> <span class="hljs-keyword">and</span> age <span class="hljs-operator">=</span> <span class="hljs-number">31</span>;<br></code></pre></td></tr></table></figure>
<p><img src="/static/imgs/loading.gif" data-original="https://cdn.jsdelivr.net/gh/ggw2021/images@main/blogs/Snipaste_2024-04-12_17-58-27.png" alt=""></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">explain <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tb_user <span class="hljs-keyword">where</span> profession <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;软件工程&#x27;</span>;<br></code></pre></td></tr></table></figure>
<p><img src="/static/imgs/loading.gif" data-original="https://cdn.jsdelivr.net/gh/ggw2021/images@main/blogs/Snipaste_2024-04-12_17-59-06.png" alt=""></p>
<p>以上的这三组测试中，我们发现只要联合索引最左边的字段 profession存在，索引就会生效，只不过索引的长度不同。 而且由以上三组测试，我们也可以推测出profession字段索引长度为47、age字段索引长度为2、status字段索引长度为5。</p>
<br>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">explain <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tb_user <span class="hljs-keyword">where</span> age <span class="hljs-operator">=</span> <span class="hljs-number">31</span> <span class="hljs-keyword">and</span> status <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;0&#x27;</span>;<br></code></pre></td></tr></table></figure>
<p><img src="/static/imgs/loading.gif" data-original="https://cdn.jsdelivr.net/gh/ggw2021/images@main/blogs/Snipaste_2024-04-12_18-00-51.png" alt=""></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">explain <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tb_user <span class="hljs-keyword">where</span> status <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;0&#x27;</span>;<br></code></pre></td></tr></table></figure>
<p><img src="/static/imgs/loading.gif" data-original="https://cdn.jsdelivr.net/gh/ggw2021/images@main/blogs/Snipaste_2024-04-12_18-01-03.png" alt=""></p>
<p>而通过上面的这两组测试，我们也可以看到索引并未生效，原因是因为不满足最左前缀法则，联合索引最左边的列profession不存在</p>
<br>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">explain <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tb_user <span class="hljs-keyword">where</span> profession <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;软件工程&#x27;</span> <span class="hljs-keyword">and</span> status <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;0&#x27;</span>;<br></code></pre></td></tr></table></figure>
<p><img src="/static/imgs/loading.gif" data-original="https://cdn.jsdelivr.net/gh/ggw2021/images@main/blogs/Snipaste_2024-04-12_18-02-15.png" alt=""></p>
<p>上述的SQL查询时，存在profession字段，最左边的列是存在的，索引满足最左前缀法则的基本条件。但是查询时，跳过了age这个列，所以后面的列索引是不会使用的，也就是索引部分生效，所以索引的长度就是47。</p>
<blockquote>
<p>思考题：</p>
<p>当执行SQL语句:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">explain <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tb_user <span class="hljs-keyword">where</span> age <span class="hljs-operator">=</span> <span class="hljs-number">31</span> <span class="hljs-keyword">and</span> status <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;0&#x27;</span> <span class="hljs-keyword">and</span> profession <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;软件工程&#x27;</span>；<br></code></pre></td></tr></table></figure>
<p>时，是否满足最左前缀法则，走不走上述的联合索引，索引长度？</p>
<p><img src="/static/imgs/loading.gif" data-original="https://cdn.jsdelivr.net/gh/ggw2021/images@main/blogs/Snipaste_2024-04-12_18-04-57.png" alt=""></p>
<p>可以看到，是完全满足最左前缀法则的，索引长度54，联合索引是生效的。</p>
<p>注意 ： 最左前缀法则中指的最左边的列，是指在查询时，联合索引的最左边的字段(即是第一个字段)必须存在，与我们编写SQL时，条件编写的先后顺序无关。</p>
</blockquote>
<hr>
<br>
<h5 id="2-6-3-范围查询">2.6.3 范围查询</h5>
<p>联合索引中，出现范围查询(<code>&gt;</code>, <code>&lt;</code>)，范围查询右侧的列索引失效。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">explain <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tb_user <span class="hljs-keyword">where</span> profession <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;软件工程&#x27;</span> <span class="hljs-keyword">and</span> age <span class="hljs-operator">&gt;</span> <span class="hljs-number">30</span> <span class="hljs-keyword">and</span> status <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;0&#x27;</span>;<br></code></pre></td></tr></table></figure>
<p><img src="/static/imgs/loading.gif" data-original="https://cdn.jsdelivr.net/gh/ggw2021/images@main/blogs/Snipaste_2024-04-12_18-07-04.png" alt=""></p>
<p>当范围查询使用&gt; 或 &lt; 时，走联合索引了，但是索引的长度为49，就说明范围查询右边的status字段是没有走索引的。</p>
<br>
<p><code>&gt;=</code> 或 <code>&lt;=</code>不会导致上述结果</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">explain <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tb_user <span class="hljs-keyword">where</span> profession <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;软件工程&#x27;</span> <span class="hljs-keyword">and</span> age <span class="hljs-operator">&gt;=</span> <span class="hljs-number">30</span> <span class="hljs-keyword">and</span> status <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;0&#x27;</span>;<br></code></pre></td></tr></table></figure>
<p><img src="/static/imgs/loading.gif" data-original="https://cdn.jsdelivr.net/gh/ggw2021/images@main/blogs/Snipaste_2024-04-12_18-09-01.png" alt=""></p>
<p>当范围查询使用&gt;= 或 &lt;= 时，走联合索引了，但是索引的长度为54，就说明所有的字段都是走索引的。</p>
<blockquote>
<p>所以，在业务允许的情况下，尽可能的使用类似于 &gt;= 或 &lt;= 这类的范围查询，而避免使用 &gt; 或 &lt;。</p>
</blockquote>
<hr>
<br>
<h5 id="2-6-4-索引失效情况">2.6.4 索引失效情况</h5>
<p><strong>1. 索引列运算</strong><br>
不要在索引列上进行运算操作， 索引将失效。</p>
<p>在tb_user表中，除了前面介绍的联合索引之外，还有一个索引，是phone字段的单列索引。</p>
<p><img src="/static/imgs/loading.gif" data-original="https://cdn.jsdelivr.net/gh/ggw2021/images@main/blogs/Snipaste_2024-04-12_18-13-15.png" alt=""></p>
<p>A. 当根据phone字段进行等值匹配查询时, 索引生效。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">explain <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tb_user <span class="hljs-keyword">where</span> phone <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;17799990015&#x27;</span>;<br></code></pre></td></tr></table></figure>
<p><img src="/static/imgs/loading.gif" data-original="https://cdn.jsdelivr.net/gh/ggw2021/images@main/blogs/Snipaste_2024-04-12_18-14-35.png" alt=""></p>
<p>B. 当根据phone字段进行函数运算操作之后，索引失效。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">explain <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tb_user <span class="hljs-keyword">where</span> <span class="hljs-built_in">substring</span>(phone,<span class="hljs-number">10</span>,<span class="hljs-number">2</span>) <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;15&#x27;</span>;<br></code></pre></td></tr></table></figure>
<p><img src="/static/imgs/loading.gif" data-original="https://cdn.jsdelivr.net/gh/ggw2021/images@main/blogs/Snipaste_2024-04-12_18-14-50.png" alt=""></p>
<br>
<p><strong>2. 字符串不加引号</strong><br>
字符串类型字段使用时，不加引号，索引将失效。</p>
<p>接下来，我们通过两组示例，来看看对于字符串类型的字段，加单引号与不加单引号的区别：<br>
（status 的类型是 char）</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql">explain <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tb_user <span class="hljs-keyword">where</span> profession <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;软件工程&#x27;</span> <span class="hljs-keyword">and</span> age <span class="hljs-operator">=</span> <span class="hljs-number">31</span> <span class="hljs-keyword">and</span> status<span class="hljs-operator">=</span> <span class="hljs-string">&#x27;0&#x27;</span>;<br><br>explain <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tb_user <span class="hljs-keyword">where</span> profession <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;软件工程&#x27;</span> <span class="hljs-keyword">and</span> age <span class="hljs-operator">=</span> <span class="hljs-number">31</span> <span class="hljs-keyword">and</span> status <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br></code></pre></td></tr></table></figure>
<p><img src="/static/imgs/loading.gif" data-original="https://cdn.jsdelivr.net/gh/ggw2021/images@main/blogs/Snipaste_2024-04-12_18-17-41.png" alt=""></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql">explain <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tb_user <span class="hljs-keyword">where</span> phone <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;17799990015&#x27;</span>;<br>explain <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tb_user <span class="hljs-keyword">where</span> phone <span class="hljs-operator">=</span> <span class="hljs-number">17799990015</span>;<br></code></pre></td></tr></table></figure>
<p><img src="/static/imgs/loading.gif" data-original="https://cdn.jsdelivr.net/gh/ggw2021/images@main/blogs/Snipaste_2024-04-12_18-18-42.png" alt=""></p>
<p>经过上面两组示例，我们会明显的发现，如果字符串不加单引号，对于查询结果，没什么影响，但是<u>数据库存在隐式类型转换，索引将失效</u>。</p>
<br>
<p><strong>3. 模糊查询</strong></p>
<p>如果仅仅是尾部模糊匹配，索引不会失效。如果是头部模糊匹配，索引失效。</p>
<p>接下来，我们来看一下这三条SQL语句的执行效果，查看一下其执行计划：</p>
<p>由于下面查询语句中，都是根据profession字段查询，符合最左前缀法则，联合索引是可以生效的，我们主要看一下，模糊查询时，%加在关键字之前，和加在关键字之后的影响。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql">explain <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tb_user <span class="hljs-keyword">where</span> profession <span class="hljs-keyword">like</span> <span class="hljs-string">&#x27;软件%&#x27;</span>;<br>explain <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tb_user <span class="hljs-keyword">where</span> profession <span class="hljs-keyword">like</span> <span class="hljs-string">&#x27;%工程&#x27;</span>;<br>explain <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tb_user <span class="hljs-keyword">where</span> profession <span class="hljs-keyword">like</span> <span class="hljs-string">&#x27;%工%&#x27;</span>;<br></code></pre></td></tr></table></figure>
<p><img src="/static/imgs/loading.gif" data-original="https://cdn.jsdelivr.net/gh/ggw2021/images@main/blogs/Snipaste_2024-04-12_18-23-53.png" alt=""></p>
<p>经过上述的测试，我们发现，在like模糊查询中，在关键字后面加%，索引可以生效。而如果在关键字前面加了%，索引将会失效。</p>
<br>
<p><strong>4. or连接条件</strong></p>
<p>用or分割开的条件， 如果or前的条件中的列有索引，而后面的列中没有索引，那么涉及的索引都不会被用到。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql">explain <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tb_user <span class="hljs-keyword">where</span> id <span class="hljs-operator">=</span> <span class="hljs-number">10</span> <span class="hljs-keyword">or</span> age <span class="hljs-operator">=</span> <span class="hljs-number">23</span>;<br>explain <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tb_user <span class="hljs-keyword">where</span> phone <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;17799990017&#x27;</span> <span class="hljs-keyword">or</span> age <span class="hljs-operator">=</span> <span class="hljs-number">23</span>;<br></code></pre></td></tr></table></figure>
<p><img src="/static/imgs/loading.gif" data-original="https://cdn.jsdelivr.net/gh/ggw2021/images@main/blogs/Snipaste_2024-04-12_18-26-56.png" alt=""></p>
<p>由于age没有索引，所以即使id、phone有索引，索引也会失效。所以需要针对于age也要建立索引。</p>
<br>
<p>然后，我们可以对age字段建立索引。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">create</span> index idx_user_age <span class="hljs-keyword">on</span> tb_user(age);<br></code></pre></td></tr></table></figure>
<p>建立了索引之后，我们再次执行上述的SQL语句，看看前后执行计划的变化。</p>
<p><img src="/static/imgs/loading.gif" data-original="https://cdn.jsdelivr.net/gh/ggw2021/images@main/blogs/Snipaste_2024-04-12_18-28-10.png" alt=""></p>
<p>最终，我们发现，当or连接的条件，左右两侧字段都有索引时，索引才会生效。</p>
<br>
<p><strong>5. 数据分布影响</strong></p>
<p>如果MySQL评估使用索引比全表更慢，则不使用索引。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql">explain <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tb_user <span class="hljs-keyword">where</span> phone <span class="hljs-operator">&gt;=</span> <span class="hljs-string">&#x27;17799990005&#x27;</span>;<br>explain <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tb_user <span class="hljs-keyword">where</span> phone <span class="hljs-operator">&gt;=</span> <span class="hljs-string">&#x27;17799990015&#x27;</span>;<br></code></pre></td></tr></table></figure>
<p><img src="/static/imgs/loading.gif" data-original="https://cdn.jsdelivr.net/gh/ggw2021/images@main/blogs/Snipaste_2024-04-12_18-32-28.png" alt=""></p>
<p><img src="/static/imgs/loading.gif" data-original="https://cdn.jsdelivr.net/gh/ggw2021/images@main/blogs/Snipaste_2024-04-12_18-32-42.png" alt=""></p>
<p>经过测试我们发现，相同的SQL语句，只是传入的字段值不同，最终的执行计划也完全不一样，这是为什么呢？</p>
<p>就是因为MySQL在查询时，会评估使用索引的效率与走全表扫描的效率，如果走全表扫描更快，则放弃索引，走全表扫描。 <u>因为索引是用来索引少量数据的，如果通过索引查询返回大批量的数据，则还不如走全表扫描来的快，此时索引就会失效</u>。</p>
<br>
<p>接下来，我们再来看看 is null 与 is not null 操作是否走索引。<br>
执行如下两条语句 ：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql">explain <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tb_user <span class="hljs-keyword">where</span> profession <span class="hljs-keyword">is</span> <span class="hljs-keyword">null</span>;<br>explain <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tb_user <span class="hljs-keyword">where</span> profession <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span>;<br></code></pre></td></tr></table></figure>
<p><img src="/static/imgs/loading.gif" data-original="https://cdn.jsdelivr.net/gh/ggw2021/images@main/blogs/Snipaste_2024-04-12_18-34-36.png" alt=""></p>
<p>接下来，我们做一个操作将profession字段值全部更新为null。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">update</span> tb_user <span class="hljs-keyword">set</span> profession <span class="hljs-operator">=</span> <span class="hljs-keyword">null</span>;<br></code></pre></td></tr></table></figure>
<p>然后，再次执行上述的两条SQL，查看SQL语句的执行计划。</p>
<p><img src="/static/imgs/loading.gif" data-original="https://cdn.jsdelivr.net/gh/ggw2021/images@main/blogs/Snipaste_2024-04-12_18-38-58.png" alt=""></p>
<p>最终我们看到，一模一样的SQL语句，先后执行了两次，结果查询计划是不一样的，为什么会出现这种现象，这是和数据库的数据分布有关系。查询时MySQL会评估，走索引快，还是全表扫描快，如果全表扫描更快，则放弃索引走全表扫描。 因此，is null 、is not null是否走索引，得具体情况具体分析，并不是固定的。</p>
<hr>
<br>
<h5 id="2-6-5-SQL提示">2.6.5 SQL提示</h5>
<p>目前tb_user表的数据情况如下:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">+----+-----------+-------------+-----------------------+-----------------------------+------+--------+--------+---------------------+<br>| id | name      | phone       | email                 | profession                  | age  | gender | status | createtime          |<br>+----+-----------+-------------+-----------------------+-----------------------------+------+--------+--------+---------------------+<br>|  1 | 吕布      | 17799990000 | lvbu666@163.com       | 软件工程                      |   23 | 1      | 6      | 2001-02-02 00:00:00 |<br>|  2 | 曹操      | 17799990001 | caocao666@qq.com      | 通讯工程                      |   33 | 1      | 0      | 2001-03-05 00:00:00 |<br>|  3 | 赵云      | 17799990002 | 17799990@139.com      | 英语                         |   34 | 1      | 2      | 2002-03-02 00:00:00 |<br>|  4 | 孙悟空    | 17799990003 | 17799990@sina.com     | 工程造价                      |   54 | 1      | 0      | 2001-07-02 00:00:00 |<br>|  5 | 花木兰    | 17799990004 | 19980729@sina.com     | 软件工程                      |   23 | 2      | 1      | 2001-04-22 00:00:00 |<br>|  6 | 大乔      | 17799990005 | daqiao666@sina.com    | 舞蹈                         |   22 | 2      | 0      | 2001-02-07 00:00:00 |<br>|  7 | 露娜      | 17799990006 | luna_love@sina.com    | 应用数学                      |   24 | 2      | 0      | 2001-02-08 00:00:00 |<br>|  8 | 程咬金    | 17799990007 | chengyaojin@163.com   | 化工                          |   38 | 1      | 5      | 2001-05-23 00:00:00 |<br>|  9 | 项羽      | 17799990008 | xiaoyu666@qq.com      | 金属材料                      |   43 | 1      | 0      | 2001-09-18 00:00:00 |<br>| 10 | 白起      | 17799990009 | baiqi666@sina.com     | 机械工程及其自动化              |   27 | 1      | 2      | 2001-08-16 00:00:00 |<br>| 11 | 韩信      | 17799990010 | hanxin520@163.com     | 无机非金属材料工程              |   27 | 1      | 0      | 2001-06-12 00:00:00 |<br>| 12 | 荆轲      | 17799990011 | jingke123@163.com     | 会计                          |   29 | 1      | 0      | 2001-05-11 00:00:00 |<br>| 13 | 兰陵王    | 17799990012 | lanlinwang666@126.com | 工程造价                       |   44 | 1      | 1      | 2001-04-09 00:00:00 |<br>| 14 | 狂铁      | 17799990013 | kuangtie@sina.com     | 应用数学                      |   43 | 1      | 2      | 2001-04-10 00:00:00 |<br>| 15 | 貂蝉      | 17799990014 | 84958948374@qq.com    | 软件工程                      |   40 | 2      | 3      | 2001-02-12 00:00:00 |<br>| 16 | 妲己      | 17799990015 | 2783238293@qq.com     | 软件工程                      |   31 | 2      | 0      | 2001-01-30 00:00:00 |<br>| 17 | 芈月      | 17799990016 | xiaomin2001@sina.com  | 工业经济                      |   35 | 2      | 0      | 2000-05-03 00:00:00 |<br>| 18 | 嬴政      | 17799990017 | 8839434342@qq.com     | 化工                         |   38 | 1      | 1      | 2001-08-08 00:00:00 |<br>| 19 | 狄仁杰    | 17799990018 | jujiamlm8166@163.com  | 国际贸易                      |   30 | 1      | 0      | 2007-03-12 00:00:00 |<br>| 20 | 安琪拉    | 17799990019 | jdodm1h@126.com       | 城市规划                      |   51 | 2      | 0      | 2001-08-15 00:00:00 |<br>| 21 | 典韦      | 17799990020 | ycaunanjian@163.com   | 城市规划                      |   52 | 1      | 2      | 2000-04-12 00:00:00 |<br>| 22 | 廉颇      | 17799990021 | lianpo321@126.com     | 土木工程                      |   19 | 1      | 3      | 2002-07-18 00:00:00 |<br>| 23 | 后羿      | 17799990022 | altycj2000@139.com    | 城市园林                      |   20 | 1      | 0      | 2002-03-10 00:00:00 |<br>| 24 | 姜子牙    | 17799990023 | 37483844@qq.com       | 工程造价                      |   29 | 1      | 4      | 2003-05-26 00:00:00 |<br>+----+-----------+-------------+-----------------------+-----------------------------+------+--------+--------+---------------------+<br></code></pre></td></tr></table></figure>
<p>索引情况如下:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">+----------+------------+----------------------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+---------+------------+<br>| Table    | Non_unique | Key_name             | Seq_in_index | Column_name | Collation | Cardinality | Sub_part | Packed | Null | Index_type | Comment | Index_comment | Visible | Expression |<br>+----------+------------+----------------------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+---------+------------+<br>| tb_user_ |          0 | PRIMARY              |            1 | id          | A         |          24 |     NULL |   NULL |      | BTREE      |         |               | YES     | NULL       |<br>| tb_user_ |          0 | idx_user_phone       |            1 | phone       | A         |          24 |     NULL |   NULL |      | BTREE      |         |               | YES     | NULL       |<br>| tb_user_ |          1 | idx_user_name        |            1 | name        | A         |          24 |     NULL |   NULL |      | BTREE      |         |               | YES     | NULL       |<br>| tb_user_ |          1 | idx_user_pro_age_sta |            1 | profession  | A         |          16 |     NULL |   NULL | YES  | BTREE      |         |               | YES     | NULL       |<br>| tb_user_ |          1 | idx_user_pro_age_sta |            2 | age         | A         |          22 |     NULL |   NULL | YES  | BTREE      |         |               | YES     | NULL       |<br>| tb_user_ |          1 | idx_user_pro_age_sta |            3 | status      | A         |          24 |     NULL |   NULL | YES  | BTREE      |         |               | YES     | NULL       |<br>| tb_user_ |          1 | idx_email            |            1 | email       | A         |          24 |     NULL |   NULL | YES  | BTREE      |         |               | YES     | NULL       |<br>+----------+------------+----------------------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+---------+------------+<br></code></pre></td></tr></table></figure>
<p>把上述的 idx_user_age, idx_email 这两个之前测试使用过的索引直接删除。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">drop</span> index idx_user_age <span class="hljs-keyword">on</span> tb_user;<br><span class="hljs-keyword">drop</span> index idx_email <span class="hljs-keyword">on</span> tb_user;<br></code></pre></td></tr></table></figure>
<p><strong>A.</strong> 执行SQL :</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">explain <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tb_user <span class="hljs-keyword">where</span> profession <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;软件工程&#x27;</span>;<br></code></pre></td></tr></table></figure>
<p><img src="/static/imgs/loading.gif" data-original="https://cdn.jsdelivr.net/gh/ggw2021/images@main/blogs/Snipaste_2024-04-12_18-43-44.png" alt=""></p>
<p>查询走了联合索引。</p>
<p><strong>B.</strong> 执行SQL，创建profession的单列索引：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">create</span> index idx_user_pro <span class="hljs-keyword">on</span> tb_user(profession);  <br></code></pre></td></tr></table></figure>
<p><strong>C.</strong> 创建单列索引后，再次执行A中的SQL语句，查看执行计划，看看到底走哪个索引。</p>
<p><img src="/static/imgs/loading.gif" data-original="https://cdn.jsdelivr.net/gh/ggw2021/images@main/blogs/Snipaste_2024-04-12_18-45-10.png" alt=""></p>
<p>测试结果，我们可以看到，possible_keys中 idx_user_pro_age_sta,idx_user_pro 这两个索引都可能用到，最终MySQL选择了idx_user_pro_age_sta索引。这是MySQL自动选择的结果。</p>
<br>
<p>那么，我们能不能在查询的时候，自己来指定使用哪个索引呢？ 答案是肯定的，此时就可以借助于MySQL的SQL提示来完成。</p>
<p>接下来，介绍一下SQL提示。</p>
<br>
<p><strong>SQL提示</strong>，是优化数据库的一个重要手段，简单来说，就是在SQL语句中加入一些人为的提示来达到优化操作的目的。</p>
<p><strong>1).</strong> use index ： 建议MySQL使用哪一个索引完成此次查询（仅仅是建议，mysql内部还会再次进行评估）。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">explain <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tb_user use index(idx_user_pro) <span class="hljs-keyword">where</span> profession <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;软件工程&#x27;</span>;<br></code></pre></td></tr></table></figure>
<p><strong>2).</strong> ignore index ： 忽略指定的索引。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">explain <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tb_user ignore index(idx_user_pro) <span class="hljs-keyword">where</span> profession <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;软件工程&#x27;</span>;<br></code></pre></td></tr></table></figure>
<p><strong>3).</strong> force index ： 强制使用索引。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">explain <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tb_user force index(idx_user_pro) <span class="hljs-keyword">where</span> profession <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;软件工程&#x27;</span>;<br></code></pre></td></tr></table></figure>
<br>
<p>示例演示：<br>
<strong>A.</strong> use index</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">explain <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tb_user use index(idx_user_pro) <span class="hljs-keyword">where</span> profession <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;软件工程&#x27;</span>;<br></code></pre></td></tr></table></figure>
<p><img src="/static/imgs/loading.gif" data-original="https://cdn.jsdelivr.net/gh/ggw2021/images@main/blogs/Snipaste_2024-04-12_18-58-07.png" alt=""></p>
<p><strong>B.</strong> ignore index</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">explain <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tb_user ignore index(idx_user_pro) <span class="hljs-keyword">where</span> profession <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;软件工程&#x27;</span>;<br></code></pre></td></tr></table></figure>
<p><img src="/static/imgs/loading.gif" data-original="https://cdn.jsdelivr.net/gh/ggw2021/images@main/blogs/Snipaste_2024-04-12_18-58-38.png" alt=""></p>
<p><strong>C.</strong> force index</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">explain <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tb_user force index(idx_user_pro_age_sta) <span class="hljs-keyword">where</span> profession <span class="hljs-operator">=</span><span class="hljs-string">&#x27;软件工程&#x27;</span>;<br></code></pre></td></tr></table></figure>
<p><img src="/static/imgs/loading.gif" data-original="https://cdn.jsdelivr.net/gh/ggw2021/images@main/blogs/Snipaste_2024-04-12_18-59-49.png" alt=""></p>
<hr>
<br>
<h5 id="2-6-6-覆盖索引">2.6.6 覆盖索引</h5>
<p>尽量使用覆盖索引，减少select *。 那么什么是覆盖索引呢？</p>
<p><u>覆盖索引是指查询使用了索引，并且需要返回的列，在该索引中已经全部能够找到</u> 。</p>
<p>接下来，我们来看一组SQL的执行计划，看看执行计划的差别，然后再来具体做一个解析。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sql">explain <span class="hljs-keyword">select</span> id, profession <span class="hljs-keyword">from</span> tb_user <br><span class="hljs-keyword">where</span> profession <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;软件工程&#x27;</span> <span class="hljs-keyword">and</span> age <span class="hljs-operator">=</span> <span class="hljs-number">31</span> <span class="hljs-keyword">and</span> status <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;0&#x27;</span> ;<br><br>explain <span class="hljs-keyword">select</span> id,profession,age, status <span class="hljs-keyword">from</span> tb_user <br><span class="hljs-keyword">where</span> profession <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;软件工程&#x27;</span> <span class="hljs-keyword">and</span> age <span class="hljs-operator">=</span> <span class="hljs-number">31</span> <span class="hljs-keyword">and</span> status <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;0&#x27;</span> ;<br><br>explain <span class="hljs-keyword">select</span> id,profession,age, status, name <span class="hljs-keyword">from</span> tb_user <br><span class="hljs-keyword">where</span> profession <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;软件工程&#x27;</span> <span class="hljs-keyword">and</span> age <span class="hljs-operator">=</span> <span class="hljs-number">31</span> <span class="hljs-keyword">and</span> status <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;0&#x27;</span> ;<br><br>explain <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tb_user <br><span class="hljs-keyword">where</span> profession <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;软件工程&#x27;</span> <span class="hljs-keyword">and</span> age <span class="hljs-operator">=</span> <span class="hljs-number">31</span> <span class="hljs-keyword">and</span> status <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;0&#x27;</span>;<br></code></pre></td></tr></table></figure>
<p>上述这几条SQL的执行结果为:</p>
<p><img src="/static/imgs/loading.gif" data-original="https://cdn.jsdelivr.net/gh/ggw2021/images@main/blogs/Snipaste_2024-04-12_19-08-57.png" alt=""></p>
<p>从上述的执行计划我们可以看到，这四条SQL语句的执行计划前面所有的指标都是一样的，看不出来差异。但是此时，我们主要关注的是后面的Extra，前面两条SQL的结果为 Using where; Using Index ; 而后面两条SQL的结果为: Using index condition 。</p>
<table>
<thead>
<tr>
<th style="text-align:left">Extra</th>
<th style="text-align:left">含义</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">Using where; Using Index</td>
<td style="text-align:left">查找使用了索引，但是需要的数据都在索引列中能找到，所以不需要回表查询数据</td>
</tr>
<tr>
<td style="text-align:left">Using index condition</td>
<td style="text-align:left">查找使用了索引，但是需要回表查询数据</td>
</tr>
</tbody>
</table>
<p>因为，在tb_user表中有一个联合索引 idx_user_pro_age_sta，该索引关联了三个字段profession、age、status，而这个索引也是一个二级索引，所以叶子节点下面挂的是这一行的主键id。 所以当我们查询返回的数据在 id、profession、age、status 之中，则直接走二级索引直接返回数据了。 如果超出这个范围，就需要拿到主键id，再去扫描聚集索引，再获取额外的数据了，这个过程就是回表。 而我们如果一直使用select * 查询返回所有字段值，很容易就会造成回表查询（除非是根据主键查询，此时只会扫描聚集索引）。</p>
<br>
<p>为了大家更清楚的理解，什么是覆盖索引，什么是回表查询，我们一起再来看下面的这组SQL的执行过程。<br>
<strong>A.</strong> 表结构及索引示意图:</p>
<p><img src="/static/imgs/loading.gif" data-original="https://cdn.jsdelivr.net/gh/ggw2021/images@main/blogs/Snipaste_2024-04-12_19-12-08.png" alt=""></p>
<p><img src="/static/imgs/loading.gif" data-original="https://cdn.jsdelivr.net/gh/ggw2021/images@main/blogs/Snipaste_2024-04-12_19-12-20.png" alt=""></p>
<p>id是主键，是一个聚集索引。 name字段建立了普通索引，是一个二级索引（辅助索引）。</p>
<p><strong>B.</strong> 执行SQL :</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> tb_user <span class="hljs-keyword">where</span> id <span class="hljs-operator">=</span> <span class="hljs-number">2</span>;<br></code></pre></td></tr></table></figure>
<p>根据id查询，直接走聚集索引查询，一次索引扫描，直接返回数据，性能高。</p>
<p><strong>C.</strong> 执行SQL：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">selet id, name <span class="hljs-keyword">from</span> tb_user <span class="hljs-keyword">where</span> name <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;Arm&#x27;</span>;  <br></code></pre></td></tr></table></figure>
<p>虽然是根据name字段查询，查询二级索引，但是由于查询返回在字段为 id，name，在name的二级索引中，这两个值都是可以直接获取到的，因为覆盖索引，所以不需要回表查询，性能高。</p>
<p><strong>D.</strong> 执行SQL：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">selet id,name,gender <span class="hljs-keyword">from</span> tb_user <span class="hljs-keyword">where</span> name <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;Arm&#x27;</span>;  <br></code></pre></td></tr></table></figure>
<p>由于在name的二级索引中，不包含gender，所以，需要两次索引扫描，也就是需要回表查询，性能相对较差一点。</p>
<blockquote>
<p>思考题：<br>
一张表, 有四个字段(id, username, password, status), 由于数据量大, 需要对以下SQL语句进行优化, 该如何进行才是最优方案:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> id,username, password <span class="hljs-keyword">from</span> tb_user <span class="hljs-keyword">where</span> username <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;itcast&#x27;</span>;<br></code></pre></td></tr></table></figure>
<p>答案: 针对于 username, password建立联合索引, sql为:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">create</span> index idx_user_name_pass <span class="hljs-keyword">on</span> tb_user(username,password);<br></code></pre></td></tr></table></figure>
<p>这样可以避免上述的SQL语句，在查询的过程中，出现回表查询。</p>
</blockquote>
<hr>
<br>
<h5 id="2-6-7-前缀索引">2.6.7 前缀索引</h5>
<p>当字段类型为字符串（varchar，text，longtext等）时，有时候需要索引很长的字符串，这会让索引变得很大，查询时，浪费大量的磁盘IO， 影响查询效率。此时可以只将字符串的一部分前缀，建立索引，这样可以大大节约索引空间，从而提高索引效率。</p>
<p><strong>1).</strong> 语法</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">create</span> index idx_xxxx <span class="hljs-keyword">on</span> table_name(<span class="hljs-keyword">column</span>(n)) ;<br></code></pre></td></tr></table></figure>
<p>示例:</p>
<p>为tb_user表的email字段，建立长度为5的前缀索引。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">create</span> index idx_email_5 <span class="hljs-keyword">on</span> tb_user(email(<span class="hljs-number">5</span>));<br></code></pre></td></tr></table></figure>
<p><img src="/static/imgs/loading.gif" data-original="https://cdn.jsdelivr.net/gh/ggw2021/images@main/blogs/Snipaste_2024-04-12_19-18-38.png" alt=""></p>
<p>NULL表示全部使用</p>
<br>
<p><strong>2).</strong> 前缀长度</p>
<p>可以根据索引的选择性来决定，而选择性是指不重复的索引值（基数）和数据表的记录总数的比值，索引选择性越高则查询效率越高；</p>
<p>唯一索引的选择性是1，这是最好的索引选择性，性能也是最好的。</p>
<p>求取选择性：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-built_in">count</span>(<span class="hljs-keyword">distinct</span> email) <span class="hljs-operator">/</span> <span class="hljs-built_in">count</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">from</span> tb_user ;<br><span class="hljs-keyword">select</span> <span class="hljs-built_in">count</span>(<span class="hljs-keyword">distinct</span> <span class="hljs-built_in">substring</span>(email,<span class="hljs-number">1</span>,<span class="hljs-number">5</span>)) <span class="hljs-operator">/</span> <span class="hljs-built_in">count</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">from</span> tb_user ;前<br></code></pre></td></tr></table></figure>
<br>
<p><strong>3).</strong> 前缀索引的查询流程</p>
<p><img src="/static/imgs/loading.gif" data-original="https://cdn.jsdelivr.net/gh/ggw2021/images@main/blogs/Snipaste_2024-04-12_19-30-58.png" alt=""></p>
<hr>
<br>
<h5 id="2-6-8-单列索引与联合索引">2.6.8 单列索引与联合索引</h5>
<p>单列索引：即一个索引只包含单个列。<br>
联合索引：即一个索引包含了多个列。</p>
<p>我们先来看看 tb_user 表中目前的索引情况:</p>
<p><img src="/static/imgs/loading.gif" data-original="https://cdn.jsdelivr.net/gh/ggw2021/images@main/blogs/Snipaste_2024-04-12_19-35-09.png" alt=""></p>
<p>在查询出来的索引中，既有单列索引，又有联合索引。</p>
<p>接下来，我们来执行一条SQL语句，看看其执行计划：</p>
<p><img src="/static/imgs/loading.gif" data-original="https://cdn.jsdelivr.net/gh/ggw2021/images@main/blogs/Snipaste_2024-04-12_19-36-18.png" alt=""></p>
<p>通过上述执行计划我们可以看出来，在and连接的两个字段 phone、name上都是有单列索引的，但是<br>
最终mysql只会选择一个索引，也就是说，只能走一个字段的索引，此时是会回表查询的。</p>
<p>紧接着，我们再来创建一个phone和name字段的联合索引来查询一下执行计划</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">create</span> <span class="hljs-keyword">unique</span> index idx_user_phone_name <span class="hljs-keyword">on</span> tb_user(phone,name);<br></code></pre></td></tr></table></figure>
<p><img src="/static/imgs/loading.gif" data-original="https://cdn.jsdelivr.net/gh/ggw2021/images@main/blogs/Snipaste_2024-04-12_19-37-58.png" alt=""></p>
<p>此时，查询时，就走了联合索引，而在联合索引中包含 phone、name的信息，在叶子节点下挂的是对<br>
应的主键id，所以查询是无需回表查询的。</p>
<blockquote>
<p>在业务场景中，如果存在多个查询条件，考虑针对于查询字段建立索引时，建议建立联合索引，而非单列索引。</p>
</blockquote>
<p>如果查询使用的是联合索引，具体的结构示意图如下：</p>
<p><img src="/static/imgs/loading.gif" data-original="https://cdn.jsdelivr.net/gh/ggw2021/images@main/blogs/Snipaste_2024-04-12_19-38-49.png" alt=""></p>
<hr>
<p><br><br><br></p>
<h4 id="2-7-索引设计原则">2.7 索引设计原则</h4>
<ol>
<li>针对于<u>数据量较大</u>，且<u>查询比较频繁</u>的表建立索引。</li>
<li>针对于<u>常作为查询条件</u>（where）、排序（order by）、分组（group by）操作的<u>字段</u>建立索引。</li>
<li>尽量选择<u>区分度高</u>的列作为索引，尽量建立唯一索引，区分度越高，使用索引的效率越高。</li>
<li>如果是<u>字符串类型</u>的字段，字段的长度较长，可以针对于字段的特点，建立<u>前缀索引</u>。</li>
<li><u>尽量使用联合索引，减少单列索引</u>，查询时，联合索引很多时候可以覆盖索引，节省存储空间，避免回表，提高查询效率。</li>
<li>要<u>控制索引的数量</u>，索引并不是多多益善，索引越多，维护索引结构的代价也就越大，<u>会影响增删改的效率</u>。</li>
<li><u>如果索引列不能存储NULL值，请在创建表时使用NOT NULL约束它</u>。当优化器知道每列是否包含NULL值时，它可以更好地确定哪个索引最有效地用于查询。</li>
</ol>
<hr>
<p><br><br><br></p>
<h3 id="3-SQL优化（未学）">3. SQL优化（未学）</h3>
<hr>
<p><br><br><br></p>
<h3 id="4-视图（未学）">4. 视图（未学）</h3>
<hr>
<p><br><br><br></p>
<h3 id="5-存储过程（未学）">5. 存储过程（未学）</h3>
<hr>
<p><br><br><br></p>
<h3 id="6-触发器（未学）">6. 触发器（未学）</h3>
<hr>
<p><br><br><br></p>
<h3 id="7-锁">7. 锁</h3>
<blockquote>
<p>锁是计算机协调多个进程或线程并发访问某一资源的机制。在数据库中，除传统的计算资源（CPU、RAM、I/O）的争用以外，数据也是一种供许多用户共享的资源。如何保证数据并发访问的一致性、有效性是所有数据库必须解决的一个问题，锁冲突也是影响数据库并发访问性能的一个重要因素。从这个角度来说，锁对数据库而言显得尤其重要，也更加复杂。</p>
<p>MySQL中的锁，按照锁的粒度分，分为以下三类：</p>
<ul>
<li><strong>全局锁</strong>：锁定数据库中的所有表。</li>
<li><strong>表级锁</strong>：每次操作锁住整张表。</li>
<li><strong>行级锁</strong>：每次操作锁住对应的行数据。</li>
</ul>
</blockquote>
<br>
<h4 id="7-1-全局锁">7.1 全局锁</h4>
<ul>
<li><strong><u>介绍</u></strong></li>
</ul>
<p>全局锁就是对整个数据库实例加锁，加锁后整个实例就处于只读状态，后续的DML的写语句，DDL语句，已经更新操作的事务提交语句都将被阻塞。</p>
<p>其典型的使用场景是做全库的逻辑备份，对所有的表进行锁定，从而获取一致性视图，保证数据的完整性。</p>
<br>
<p>为什么全库逻辑备份，就需要加全局锁呢？</p>
<p><strong>A.</strong> 我们一起先来分析一下不加全局锁，可能存在的问题。</p>
<p>假设在数据库中存在这样三张表:<br>
tb_stock 库存表，<br>
tb_order 订单表，<br>
tb_orderlog 订单日志表。</p>
<p><img src="/static/imgs/loading.gif" data-original="https://cdn.jsdelivr.net/gh/ggw2021/images@main/blogs/Snipaste_2024-04-12_21-11-37.png" alt=""></p>
<ol>
<li>在进行数据备份时，先备份了tb_stock库存表。</li>
<li>然后接下来，在业务系统中，执行了下单操作，扣减库存，生成订单（更新tb_stock表，插入tb_order表）。</li>
<li>然后再执行备份 tb_order表的逻辑。</li>
<li>业务中执行插入订单日志操作。</li>
<li>最后，又备份了tb_orderlog表。</li>
</ol>
<p>此时备份出来的数据，是存在问题的。因为备份出来的数据，tb_stock表与tb_order表的数据不一致(有最新操作的订单信息,但是库存数没减)。</p>
<p>那如何来规避这种问题呢? 此时就可以借助于MySQL的全局锁来解决。</p>
<br>
<p><strong>B.</strong> 再来分析一下加了全局锁后的情况</p>
<p><img src="/static/imgs/loading.gif" data-original="https://cdn.jsdelivr.net/gh/ggw2021/images@main/blogs/Snipaste_2024-04-12_21-13-32.png" alt="">对数据库进行进行逻辑备份之前，先对整个数据库加上全局锁，一旦加了全局锁之后，其他的DDL、DML全部都处于阻塞状态，但是可以执行DQL语句，也就是处于只读状态，而数据备份就是查询操作。那么数据在进行逻辑备份的过程中，数据库中的数据就是不会发生变化的，这样就保证了数据的一致性和完整性。</p>
<hr>
<br>
<ul>
<li><strong><u>语法</u></strong></li>
</ul>
<p><strong>1).</strong> 加全局锁</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">flush tables <span class="hljs-keyword">with</span> read lock;<br></code></pre></td></tr></table></figure>
<p><strong>2).</strong> 数据备份</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">mysqldump -uroot –p1234 itcast &gt; itcast.sql<br></code></pre></td></tr></table></figure>
<p>数据备份的相关指令, 在后面MySQL管理章节, 还会详细讲解.</p>
<p><strong>3).</strong> 释放锁</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">unlock tables;<br></code></pre></td></tr></table></figure>
<hr>
<br>
<ul>
<li><strong><u>特点</u></strong></li>
</ul>
<p>数据库中加全局锁，是一个比较重的操作，存在以下问题：</p>
<ul>
<li>如果在主库上备份，那么在备份期间都不能执行更新，业务基本上就得停摆。</li>
<li>如果在从库上备份，那么在备份期间从库不能执行主库同步过来的二进制日志（binlog），会导<br>
致主从延迟。</li>
</ul>
<blockquote>
<p>在InnoDB引擎中，我们可以在备份时加上参数 <code>--single-transaction</code> 参数来完成不加锁的一致性数据备份。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">mysqldump --single-transaction -uroot –p123456 itcast &gt; itcast.sql<br></code></pre></td></tr></table></figure>
</blockquote>
<hr>
<p><br><br><br></p>
<h4 id="7-2-表级锁">7.2 表级锁</h4>
<ul>
<li><strong><u>介绍</u></strong></li>
</ul>
<p>表级锁，每次操作锁住整张表。锁定粒度大，发生锁冲突的概率最高，并发度最低。应用在MyISAM、<br>
InnoDB、BDB等存储引擎中。</p>
<p>对于表级锁，主要分为以下三类：</p>
<ul>
<li>表锁</li>
<li>元数据锁（meta data lock，MDL）</li>
<li>意向锁</li>
</ul>
<hr>
<br>
<ul>
<li><strong><u>表锁</u></strong></li>
</ul>
<p>对于表锁，分为两类：</p>
<ul>
<li>表共享读锁（read lock）</li>
<li>表独占写锁（write lock）</li>
</ul>
<br>
<p><strong>语法</strong>：</p>
<p>加锁：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">lock tables 表名... read<span class="hljs-operator">/</span>write;<br></code></pre></td></tr></table></figure>
<p>释放锁：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">unlock tables; <span class="hljs-operator">/</span> 客户端断开连接（自动释放） <br></code></pre></td></tr></table></figure>
<br>
<p><strong>特点</strong>:</p>
<p><strong>A.</strong> 读锁</p>
<p><img src="/static/imgs/loading.gif" data-original="https://cdn.jsdelivr.net/gh/ggw2021/images@main/blogs/Snipaste_2024-04-12_21-29-48.png" alt=""></p>
<p>左侧为客户端一，对指定表加了读锁，不会影响右侧客户端二的读，但是会阻塞右侧客户端的写。</p>
<p>测试:</p>
<p><img src="/static/imgs/loading.gif" data-original="https://cdn.jsdelivr.net/gh/ggw2021/images@main/blogs/Snipaste_2024-04-12_21-31-12.png" alt=""></p>
<br>
<p><strong>B.</strong> 写锁</p>
<p><img src="/static/imgs/loading.gif" data-original="https://cdn.jsdelivr.net/gh/ggw2021/images@main/blogs/Snipaste_2024-04-12_21-32-25.png" alt=""></p>
<p>左侧为客户端一，对指定表加了写锁，会阻塞右侧客户端的读和写，但是自己可以读写。</p>
<p><img src="/static/imgs/loading.gif" data-original="https://cdn.jsdelivr.net/gh/ggw2021/images@main/blogs/Snipaste_2024-04-12_21-31-59.png" alt=""></p>
<blockquote>
<p>结论: 读锁不会阻塞其他客户端的读，但是会阻塞写。写锁既会阻塞其他客户端的读，又会阻塞其他客户端的写。</p>
</blockquote>
<hr>
<br>  
<ul>
<li><strong><u>元数据锁</u></strong></li>
</ul>
<p>meta data lock , 元数据锁，简写MDL。</p>
<p>MDL加锁过程是系统自动控制，无需显式使用，在访问一张表的时候会自动加上。MDL锁主要作用是维护表元数据的数据一致性，在表上有活动事务的时候，不可以对元数据进行写入操作。<strong>为了避免DML与DDL冲突，保证读写的正确性</strong>。</p>
<p>这里的元数据，大家可以简单理解为就是一张表的表结构。 也就是说，某一张表涉及到未提交的事务时，是不能够修改这张表的表结构的。</p>
<p>在MySQL5.5中引入了MDL，当对一张表进行增删改查的时候，加MDL读锁(共享)；当对表结构进行变更操作的时候，加MDL写锁(排他)。</p>
<p>常见的SQL操作时，所添加的元数据锁：</p>
<table>
<thead>
<tr>
<th style="text-align:left">对应SQL</th>
<th style="text-align:left">锁类型</th>
<th style="text-align:left">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">lock tables xxx read / write</td>
<td style="text-align:left">SHARED_READ_ONLY / SHARED_NO_READ_WRITE</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">select 、select … lock in share mode</td>
<td style="text-align:left">SHARED_READ</td>
<td style="text-align:left">与SHARED_READ、 SHARED_WRITE兼容，与 EXCLUSIVE互斥</td>
</tr>
<tr>
<td style="text-align:left">insert 、update、 delete、select … for update</td>
<td style="text-align:left">SHARED_WRITE</td>
<td style="text-align:left">与SHARED_READ、 SHARED_WRITE兼容，与 EXCLUSIVE互斥</td>
</tr>
<tr>
<td style="text-align:left">alter table …</td>
<td style="text-align:left">EXCLUSIVE</td>
<td style="text-align:left">与其他的MDL都互斥</td>
</tr>
</tbody>
</table>
<details class="toggle" style="border: 1px solid  #edf4ee"><summary class="toggle-button" style="background-color:  #edf4ee;color:  #17181a">解释表格 </summary><div class="toggle-content"><ol>
<li>
<p><strong><code>lock tables xxx read / write</code></strong></p>
<ul>
<li><strong>锁类型</strong>：
<ul>
<li><code>SHARED_READ_ONLY</code>：当你用 <code>lock tables xxx read</code> 时，表示这个表被加上共享锁，其他会话可以读表，但不能写。</li>
<li><code>SHARED_NO_READ_WRITE</code>：当你用 <code>lock tables xxx write</code> 时，表示这个表被加上排它锁，其他会话既不能读也不能写。</li>
</ul>
</li>
<li><strong>说明</strong>：这个命令用于在会话中对表加锁，直到会话结束或者锁被显式释放。</li>
</ul>
</li>
<li>
<p><strong><code>select 、select ... lock in share mode</code></strong></p>
<ul>
<li><strong>锁类型</strong>：<code>SHARED_READ</code></li>
<li><strong>说明</strong>：纯粹的 <code>SELECT</code> 不加锁。但如果使用 <code>SELECT ... LOCK IN SHARE MODE</code>，则在读取的行上加上共享锁，其他事务可以读这些行，但在没有额外的共享锁的情况下不能修改这些行。与其他共享锁兼容，但与排它锁互斥。</li>
</ul>
</li>
<li>
<p><strong><code>insert 、update、 delete、select ... for update</code></strong></p>
<ul>
<li><strong>锁类型</strong>：<code>SHARED_WRITE</code></li>
<li><strong>说明</strong>：这些操作通常需要修改表中的数据。<code>SELECT ... FOR UPDATE</code> 在读取的行上加排它锁，防止其他事务读取或修改这些行直到当前事务完成。虽然叫<code>SHARED_WRITE</code>，但实际上更像是对修改操作的排他控制。</li>
</ul>
</li>
<li>
<p><strong><code>alter table ...</code></strong></p>
<ul>
<li><strong>锁类型</strong>：<code>EXCLUSIVE</code></li>
<li><strong>说明</strong>：<code>ALTER TABLE</code> 操作通常需要对表进行结构上的修改，这需要加上排它锁，这时其他的所有操作（读、写等）都会被阻塞，直到修改完成。</li>
</ul>
</li>
</ol>
</div></details>
<br>
<p>演示：<br>
当执行SELECT、INSERT、UPDATE、DELETE等语句时，添加的是元数据共享锁（SHARED_READ / SHARED_WRITE），之间是兼容的。</p>
<p><img src="/static/imgs/loading.gif" data-original="https://cdn.jsdelivr.net/gh/ggw2021/images@main/blogs/Snipaste_2024-04-12_22-27-07.png" alt=""></p>
<p>当执行SELECT语句时，添加的是元数据共享锁（SHARED_READ），会阻塞元数据排他锁（EXCLUSIVE），之间是互斥的。</p>
<p><img src="/static/imgs/loading.gif" data-original="https://cdn.jsdelivr.net/gh/ggw2021/images@main/blogs/Snipaste_2024-04-12_22-27-32.png" alt=""></p>
<p>我们可以通过下面的SQL，来查看数据库中的元数据锁的情况：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> object_type,object_schema,object_name,lock_type,lock_duration <br><span class="hljs-keyword">from</span> performance_schema.metadata_locks ;<br></code></pre></td></tr></table></figure>
<p><img src="/static/imgs/loading.gif" data-original="https://cdn.jsdelivr.net/gh/ggw2021/images@main/blogs/Snipaste_2024-04-12_22-27-50.png" alt=""></p>
<hr>
<br>
<ul>
<li><strong><u>意向锁</u></strong></li>
</ul>
<p><strong>1).</strong> 介绍</p>
<p>为了避免DML在执行时，加的行锁与表锁的冲突，在InnoDB中引入了意向锁，使得表锁不用检查每行数据是否加锁，使用意向锁来减少表锁的检查。</p>
<p>假如没有意向锁，客户端一对表加了行锁后，客户端二如何给表加表锁呢，来通过示意图简单分析一下：</p>
<p>首先客户端一，开启一个事务，然后执行DML操作，在执行DML语句时，会对涉及到的行加行锁。</p>
<p><img src="/static/imgs/loading.gif" data-original="https://cdn.jsdelivr.net/gh/ggw2021/images@main/blogs/Snipaste_2024-04-12_22-30-44.png" alt=""></p>
<p>当客户端二，想对这张表加表锁时，会检查当前表是否有对应的行锁，如果没有，则添加表锁，此时就会从第一行数据，检查到最后一行数据，效率较低。</p>
<p><img src="/static/imgs/loading.gif" data-original="https://cdn.jsdelivr.net/gh/ggw2021/images@main/blogs/Snipaste_2024-04-12_22-31-36.png" alt=""></p>
<br>
<p>有了意向锁之后 :<br>
客户端一，在执行DML操作时，会对涉及的行加行锁，同时也会对该表加上意向锁。</p>
<p><img src="/static/imgs/loading.gif" data-original="https://cdn.jsdelivr.net/gh/ggw2021/images@main/blogs/Snipaste_2024-04-12_22-32-21.png" alt=""></p>
<p>而其他客户端，在对这张表加表锁的时候，会根据该表上所加的意向锁来判定是否可以成功加表锁，而不用逐行判断行锁情况了。加锁类型不冲突则加锁成功，冲突则线程B阻塞。</p>
<p><img src="/static/imgs/loading.gif" data-original="https://cdn.jsdelivr.net/gh/ggw2021/images@main/blogs/Snipaste_2024-04-12_22-32-41.png" alt=""></p>
<br>
<p><strong>2).</strong> 分类</p>
<p>意向共享锁(IS): 由语句<code>select ... lock in share mode</code>添加 。 与表锁共享锁(read)兼容，与表锁排他锁(write)互斥。</p>
<p>意向排他锁(IX): 由<code>insert、update、delete、select...for update</code>添加 。与表锁共享锁(read)及排他锁(write)都互斥，意向锁之间不会互斥。</p>
<blockquote>
<p>一旦事务提交了，意向共享锁、意向排他锁，都会自动释放。</p>
</blockquote>
<p>可以通过以下SQL，查看意向锁及行锁的加锁情况:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> object_schema,object_name,index_name,lock_type,lock_mode,lock_data <br><span class="hljs-keyword">from</span> performance_schema.data_locks;<br></code></pre></td></tr></table></figure>
<br>
<p>演示：<br>
<strong>A.</strong> 意向共享锁与表读锁是兼容的</p>
<p><img src="/static/imgs/loading.gif" data-original="https://cdn.jsdelivr.net/gh/ggw2021/images@main/blogs/Snipaste_2024-04-12_22-36-32.png" alt=""></p>
<p><strong>B.</strong> 意向排他锁与表读锁、写锁都是互斥的</p>
<p><img src="/static/imgs/loading.gif" data-original="https://cdn.jsdelivr.net/gh/ggw2021/images@main/blogs/Snipaste_2024-04-12_22-36-46.png" alt=""></p>
<hr>
<p><br><br><br></p>
<h4 id="7-3-行级锁">7.3 行级锁</h4>
<blockquote>
<p>行级锁，每次操作锁住对应的行数据。锁定粒度最小，发生锁冲突的概率最低，并发度最高。应用在InnoDB存储引擎中。</p>
<p>InnoDB的数据是基于索引组织的，行锁是通过对索引上的索引项加锁来实现的，而不是对记录加的锁。对于行级锁，主要分为以下三类：</p>
<ul>
<li>
<p><strong>行锁</strong>（Record Lock）：锁定单个行记录的锁，防止其他事务对此行进行update和delete。在RC、RR隔离级别下都支持。</p>
<p><img src="/static/imgs/loading.gif" data-original="https://cdn.jsdelivr.net/gh/ggw2021/images@main/blogs/Snipaste_2024-04-12_22-55-30.png" alt=""></p>
</li>
<li>
<p><strong>间隙锁</strong>（Gap Lock）：锁定索引记录间隙（不含该记录），确保索引记录间隙不变，防止其他事务在这个间隙进行insert，产生幻读。在RR隔离级别下都支持。</p>
<p><img src="/static/imgs/loading.gif" data-original="https://cdn.jsdelivr.net/gh/ggw2021/images@main/blogs/Snipaste_2024-04-12_22-56-00.png" alt=""></p>
</li>
<li>
<p><strong>临键锁</strong>（Next-Key Lock）：行锁和间隙锁组合，同时锁住数据，并锁住数据前面的间隙Gap。在RR隔离级别下支持。</p>
<p><img src="/static/imgs/loading.gif" data-original="https://cdn.jsdelivr.net/gh/ggw2021/images@main/blogs/Snipaste_2024-04-12_22-56-22.png" alt=""></p>
</li>
</ul>
</blockquote>
<hr>
<br>
<ul>
<li><strong><u>行锁</u></strong></li>
</ul>
<p><strong>1).</strong> 介绍</p>
<p>InnoDB实现了以下两种类型的行锁：</p>
<ol>
<li><strong>共享锁</strong>（S）：允许一个事务去读一行，阻止其他事务获得相同数据集的排它锁。<br>
简单说就是共享锁和共享锁兼容，共享锁和排他锁互斥。</li>
<li><strong>排他锁</strong>（X）：允许获取排他锁的事务更新数据，阻止其他事务获得相同数据集的共享锁和排他锁。<br>
简单说就是排他锁和共享锁互斥，排他锁和排他锁互斥。</li>
</ol>
<p>两种行锁的兼容情况如下:</p>
<table>
<thead>
<tr>
<th style="text-align:center"></th>
<th style="text-align:center">共享锁 S</th>
<th style="text-align:center">排他锁 X</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><strong>共享锁 S</strong></td>
<td style="text-align:center">兼容</td>
<td style="text-align:center">冲突</td>
</tr>
<tr>
<td style="text-align:center"><strong>排他锁 X</strong></td>
<td style="text-align:center">冲突</td>
<td style="text-align:center">冲突</td>
</tr>
</tbody>
</table>
<br>
<p>常见的SQL语句，在执行时，所加的行锁如下：</p>
<table>
<thead>
<tr>
<th style="text-align:left">SQL</th>
<th style="text-align:left">行锁类型</th>
<th style="text-align:left">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">INSERT …</td>
<td style="text-align:left">排他锁</td>
<td style="text-align:left">自动加锁</td>
</tr>
<tr>
<td style="text-align:left">UPDATE …</td>
<td style="text-align:left">排他锁</td>
<td style="text-align:left">自动加锁</td>
</tr>
<tr>
<td style="text-align:left">DELETE …</td>
<td style="text-align:left">排他锁</td>
<td style="text-align:left">自动加锁</td>
</tr>
<tr>
<td style="text-align:left">SELECT（正常）</td>
<td style="text-align:left">不加任何锁</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">SELECT … LOCK IN SHARE MODE</td>
<td style="text-align:left">共享锁</td>
<td style="text-align:left">需要手动在SELECT之后加LOCK IN SHARE MODE</td>
</tr>
<tr>
<td style="text-align:left">SELECT … FOR UPDATE</td>
<td style="text-align:left">排他锁</td>
<td style="text-align:left">需要手动在SELECT之后加FOR UPDATE</td>
</tr>
</tbody>
</table>
<br>
<p><strong>2).</strong> 演示</p>
<p>默认情况下，InnoDB在 REPEATABLE READ事务隔离级别运行，InnoDB使用 next-key 锁进行搜索和索引扫描，以防止幻读。</p>
<ul>
<li>针对唯一索引进行检索时，对已存在的记录进行等值匹配时，将会自动优化为行锁。</li>
<li>InnoDB的行锁是针对于索引加的锁，不通过索引条件检索数据，那么InnoDB将对表中的所有记录加锁，此时 就会升级为表锁。</li>
</ul>
<p>可以通过以下SQL，查看意向锁及行锁的加锁情况：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> object_schema,object_name,index_name,lock_type,lock_mode,lock_data <br><span class="hljs-keyword">from</span> performance_schema.data_locks;<br></code></pre></td></tr></table></figure>
<br>
<p>示例演示 ：</p>
<details class="toggle" style="border: 1px solid  #edf4ee"><summary class="toggle-button" style="background-color:  #edf4ee;color:  #17181a">数据准备 </summary><div class="toggle-content"><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `stu` (<br>    `id` <span class="hljs-type">int</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">PRIMARY</span> KEY AUTO_INCREMENT,<br>    `name` <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,<br>    `age` <span class="hljs-type">int</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span><br>) ENGINE <span class="hljs-operator">=</span> InnoDB <span class="hljs-type">CHARACTER</span> <span class="hljs-keyword">SET</span> <span class="hljs-operator">=</span> utf8mb4;<br><br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> `stu` <span class="hljs-keyword">VALUES</span> (<span class="hljs-number">1</span>, <span class="hljs-string">&#x27;tom&#x27;</span>, <span class="hljs-number">1</span>);<br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> `stu` <span class="hljs-keyword">VALUES</span> (<span class="hljs-number">3</span>, <span class="hljs-string">&#x27;cat&#x27;</span>, <span class="hljs-number">3</span>);<br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> `stu` <span class="hljs-keyword">VALUES</span> (<span class="hljs-number">8</span>, <span class="hljs-string">&#x27;rose&#x27;</span>, <span class="hljs-number">8</span>);<br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> `stu` <span class="hljs-keyword">VALUES</span> (<span class="hljs-number">11</span>, <span class="hljs-string">&#x27;jetty&#x27;</span>, <span class="hljs-number">11</span>);<br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> `stu` <span class="hljs-keyword">VALUES</span> (<span class="hljs-number">19</span>, <span class="hljs-string">&#x27;lily&#x27;</span>, <span class="hljs-number">19</span>);<br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> `stu` <span class="hljs-keyword">VALUES</span> (<span class="hljs-number">25</span>, <span class="hljs-string">&#x27;luci&#x27;</span>, <span class="hljs-number">25</span>);<br></code></pre></td></tr></table></figure>
<p>演示行锁的时候，我们就通过上面这张表来演示一下。</p>
</div></details>
<p><strong>A.</strong> 普通的select语句，执行时，不会加锁。</p>
<p><img src="/static/imgs/loading.gif" data-original="https://cdn.jsdelivr.net/gh/ggw2021/images@main/blogs/Snipaste_2024-04-12_23-54-49.png" alt=""></p>
<p>B. select…lock in share mode，加共享锁，<br>
共享锁与共享锁之间兼容：</p>
<p><img src="/static/imgs/loading.gif" data-original="https://cdn.jsdelivr.net/gh/ggw2021/images@main/blogs/Snipaste_2024-04-12_23-55-20.png" alt=""></p>
<p>共享锁与排他锁之间互斥：</p>
<p><img src="/static/imgs/loading.gif" data-original="https://cdn.jsdelivr.net/gh/ggw2021/images@main/blogs/Snipaste_2024-04-12_23-56-59.png" alt=""></p>
<p>客户端一获取的是id为1这行的共享锁，客户端二是可以获取id为3这行的排它锁的，因为不是同一行数据。 而如果客户端二想获取id为1这行的排他锁，会处于阻塞状态，以为共享锁与排他锁之间互斥。</p>
<p><strong>C.</strong> 排它锁与排他锁之间互斥</p>
<p><img src="/static/imgs/loading.gif" data-original="https://cdn.jsdelivr.net/gh/ggw2021/images@main/blogs/Snipaste_2024-04-12_23-58-02.png" alt=""></p>
<p>当客户端一，执行update语句，会为id为1的记录加排他锁； 客户端二，如果也执行update语句更新id为1的数据，也要为id为1的数据加排他锁，但是客户端二会处于阻塞状态，因为排他锁之间是互斥的。 直到客户端一，把事务提交了，才会把这一行的行锁释放，此时客户端二，解除阻塞。</p>
<p><strong>D.</strong> 无索引行锁升级为表锁</p>
<p>stu表中数据如下:</p>
<p><img src="/static/imgs/loading.gif" data-original="https://cdn.jsdelivr.net/gh/ggw2021/images@main/blogs/Snipaste_2024-04-13_00-01-06.png" alt=""></p>
<p><img src="/static/imgs/loading.gif" data-original="https://cdn.jsdelivr.net/gh/ggw2021/images@main/blogs/Snipaste_2024-04-12_23-59-14.png" alt=""></p>
<p>在客户端一中，开启事务，并执行update语句，更新name为Lily的数据，也就是id为19的记录 。然后在客户端二中更新id为3的记录，却不能直接执行，会处于阻塞状态，为什么呢？</p>
<p>原因就是因为此时，客户端一，根据name字段进行更新时，name字段是没有索引的，如果没有索引，此时行锁会升级为表锁(因为行锁是对索引项加的锁，而name没有索引)。</p>
<p>接下来，我们再针对name字段建立索引，索引建立之后，再次做一个测试：</p>
<p><img src="/static/imgs/loading.gif" data-original="https://cdn.jsdelivr.net/gh/ggw2021/images@main/blogs/Snipaste_2024-04-13_00-00-48.png" alt=""></p>
<p>此时我们可以看到，客户端一，开启事务，然后依然是根据name进行更新。而客户端二，在更新id为3的数据时，更新成功，并未进入阻塞状态。 这样就说明，我们根据索引字段进行更新操作，就可以避免行锁升级为表锁的情况。</p>
<hr>
<br>
<ul>
<li><strong><u>间隙锁&amp;临键锁</u></strong></li>
</ul>
<p>默认情况下，InnoDB在 REPEATABLE READ事务隔离级别运行，InnoDB使用 next-key 锁进行搜索和索引扫描，以防止幻读。</p>
<ul>
<li>索引上的等值查询(唯一索引)，给不存在的记录加锁时, 优化为间隙锁 。</li>
<li>索引上的等值查询(非唯一普通索引)，向右遍历时最后一个值不满足查询需求时，next-key lock 退化为间隙锁。</li>
<li>索引上的范围查询(唯一索引)–会访问到不满足条件的第一个值为止。</li>
</ul>
<blockquote>
<p>注意：间隙锁唯一目的是防止其他事务插入间隙。间隙锁可以共存，一个事务采用的间隙锁不会阻止另一个事务在同一间隙上采用间隙锁。</p>
</blockquote>
<br>
<p><strong>示例演示</strong><br>
<strong>A.</strong> 索引上的等值查询(唯一索引)，给不存在的记录加锁时, 优化为间隙锁 。</p>
<p><img src="/static/imgs/loading.gif" data-original="https://cdn.jsdelivr.net/gh/ggw2021/images@main/blogs/Snipaste_2024-04-13_00-19-39.png" alt=""></p>
<p><strong>B.</strong> 索引上的等值查询(非唯一普通索引)，向右遍历时最后一个值不满足查询需求时，next-key lock 退化为间隙锁。</p>
<p>介绍分析一下：<br>
我们知道InnoDB的B+树索引，叶子节点是有序的双向链表。 假如，我们要根据这个二级索引查询值为18的数据，并加上共享锁，我们是只锁定18这一行就可以了吗？ 并不是，因为是非唯一索引，这个结构中可能有多个18的存在，所以，在加锁时会继续往后找，找到一个不满足条件的值（当前案例中也就是29）。此时会对18加临键锁，并对29之前的间隙加锁。</p>
<p><img src="/static/imgs/loading.gif" data-original="https://cdn.jsdelivr.net/gh/ggw2021/images@main/blogs/Snipaste_2024-04-13_00-20-54.png" alt=""></p>
<p><img src="/static/imgs/loading.gif" data-original="https://cdn.jsdelivr.net/gh/ggw2021/images@main/blogs/Snipaste_2024-04-13_00-21-44.png" alt=""></p>
<p><strong>C.</strong> 索引上的范围查询(唯一索引)–会访问到不满足条件的第一个值为止。</p>
<p><img src="/static/imgs/loading.gif" data-original="https://cdn.jsdelivr.net/gh/ggw2021/images@main/blogs/Snipaste_2024-04-13_00-23-35.png" alt=""></p>
<p>查询的条件为id&gt;=19，并添加共享锁。 此时我们可以根据数据库表中现有的数据，将数据分为三个部分：<br>
[19]<br>
(19,25]<br>
(25,+∞]<br>
所以数据库数据在加锁是，就是将19加了行锁，25的临键锁（包含25及25之前的间隙），正无穷的临<br>
键锁(正无穷及之前的间隙)。</p>
<hr>
<p><br><br><br></p>
<h2 id="运维篇">运维篇</h2>
<hr>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="https://gxblogs.com">ggw &amp; xpl</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://gxblogs.com/posts/51482/">https://gxblogs.com/posts/51482/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://gxblogs.com" target="_blank">GXBLOGS</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库</a></div><div class="post_share"><div class="social-share" data-image="https://cdn.jsdelivr.net/gh/ggw2021/images@main/blogs/Snipaste_2024-04-09_13-37-59.png" data-sites="wechat,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i> 打赏</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="https://cdn.jsdelivr.net/gh/ggw2021/images@main/blogs/Snipaste_2023-01-05_13-03-06.png" target="_blank"><img class="post-qr-code-img" src="/static/imgs/loading.gif" data-original="https://cdn.jsdelivr.net/gh/ggw2021/images@main/blogs/Snipaste_2023-01-05_13-03-06.png" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://cdn.jsdelivr.net/gh/ggw2021/images@main/blogs/Snipaste_2023-01-05_13-04-50.png" target="_blank"><img class="post-qr-code-img" src="/static/imgs/loading.gif" data-original="https://cdn.jsdelivr.net/gh/ggw2021/images@main/blogs/Snipaste_2023-01-05_13-04-50.png" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/38113/"><img class="prev-cover" src="/static/imgs/loading.gif" data-original="https://cdn.jsdelivr.net/gh/ggw2021/images@main/blogs/Snipaste_2024-04-22_19-06-25.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">amis</div></div></a></div><div class="next-post pull-right"><a href="/posts/34219/"><img class="next-cover" src="/static/imgs/loading.gif" data-original="https://cdn.jsdelivr.net/gh/ggw2021/images@main/blogs/Snipaste_2024-03-28_23-17-22.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">C++笔记</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/posts/41468/" title="数据库系统原理"><img class="cover" src="/static/imgs/loading.gif" data-original="https://cdn.jsdelivr.net/gh/ggw2021/images@main/blogs/Snipaste_2023-01-06_16-38-36.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-03-05</div><div class="title">数据库系统原理</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E7%AF%87"><span class="toc-text">基础篇</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E6%A6%82%E8%BF%B0"><span class="toc-text">1. 概述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-SQL"><span class="toc-text">2. SQL</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-SQL%E9%80%9A%E7%94%A8%E8%AF%AD%E6%B3%95%E4%BB%A5%E5%8F%8A%E5%88%86%E7%B1%BB"><span class="toc-text">2.1 SQL通用语法以及分类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-DDL"><span class="toc-text">2.2 DDL</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-DML"><span class="toc-text">2.3 DML</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-4-DQL"><span class="toc-text">2.4 DQL</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-5-DCL"><span class="toc-text">2.5 DCL</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E5%87%BD%E6%95%B0"><span class="toc-text">3. 函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E7%BA%A6%E6%9D%9F"><span class="toc-text">4. 约束</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-1-%E6%A6%82%E8%BF%B0%E4%B8%8E%E6%BC%94%E7%A4%BA"><span class="toc-text">4.1 概述与演示</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-2-%E5%A4%96%E9%94%AE%E7%BA%A6%E6%9D%9F"><span class="toc-text">4.2 外键约束</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A2"><span class="toc-text">5. 多表查询</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-1-%E5%A4%9A%E8%A1%A8%E5%85%B3%E7%B3%BB"><span class="toc-text">5.1 多表关系</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-2-%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A2%E6%A6%82%E8%BF%B0"><span class="toc-text">5.2 多表查询概述</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-3-%E5%86%85%E8%BF%9E%E6%8E%A5"><span class="toc-text">5.3 内连接</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-4-%E5%A4%96%E8%BF%9E%E6%8E%A5"><span class="toc-text">5.4 外连接</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-5-%E8%87%AA%E8%BF%9E%E6%8E%A5"><span class="toc-text">5.5 自连接</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-6-%E5%AD%90%E6%9F%A5%E8%AF%A2"><span class="toc-text">5.6 子查询</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-7-%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A2%E6%A1%88%E4%BE%8B"><span class="toc-text">5.7 多表查询案例</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-%E4%BA%8B%E5%8A%A1"><span class="toc-text">6. 事务</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#6-1-%E4%BA%8B%E5%8A%A1%E7%AE%80%E4%BB%8B"><span class="toc-text">6.1 事务简介</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-2-%E4%BA%8B%E5%8A%A1%E6%93%8D%E4%BD%9C"><span class="toc-text">6.2 事务操作</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-3-%E4%BA%8B%E5%8A%A1%E5%9B%9B%E5%A4%A7%E7%89%B9%E6%80%A7"><span class="toc-text">6.3 事务四大特性</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-4-%E5%B9%B6%E5%8F%91%E4%BA%8B%E5%8A%A1%E9%97%AE%E9%A2%98"><span class="toc-text">6.4 并发事务问题</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-5-%E4%BA%8B%E5%8A%A1%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB"><span class="toc-text">6.5 事务隔离级别</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%9B%E9%98%B6%E7%AF%87"><span class="toc-text">进阶篇</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E"><span class="toc-text">1. 存储引擎</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-MySQL%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84"><span class="toc-text">1.1 MySQL体系结构</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E%E4%BB%8B%E7%BB%8D"><span class="toc-text">1.2 存储引擎介绍</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E%E7%89%B9%E7%82%B9"><span class="toc-text">1.3 存储引擎特点</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-4-%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E%E9%80%89%E6%8B%A9"><span class="toc-text">1.4 存储引擎选择</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E7%B4%A2%E5%BC%95"><span class="toc-text">2. 索引</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-%E7%B4%A2%E5%BC%95%E6%A6%82%E8%BF%B0"><span class="toc-text">2.1 索引概述</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-%E7%B4%A2%E5%BC%95%E7%BB%93%E6%9E%84"><span class="toc-text">2.2 索引结构</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-%E7%B4%A2%E5%BC%95%E5%88%86%E7%B1%BB"><span class="toc-text">2.3 索引分类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-4-%E7%B4%A2%E5%BC%95%E8%AF%AD%E6%B3%95"><span class="toc-text">2.4 索引语法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-5-SQL%E6%80%A7%E8%83%BD%E7%9A%84%E5%88%86%E6%9E%90"><span class="toc-text">2.5 SQL性能的分析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-6-%E7%B4%A2%E5%BC%95%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-text">2.6 索引的使用</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#2-6-1-%E9%AA%8C%E8%AF%81%E7%B4%A2%E5%BC%95%E6%95%88%E7%8E%87"><span class="toc-text">2.6.1 验证索引效率</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-6-2-%E6%9C%80%E5%B7%A6%E5%89%8D%E7%BC%80%E6%B3%95%E5%88%99"><span class="toc-text">2.6.2 最左前缀法则</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-6-3-%E8%8C%83%E5%9B%B4%E6%9F%A5%E8%AF%A2"><span class="toc-text">2.6.3 范围查询</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-6-4-%E7%B4%A2%E5%BC%95%E5%A4%B1%E6%95%88%E6%83%85%E5%86%B5"><span class="toc-text">2.6.4 索引失效情况</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-6-5-SQL%E6%8F%90%E7%A4%BA"><span class="toc-text">2.6.5 SQL提示</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-6-6-%E8%A6%86%E7%9B%96%E7%B4%A2%E5%BC%95"><span class="toc-text">2.6.6 覆盖索引</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-6-7-%E5%89%8D%E7%BC%80%E7%B4%A2%E5%BC%95"><span class="toc-text">2.6.7 前缀索引</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-6-8-%E5%8D%95%E5%88%97%E7%B4%A2%E5%BC%95%E4%B8%8E%E8%81%94%E5%90%88%E7%B4%A2%E5%BC%95"><span class="toc-text">2.6.8 单列索引与联合索引</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-7-%E7%B4%A2%E5%BC%95%E8%AE%BE%E8%AE%A1%E5%8E%9F%E5%88%99"><span class="toc-text">2.7 索引设计原则</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-SQL%E4%BC%98%E5%8C%96%EF%BC%88%E6%9C%AA%E5%AD%A6%EF%BC%89"><span class="toc-text">3. SQL优化（未学）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E8%A7%86%E5%9B%BE%EF%BC%88%E6%9C%AA%E5%AD%A6%EF%BC%89"><span class="toc-text">4. 视图（未学）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B%EF%BC%88%E6%9C%AA%E5%AD%A6%EF%BC%89"><span class="toc-text">5. 存储过程（未学）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-%E8%A7%A6%E5%8F%91%E5%99%A8%EF%BC%88%E6%9C%AA%E5%AD%A6%EF%BC%89"><span class="toc-text">6. 触发器（未学）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-%E9%94%81"><span class="toc-text">7. 锁</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#7-1-%E5%85%A8%E5%B1%80%E9%94%81"><span class="toc-text">7.1 全局锁</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-2-%E8%A1%A8%E7%BA%A7%E9%94%81"><span class="toc-text">7.2 表级锁</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-3-%E8%A1%8C%E7%BA%A7%E9%94%81"><span class="toc-text">7.3 行级锁</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%90%E7%BB%B4%E7%AF%87"><span class="toc-text">运维篇</span></a></li></ol></div></div></div></div></main><footer id="footer" style="background: rgb(112, 112, 112)"><div id="footer-wrap"><div class="copyright">&copy;2023 - 2024 By ggw & xpl</div><div class="footer_custom_text">都是科技与狠活啊</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="chat_btn" type="button" title="聊天"><i class="fas fa-sms"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>function loadValine () {
  function initValine () {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: 'QvVqZWBQWj9Aq2xrw4Z8z8Pz-gzGzoHsz',
      appKey: 'COANudzj20V6IrCfAsD1Ufya',
      avatar: 'robohash',
      serverURLs: '',
      emojiMaps: "",
      path: window.location.pathname,
      visitor: false
    }, null))
  }

  if (typeof Valine === 'function') initValine() 
  else getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js').then(initValine)
}

if ('Valine' === 'Valine' || !false) {
  if (false) btf.loadComment(document.getElementById('vcomment'),loadValine)
  else setTimeout(loadValine, 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script></div><script src="/js/ggwsettings.js"></script><script>(function(d, w, c) {
    w.ChatraID = 'dKkRxvMac7f9AeKhu';
    var s = d.createElement('script');
    w[c] = w[c] || function() {
        (w[c].q = w[c].q || []).push(arguments);
    };
    s.async = true;
    s.src = 'https://call.chatra.io/chatra.js';
    if (d.head) d.head.appendChild(s);
})(document, window, 'Chatra');

if (true) {
  var chatBtnFn = () => {
    var chatBtn = document.getElementById("chat_btn")
    chatBtn.addEventListener("click", function(){
      Chatra('openChat')
    });
  }
  chatBtnFn()
} else {
  if (true) {
    function chatBtnHide () {
      Chatra('hide')
    }
    function chatBtnShow () {
      Chatra('show')
    }
  }
}</script></div><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginModelPath":"assets/","model":{"jsonPath":"/live2dw/assets/tororo.model.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":false},"log":false,"pluginJsPath":"lib/","pluginRootPath":"live2dw/","tagMode":false});</script>
        <style>
            [bg-lazy] {
                background-image: none !important;
                background-color: #eee !important;
            }
        </style>
        <script>
            window.imageLazyLoadSetting = {
                isSPA: false,
                preloadRatio: 1,
                processImages: null,
            };
        </script><script>window.addEventListener("load",function(){var t=/\.(gif|jpg|jpeg|tiff|png)$/i,r=/^data:image\/[a-z]+;base64,/;Array.prototype.slice.call(document.querySelectorAll("img[data-original]")).forEach(function(a){var e=a.parentNode;"A"===e.tagName&&(e.href.match(t)||e.href.match(r))&&(e.href=a.dataset.original)})});</script><script>!function(r){r.imageLazyLoadSetting.processImages=t;var e=r.imageLazyLoadSetting.isSPA,n=r.imageLazyLoadSetting.preloadRatio||1,c=a();function a(){var t=Array.prototype.slice.call(document.querySelectorAll("img[data-original]")),e=Array.prototype.slice.call(document.querySelectorAll("[bg-lazy]"));return t.concat(e)}function t(){e&&(c=a());for(var t,o=0;o<c.length;o++)0<=(t=(t=c[o]).getBoundingClientRect()).bottom&&0<=t.left&&t.top<=(r.innerHeight*n||document.documentElement.clientHeight*n)&&function(){var t,e,n,a,i=c[o];e=function(){c=c.filter(function(t){return i!==t}),r.imageLazyLoadSetting.onImageLoaded&&r.imageLazyLoadSetting.onImageLoaded(i)},(t=i).hasAttribute("bg-lazy")?(t.removeAttribute("bg-lazy"),e&&e()):(n=new Image,a=t.getAttribute("data-original"),n.onload=function(){t.src=a,t.removeAttribute("data-original"),e&&e()},t.src!==a&&(n.src=a))}()}function i(){clearTimeout(t.tId),t.tId=setTimeout(t,500)}t(),document.addEventListener("scroll",i),r.addEventListener("resize",i),r.addEventListener("orientationchange",i)}(this);</script></body></html>